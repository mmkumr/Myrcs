"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[1308],{83606:(e,t,n)=>{n.r(t),n.d(t,{MessageStoreDebugPanel:()=>y});var a=n(23174),i=n.n(a),s=(n(57658),n(32594)),o=n(30817),r=n(11720),d=n(98649),l=n(93382),u=n(17455),c=n(67294),p=n(24405),g=n(72126),h=n(63143),m=n(4827),b=n(75233),v=n(79420),x=n(88536);const w=300,f=1*h.C0,M={...l.j,fontSize:"10px",background:"black",border:"1px solid white",color:"white"},S={fontSize:"10px"};function k(e,t,n){const a=e.slice();return a.push(t),a.length>n&&a.splice(0,a.length-n),a}function y(){window.__c={n:"MessageStoreDebugPanel"};const[e,t]=(0,c.useState)({subscriptions:[],queueSize:[],pendingUnsubscribes:[],pendingEvictions:[]}),n=(0,c.useMemo)((()=>[{pluralName:"subscriptions",stroke:"white",fill:"black",data:e.subscriptions},{pluralName:"queued requests",stroke:"yellow",fill:"transparent",data:e.queueSize},{pluralName:"pending unsubscribes",stroke:"springgreen",fill:"transparent",data:e.pendingUnsubscribes},{pluralName:"pending evictions",stroke:"lightgray",fill:"transparent",data:e.pendingEvictions}]),[e]);(0,c.useEffect)((()=>{const n=window.setTimeout((()=>{const n=(0,x.Tm)(),a=(0,x.EM)(),i=v.Z.getPendingUnsubscribeCount(),s=b.Z.getPendingEvictionCount();t({subscriptions:k(e.subscriptions,n._total,w),queueSize:k(e.queueSize,a.queue,w),pendingUnsubscribes:k(e.pendingUnsubscribes,i,w),pendingEvictions:k(e.pendingEvictions,s,w)})}),f);return()=>window.clearTimeout(n)}),[e]);const a=(0,p.yK)((()=>({panelStyle:{position:"fixed",right:"calc(50% - 160px)",bottom:0,width:"320px",color:"white",background:"rgba(0, 0, 0, 0.75)",padding:"8px"},headingStyle:{fontWeight:600,fontSize:"14px"}})),[]);return i()(m.Z,{open:!0},void 0,i()("div",{style:a.panelStyle},void 0,i()("div",{style:a.headingStyle},void 0,"MessageStore metrics"),i()(C,{width:304,height:64,dataStreams:n,maxDataLength:w,baseMaxDataValue:500,dataPointIntervalMs:f})))}function C(e){window.__c={n:"RealtimeVisualization"};const{width:t,height:n,dataStreams:a,maxDataLength:l,baseMaxDataValue:p,dataPointIntervalMs:m}=e,[b,v]=(0,c.useState)(),x=(0,c.useMemo)((()=>Math.max(p,...g.xH(a.map((e=>e.data))))),[a,p]),w=(0,c.useMemo)((()=>(0,o.Z)({range:[n,0],domain:[0,x],nice:!0})),[n,x]),f=(0,c.useMemo)((()=>(0,o.Z)({range:[0,t],domain:[0,l-1],nice:!0})),[t,l]),k=(0,c.useCallback)((()=>v(void 0)),[]),y=(0,c.useCallback)((e=>{const{x:t}=(0,s.Z)(e)||{x:0},n=Math.round(f.invert(t)),i=a[0].data.length;if(n>=i)return void v(void 0);const o=a[0][n],r=w(o),d=Date.now()-(i-1-n)*m;v({x:t,y:r,dataStreamIndex:n,timestamp:d})}),[f,a,w,m]);return i()("div",{},void 0,i()("svg",{width:t,height:n},void 0,a.map(((e,t)=>i()(r.Z,{data:e.data,x:(e,t)=>f(t),y:e=>w(e),strokeWidth:1,stroke:e.stroke,fill:e.fill,yScale:w},t))),i()(d.Z,{x:0,y:0,width:t,height:n,fill:"transparent",onMouseMove:y,onMouseLeave:k})),b&&i()("div",{},void 0,i()(u.Z,{top:b.y,left:b.x,style:M},Math.random(),i()("div",{style:{color:"darkgray"}},void 0,function(e){const t=Date.now()-e;return t<h.C0?"just now":t<h.hM?`${Math.round(t/h.C0)} seconds ago`:`${(t/h.hM).toFixed(1)} minutes ago`}(b.timestamp)),a.map(((e,t)=>i()("div",{style:{color:e.stroke}},t,e.data[b.dataStreamIndex]," ",e.pluralName))))),i()("div",{style:S},void 0,a.map(((e,t)=>i()("div",{style:{color:e.stroke}},t,0===e.data.length?"0":e.data[e.data.length-1]," ",e.pluralName)))))}}}]);