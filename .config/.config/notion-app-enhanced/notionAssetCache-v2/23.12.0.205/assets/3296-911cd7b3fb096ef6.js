"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3296,5203],{73657:(e,t,o)=>{o.d(t,{Z:()=>d});var i=o(10434),r=o.n(i),n=o(67294),a=o(83355),l=o(28992);class s extends a.Z{renderComponent(){return n.createElement(l.Z,r()({},this.props,{style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...this.props.style}}))}}s.displayName="CaptionMenuItem";const d=s},46247:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(23174),r=o.n(i),n=(o(67294),o(83355)),a=o(84169),l=o(50906),s=o(64921),d=o(16354);class c extends n.Z{renderComponent(){return r()(d.Z,{style:{display:"flex",alignSelf:"stretch",width:36,...this.props.isRight?{marginRight:-8}:{marginLeft:-8}},external:!0,href:this.props.href,onClick:()=>l.Fsx(this.environment,{from:this.props.analyticsFrom})},void 0,r()(s.Z,{mobileFeedback:!0,style:{display:"flex",alignItems:"center",justifyContent:"center",width:"100%"}},void 0,(0,a.m)({width:18,marginTop:1,fill:this.theme.lightIconColor})))}}c.displayName="HelpIconButtonMobile";const p=c},86765:(e,t,o)=>{o.d(t,{Z:()=>u});var i=o(23174),r=o.n(i),n=(o(67294),o(480)),a=o(86628),l=o(24405),s=o(5366),d=o(1018),c=o(31278),p=o(76798);const u=(0,s.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,i=(0,n.Fy)(),u=(0,a.VK)((()=>o.getIcon()),[o]),g=(0,l.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:d.Qi*(i.isRetina?.5:1)}})),[i.isRetina]),h=t?r()("span",{},void 0," ",t," "):r()("span",{},void 0," "),m=r()("div",{style:g.dbName},void 0,r()(c.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:i.isMobile?24:20}),r()(p.Z,{store:o,style:g.title}));return r()("div",{style:{display:"flex",alignItems:"center"}},void 0,r()(s.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>r()("span",{style:g.medium},void 0,e),pageName:h,databaseNameWithIcon:m}}))}))},75203:(e,t,o)=>{o.r(t),o.d(t,{default:()=>B});var i=o(10434),r=o.n(i),n=o(23174),a=o.n(n),l=o(67294),s=o(83355),d=o(39068),c=o(56666),p=o(39132),u=o(61061),g=o(72126),h=o(82990),m=o(5366),y=o(50906),v=o(31869),f=o(96802),b=o(39699),S=o(87279),P=o(29376),R=o(4023),M=o(29798),C=o(73657),k=o(52275),w=o(31945),I=o(79131),x=o(73063),_=o(78140),Z=o(32163),T=o(53437),F=o(72495),D=o(26388);class L extends s.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:M.Z},this.renderRelationPropertyMenuPopup=e=>{const t=this.allRelatedTargetProperties.state;if(!t)return;const o=t.filter((e=>e.visible)),i=t.filter((e=>!e.visible));return a()(_.Z,{menuType:S.og.Popup,maxWidth:240,maxHeight:500},void 0,0===t.length&&a()(F.Z,{},void 0,a()(C.Z,{caption:a()(m.FormattedMessage,{defaultMessage:"No properties",id:"database.relationMenu.noProperties"})})),t.length>0&&a()(Z.Z,{type:Z.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:g.oA([o.length>0&&{key:"visible_and_hidden_properties",render:e=>l.createElement(F.Z,r()({},e,{noTextOverflow:!0,isTitleUppercase:!1,title:a()(m.FormattedMessage,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle"}),desktopTitleStyle:{height:18}}),this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:i,children:e.children})),items:g.oA([...this.renderPropertySortListItems({properties:o,visibility:!0}),i.length>0&&{key:"group-header-hidden-property",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:l.createElement(l.Fragment,null)}),action:()=>{}},...this.renderPropertySortListItems({properties:i,visibility:!1})])},0===o.length&&i.length>0&&{key:"hidden_properties",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:this.renderPropertyDraggableList({visibleProperties:o,hiddenProperties:i,children:e.children})}),items:this.renderPropertySortListItems({properties:i,visibility:!1})}])}))},this.handlePropertyReorder=e=>{const{newPropertyKeys:t}=e,{collectionStore:o,property:i}=this.props,r=P.U1({collectionStore:o,property:i}),n=t.indexOf("group-header-hidden-property"),a=g.oA(t.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const o=r.find((t=>t.property===e));return o?n>0?"title"===e&&t>=n?o:{...o,visible:Boolean(t<n)}:o:{property:e,visible:!(n>0)||Boolean(t<n)}}))),l=r.filter((e=>!t.includes(e.property))),s={...P.ZI(o)};s[i]||(s[i]={}),s[i].related_properties=[...a,...l],b.createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:this.environment,perform:e=>{f.FH({stores:[o],update:{collection_relation_options:s},transaction:e})}}),this.stores.menuListStore.reset()},this.allRelatedTargetProperties=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:o}=this.props,i=P.U1({collectionStore:e,property:o}),r=Object.keys(t.getSchema()).map((e=>i.find((t=>t.property===e))??{property:e,visible:!1})),n=i.map((e=>e.property)),a=e=>{const t=n.indexOf(e);return-1!==t?t:1/0};return r.sort(((e,t)=>a(e.property)-a(t.property))),r}),!0)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone||"section"===this.props.rowType)return a()(D.Z,{renderTooltip:()=>a()(m.FormattedMessage,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties"}),placement:"section"===this.props.rowType?R.u.Top:R.u.Right,render:e=>l.createElement(w.ZP,r()({popupType:T.kQ.Popup,alignmentToOrigin:R.v.Start},e,{renderOrigin:t=>l.createElement(x.Z,r()({icon:c.o,iconStyle:{width:16,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor}},t,e)),onClick:()=>{y.gP4(this.environment,{from:"section"===this.props.rowType?"relation_section":"configure_relation_modal"})},originGap:16,render:this.renderRelationPropertyMenuPopup}))})}renderPropertySortListItems(e){const{properties:t,visibility:o}=e;return g.oA(t.map((e=>this.renderPropertySortListItem({propertyFormat:e,visibility:o}))))}renderPropertyDraggableList(e){const{visibleProperties:t,hiddenProperties:o,children:i}=e,r=g.oA([...t.map((e=>e.property)),t.length>0&&o.length>0&&{key:"group-header-hidden-property",draggable:!1},...o.map((e=>e.property))]);return a()(I.ZP,{direction:"vertical",keys:r,renderKey:(e,t)=>i[t],onDrop:e=>{this.handlePropertyReorder({newPropertyKeys:e})},disabled:this.props.disabled})}renderPropertySortListItem(e){const{propertyFormat:t,visibility:o}=e,i=!o,{collectionStore:n,targetCollectionStore:s,property:c,disabled:g}=this.props,m=this.environment,y=s.getSchema();if(!y)return;const f=y[t.property];if(!f)return;const{theme:b}=this;return{key:t.property,render:e=>l.createElement(k.Z,r()({},e,{showDragHandle:!g,title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(d.ZP,{icon:f.icon,type:f.type,size:16,theme:b,style:{fill:b.regularIconColor}}),a()("span",{style:{marginLeft:8,...h.Z.textOverflowStyle}},void 0,f.name)),right:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(x.Z,{icon:i?u.B:p.c,iconStyle:{width:16,height:16},isDarkIconColor:!i,onClick:()=>{v.qK({propertyFormat:t,visibility:o,collectionStore:n,property:c,environment:m})},disabled:g||"title"===t.property}))})),action:()=>{}}}renderHiddenPropertySectionHeader(e){const{props:t,children:o}=e;return l.createElement(F.Z,r()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:a()(m.FormattedMessage,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle"}),desktopTitleStyle:{height:19},children:o,disableDesktopPadding:!0}))}}L.displayName="RelationPropertyCustomizeLayoutMenu";const B=L},49122:(e,t,o)=>{o.d(t,{Z:()=>p});var i=o(23174),r=o.n(i),n=(o(67294),o(480)),a=o(24405),l=o(41892),s=o(82990),d=o(5366),c=o(32662);function p(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,d.useIntl)(),o=function(e){const{isMobile:t}=(0,n.Fy)(),o=t?18:14,i=1,r=6,l=20;return(0,a.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:l,border:`${i}px solid ${t.tableDividerColor}`,borderRadius:r,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${l}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:s.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:r,color:t.regularTextColor,verticalAlign:"text-bottom",...s.Z.textOverflowStyle}})),[o,e])}(e.width),i=r()("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow},void 0,r()("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle},void 0,r()(c.Z,{size:2}),"[",r()("div",{id:"github-preview-github-pr-task",style:o.githubTask},void 0,e.uniqueIdPrefix||t.formatMessage(u.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"),"]",r()(c.Z,{size:2}),t.formatMessage(u.prTitle))),p=r()("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow},void 0,r()("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill},void 0,r()("img",{src:l.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),r()(c.Z,{size:2}),r()("div",{style:o.githubPrInfoOpenText},void 0,t.formatMessage(u.open))),r()(c.Z,{size:8}),r()("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto},void 0,r()("span",{style:o.githubPrInfoMergeInto},void 0,t.formatMessage(u.mergeInto),r()(c.Z,{size:4}),r()("span",{style:o.githubPrInfoMain},void 0,t.formatMessage(u.main)))));return r()("div",{id:"github-preview-github-container",style:o.githubContainer},void 0,i,r()(c.Z,{size:12}),p)}const u=(0,d.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},53296:(e,t,o)=>{o.r(t),o.d(t,{default:()=>Zt});var i=o(10434),r=o.n(i),n=o(23174),a=o.n(n),l=(o(57658),o(21703),o(67294)),s=o(83355),d=o(1302),c=o(480),p=o(86628),u=o(24405),g=o(15145),h=o(99036),m=o(80951),y=o(43690),v=o(1800),f=o(45433),b=o(96449),S=o(77657),P=o(92785),R=o(42875),M=o(47453),C=o(91155),k=o(59753),w=o(4615),I=o(74446),x=o(21202),_=o(3791),Z=o(82990),T=o(5366),F=o(50906),D=o(8406),L=o(54642),B=o(14871),V=o(47307),E=o(9953),A=o(75018),U=o(31299),O=o(39699),K=o(61202),N=o(52275),q=o(36488),G=o(74194),z=o(68894),H=o(84076),W=o(78140),Q=o(53437),j=o(31278),$=o(76798),Y=o(77137),X=o(72495),J=o(46247),ee=o(86765);function te(e){window.__c={n:"RelationCreateNewRow"};const{targetCollectionStore:t,title:o,onClick:i,focused:r,isSection:n,index:s}=e,d=(0,p.VK)((()=>t.canEdit()),[t]),g=(0,p.VK)((()=>t.isSyncedCollection()),[t]),h=(0,c.Fy)(),m=(0,u.yK)((e=>({wrapper:{borderTop:`1px solid ${e.lightDividerColor}`,paddingTop:4,paddingBottom:4},icon:{width:16,fill:e.mediumIconColor,marginRight:4,marginLeft:-2},row:{fontSize:h.isMobile?16:14,minHeight:h.isMobile?44:32}})),[h]);if(!d)return null;const y=a()(N.Z,{focused:r,icon:(0,M.R)(m.icon),style:m.row,onClick:()=>i(s),title:a()(ee.Z,{targetCollectionStore:t,title:o})});return g?l.createElement(l.Fragment,null):n?a()(X.Z,{style:m.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0},void 0,y):y}var oe=o(66890),ie=o(91309),re=o(70764),ne=o(75079),ae=o(33929),le=o(87279),se=o(70219),de=o(65598),ce=o(18514),pe=o(18245),ue=o(80444),ge=o(77080),he=o(30874),me=o(57559),ye=o(72087),ve=o(78291),fe=o(51741),be=o(49085);class Se extends be.default{getInitialState(){return{searchQuery:"",searchLimit:Se.limitIncrement,searchPopupOpen:!1,addingPage:!1}}}Se.limitIncrement=20,Se.incrementScrollOffset=200;const Pe=Se;o(30541);var Re=o(72126),Me=o(60971),Ce=o(14473),ke=o(79131),we=o(68785),Ie=o(32163),xe=o(53336),_e=o(43145),Ze=o(26388),Te=o(68139),Fe=o(89767);function De(e){window.__c={n:"RelationMoveToBacklog"};const{targetCollectionStore:t,onClick:o,focused:i,isSection:r,index:n,onMouseEnter:s,blockPropertyValueOverlayStore:d}=e,g=(0,p.VK)((()=>t.canEdit()),[t]),h=(0,p.VK)((()=>t.isSyncedCollection()),[t]),m=(0,c.Fy)(),y=(0,u.yK)((e=>({medium:{fontWeight:Z.Z.fontWeight.medium},wrapper:{borderTop:`1px solid ${e.lightDividerColor}`},icon:{width:14,fill:"#A6A299",marginRight:-2,marginLeft:0},row:{fontSize:m.isMobile?16:14,minHeight:m.isMobile?44:32}})),[m]),v=a()(N.Z,{focused:i,onMouseEnter:s,icon:(0,Fe.R)(y.icon),style:y.row,onClick:(0,l.useCallback)((()=>{o(n),d.setState({isOpen:!1})}),[n,o,d]),title:a()(T.FormattedMessage,{id:"database.searchRelation.MoveToBacklogFooter",defaultMessage:"<medium>Move to backlog</medium>",values:{medium:e=>a()("span",{style:y.medium},void 0,e)}})}),f=r?a()(X.Z,{style:y.wrapper,disableDesktopPadding:!0,disableMobilePadding:!0},void 0,v):v;return g?h?null:f:null}var Le=o(75203),Be=o(73744),Ve=o(98742),Ee=o(34859),Ae=o(45452),Ue=o(29798),Oe=o(30120),Ke=o(8848),Ne=o(7057),qe=o(53877),Ge=o(84795),ze=o(59054),He=o(20270),We=o(75071),Qe=o(18613),je=o(44876),$e=o(63143),Ye=o(42631),Xe=o(12981),Je=o(95477),et=o(24990),tt=o(6398),ot=o(12534),it=o(1634);function rt(){window.__c={n:"FigmaRelationPropertyMenuResults"};const e=(0,c.O7)(),t=function(){const e=(0,c.Fy)().isMobile;return(0,u.yK)((t=>({figmaResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},figmaResultsCopyWrapper:{marginTop:0,color:t.lightTextColor}})),[e])}();return e.device.isMobile?l.createElement(l.Fragment,null):l.createElement(l.Fragment,null,a()("div",{style:t.figmaResults},void 0,a()("p",{style:t.figmaResultsCopyWrapper},void 0,a()(T.FormattedMessage,{defaultMessage:"To link, paste the Figma File URL above",id:"connectedRelationPropertyMenuResults.figmaRelationUserEducationPasteUrl.description"}))))}var nt=o(90559),at=o(75553),lt=o(84169),st=o(74882),dt=o(16956),ct=o(49122),pt=o(64921),ut=o(61519),gt=o(32662),ht=o(75081);const mt=(0,T.defineMessages)({githubCopyIdAria:{defaultMessage:"Copy the ID value.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyIdAria"},githubAddIdAria:{defaultMessage:"Add a unique id property to the database.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addIdAria"},githubLearnMoreAria:{defaultMessage:"Learn more about the GitHub Pull Requests feature.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMoreAria"}});function yt(e){window.__c={n:"GithubRelationPropertyMenuResults"};const{pageBlockStore:t,blockPropertyValueOverlayStore:o}=e,i=(0,c.O7)(),r=(0,T.useIntl)(),n=vt(),s=(0,oe.Y$)(),d=(0,p.VK)((()=>s.collectionStore()),[s]),u=(0,p.VK)((()=>s.databaseType),[s]),g=(0,p.VK)((()=>{var e;return d&&(null===(e=d.getRecordKeyStore())||void 0===e?void 0:e.getRecordKey())}),[d]),{uniqueIdPropertyId:h,uniqueIdValue:y}=(0,p.VK)((()=>{const e=t.getSchema(),o=(0,nt.$z)(e);if(1!==o.length)return{uniqueIdPropertyId:void 0,uniqueIdValue:void 0};const i=t.getPropertyValue(o[0]);return{uniqueIdPropertyId:o[0],uniqueIdValue:(0,m.ah)(i)}}),[t]),v=(0,p.VK)((()=>(0,nt.wf)(g,y)),[g,y]),f=(0,p.VK)((()=>!Boolean(g)||!Boolean(y)),[g,y]);return l.createElement(l.Fragment,null,a()("div",{style:n.githubResults},void 0,a()(ft,{}),a()("p",{style:n.githubResultsCopyWrapper},void 0,a()(T.FormattedMessage,f?{defaultMessage:"Create a prefixed ID property to paste in the GitHub PR title.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.badIdError"}:{defaultMessage:"Copy the {singleItemName} ID and paste it into the title of your PR in GitHub.",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationLinkPastingOn.description",values:{singleItemName:(0,ht.sN)(u)}})),a()(ct.Z,{width:"100%",uniqueIdPrefix:g,uniqueIdValue:y})),a()("div",{style:n.githubResultsButtonsWrapper},void 0,a()(pt.Z,{style:n.githubResultsLearnMore,ariaLabel:r.formatMessage(mt.githubLearnMoreAria),onClick:e=>{e.preventDefault(),A.navigateToExternalURL({environment:i,url:(0,ce.UY)("guides.githubRelation"),targetSelf:!1})}},void 0,(0,lt.m)({width:i.device.isMobile?16:12}),a()(gt.Z,{size:4}),a()(T.FormattedMessage,{defaultMessage:"Learn more",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.learnMore"})),f?a()(pt.Z,{style:n.githubResultsCTAButton,ariaLabel:r.formatMessage(mt.githubAddIdAria),onClick:async e=>{e.preventDefault(),d&&(await st.K({environment:i,collectionStore:d}),O.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:i,perform:e=>{dt.G3({environment:i,collectionStore:d,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:e})}}),D._H({environment:i,collectionContextStore:s,from:"github_relation_menu",property_type:"auto_increment_id",integration_id:S.U9}))}},void 0,(0,M.R)({width:i.device.isMobile?16:12}),a()(gt.Z,{size:4}),a()(T.FormattedMessage,{defaultMessage:"Add ID property",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.addId"})):a()(pt.Z,{style:n.githubResultsCTAButton,ariaLabel:r.formatMessage(mt.githubCopyIdAria),onClick:async e=>{e.preventDefault(),await B.RD({stringValue:v,environment:i,copiedMessage:B.tq.copiedPropertyToClipboard}),h&&D.S$(i,s,{block_id:t.id,property:h,property_type:"auto_increment_id",github_relation_menu:!0}),o.setState({isOpen:!1})}},void 0,(0,at.U)({width:i.device.isMobile?16:12}),a()(gt.Z,{size:4}),a()(T.FormattedMessage,{defaultMessage:"Copy {singleItemName} ID",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducation.copyId",values:{singleItemName:(0,ht.sN)(u)}}))))}function vt(){const e=(0,c.Fy)().isMobile;return(0,u.yK)((t=>({githubResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4},githubResultsCopyWrapper:{marginTop:0,color:t.lightTextColor},githubResultsErrorWrapper:{marginTop:0,color:Ke.ZP.red},githubResultsButtonsWrapper:{width:"100%",display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",fontSize:e?16:12,padding:"10px"},githubResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.lightTextColor},githubResultsCTAButton:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5,color:t.blueColor},githubLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},githubLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},githubLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.popoverBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}function ft(){window.__c={n:"GithubPropertyLinkPastingUserEducation"};const e=vt();return l.createElement(l.Fragment,null,a()("p",{style:e.githubResultsCopyWrapper},void 0,a()(T.FormattedMessage,{defaultMessage:"To link, paste the GitHub PR URL above",id:"connectedRelationPropertyMenuResults.githubPrRelationUserEducationPasteUrl.description"})),a()("div",{style:e.githubLinkPastingContainer},void 0,a()(ut.Z,{size:1,style:e.githubLinkPastingSeparator}),a()("div",{style:e.githubLinkPastingSeparatorText},void 0,"or")),a()(gt.Z,{size:8}))}var bt=o(28415);function St(e){window.__c={n:"GoogleDriveRelationPropertyMenuResults"};const t=(0,c.O7)(),o=function(){const e=(0,c.Fy)().isMobile;return(0,u.yK)((t=>({googleDriveResults:{display:"flex",flexDirection:"column",alignItems:"flex-start",fontSize:e?16:12,padding:16,paddingBottom:4,paddingTop:4},googleDriveResultsCopyWrapper:{marginTop:0,color:t.lightTextColor,marginBottom:0},googleDriveResultsLearnMore:{display:"flex",flexDirection:"row",alignItems:"center",padding:4,borderRadius:5},googleDriveResultsAccount:{fontSize:12,margin:0},googleDriveLinkPastingSeparator:{border:t.tableDividerColor,width:"100%"},googleDriveLinkPastingContainer:{width:"100%",position:"relative",display:"flex",justifyContent:"center",alignItems:"center",margin:"8px 0px"},googleDriveLinkPastingSeparatorText:{position:"absolute",backgroundColor:t.cardContentBackground,color:t.lightTextColor,padding:"0px 8px"}})),[e])}(),i=(0,p.VK)((()=>he.Z.externalAuthentications.state.filter((e=>{let{integration_id:t}=e;return t===S.f3}))),[]);return t.device.isMobile?l.createElement(l.Fragment,null):l.createElement(l.Fragment,null,a()("div",{style:o.googleDriveResults},void 0,a()("p",{style:o.googleDriveResultsCopyWrapper},void 0,a()(T.FormattedMessage,{defaultMessage:"To link, paste the Google Drive File URL above",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationPasteUrl.description"})),a()("div",{style:o.googleDriveLinkPastingContainer},void 0,a()(ut.Z,{size:1,style:o.googleDriveLinkPastingSeparator}),a()("div",{style:o.googleDriveLinkPastingSeparatorText},void 0,"or")),a()(gt.Z,{size:2}),a()("p",{style:o.googleDriveResultsCopyWrapper},void 0,a()(T.FormattedMessage,{defaultMessage:"Select an account below to browse files on your Google Drive",id:"connectedRelationPropertyMenuResults.googleDriveRelationUserEducationSourcePicker.description"})),a()(gt.Z,{size:2}),i.map(((i,r)=>a()(pt.Z,{style:o.googleDriveResultsLearnMore,onClick:async o=>{o.preventDefault(),await(async(o,i)=>{const r=await K.jh({environment:t,externalAuthenticationValue:i}),n=he.Z.integrations.state.find((e=>e.id===i.integration_id));if(!n)return;const{id:a,name:l,info:s}=n,{icon:d,dark_icon:c,accent_color:p,accent_icon:u}=s,g="dark"===t.ThemeStore.state.mode&&c?c:d;g&&p&&u&&r&&"failed"!==r.type&&await(0,bt.vE)({environment:t,accessToken:r.data.access_token,callback:(t,i)=>{e.onFileSelect(o,i)},integration:{id:a,name:l,icon:g,accentColor:p,accentIcon:u},from:"connected_relation_property_value"})})(o,i)}},r,a()("p",{style:o.googleDriveResultsAccount},void 0,a()(T.FormattedMessage,{defaultMessage:"{account}",id:"connectedRelationPropertyMenuResults.googleDriveRelation.googleDriveAccount.description",values:{account:i.account_name}})))))))}function Pt(e){var t;window.__c={n:"ConnectedRelationPropertyMenuResults"};const{sections:o,collectionStore:i,targetCollectionStore:n,search:s,property:d,propertySchema:g,pageRecordStore:h,blockPropertyValueOverlayStore:y}=e,v=(0,u.yK)((e=>({settingsMenu:{display:"flex",flexGrow:1,flexDirection:"column",padding:"8px 16px 16px 8px"},settingsMenuSearchBox:{background:e.contentBackground,marginBottom:10},addPageButton:{width:"100%",display:"flex",justifyContent:"center"},suggestionBox:{display:"flex",alignItems:"center",fontSize:12,color:Ke.ZP.white,background:Ke.ZP.blue,borderRadius:6,padding:10,boxShadow:e.largeLightBoxShadow,alignSelf:"center",maxWidth:"80%"},errorMessage:{alignSelf:"center",padding:10,fontSize:14,color:e.errorText},addingPage:{width:"100%",padding:10,display:"flex",justifyContent:"flex-start",fontSize:14,color:e.mediumTextColor}})),[]),f=m.Kp(g),b=m.gg(g),P=m.ic(g),M=(0,p.VK)((()=>{if(!n)return;const e=n.getFormat().integration_id;return he.Z.integrations.state.find((t=>t.id===e))}),[n]),C=(0,p.VK)((()=>M?(0,re.NP)(M.id):[]),[M]),I=(0,c.O7)(),_=(0,T.useIntl)(),Z=(0,u.Fg)(),F=(0,p.VK)((()=>{const e=he.Z.state;return e.loaded?e.integrations:[]}),[]),D=(0,p.VK)((()=>{var e;return Boolean(null===(e=ue.default.state.currentSpaceStore)||void 0===e?void 0:e.canAdmin())}),[]),B=(0,p.VK)((()=>{var e;return!(!(null===(e=ue.default.state.currentSpaceStore)||void 0===e?void 0:e.canEdit())||!(0,re.sw)(I))}),[I]),V=(0,p.VK)((()=>{const e=he.Z.state;return e.loaded&&M?e.externalAuthentications.filter((e=>e.integration_id===M.id)):[]}),[M]),E=(0,p.VK)((()=>V.length?V[0]:null),[V]),[{value:A,status:U}]=(0,ze.r5)((async()=>{if(!E||!M||!(0,S.ok)(M.id))return;const e=E.parent_id;return L.listExternalObjects(I,{bot_id:e,query:s})}),[I,E,s,M],{debounce:1e3}),O=(0,p.VK)((()=>n.getFormat().pattern_name),[n]),K=(0,p.VK)((()=>{if(M&&s)return Rt({integration:M,patternName:O,url:s})}),[O,M,s]),q=(0,de.NZ)(h)?h:void 0,G=(0,de.NZ)(h)?h.getPropertyStore(d):void 0,z=(0,p.VK)((()=>null==n?void 0:n.getIcon()),[n]),H=(0,p.VK)((()=>{var e;return null===(e=ue.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),W=(0,p.VK)((()=>et.Z.state),[]),Q={key:"githubPrRelationUserEducation",render:e=>void 0!==q&&a()(yt,{pageBlockStore:q,blockPropertyValueOverlayStore:y}),items:[]},j={key:"googleDriveRelation",render:t=>a()(St,{onFileSelect:(t,o)=>{(0,ot.ZP)({context:ot.Af.ButtonMouseDown,callback:()=>{e.addPage(o)},event:t})}}),items:[]},$={key:"figmaRelation",render:e=>a()(rt,{}),items:[]};if(!i||!G||!M)return a()(Ie.Z,{type:Ie.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:o});if(!((null==M?void 0:M.id)===S.U9?null===(t=C[0])||void 0===t?void 0:t.id:null==E?void 0:E.parent_id)){const e=function(e){const{collectionIcon:t,integration:o,environment:i,spaceId:n,isAdmin:s,userAllowedToAuth:d}=e,c=o.id===S.U9,p=()=>{n&&(Ye.hM({environment:i,integration:o,spaceId:n,from:"connected_relation_property_menu"}),it.Z.reset())};if([S.f3,S.mQ].includes(e.integration.id)&&e.environment.device.isMobile)return{key:"authenticateIntegrationgoogledrive",render:e=>l.createElement(X.Z,r()({},e,{disableMobilePadding:!0,title:a()("div",{style:{whiteSpace:"normal",paddingTop:8}},void 0,a()(T.FormattedMessage,{defaultMessage:"Please authorize this integration in the browser or a desktop app.",id:"connectedRelationProperty.mobile.guide.title"}))})),items:[]};return{key:"authenticateIntegration",render:e=>l.createElement(X.Z,r()({},e,{disableMobilePadding:!0,title:a()(T.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateHeader.title",values:{integration:o.name}})})),items:[!c||s&&d?{key:"authenticateButton",render:e=>l.createElement(N.Z,r()({},e,{title:a()(T.FormattedMessage,{defaultMessage:"Connect to {integration}",id:"connectedRelationPropertyMenuResults.authenticateButton.title",values:{integration:o.name}}),icon:a()(Xe.Z,{src:null==t?void 0:t.icon,style:{width:14}})})),action:()=>p()}:{key:"askAdminToAuthenticateButton",render:e=>l.createElement(N.Z,r()({},e,{title:a()("div",{style:{whiteSpace:"normal"}},void 0,a()(T.FormattedMessage,{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"connectedRelationPropertyMenuResults.askAdminToAuthenticateButton.title"})),icon:a()(Xe.Z,{src:null==t?void 0:t.icon,style:{width:14}}),hoveredStyle:{cursor:"default",background:void 0},pressedStyle:{background:void 0}})),action:()=>{}}]}}({environment:I,collectionStore:i,integration:M,collectionIcon:z,spaceId:H,isAdmin:D,userAllowedToAuth:B});return a()(Ie.Z,{type:Ie.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,e]})}const Y=("success"===(null==A?void 0:A.type)&&"data"in A.data?A.data.data:[]).map((e=>{const t=e.attributes.flatMap((e=>{const t=(0,je.GY)(e);return(0,He.nj)(t)?[t]:(console.error(t),[])})),o=(0,$e.m8)(t.flatMap((e=>[[e.id,e]])));return{uri:e.uri,attributes:t,attributesById:o}}));function J(){let e=a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addPageButton.label",defaultMessage:"Link Page"});return(null==M?void 0:M.id)===S.f3||(null==M?void 0:M.id)===S.mQ?e=a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addFileButton.label",defaultMessage:"Link File"}):(null==M?void 0:M.id)===S.Nw?e=a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addTicketButton.label",defaultMessage:"Link Ticket"}):(null==M?void 0:M.id)===S.U9&&(e=a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.addPRButton.label",defaultMessage:"Link PR"})),e}const ee={key:"thirdPartySearchResults",render:e=>l.createElement(X.Z,r()({},e,{disableMobilePadding:!0})),items:[{key:"addPage",render:e=>l.createElement(N.Z,r()({},e,{title:J(),icon:(0,We.f)({width:14})})),action:t=>{(0,ot.ZP)({event:t,context:ot.Af.ButtonMouseDown,callback:()=>{e.addPage()}})}}]},te={key:"noResultsFoundInThirdParty",render:e=>l.createElement(X.Z,r()({},e,{disableMobilePadding:!0,title:a()(T.FormattedMessage,{defaultMessage:"No results found in {integration}.",id:"connectedRelationPropertyMenuResults.notMatched.help",values:{integration:M.name}})})),items:[]},oe=[];M&&(0,S.ok)(M.id)&&oe.push(...function(e){const{environment:t,intl:o,theme:i,externalIntegrations:n,emojiData:s}=e,d=e.results.flatMap((e=>{const t=e.attributesById.start;if(t&&(0,je.Gc)(t)){const i=(0,qe.NK)(t.values[0],(0,R.r)(),o.locale);return[{...e,dateTime:i.start}]}return[]})),c=Re.vM(d,(e=>e.dateTime.toFormat(qe.Iq))),p=Re.MR(Object.keys(c),(e=>Oe.ou.fromFormat(e,qe.Iq).valueOf()));return p.flatMap((d=>{const p=c[d],u=Re.MR(p,(e=>e.dateTime.valueOf())),g=(0,Ge.parseDateTimeRangeString)(d);if(!g)return[];let h;(Re.Xy(g,(0,qe.Lg)((0,R.r)()))||Re.Xy(g,(0,qe.Ro)((0,R.r)())))&&(h="relative");const m=(0,Ne.ZV)({value:g,intl:o,allowRelativeDates:Boolean(h),date_format:h});return[{key:m,items:u.flatMap((d=>{const c=new me.G(t,{table:x.iU,id:(0,w.ZP)(),spaceId:(0,w.ZP)()}),p={id:c.id,type:"external_object_instance",alive:!0,format:{bot_id:"",external_object_id:"",uri:d.uri,attributes:d.attributes},version:0,space_id:"",parent_id:"",parent_table:"block"};let u=null,g=null;const h=d.attributesById.title,m=d.attributesById.start,y=d.attributesById.end;return m&&y&&(0,je.Gc)(m)&&(0,je.Gc)(y)&&(u=a()("div",{},void 0,a()("span",{},void 0,a()(tt.r4,{style:{color:void 0,display:"inline"},attribute:m,dateStyle:"exact_time",intl:o})," - ",a()(tt.r4,{attribute:y,dateStyle:"exact_time",style:{color:void 0,display:"inline"},intl:o}))),g=a()("div",{},void 0,a()("span",{},void 0,a()(tt.ox,{style:{color:void 0,display:"inline"},store:c,attribute:h})),u)),{key:d.uri,render:e=>a()(Ze.Z,{renderTooltip:()=>g,placement:Ze.Z.Placement.Left,textWrap:!0,render:a=>l.createElement(N.Z,r()({},(0,Ve.Z)(a||{},e),{title:(0,Qe.dD)({blockModel:k.kk.fromBlock(p),intl:o,index:0,style:{},disableHover:!0,disableLinks:!0,isAndroid:!1,theme:i,baseUrl:Je.default.domainBaseUrl,emojiType:"raw",currentUserId:t.currentUser.id,getRecordModel:c.getRecordModel,externalIntegrations:n,emojiData:s}),caption:u}))}),action:t=>{(0,ot.ZP)({event:t.event,context:ot.Af.ButtonMouseDown,callback:()=>{e.addPage(d.uri)}})}}})),render:e=>l.createElement(X.Z,r()({},e,{disableMobilePadding:!0,title:m}))}]}))}({environment:I,intl:_,theme:Z,externalIntegrations:F,results:Y,addPage:e.addPage,emojiData:W}));const ie={key:"loadingSpinner",render:t=>l.createElement(X.Z,r()({},t,{disableMobilePadding:!0,title:a()("div",{style:{...v.addingPage,justifyContent:e.addingPage?"center":"flex-start"}},void 0,a()(we.Z,{}),a()("span",{style:{marginLeft:10}},void 0,a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.fetchingData",defaultMessage:"Fetching data..."})))})),items:[]},ne=[];return"pending"===U||e.addingPage?ne.push(ie):K?ne.push(ee):oe.length>0?ne.push(...oe):b?ne.push(j):P?ne.push($):f&&0===o.length?ne.push(Q):f&&o.length>0||ne.push(te),a()(Ie.Z,{type:Ie.i.Vertical,style:{padding:"4px 0px"},initialFocus:0,sections:[...o,...ne]})}const Rt=e=>{var t;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((t=>{var o;return t.name===e.patternName&&(null===(o=t.additional_types)||void 0===o?void 0:o.connectedRelation)})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))};class Mt extends s.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:Ue.Z,draggableListStore:Ae.Z},this.handleDraggableListDrop=(e,t)=>{const{onDrag:o}=this.props,{menuListStore:i}=this.stores;o&&o(e),Me.sv({store:i,focus:{section:0,indexLocal:t.endPosition,indexGlobal:t.endPosition}})},this.hasLimit=()=>{const{property:e,schema:t}=this.props,o=t[e];return Boolean(o&&"relation"===o.type&&1===o.limit)}}didUpdate(e){const{menuListStore:t}=this.stores,{device:o}=this.environment;!this.props.searchQuery||Re.Xy(e.searchQuery,this.props.searchQuery)||o.isMobile||t.setState({...t.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}renderComponent(){const{device:e}=this.environment;return e.isMobile?this.renderMobileResults():this.renderDesktopResults()}renderDesktopResults(){const{results:e,loading:t,onScrollOffsetChange:o}=this.props,i=0===e.length;return a()(l.Fragment,{},void 0,a()(xe.Z,{style:{width:"100%",maxHeight:300,position:"relative",...i&&{marginTop:0}},type:Ee.Z.Y},void 0,this.renderRowsMenuList(e),t&&a()(Ct,{}),o&&a()(_e.Z,{onChange:o})))}renderMobileResults(){const{results:e,loading:t,resultsType:o}=this.props,i=0===e.length,r=this.props.schema[this.props.property];return Boolean("relation"===(null==r?void 0:r.type)&&r.connectedRelation)&&i?a()("div",{style:{marginTop:20}},void 0,a()(Pt,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:this.props.collectionStore,targetCollectionStore:this.props.targetCollectionStore,sections:[],propertySchema:r,property:this.props.property,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore,addPage:this.props.addPage,addingPage:this.props.addingPage})):a()(l.Fragment,{},void 0,i&&!t&&"existing"===o?void 0:this.renderRowsMenuList(e),t&&a()(Ct,{}))}renderRowsMenuList(e){const{parentStore:t,collectionStore:o,targetCollectionStore:i,property:n,canDrag:s,canConfigureCollection:d,loading:c,onCreatePage:p,handleClearProperty:u,overlayMode:g,disabled:h}=this.props,{device:m}=this.environment,y=this.props.schema[n],v=Boolean("relation"===(null==y?void 0:y.type)&&y.connectedRelation),b=i.getFormat().integration_id,P=e=>{let t=a()(T.FormattedMessage,{id:"database.relationProperty.relatedPages.subHeader",defaultMessage:"{count, plural, one {{count} linked page} other {{count} linked pages}}",values:{count:e}});return b&&([S.f3,S.mQ].includes(b)?t=a()(T.FormattedMessage,{id:"database.relationProperty.relatedGoogleDriveOrFigmaFiles.subHeader",defaultMessage:"{count, plural, one {{count} linked file} other {{count} linked files}}",values:{count:e}}):b===S.U9&&(t=a()(T.FormattedMessage,{id:"database.relationProperty.relatedGithubPages.subHeader",defaultMessage:"{count, plural, one {{count} linked PR} other {{count} linked PRs}}",values:{count:e}}))),t},R=i.getFormatStore().getKeyStore("app_config_uri").getValue()===f.p$,M=[],C=[],k=e.filter((e=>{let{pageResult:t}=e;return t.type===fe.Rt.SelectedPage})).length;e.map((e=>{if(e.pageResult.type===fe.Rt.SearchPage){me.G.createChildStore(t,e.pageResult.pointer).isTemplate()||C.push(this.renderRowMenuItem(e,e.pageResult.pointer,k))}else e.pageResult.type===fe.Rt.SelectedPage&&M.push(this.renderRowMenuItem(e,e.pageResult.pointer,k))}));const w=[];if(M.length>0){const e=M.map((e=>e.key.toString()));w.push({key:"results",render:t=>l.createElement(kt,r()({},t,{title:R?void 0:this.hasLimit()?a()(T.FormattedMessage,{id:"database.relationProperty.relatedPages.limit.subHeader",defaultMessage:"Linked page"}):P(M.length),collectionStore:o,targetCollectionStore:i,property:n,showRight:"add"!==(null==g?void 0:g.type),disabled:!d,style:{paddingBottom:R?0:4}}),s&&!this.hasLimit()&&e.length>1?a()(ke.ZP,{direction:"vertical",keys:e,renderKey:o=>t.children[e.indexOf(o)],onDrop:this.handleDraggableListDrop,store:this.stores.draggableListStore}):t.children),items:M})}if(!v&&(0===C.length&&0===M.length||C.length>0)){const e=R||c?void 0:C.length>0?M.length>0?a()(T.FormattedMessage,{id:"database.relationProperty.unrelatedPages.anotherPage.subHeader",defaultMessage:"Link another page"}):a()(T.FormattedMessage,{id:"database.relationProperty.unrelatedPages.subHeader",defaultMessage:"Link a page"}):a()(T.FormattedMessage,{id:"database.relationProperty.noResults.subHeader",defaultMessage:"No results"});let t;c||0!==C.length||m.isMobile||v||!this.props.searchQuery||!(R&&C.length<1)&&R||(C.push({key:"empty",render:e=>a()(te,{targetCollectionStore:i,title:this.props.searchQuery||"",focused:e.focused,onClick:p,isSection:!1,index:this.props.index}),action:()=>{p&&p()}}),t={paddingBottom:0}),R&&(t={paddingBottom:0});const s={key:"unrelated",render:a=>l.createElement(kt,r()({},a,{title:e,collectionStore:o,targetCollectionStore:i,property:n,showRight:0===M.length||"add"===(null==g?void 0:g.type),disabled:!d,style:t})),items:C};"add"===(null==g?void 0:g.type)?w.unshift(s):w.push(s)}const I=[];let x;if(R&&!m.isMobile&&M.length>0&&!h){I.push({key:"sprints_backlog",render:e=>a()(De,{focused:e.focused,onMouseEnter:e.onMouseEnter,targetCollectionStore:i,onClick:u,isSection:!1,index:this.props.index,blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore}),action:()=>{u&&u()}}),x={paddingBottom:0,paddingTop:0};const e={key:"backlog",render:e=>l.createElement(kt,r()({},e,{collectionStore:o,targetCollectionStore:i,property:n,showRight:0===M.length||"add"===(null==g?void 0:g.type),disabled:!d,style:x})),items:I};w.push(e)}return v?a()(Pt,{blockPropertyValueOverlayStore:this.props.blockPropertyValueOverlayStore,collectionStore:o,targetCollectionStore:i,sections:w,propertySchema:y,property:n,pageRecordStore:this.props.parentStore,search:this.props.searchQuery,relationPropertyMenuStore:this.props.relationPropertyMenuStore,addPage:this.props.addPage,addingPage:this.props.addingPage}):a()(Ie.Z,{type:Ie.i.Vertical,store:this.stores.menuListStore,style:{padding:"4px 0px"},initialFocus:this.environment.device.isMobile?void 0:0,sections:w})}renderRowMenuItem(e,t,o){const{disabled:i,canDrag:n,parentStore:s,collectionStore:d,targetCollectionStore:c,onAccept:p,property:u,blockPropertyValueOverlayStore:g}=this.props,h=me.G.createChildStore(s,t),m=this.props.targetCollectionStore.getFormatStore().getKeyStore("app_config_uri").getValue()===f.p$;let y=n&&!this.hasLimit()&&!m;o&&(y=y&&o>1);return{key:h.id,render:o=>{const n=e.pageResult.type===fe.Rt.SelectedPage;return a()(Ze.Z,{disableTooltip:e.canEdit,renderTooltip:()=>{const e=n?Mt.messages.noEditAccessForSelectedRelation:Mt.messages.noEditAccessForUnselectedRelation;return ae.default.formatMessage(e)},render:a=>l.createElement(Te.Z,r()({},o,{canDrag:y&&n,collectionStore:d,targetCollectionStore:c,relatedPageStore:h,disabled:i||!e.canEdit,isSelected:n,pageStore:s,property:u,rowType:"popup",onActionButtonClick:()=>this.props.onClickActionButton(e.pageResult),blockPropertyValueOverlayStore:g,propertyLimit:this.hasLimit()?1:void 0,onOpenPageButtonClick:()=>{Ce.O([t],h,this.environment,"relation_property")},handleClearProperty:()=>this.props.handleClearProperty()},(0,Ve.Z)(o,a))),textWrap:!0})},action:t=>{p(e.pageResult,Be.DJ(t.event))}}}}function Ct(){return a()("div",{style:{height:"100%",padding:fe.wI,display:"flex",alignItems:"center",justifyContent:"center"}},void 0,a()(we.Z,{style:{margin:"0 auto"}}))}function kt(e){window.__c={n:"RelationSectionHeader"};const{collectionStore:t,targetCollectionStore:o,property:i,showRight:n,disabled:s,style:d}=e,c=(0,p.VK)((()=>o.isSyncedCollection()),[o]),u=(0,p.VK)((()=>{const e=t.getSchema()[i];return Boolean(e&&h.NK(e))}),[t,i]);return l.createElement(X.Z,r()({},e,{noTextOverflow:!0,isTitleUppercase:!1,right:n&&!c&&!u&&a()(Le.default,{collectionStore:t,targetCollectionStore:o,property:i,disabled:s}),style:{paddingTop:0,paddingBottom:4,...d},desktopTitleStyle:{height:19,alignItems:"center",marginTop:6,marginBottom:6,paddingLeft:12,paddingRight:9}}))}Mt.displayName="RelationPropertyMenuResults",Mt.messages=(0,T.defineMessages)({noEditAccessForUnselectedRelation:{id:"collectionsRelationsPicker.noEditAccessForUnselectedRelation",defaultMessage:"Edit access required to add."},noEditAccessForSelectedRelation:{id:"collectionsRelationsPicker.noEditAccessForSelectedRelation",defaultMessage:"Edit access required to remove."}});const wt=Mt,It=(0,T.defineMessages)({inputPlaceholder:{defaultMessage:"Link or create a page…",id:"relationPropertyMenu2.searchPlaceholder"},searchLinkedInputPlaceholder:{defaultMessage:"Search linked pages…",id:"relationPropertyMenu2.viewExisting.searchPlaceholder"},syncedCollectionInputPlaceholder:{defaultMessage:"Link a page",id:"relationPropertyMenu2.syncedCollection.searchPlaceholder"},connectedRelationInputPlaceholder:{defaultMessage:"Find a page",id:"relationPropertyMenu2.connectedRelation.searchPlaceholder"},connectedRelationGoogleDriveInputPlaceholder:{defaultMessage:"Paste in Google Drive or Google Docs link",id:"relationPropertyMenu2.connectedRelationGoogleDrive.searchPlaceholder"},connectedRelationFigmaInputPlaceholder:{defaultMessage:"Paste in https://figma.com/...",id:"relationPropertyMenu2.connectedRelationFigma.searchPlaceholder"},connectedRelationGithubInputPlaceholder:{defaultMessage:"Paste in https://github.com/...",id:"relationPropertyMenu2.connectedRelationGithub.searchPlaceholder"},sprintTypedPropertyInputAddPlaceholder:{defaultMessage:"Search...",id:"relationPropertyMenu2.sprintTypedPropertyInputAddPlaceholder.searchPlaceholder"},sprintTypedPropertyInputViewPlaceholder:{defaultMessage:"Search linked sprints…",id:"relationPropertyMenu2.sprintTypedPropertyInputViewPlaceholder.searchPlaceholder"}});class xt extends s.Z{constructor(){super(...arguments),this.storeTypes={store:Pe,requestStore:ye.Z},this.maybeOverwriteBaseUrlFromSpaceId=(0,se.b)(this.environment),this.addPage=async e=>{const{collectionStore:t,blockPropertyValueOverlayStore:o,blockStore:i,schema:r,property:n}=this.props,l=this.getRenderState();if(!l)return;const{targetCollectionStore:s}=l,d=s.getFormat().integration_id,c=he.Z.externalAuthentications.state.filter((e=>e.integration_id===d))[0],p=s.getFormat().pattern_name,u=he.Z.integrations.state.find((e=>e.id===d)),{searchQuery:g}=this.stores.store.state,h=(0,de.NZ)(i)?i:void 0,y=(0,de.NZ)(i)?i.getPropertyStore(n):void 0;this.stores.store.setState({...this.stores.store.state,addingPage:!0});try{var v,f;if(!(t&&u&&h&&y))return;const i=m.rq(y.getValue()),l=e||g||"";if(!Tt({integration:u,patternName:p,url:l}))return void V.showDialog({items:[{label:a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.copyDebuggingInformation",defaultMessage:"Copy debugging information"}),color:"blue",onAccept:()=>{B.RD({environment:this.environment,stringValue:JSON.stringify({botId:null==c?void 0:c.parent_id,url:l},null,2),copiedMessage:B.tq.copiedToClipboard})}},{label:a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.closeButton",defaultMessage:"Close"}),onAccept:()=>{}}],showCancel:!1,keepFocus:!1,message:a()(T.FormattedMessage,{id:"connectedRelationPropertyMenuResults.unsupportedUrlErrorDialog.title",defaultMessage:"This source is currently not supported. Please try a different source."})});const d=r[n],b=m.Kp(d),P=b?y.id:void 0,R=m.gg(d),M=m.ic(d),C=m.U8(d),k=M&&ge.default.checkGate("figma_connected_relation"),w=C&&ge.default.checkGate("zendesk_connected_relation"),I=R&&ge.default.checkGate("google_drive_connected_relation"),Z=(0,re.NP)(u.id),A=(null==u?void 0:u.id)===S.U9?null===(v=Z[0])||void 0===v?void 0:v.id:null==c?void 0:c.parent_id,U=b||I||w||k?Z.map((e=>e.id)):[A],N=await K.yp({environment:this.environment,url:l,botIds:U,userDefinedExternalCollectionStore:s,relatedPageId:P});if(!N)return;const q=(null===(f=ve.default.state.data)||void 0===f?void 0:f.addOns)??[];if(w&&(0,_.de)(q)){const e=this.environment;L.getZendeskTicketConversation(e,{ticketUrl:l,spaceId:N.getSpaceId(),botId:U[0],pageId:y.id}),ie.j(e,"zendesk_unfurl_ai")}O.createAndCommit({userAction:"connectedRelationPropertyMenuResults.createRelationPage",environment:this.environment,perform:e=>{const t={id:N.id,table:x.iU,spaceId:N.getSpaceId()},r=null!=d&&d.limit?[t]:[...i,t],a=m.ow(r);E.sO({store:y,value:a,transaction:e}),o&&o.state.isOpen&&o.state.collectionContextStore&&(D.rv({environment:this.environment,collectionContextStore:o.state.collectionContextStore,block_id:h.id,property:n,property_type:"relation",from:"relation_section",isFromBulkActionsToolbar:!1,integration_id:u.id,action:"add"}),F.kmb(this.environment,{...(0,ne.Pn)(o.state.collectionContextStore),from:"relation_section",target_collection_id:s.id,integration_id:u.id}))}}),this.stores.store.reset()}finally{this.stores.store.setState({...this.stores.store.state,addingPage:!1})}},this.handleSearchInputChange=e=>{const t=e.target.value;this.stores.store.setState({...this.stores.store.state,searchQuery:t,searchLimit:Pe.limitIncrement})},this.handleMobileTargetCollectionClick=()=>{const e=this.getRenderState();e&&(A.navigate({environment:this.environment,url:e.targetParentUrl}),F.ZZ8(this.environment,{from:this.props.analyticsFrom}))},this.handleMobileSearchInputClick=()=>{const e=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,searchQuery:e.searchQuery,searchPopupOpen:!0,searchLimit:Pe.limitIncrement})},this.handleSelectedPageClick=(e,t)=>{const{mainEditorCurrentBlockStore:o}=ue.default.state;if(!o)return;let i;if(t){const t=me.G.createChildStore(o,e.pointer),r=t.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(t.getSpaceId()):void 0;i=(0,v.Z)({pageId:e.pointer.id,pageModel:t.getModel(),baseUrl:r,pageVisitSource:g.tY.LinkInPage})}else{const t=o.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(o.getSpaceId()):void 0;i=(0,v.Z)({pageId:o.id,pageModel:o.getModel(),baseUrl:t,peekViewBlockId:e.pointer.id,pageVisitSource:g.tY.LinkInPage})}A.navigate({environment:this.environment,url:i,openInNew:t}),F.XXm(this.environment,{from:this.props.analyticsFrom,meta_click:Boolean(t)})},this.handleValueRelationPropertyMenuResultsAccept=(e,t)=>{e.type===fe.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleSearchRelationPropertyMenuResultsAccept=(e,t)=>{var o;if(this.props.disabled)return;const{value:i,onChange:r,overlayMode:n}=this.props,{mainEditorCurrentBlockStore:a}=ue.default.state;if(!a)return;const l=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit;if(e.type===fe.Rt.SearchPage){var s,d,c,p;r({value:l?[e.pointer]:"add"===(null==n?void 0:n.type)?[...i.slice(0,n.index),e.pointer,...i.slice(n.index)]:[...i,e.pointer]}),F.dw6(this.environment,{from:this.props.analyticsFrom,collection_id:null===(s=this.props.collectionStore)||void 0===s?void 0:s.id,collection_view_id:null===(d=this.context.collectionContextStore)||void 0===d||null===(d=d.collectionViewStore())||void 0===d?void 0:d.id,collection_view_block_id:null===(c=this.context.collectionContextStore)||void 0===c||null===(c=c.collectionViewBlockStore())||void 0===c?void 0:c.id,target_collection_id:null===(p=this.getRenderState())||void 0===p||null===(p=p.targetCollectionStore)||void 0===p?void 0:p.id})}else e.type===fe.Rt.SelectedPage&&this.handleSelectedPageClick(e,t)},this.handleCreateNewPage=e=>{var t,o,i;const{searchQuery:r}=this.stores.store.state,n=(0,w.ZP)(),a=null===(t=this.getRenderState())||void 0===t?void 0:t.targetCollectionStore.getSpaceId(),{value:l,onChange:s}=this.props,d=null===(o=this.getRenderState())||void 0===o?void 0:o.propertySchema.limit,c={id:n,table:x.iU,spaceId:a};s({newPage:{id:n,spaceId:a,name:r},value:d?[c]:e?[...l.slice(0,e),c,...l.slice(e)]:[...l,c]}),F.kmb(this.environment,{...(0,ne.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(i=this.getRenderState())||void 0===i||null===(i=i.targetCollectionStore)||void 0===i?void 0:i.id})},this.handleClearProperty=()=>{const{onChange:e}=this.props;e({value:[]})},this.handleClickActionButton=e=>{var t;const{value:o,onChange:i,overlayMode:r}=this.props,{mainEditorCurrentBlockStore:n}=ue.default.state;if(!n)return;const a=null===(t=this.getRenderState())||void 0===t?void 0:t.propertySchema.limit;if(e.type===fe.Rt.SearchPage){var l;i({value:a?[e.pointer]:"add"===(null==r?void 0:r.type)?[...o.slice(0,r.index),e.pointer,...o.slice(r.index)]:[...o,e.pointer]}),F.dw6(this.environment,{from:this.props.analyticsFrom,...(0,ne.Pn)(this.context.collectionContextStore),target_collection_id:null===(l=this.getRenderState())||void 0===l||null===(l=l.targetCollectionStore)||void 0===l?void 0:l.id})}else if(e.type===fe.Rt.SelectedPage){var s;i({value:a?[]:o.filter((t=>t.id!==e.pointer.id))}),F.WFT(this.environment,{...(0,ne.Pn)(this.context.collectionContextStore),from:this.props.analyticsFrom,target_collection_id:null===(s=this.getRenderState())||void 0===s||null===(s=s.targetCollectionStore)||void 0===s?void 0:s.id})}var d;a&&(null===(d=this.props.blockPropertyValueOverlayStore)||void 0===d||d.setState({isOpen:!1}))},this.handleRelationPropertyMenuResultsDrag=e=>{const{collectionStore:t,onChange:o}=this.props;o({value:e.map((e=>({id:e,spaceId:t.pointer.spaceId,table:x.iU})))}),F.yT1(this.environment,{from:this.props.analyticsFrom})},this.handleMobileSearchMenuClickRight=()=>{this.resetInputState()},this.handleSearchScrollOffsetChange=e=>{const{store:t,requestStore:o}=this.stores,{loading:i,result:r}=o.state;e<Pe.incrementScrollOffset&&r&&!i&&r.results.length>=t.state.searchLimit&&t.setState({...t.state,searchLimit:t.state.searchLimit+Pe.limitIncrement})},this.performSearchRequest=async e=>{const{disabled:t}=this.props,o={results:[],query:e.query},i=this.getRenderState();if(!i)return o;if(t)return o;if(m.gg(i.propertySchema)||m.ic(i.propertySchema))return o;const{targetCollectionStore:r}=i;let n=[];if(r.getFormatStore().getKeyStore("app_config_uri").getValue()===f.p$)try{const t=await async function(e){const{environment:t,sprintCollectionStore:o,searchQuery:i}=e,r=o.getPropertyMapping(),n=null==r?void 0:r[b.b0.StatusV2],a=null==r?void 0:r[b.b0.Dates];if(!n||!a)throw new Error("Sprints database does not have the required properties");const l="results",s={type:"reducer",userTimeZone:(0,R.r)(),searchQuery:i,sort:[{property:n,direction:"ascending"},{property:a,direction:"ascending"}],reducers:{[l]:{type:"results",limit:100}}},d=o.getParentBlockStore();if(!d)return[];await d.load();const c=d.getCollectionViewStores()[0];if(!c)return[];const p=o.getSpaceId(),u=await L.queryCollection(t,{source:{type:"collection",id:o.id,spaceId:p},collectionView:{id:c.id,spaceId:p},loader:s},void 0,{src:"relation_property_menu"});if("success"!==u.type)return[];const g=u.data.result.reducerResults[l];if("results"!==g.type)return[];return g.blockIds}({environment:this.environment,sprintCollectionStore:r,searchQuery:e.query});return n=this.convertPageIdsToRelationResults(t,r,i.propertySchema),{results:n,query:e.query}}catch(a){}try{const{results:t}=await U.df({environment:this.environment,query:e.query,collectionId:r.id,limit:e.limit,spaceId:r.getSpaceId(),excludeTemplates:!0,source:"relation_menu",includePublicPagesWithoutExplicitAccess:!0,boostRecentlyViewedPages:!0,ignoresHighlight:!0});n=this.convertPageIdsToRelationResults(t,r,i.propertySchema)}catch(a){P.log({level:"error",from:"relationPropertyMenu",type:"search",error:(0,C.Ui)(a)})}return{results:n,query:e.query}},this.getRecordModel=k.om.fromMonomorphicFunctionUnsafe((e=>me.G.createChildStore(this.props.blockStore,e).getRecordModel(e)),I.mF.fromMonomorphicFunctionUnsafe((e=>{const t=me.G.createChildStore(this.props.blockStore,e);return t.computeWithRecordValues((e=>{let{getRecordValueAndSubscribe:o}=e;return o(t)}))})))}didMount(){super.didMount(),d.default.afterNextFlush((()=>{d.default.afterNextFlush((()=>{const e=this.getRenderState();if(e){0===this.getValueResults(e).length&&this.stores.store.setState({searchPopupOpen:this.environment.device.isMobile,searchQuery:this.props.insertChar??"",searchLimit:Pe.limitIncrement,addingPage:!1})}}))}))}renderComponent(){const{device:e}=this.environment,t=this.getRenderState();if(t)return a()(q.Z,{capture:!0,allowMenuList:!0,allowEsc:!0,allowUndo:!0,allowTabUntab:!0,render:()=>e.isMobile?this.renderMobileMenu(t):this.renderDesktopMenu(t)})}realWindowAsJSDOMWindow(e){return e}lightweightIsPhoneNumber(e){return/^(\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]\d{3}[\s.-]\d{4}$/.test(e)}renderDesktopMenu(e){const{searchQuery:t}=this.stores.store.state,o=this.stores.requestStore.state.result,{blockStore:i,disabled:r,analyticsFrom:n,overlayMode:l}=this.props,{targetCollectionStore:s}=e,d=Boolean(he.Z.bots.state.find((e=>e.integration_id===S.U9))),c=m.Kp(e.propertySchema)&&!d,p=l&&"add"===l.type?l.index:void 0;return a()(W.Z,{menuType:le.og.Popup,header:c?null:a()(_t,{store:this.stores.store,disabled:r,renderState:e,blockStore:i,analyticsFrom:n,isConnectedRelation:Boolean(e.propertySchema.connectedRelation),overlayMode:l,addPage:this.addPage}),footer:this.renderFooter({requestStateResult:o,searchQuery:t,overlayMode:l,disabled:r,targetCollectionStore:s,index:p,propertySchema:e.propertySchema})},void 0,a()("div",{style:{overflow:"hidden",maxHeight:"70vh"}},void 0,this.renderSearchResults(e)))}renderFooter(e){const{requestStateResult:t,searchQuery:o,overlayMode:i,disabled:r,targetCollectionStore:n,index:l,propertySchema:s}=e;return!(n.getFormatStore().getKeyStore("app_config_uri").getValue()===f.p$)&&"view"===(null==i?void 0:i.type)||r||s.connectedRelation?null:t&&t.results.length>0&&o&&a()(te,{targetCollectionStore:n,title:o,onClick:this.handleCreateNewPage,focused:!1,isSection:!0,index:l})}renderMobileMenu(e){const{device:t}=this.environment,{searchPopupOpen:o}=this.stores.store.state,{collectionStore:i,property:r,schema:n,blockStore:l,blockPropertyValueOverlayStore:s,disabled:d,canConfigureCollection:c,onDismiss:p}=this.props,{showProperties:u,targetCollectionStore:g}=e,{mediumTextColor:y}=this.theme,v=this.getValueResults(e),f=n[r],b=f&&h.NK(f),P=Boolean(he.Z.bots.state.find((e=>e.integration_id===S.U9))),R=Boolean(he.Z.bots.state.find((e=>e.integration_id===S.f3))),C=Boolean(he.Z.bots.state.find((e=>e.integration_id===S.mQ))),k=m.Kp(e.propertySchema),w=m.gg(e.propertySchema),I=m.ic(e.propertySchema),x=k&&!P||w&&!R||I&&!C;return a()(W.Z,{menuType:le.og.Modal,title:e.propertySchema.name,right:a()(T.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileMenuDone.button"}),onClickRight:p},void 0,b?null:a()(X.Z,{disableMobilePadding:!0},void 0,a()(N.Z,{focused:!1,title:a()("div",{style:{display:"flex"}},void 0,a()(T.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>e,databaseWithIcon:a()("div",{style:{display:"flex",marginLeft:2*fe.Qi}},void 0,a()(j.Z,{disabled:!0,icon:g.getIcon(),isEmptyPage:!1,size:20}),a()($.Z,{store:g,underline:!0,style:{marginLeft:fe.Qi}}))}})),showExtensionArrow:!1,onClick:this.handleMobileTargetCollectionClick})),x?null:a()(X.Z,{topBorder:!0,disableMobilePadding:!1},void 0,a()(Q.GI,{popupType:Q.kQ.SlideUp,open:o,origin:a()(N.Z,{focused:!1,title:a()("span",{style:{display:"flex",alignItems:"center"}},void 0,(0,M.R)({marginRight:8,width:t.isMobile?16:14,height:t.isMobile?16:14}),a()(T.FormattedMessage,{defaultMessage:"Add a page",id:"relationPropertyMenu.addAPage.button"})),onClick:this.handleMobileSearchInputClick,style:{color:y}}),render:()=>this.renderSearchResults(e)})),a()(wt,{collectionStore:i,targetCollectionStore:g,showProperties:u,results:v,resultsType:"existing",property:r,schema:n,parentStore:l,disabled:d,canConfigureCollection:c,loading:!1,canDrag:!1,blockPropertyValueOverlayStore:s,onAccept:this.handleValueRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onCreatePage:this.handleCreateNewPage,handleClearProperty:this.handleClearProperty,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage}))}renderSearchResults(e){const{device:t}=this.environment,{collectionStore:o,value:i,property:n,schema:s,blockStore:d,blockPropertyValueOverlayStore:c,disabled:p,canConfigureCollection:u,overlayMode:g}=this.props,{requestStore:v}=this.stores,{showProperties:f,targetCollectionStore:b,propertySchema:S}=e,{searchQuery:P,searchLimit:M}=this.stores.store.state;let C=pe.default.mark("rum.relation_search_query");const k=S.limit?i.slice(0,1):i,w={request:{query:P,limit:M},debounce:U.vp,performRequest:this.performSearchRequest,render:(i,r)=>{let v=[];v=P?this.getValueResults(e).filter((e=>{let{pageResult:t}=e;const o=me.G.createChildStore(this.props.blockStore,t.pointer),i=o.getModel();if(i)return(0,y.fY)({block:i,query:P,getRecordModel:o.getRecordModel,userTimeZone:(0,R.r)(),schema:s,intl:ae.default.getIntl(),onlyPropertyIds:["title"]})})):this.getValueResults(e);const M=!r&&0===v.length,w=v;r&&r.results.forEach((e=>{const t=e.pageResult;if((t.type===fe.Rt.SelectedPage||t.type===fe.Rt.SearchPage)&&v.find((e=>(e.pageResult.type===fe.Rt.SelectedPage||e.pageResult.type===fe.Rt.SearchPage)&&e.pageResult.pointer.id===t.pointer.id)))return;const o=e.pageResult.type!==fe.Rt.NewPage?k.map((e=>e.id)).includes(e.pageResult.pointer.id):void 0;o&&!P&&"add"===(null==g?void 0:g.type)||(e.pageResult.type===fe.Rt.SearchPage&&o?w.push({...e,pageResult:{...e.pageResult,type:fe.Rt.SelectedPage}}):e.pageResult.type!==fe.Rt.SelectedPage||o?w.push(e):w.push({...e,pageResult:{...e.pageResult,type:fe.Rt.SearchPage}}))})),!M&&""!==P&&C&&r&&r.query===P&&(pe.default.measure(C,{environment:this.environment}),C=void 0);const I=a()(wt,{collectionStore:o,targetCollectionStore:b,showProperties:f,results:w,resultsType:0===w.length&&0===this.getValueResults(e).length?"existing":"search",property:n,schema:s,parentStore:d,disabled:p,canConfigureCollection:u,loading:M,canDrag:!p&&0===P.length,blockPropertyValueOverlayStore:c,onAccept:this.handleSearchRelationPropertyMenuResultsAccept,onClickActionButton:this.handleClickActionButton,onScrollOffsetChange:this.handleSearchScrollOffsetChange,onDrag:this.handleRelationPropertyMenuResultsDrag,onCreatePage:this.handleCreateNewPage,handleClearProperty:this.handleClearProperty,searchQuery:P,overlayMode:g,relationPropertyMenuStore:this.stores.store,addPage:this.addPage,addingPage:this.stores.store.state.addingPage});if(t.isMobile){let e=ae.default.formatMessage(It.inputPlaceholder);const o=h.NK(S);return o&&(e=ae.default.formatMessage(It.connectedRelationInputPlaceholder)),m.gg(S)&&(e=ae.default.formatMessage(It.connectedRelationGoogleDriveInputPlaceholder)),m.ic(S)&&(e=ae.default.formatMessage(It.connectedRelationFigmaInputPlaceholder)),m.Kp(S)&&(e=ae.default.formatMessage(It.connectedRelationGithubInputPlaceholder)),a()(W.Z,{menuType:le.og.Modal,title:a()(T.FormattedMessage,{defaultMessage:"Relation",id:"relationPropertyMenu.mobileRelationMenu.title"}),left:this.renderMobileHelpButton(),right:a()(T.FormattedMessage,{defaultMessage:"Done",id:"relationPropertyMenu.mobileDoneButton"}),header:l.createElement(l.Fragment,null,a()(z.ZP,{value:P,disabled:p,onChange:this.handleSearchInputChange,placeholder:e,showClearButton:!0,focus:!t.isMobile||void 0,focusInitial:!0,style:{...t.isAndroid&&{borderBottom:"none"}}}),P&&!p&&!o&&a()(te,{targetCollectionStore:b,title:P,onClick:this.handleCreateNewPage,focused:!1,isSection:!0})),onClickRight:this.handleMobileSearchMenuClickRight},void 0,I)}return I}};return l.createElement(Y.Z,r()({},w,{requestStore:v}))}renderMobileHelpButton(){return a()(J.Z,{href:(0,ce.UY)("guides.relations"),analyticsFrom:"relation_menu"})}getRenderState(){const{schema:e,property:t,blockStore:o,collectionStore:i}=this.props,r=e[t];if(!r||"relation"!==r.type)return;const n=h.j0(r);if(!n)return;const a=me.NW.createChildStore(o,n),l=a.getParentId();if(!l)return;const s=me.G.createChildStore(a,{table:x.iU,id:l}),d=h.oC({schema:a.getSchema(),format:a.getFormat(),space_id:a.getSpaceId()}),c=[d[`${m.UU}title`]?`${m.UU}title`:"title"],p=s.isDefined()?this.maybeOverwriteBaseUrlFromSpaceId(s.getSpaceId()):void 0,u=(0,v.Z)({pageId:s.id,pageModel:s.getModel(),baseUrl:p,pageVisitSource:void 0});return{propertySchema:r,property:t,targetCollectionStore:a,targetParentBlock:s,showProperties:c,targetCollectionSchema:d,targetParentUrl:u,collectionStore:i}}resetInputState(){this.stores.store.reset()}canEditRelation(e,t,o){if(!(Boolean(t.property)&&ge.default.checkGate("collections_relation_picker_require_edit_perms")))return!0;return me.G.createChildStore(e,o).canEdit()}convertPageIdsToRelationResults(e,t,o){const{value:i}=this.props,r=new Set(i.map((e=>e.id))),n=[];return e.forEach((e=>{const i={spaceId:t.getSpaceId(),id:e,table:x.iU},a=this.canEditRelation(t,o,i);if(r.has(e)){const t={key:e,type:fe.Rt.SelectedPage,pointer:i};n.push({pageResult:t,canEdit:a})}else{const t={key:e,type:fe.Rt.SearchPage,pointer:i};n.push({pageResult:t,canEdit:a})}})),n}getValueResults(e){const{value:t,overlayMode:o}=this.props,{propertySchema:i,targetCollectionStore:r}=e,{searchQuery:n}=this.stores.store.state;return n||"add"!==(null==o?void 0:o.type)?m.j$({relationValue:t,propertySchema:i,getRecordModel:this.getRecordModel}).map((e=>({pageResult:{key:e.id,type:fe.Rt.SelectedPage,pointer:e},canEdit:this.canEditRelation(r,i,e)}))):[]}}function _t(e){var t;window.__c={n:"RelationPropertyMenuInput"};const o=(0,c.O7)(),i=(0,c.Fy)(),{targetParentUrl:r,targetCollectionStore:n,propertySchema:l}=e.renderState,[s,d,g]=(0,p.AF)(e.store),{searchQuery:h,searchPopupOpen:y}=s,v=(0,p.VK)((()=>n.getIcon()),[n]),b=(0,p.VK)((()=>n.isSyncedCollection()),[n]),S=(0,p.VK)((()=>m.Kp(l)),[l]),P=(0,p.VK)((()=>m.gg(l)),[l]),R=(0,p.VK)((()=>m.ic(l)),[l]),M=(0,p.VK)((()=>n.getFormatStore().getKeyStore("app_config_uri").getValue()===f.p$),[n]),C=(0,u.yK)((e=>({regular:{color:e.mediumTextColor,whiteSpace:"nowrap",marginLeft:4},headerWrap:{display:"flex",width:"100%",position:"relative",zIndex:2,padding:"6px 10px",fontSize:14,background:e.inputBackground,boxShadow:`\n\t\t\t\t\t0 1px 0 ${e.darkDividerColor}\n\t\t\t\t`},recordTitle:{fontWeight:Z.Z.fontWeight.semibold,fontSize:14,marginLeft:fe.Qi*(i.isRetina?.5:1)},searchIcon:{fill:e.mediumIconColor,width:14,height:14,marginRight:10}})),[i.isRetina]);let k=It.inputPlaceholder;if(b)k=It.syncedCollectionInputPlaceholder;else if(S)k=It.connectedRelationGithubInputPlaceholder;else if(P)k=It.connectedRelationGoogleDriveInputPlaceholder;else if(R)k=It.connectedRelationFigmaInputPlaceholder;else if(M){var w;"view"===(null===(w=e.overlayMode)||void 0===w?void 0:w.type)&&(k=It.sprintTypedPropertyInputViewPlaceholder),k=It.sprintTypedPropertyInputAddPlaceholder}else e.isConnectedRelation?k=It.connectedRelationInputPlaceholder:("view"===(null===(t=e.overlayMode)||void 0===t?void 0:t.type)||e.disabled)&&(k=It.searchLinkedInputPlaceholder);const I=ae.default.formatMessage(k);return a()("div",{style:C.headerWrap},void 0,a()(G.Z,{style:{flexGrow:1},value:h,placeholder:I,forceShowClearButton:Boolean(h||y),focus:!0,onChange:e=>{const t=e.target.value;d({...s,searchQuery:t,searchPopupOpen:!!t,searchLimit:Pe.limitIncrement})},onClearButtonClick:()=>{d(g.getInitialState())},onClick:()=>{d({...s,searchQuery:s.searchQuery,searchPopupOpen:!0,searchLimit:Pe.limitIncrement})},onKeyDown:e=>{"Escape"===e.key&&d(g.getInitialState())},format:G.B.Transparent,onSubmit:()=>(()=>{const t=n.getFormat().integration_id,o=he.Z.integrations.state.find((e=>e.id===t)),i=n.getFormat().pattern_name;if(!o||!i)return;Tt({integration:o,patternName:i,url:s.searchQuery})&&e.addPage()})()}),!e.isConnectedRelation&&!M&&a()("div",{style:{display:"flex",marginLeft:10,alignItems:"center"}},void 0,a()(T.FormattedMessage,{id:"database.relationProperty.newRelation.targetDatabase",defaultMessage:"<regular>In</regular> {databaseWithIcon}",values:{regular:e=>a()("span",{style:C.regular},void 0,e),databaseWithIcon:a()(H.Z,{href:r,style:{marginLeft:fe.Qi},innerStyle:{display:"flex"},onClick:()=>{F.ZZ8(o,{from:e.analyticsFrom})}},void 0,a()(j.Z,{disabled:!0,icon:v,isEmptyPage:!1,size:20}),a()($.Z,{store:n,underline:!0,style:C.recordTitle}))}})))}xt.displayName="RelationPropertyMenu",xt.contextTypes={...s.w,...oe.xm},xt.titleColumnWidth=300,xt.columnWidth=150,xt.rowHeight=32;const Zt=xt,Tt=e=>{var t;if(e.patternName)return null===(t=e.integration.info)||void 0===t||null===(t=t.original_url_patterns)||void 0===t?void 0:t.filter((t=>{var o;return t.name===e.patternName&&(null===(o=t.additional_types)||void 0===o?void 0:o.connectedRelation)})).find((t=>{let{regex:o}=t;return new RegExp(o).test(e.url)}))}},75071:(e,t,o)=>{o.d(t,{f:()=>n});var i=o(23174),r=o.n(i);o(67294);const n=(0,o(45238).I)("plusThick",{viewBox:"0 0 14 14",svg:r()("path",{d:"M2 7.16357C2 7.59692 2.36011 7.95093 2.78735 7.95093H6.37622V11.5398C6.37622 11.9731 6.73022 12.3271 7.16357 12.3271C7.59692 12.3271 7.95093 11.9731 7.95093 11.5398V7.95093H11.5398C11.9731 7.95093 12.3271 7.59692 12.3271 7.16357C12.3271 6.73022 11.9731 6.37622 11.5398 6.37622H7.95093V2.78735C7.95093 2.36011 7.59692 2 7.16357 2C6.73022 2 6.37622 2.36011 6.37622 2.78735V6.37622H2.78735C2.36011 6.37622 2 6.73022 2 7.16357Z"})})}}]);