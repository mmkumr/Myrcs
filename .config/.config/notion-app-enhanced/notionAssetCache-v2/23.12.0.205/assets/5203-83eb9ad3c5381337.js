"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5203],{73657:(e,t,r)=>{r.d(t,{Z:()=>a});var o=r(10434),i=r.n(o),n=r(67294),s=r(83355),p=r(28992);class l extends s.Z{renderComponent(){return n.createElement(p.Z,i()({},this.props,{style:{background:"none",borderBottom:"none",boxShadow:"",marginTop:2,marginBottom:6,paddingTop:4,paddingBottom:4,minHeight:"none",...this.props.style}}))}}l.displayName="CaptionMenuItem";const a=l},75203:(e,t,r)=>{r.r(t),r.d(t,{default:()=>O});var o=r(10434),i=r.n(o),n=r(23174),s=r.n(n),p=r(67294),l=r(83355),a=r(39068),d=r(56666),c=r(39132),h=r(61061),y=r(72126),m=r(82990),u=r(5366),g=r(50906),P=r(31869),v=r(96802),b=r(39699),S=r(87279),f=r(29376),T=r(4023),Z=r(29798),k=r(73657),C=r(52275),w=r(31945),M=r(79131),I=r(73063),L=r(78140),x=r(32163),R=r(53437),_=r(72495),H=r(26388);class F extends l.Z{constructor(){super(...arguments),this.storeTypes={menuListStore:Z.Z},this.renderRelationPropertyMenuPopup=e=>{const t=this.allRelatedTargetProperties.state;if(!t)return;const r=t.filter((e=>e.visible)),o=t.filter((e=>!e.visible));return s()(L.Z,{menuType:S.og.Popup,maxWidth:240,maxHeight:500},void 0,0===t.length&&s()(_.Z,{},void 0,s()(k.Z,{caption:s()(u.FormattedMessage,{defaultMessage:"No properties",id:"database.relationMenu.noProperties"})})),t.length>0&&s()(x.Z,{type:x.i.Vertical,store:this.stores.menuListStore,initialFocus:void 0,sections:y.oA([r.length>0&&{key:"visible_and_hidden_properties",render:e=>p.createElement(_.Z,i()({},e,{noTextOverflow:!0,isTitleUppercase:!1,title:s()(u.FormattedMessage,{defaultMessage:"Shown in relation",id:"database.relationMenu.shownInRelationTitle"}),desktopTitleStyle:{height:18}}),this.renderPropertyDraggableList({visibleProperties:r,hiddenProperties:o,children:e.children})),items:y.oA([...this.renderPropertySortListItems({properties:r,visibility:!0}),o.length>0&&{key:"group-header-hidden-property",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:p.createElement(p.Fragment,null)}),action:()=>{}},...this.renderPropertySortListItems({properties:o,visibility:!1})])},0===r.length&&o.length>0&&{key:"hidden_properties",render:e=>this.renderHiddenPropertySectionHeader({props:e,children:this.renderPropertyDraggableList({visibleProperties:r,hiddenProperties:o,children:e.children})}),items:this.renderPropertySortListItems({properties:o,visibility:!1})}])}))},this.handlePropertyReorder=e=>{const{newPropertyKeys:t}=e,{collectionStore:r,property:o}=this.props,i=f.U1({collectionStore:r,property:o}),n=t.indexOf("group-header-hidden-property"),s=y.oA(t.filter((e=>!e.startsWith("group-header-"))).map(((e,t)=>{const r=i.find((t=>t.property===e));return r?n>0?"title"===e&&t>=n?r:{...r,visible:Boolean(t<n)}:r:{property:e,visible:!(n>0)||Boolean(t<n)}}))),p=i.filter((e=>!t.includes(e.property))),l={...f.ZI(r)};l[o]||(l[o]={}),l[o].related_properties=[...s,...p],b.createAndCommit({userAction:"RelationPropertyCustomizeLayoutMenu.handlePropertyReorder",environment:this.environment,perform:e=>{v.FH({stores:[r],update:{collection_relation_options:l},transaction:e})}}),this.stores.menuListStore.reset()},this.allRelatedTargetProperties=this.createComputedStore((()=>{const{collectionStore:e,targetCollectionStore:t,property:r}=this.props,o=f.U1({collectionStore:e,property:r}),i=Object.keys(t.getSchema()).map((e=>o.find((t=>t.property===e))??{property:e,visible:!1})),n=o.map((e=>e.property)),s=e=>{const t=n.indexOf(e);return-1!==t?t:1/0};return i.sort(((e,t)=>s(e.property)-s(t.property))),i}),!0)}renderComponent(){const{device:e}=this.environment;if(!e.isPhone||"section"===this.props.rowType)return s()(H.Z,{renderTooltip:()=>s()(u.FormattedMessage,{id:"database.RelationCustomizeLayoutMenu.tooltip.button.message",defaultMessage:"Customize shown properties"}),placement:"section"===this.props.rowType?T.u.Top:T.u.Right,render:e=>p.createElement(w.ZP,i()({popupType:R.kQ.Popup,alignmentToOrigin:T.v.Start},e,{renderOrigin:t=>p.createElement(I.Z,i()({icon:d.o,iconStyle:{width:16,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor}},t,e)),onClick:()=>{g.gP4(this.environment,{from:"section"===this.props.rowType?"relation_section":"configure_relation_modal"})},originGap:16,render:this.renderRelationPropertyMenuPopup}))})}renderPropertySortListItems(e){const{properties:t,visibility:r}=e;return y.oA(t.map((e=>this.renderPropertySortListItem({propertyFormat:e,visibility:r}))))}renderPropertyDraggableList(e){const{visibleProperties:t,hiddenProperties:r,children:o}=e,i=y.oA([...t.map((e=>e.property)),t.length>0&&r.length>0&&{key:"group-header-hidden-property",draggable:!1},...r.map((e=>e.property))]);return s()(M.ZP,{direction:"vertical",keys:i,renderKey:(e,t)=>o[t],onDrop:e=>{this.handlePropertyReorder({newPropertyKeys:e})},disabled:this.props.disabled})}renderPropertySortListItem(e){const{propertyFormat:t,visibility:r}=e,o=!r,{collectionStore:n,targetCollectionStore:l,property:d,disabled:y}=this.props,u=this.environment,g=l.getSchema();if(!g)return;const v=g[t.property];if(!v)return;const{theme:b}=this;return{key:t.property,render:e=>p.createElement(C.Z,i()({},e,{showDragHandle:!y,title:s()("div",{style:{display:"flex",alignItems:"center"}},void 0,s()(a.ZP,{icon:v.icon,type:v.type,size:16,theme:b,style:{fill:b.regularIconColor}}),s()("span",{style:{marginLeft:8,...m.Z.textOverflowStyle}},void 0,v.name)),right:s()("div",{style:{display:"flex",alignItems:"center"}},void 0,s()(I.Z,{icon:o?h.B:c.c,iconStyle:{width:16,height:16},isDarkIconColor:!o,onClick:()=>{P.qK({propertyFormat:t,visibility:r,collectionStore:n,property:d,environment:u})},disabled:y||"title"===t.property}))})),action:()=>{}}}renderHiddenPropertySectionHeader(e){const{props:t,children:r}=e;return p.createElement(_.Z,i()({},t,{noTextOverflow:!0,isTitleUppercase:!1,title:s()(u.FormattedMessage,{defaultMessage:"Hidden in relation",id:"database.relationMenu.hiddenInRelationTitle"}),desktopTitleStyle:{height:19},children:r,disableDesktopPadding:!0}))}}F.displayName="RelationPropertyCustomizeLayoutMenu";const O=F}}]);