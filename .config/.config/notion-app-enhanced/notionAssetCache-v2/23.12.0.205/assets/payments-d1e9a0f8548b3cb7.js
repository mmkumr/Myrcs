"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[7983],{75522:(e,t,a)=>{a.r(t),a.d(t,{default:()=>me});var r=a(23174),n=a.n(r),o=a(86664),i=a(67294),s=a(480),d=a(86628),l=a(24405),u=a(8848),p=a(92595),c=a(13148),m=a(3791),y=a(5366),g=a(19234),v=a(92785),f=a(90850),b=a(16100),S=a(62216),M=a(41168),C=a(80444),h=a(92083),I=a(27242),x=a(30751),Z=a(50906),w=a(21325),_=a(71993);async function O(e){const{environment:t,state:a,data:r,stripe:n,elements:i,intl:s,paymentOptionAvailabilityStore:d}=e,l=a.temporaryPaymentMethod;Z.PNo(t,{paymentMethod:l});const u=d.state.paymentRequest;if("native_payment_platform"===l&&u)return void u.show();I.Z.update((e=>({...e,payButtonState:"disabled"})));T({environment:t,state:a,intl:s})&&await async function(e){const{environment:t,state:a,data:r,stripe:n,elements:i,intl:s}=e;if(!i||!n)return void v.log({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});if(S.rR()){let e=a.paymentData;if(!e){const{error:r}=await i.submit();if(r)return Z.VQs(t,{error:"could not submit form",error_type:"payment_method"}),void I.Z.setState({...a,error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})});const o=await n.createPaymentMethod({elements:i});if(o.error)return Z.VQs(t,{error:o.error.message,error_type:"payment_method"}),void I.Z.setState({...a,error:b.translateStripeError(t,s,o.error)});if(!o.paymentMethod)return Z.VQs(t,{error:"could not create token",error_type:"payment_method"}),void I.Z.setState({...a,error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})});e={type:"paymentMethodId",value:o.paymentMethod.id},I.Z.setState({...a,paymentData:e})}await A({environment:t,data:r,paymentData:e,stripe:n,onComplete:void 0})}else{if("invoice"===a.temporaryPaymentMethod)return void(await A({environment:t,data:r,stripe:n,paymentData:void 0,onComplete:void 0}));const e=i.getElement(o.CardElement);if(!e)return void v.log({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe Card Element could not be found"}});const d=await n.createToken(e);if(!d.error&&d.token){const e={type:"stripeToken",value:d.token.id};await A({environment:t,data:r,paymentData:e,stripe:n,onComplete:void 0})}else d.error?(Z.VQs(t,{error:d.error.message,error_type:"credit_card"}),I.Z.setState({...a,error:b.translateStripeError(t,s,d.error)})):(Z.VQs(t,{error:"could not create token",error_type:"credit_card"}),I.Z.setState({...a,error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.creditCard.genericError",defaultMessage:"Your card could not be processed. Please try again."})}))}}({environment:t,state:a,data:r,stripe:n,elements:i,intl:s});const p=I.Z.state;p.open&&I.Z.setState({...p,payButtonState:"enabled"})}async function A(e){var t,a;const{environment:r,data:n,paymentData:o,stripe:i,onComplete:s}=e,d=C.default.state.currentSpaceStore,l=I.Z.state;d&&_.Z({environment:r,spaceId:d.id});const{status:u,prices:p,selectedCurrencyCode:c}=x.Z.state;if(!l.open||!d||"ready"!==u)return void(s&&s("fail"));const m=l.temporaryPaymentMethod,y=M.GD(l.temporaryBillingInterval),g=M.Md(l,n),v=null===(t=p.find((e=>e.product===l.subscriptionTier&&e.billingInterval===y&&e.currencyCode===c)))||void 0===t?void 0:t.externalId,b=null===(a=p.find((e=>e.product===l.addOnFeature&&e.billingInterval===y&&e.currencyCode===c)))||void 0===a?void 0:a.externalId,S=l.appliedPromo,O=l.temporaryAddress;try{const e=await w.Mg({environment:r,spaceStore:d,plan:v,paymentData:o,billingEmail:g,coupon:S&&"coupon"===S.source?S.code:void 0,customerName:O.name,businessName:O.businessName,addressLine1:O.addressLine1,addressCity:O.city,addressZip:O.zipCode,addressState:O.state,addressCountry:O.country,vatId:l.vatApplicable?l.temporaryVatCode:void 0,promoCodeId:S&&"promo_code"===S.source?S.code:void 0,from:"subscription_upgrade_modal",addOns:b?[{priceId:b,isCancellation:!1}]:[],useTestClock:l.useTestClock,sessionId:l.sessionId,inAppOffer:"ai"===l.addOnFeature?l.coupon:void 0});Z.fZH(r,{paymentMethod:m});const{paymentIntentClientSecret:t,paymentIntentStatus:a}=e;t&&"requires_action"===a&&await i.handleNextAction({clientSecret:t}),s&&s("success"),S&&(0,f.$r)(r.currentUser.id),function(e){const{environment:t}=e;I.Z.reset(),Z.Xov(t)}({environment:r}),h.Z.setState({...h.Z.state,currentTab:"billing",defaultSubtab:void 0})}catch{Z.cYL(r),s&&s("fail")}}function T(e){const{environment:t,intl:a,state:r}=e;if(!S.vi())return!0;let n;return r.temporaryAddress.country?"address_resolution_failed"!==r.taxCalculationError&&(0,g.A)(r.temporaryAddress)||(n=a.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})):n=a.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.missingCountryError",defaultMessage:"Invalid country. Please select the country from the dropdown menu."}),n&&(I.Z.setState({...r,error:n}),Z.VQs(t,{error:void 0,error_type:"address"})),void 0===n}a(95477);var B=a(43250),F=a(69653),k=a(34859),P=a(88632),D=a(45407),V=a(78291),E=a(36488),U=a(50506),N=a(53336),W=a(71422),L=a(10644),z=a(97880),Y=a(82990),K=a(61519),q=a(68785),H=a(1063),Q=a(25889),R=a(42045),X=a(67773),G=a(43761),$=a(24862),j=a(26156);function J(e){window.__c={n:"SpaceSubscriptionOrderSummary"};const{state:t,data:a,promo:r}=e,{coupon:o}=t,i=(0,s.O7)(),u=(0,l.yK)((e=>({container:{display:"flex",flexDirection:"column",gap:16},header:{alignItems:"center",color:e.regularTextColor,display:"flex",fontSize:16,fontWeight:Y.Z.fontWeight.semibold,gap:8,marginBottom:11},couponLink:{fontSize:12}})),[]),{availableCurrencyCodes:p,selectedCurrencyCode:c}=(0,d.VK)((()=>({availableCurrencyCodes:x.Z.availableCurrencyCodes,selectedCurrencyCode:x.Z.selectedCurrencyCode})),[]),m=t.temporaryBillingInterval??"month",g=F.Zr(r),v=F.Lp(t),f=(0,d.VK)((()=>v.map((e=>x.Z.getPrice(i,(t=>t.product===e&&t.billingInterval===m))))),[m,i,v]);if(f.some((e=>!e.isLoaded)))return n()(q.Z,{});const b=f.map((e=>e.result)).filter(Boolean),S=M.su(a),C=b[0].unitAmount.currencyValue,h=F.cv({prices:b,quantity:S,coupon:o}),I=F.VT({calculatingTax:t.calculatingTax,taxAmount:t.taxAmount,currencyValue:C}),Z=F.rF({prices:b,quantity:S,promo:g}),w=F.Et(a,C),O=h.plus(I).minus(Z).minus(w),A=O.amount<0?O.withMultipliedAmount(0):O;return n()("div",{style:u.container},void 0,n()("label",{style:u.header},void 0,n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.header",defaultMessage:"Order summary"}),n()(Q.V,{availableCurrencyCodes:p,from:"upgrade_modal",onSelectCurrency:_.y,selectedCurrencyCode:c})),n()(ae,{prices:b,coupon:t.coupon,data:a}),M.Fu(t.subscriptionTier)&&n()(H.X,{tier:t.subscriptionTier}),n()(K.Z,{size:1}),n()(te,{subtotal:h,tax:I,discount:Z,accountBalance:w,promo:g,state:t,style:{marginBottom:8}}),n()(ee,{total:A}))}function ee(e){const t=F.hr();return n()("div",{style:t.itemContainer},void 0,n()("div",{style:t.captionContainer},void 0,n()("span",{style:t.totalName},void 0,n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeOrderSummary.totalForToday",defaultMessage:"Total for today"}))),n()("span",{style:t.totalPrice},void 0,n()(R.W,{cost:e.total.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})))}function te(e){const{subtotal:t,tax:a,discount:r,accountBalance:o,style:i,promo:s}=e,{calculatingTax:d,coupon:l}=e.state;return n()("div",{style:i},void 0,n()($.r,{subtotal:t}),n()(j.u,{tax:a,calculatingTax:d}),s&&!l?n()(G.T,{discount:r,promo:s}):void 0,n()(X.G,{accountBalance:o}))}function ae(e){const{coupon:t,data:a,prices:r}=e;return i.createElement(i.Fragment,null,r.map((e=>n()(re,{price:e,data:a,coupon:t},e.externalId))))}function re(e){window.__c={n:"SpaceSubscriptionGrossOrderItem"};const{price:t,data:a,coupon:r}=e,o=(0,l.yK)((e=>({container:{display:"flex",justifyContent:"space-between"},item:{},title:{fontSize:14,fontWeight:Y.Z.fontWeight.medium,marginBottom:4},subtitle:{color:e.mediumTextColor,fontSize:12},price:{fontSize:14}})),[]),i=M.su(a),s=t.getCostPerBillingInterval({quantity:i,coupon:r}),d=n()(R.W,{cost:s.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"});return n()("div",{style:o.container},void 0,n()("div",{style:o.item},void 0,n()("div",{style:o.title},void 0,n()(ne,{price:t})),n()("div",{style:o.subtitle},void 0,n()(oe,{price:t,data:a,coupon:r}))),n()("div",{style:o.price},void 0,d))}function ne(e){const{price:t}=e;switch(t.product){case"free":case"student":return null;case"ai":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.ai.addOn",defaultMessage:"Notion AI"});case"personal":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.singlePlayerPlusPlan",defaultMessage:"Plus plan with a 1-member limit"});case"plus":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.plusPlan",defaultMessage:"Plus plan"});case"business":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.businessPlan",defaultMessage:"Business plan"});case"enterprise":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.enterprisePlan",defaultMessage:"Enterprise plan"});default:(0,z.t1)(t.product)}}function oe(e){const{price:t,data:a,coupon:r}=e,o=M.su(a),i=t.getMonthlyUnitCost(r),s=n()(R.W,{cost:i.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"});switch(t.billingInterval){case"year":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedYearly",defaultMessage:"{price} / member / month × {numberOfMembers, plural, one {# member} other {# members}}{br}Billed yearly",values:{br:n()("br",{}),price:s,numberOfMembers:o}});case"month":return n()(y.FormattedMessage,{id:"spaceSubscriptionUpgradeModal.orderSummary.planSubtitle.billedMonthly",defaultMessage:"{price} / member / month × {numberOfMembers, plural, one {# member} other {# members}}{br}Billed monthly",values:{br:n()("br",{}),price:s,numberOfMembers:o}});default:(0,z.t1)(t.billingInterval)}}var ie=a(93537),se=a(58025),de=a(65734),le=a(502);function ue(){return(0,l.yK)((e=>({closeButton:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:24,right:20,width:22,height:22,padding:0,borderRadius:"50%",border:"none",background:"light"===e.mode?u.FN.light.gray[75]:u.FN.dark.gray[500],zIndex:10},closeButtonIcon:{width:12,height:12,fill:"light"===e.mode?u.FN.light.gray[400]:u.FN.dark.gray[800]},modal:{background:"dark"===e.mode?"#191919":e.popoverBackground,borderRadius:12,width:750,maxHeight:760,display:"flex"},modalContent:{flex:1,display:"flex",flexDirection:"column",position:"relative",borderRadius:"12px 0 0 12px"},modalContentBody:{padding:"36px 42px 50px 42px",display:"flex",flexDirection:"column"},modalContentSidebar:{flexShrink:1,background:"dark"===e.mode?"#202020":e.sidebarSecondaryBackground,borderLeft:`1px solid ${e.lightDividerColor}`,display:"flex",flexDirection:"column"},modalContentSidebarScroller:{padding:24,display:"grid",gridTemplateColumns:"260px"}})),[])}function pe(e){window.__c={n:"ModalContentWrapper"};const{state:t,data:a,paymentOptionAvailabilityStore:r}=e,{subscriptionTier:i,onlyShowAddOn:s,calculatingTax:l,temporaryBillingInterval:u,taxAmount:p,addOnFeature:c,coupon:m}=t,y=M.XX(a),g=(0,d.VK)((()=>(null==y?void 0:y.currencyCode)??x.Z.selectedCurrencyCode),[y]),{payAmount:v}=M.uN({subscriptionTier:i,currencyCode:g,promo:t.appliedPromo,data:a,onlyShowAddOn:s,calculatingTax:l,billingInterval:u??"year",taxAmount:p,addOnFeature:c,coupon:m}),f=(0,b.useElementsOptions)({type:"subscription",amount:v.amount,currency:v.currencyCode});return n()(o.Elements,{stripe:(0,b.getStripe)(),options:f},void 0,n()(ce,{state:t,data:a,paymentOptionAvailabilityStore:r}))}function ce(e){window.__c={n:"ModalContent"};const{state:t,data:a,paymentOptionAvailabilityStore:r}=e,l=(0,s.O7)(),u=(0,y.useIntl)(),p=ue(),g=(0,o.useStripe)(),v=(0,o.useElements)();!function(e){const{data:t,paymentOptionAvailabilityStore:a}=e,r=(0,s.O7)(),n=(0,o.useStripe)(),d=(0,y.useIntl)(),[l,u]=(0,i.useState)(!1);(0,i.useEffect)((()=>{if(!n||l)return;const e=n.paymentRequest({country:"US",currency:"usd",total:{label:d.formatMessage({id:"spaceSubscriptionUpgradeModal.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});e.canMakePayment().then((t=>{t&&(a.update((a=>({...a,supportsApplePay:t.applePay,paymentRequest:e}))),a.addPaymentOption("native_payment_platform"))})),e.on("paymentmethod",(e=>{const a=I.Z.state;if(a.open)if(T({environment:r,state:a,intl:d})){const a={type:"paymentMethodId",value:e.paymentMethod.id};A({environment:r,data:t,paymentData:a,stripe:n,onComplete:e.complete})}else e.complete("fail")})),u(!0)}),[n,l,t,r,d,a])}({data:a,paymentOptionAvailabilityStore:r});const[f,b]=(0,d.VK)((()=>[P.Z.state.online,r.state.availablePaymentMethods]),[r]),[S,C,h,x,Z]=(0,d.VK)((()=>{var e;const a=(null===(e=V.default.state.data)||void 0===e?void 0:e.addOns)??[];return[t.subscriptionTier,t.temporaryBillingInterval,t.addOnFeature,!(0,m.de)(a),t.coupon]}),[t]);if(!t.open)return null;if(!f)return n()(L.Z,{});const w=F.Lp(t),_=M.E$({state:t,availablePaymentMethods:b});return i.createElement(i.Fragment,null,n()("div",{style:p.modalContent},void 0,n()(N.Z,{type:k.Z.Y,showScrollToBottomIndicator:!0},void 0,n()("div",{style:p.modalContentBody},void 0,n()(de.Q,{subscriptionTier:t.subscriptionTier,onlyShowAddOn:t.onlyShowAddOn,addOnFeature:t.addOnFeature,type:t.type}),t.onlyShowAddOn?null:n()(W.Z,{subscriptionTier:S,billingInterval:C,addOnFeature:h,canAddAI:x,coupon:Z,onChangeBillingInterval:e=>{I.Z.update((t=>({...t,temporaryBillingInterval:e})))},onChangeAddOnFeature:e=>{I.Z.update((t=>({...t,addOnFeature:e})))}}),n()(se.g,{state:t,paymentOptionAvailabilityStore:r}),n()(le.C,{paymentMethods:_})))),n()("div",{style:p.modalContentSidebar},void 0,n()(N.Z,{type:k.Z.Y,style:p.modalContentSidebarScroller},void 0,n()(J,{state:t,data:a,promo:t.appliedPromo}),n()(ie.f,{state:t,paymentOptionAvailabilityStore:r,products:w,onClickUpgrade:()=>O({environment:l,intl:u,state:t,stripe:g,elements:v,data:a,paymentOptionAvailabilityStore:r})}))),n()("button",{style:p.closeButton,onClick:()=>{I.Z.setState({open:!1})}},void 0,(0,c.U)(p.closeButtonIcon)))}const me=function(e){window.__c={n:"SpaceSubscriptionUpgradeModal"};const{data:t}=e,a=(0,d.VK)((()=>I.Z.state),[]),r=(0,y.useIntl)(),o=ue(),s=(0,i.useMemo)((()=>new D.Z),[]);return(0,i.useEffect)((()=>{const{state:e}=I.Z;if(!e.open)return;const{currentUserStore:a}=C.default.state,n=null!=a&&a.isDefined()?a.getModel():void 0;if(n){const a=n.getDisplayName(r);var o;if(I.Z.setState({...e,temporaryAddress:{...e.temporaryAddress,name:a}}),"subscribed_admin"===t.type||"unsubscribed_admin"===t.type)I.Z.setState({...e,appliedPromo:null===(o=t.customerData)||void 0===o?void 0:o.stripe.promo})}["local","development","staging"].includes("production")&&(0,p.exposeDebugValue)("useTestClock",(()=>{I.Z.setUseTestClock(!0)}))}),[]),n()(U.Z,{ariaLabelledBy:B.BaY,ariaDescribedBy:B.qr0,open:a.open,preventHideChildrenWhileOpening:!0,innerStyle:o.modal,render:()=>n()(E.Z,{capture:!0,allowEsc:!0,render:()=>a.open?n()(pe,{state:a,data:t,paymentOptionAvailabilityStore:s}):null})})}},1063:(e,t,a)=>{a.d(t,{X:()=>p});var r=a(23174),n=a.n(r),o=(a(67294),a(480)),i=a(24405),s=a(5366),d=a(50906),l=a(8323),u=a(42402);function p(e){window.__c={n:"StartupCouponInlineTextLink"};const t=(0,o.O7)(),a=(0,i.yK)((()=>({couponLink:{fontSize:12}})),[]);return n()(u.Z,{href:"https://notionup.typeform.com/to/qYXezfBW",external:!0,style:a.couponLink,onClick:()=>{const a=(0,l.zt)();d.sS1(t,{tier:e.tier,currentTier:a})}},void 0,n()("div",{},void 0,n()(s.FormattedMessage,{id:"startupCouponInlineLink.text",defaultMessage:"Are you a startup?"})))}},67773:(e,t,a)=>{a.d(t,{G:()=>d});var r=a(23174),n=a.n(r),o=(a(67294),a(5366)),i=a(69653),s=a(42045);function d(e){window.__c={n:"OrderSummaryAccountBalanceItem"};const t=(0,i.hr)(),{accountBalance:a}=e;return 0===a.amount?null:n()("div",{style:t.itemContainer},void 0,n()("div",{style:t.captionContainer},void 0,n()("span",{style:t.name},void 0,n()(o.FormattedMessage,{id:"subscriptionHelpers.lineItems.balance",defaultMessage:"Balance"}))),n()("span",{style:t.credit},void 0,n()(s.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})))}},43761:(e,t,a)=>{a.d(t,{T:()=>d});var r=a(23174),n=a.n(r),o=(a(67294),a(5366)),i=a(69653),s=a(42045);function d(e){window.__c={n:"OrderSummaryDiscountItem"};const t=(0,i.hr)(),{discount:a,promo:r}=e;return n()("div",{style:t.itemContainer},void 0,n()("div",{style:t.captionContainer},void 0,n()("span",{style:t.name},void 0,n()(o.FormattedMessage,{id:"subscriptionHelpers.lineItems.promo",defaultMessage:"Coupon"}))),r.duration_in_months?n()("span",{style:t.caption},void 0,n()(o.FormattedMessage,{id:"subscriptionHelpers.lineItems.promo.subtitle",defaultMessage:"Valid for {durationInMonths} months",values:{durationInMonths:r.duration_in_months}})):void 0,n()("span",{style:t.credit},void 0,n()(s.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})))}},24862:(e,t,a)=>{a.d(t,{r:()=>d});var r=a(23174),n=a.n(r),o=(a(67294),a(5366)),i=a(69653),s=a(42045);function d(e){window.__c={n:"OrderSummarySubtotalItem"};const t=(0,i.hr)(),{subtotal:a}=e;return n()("div",{style:t.itemContainer},void 0,n()("div",{style:t.captionContainer},void 0,n()("span",{style:t.name},void 0,n()(o.FormattedMessage,{id:"subscriptionHelpers.lineItems.subTotal",defaultMessage:"Subtotal"}))),n()("span",{style:t.price},void 0,n()(s.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})))}},26156:(e,t,a)=>{a.d(t,{u:()=>l});var r=a(23174),n=a.n(r),o=(a(67294),a(5366)),i=a(69653),s=a(68785),d=a(42045);function l(e){window.__c={n:"OrderSummaryTaxItem"};const t=(0,i.hr)(),{tax:a,calculatingTax:r}=e;return n()("div",{style:t.itemContainer},void 0,n()("div",{style:t.captionContainer},void 0,n()("span",{style:t.name},void 0,n()(o.FormattedMessage,{id:"subscriptionHelpers.lineItems.taxIfApplicable.title",defaultMessage:"Tax if applicable"}))),n()("span",{style:t.price},void 0,r?n()(s.Z,{}):0===a.amount?"—":n()(d.W,{cost:a.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})))}}}]);