"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8144],{69054:(e,t,o)=>{o.d(t,{J:()=>re});var i=o(10434),n=o.n(i),a=o(23174),s=o.n(a),r=o(67294),d=o(74725),l=o(480),c=o(86628),p=o(24405),u=o(7057),m=o(42875);const g=(0,o(45238).I)("commentSidebarZero",{viewBox:"0 0 56 56",svg:s()("path",{d:"M13.1289 47.6641C13.9297 47.6641 14.4961 47.3516 15.4141 46.5508L21.8984 40.5938C23.0703 42.4297 25.1602 43.4258 27.9922 43.4258H36.3516L42.6602 48.8164C43.5195 49.5586 44.0273 49.9492 44.7305 49.9492C45.7461 49.9492 46.332 49.2266 46.332 48.0938V43.4258H47.4453C51.8398 43.4258 54.6328 40.8281 54.6328 36.2969V24.1289C54.6328 19.5977 51.8398 17 47.4453 17H43.9688V14.793C43.9688 9.83203 41.0781 7 36.0977 7H8.87109C4.00781 7 1 9.83203 1 14.793V32.4297C1 37.4102 4.00781 40.2422 8.87109 40.2422H11.4492V45.7695C11.4492 46.9609 12.0742 47.6641 13.1289 47.6641ZM13.7539 39.2461C13.7539 38.3867 13.2266 37.9766 12.543 37.9766H9.08594C5.43359 37.9766 3.42188 36.043 3.42188 32.293V14.9492C3.42188 11.2188 5.45312 9.26562 9.08594 9.26562H35.8828C39.5156 9.26562 41.5469 11.2188 41.5469 14.9492V17H27.9922C23.4414 17 20.8047 19.5977 20.8047 24.1289V36.3164C20.8047 36.9805 20.8438 37.6055 20.9609 38.1719L13.7539 44.9883V39.2461ZM44.0859 47.2148L38.1289 41.9023C37.4844 41.3359 37.0938 41.1602 36.2344 41.1602H28.168C25.0039 41.1602 23.207 39.4805 23.207 36.1797V24.2656C23.207 20.9648 25.0039 19.2656 28.168 19.2656H47.25C50.4336 19.2656 52.2305 20.9648 52.2305 24.2656V36.1602C52.2305 39.4609 50.4336 41.1602 47.25 41.1602H45.2383C44.5938 41.1602 44.0859 41.5312 44.0859 42.3711V47.2148Z"})});var f=o(72126),v=o(80503),y=o(82990),b=o(5366),S=o(54564),h=o(96514),w=o(43250),M=o(78089),C=o(33929),k=o(65598),x=o(77546),Z=o(45094),_=o(34859),I=o(80444),T=o(24229),F=o(29798),A=o(7011),K=o(32163),B=o(53336),P=o(36591),V=o(42853),D=o(74647),E=o(4708),R=o(50141),U=o(81258),N=o(52275),O=o(89728),H=o(53437),L=o(72495),G=o(64921);function z(){window.__c={n:"UpdateSidebarTabCommentsSegmentedControl"};const e=(0,c.VK)((()=>A.ZP.state.commentsMode),[]),t=(0,p.yK)((e=>({container:{background:e.buttonHoveredBackground,width:"calc(100% - 32px)",height:36,borderRadius:10,display:"flex",margin:"10px 16px 6px 16px",marginTop:20,padding:4,gap:2,pointerEvents:"auto"},defaultButton:{borderRadius:8,fontSize:13,fontWeight:y.Z.fontWeight.medium,textAlign:"center",width:"100%",display:"flex",justifyContent:"center",alignItems:"center",lineHeight:1.8,color:e.regularTextColor,letterSpacing:-.08},selectedButton:{fontWeight:y.Z.fontWeight.semibold,background:e.segmentedControlActiveBackground,border:`0.5px solid ${e.outlineButtonBorder}`}})),[]);return s()("div",{style:t.container,className:w.rG8},void 0,s()(G.Z,{style:{...t.defaultButton,...e===A.F7.Unresolved?t.selectedButton:{}},onClick:()=>{D.setUpdateSidebarCommentsMode(A.F7.Unresolved)}},void 0,s()("span",{},void 0,s()(b.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.open",defaultMessage:"Open"}))),s()(G.Z,{style:{...t.defaultButton,...e===A.F7.Resolved?t.selectedButton:{}},onClick:()=>{D.setUpdateSidebarCommentsMode(A.F7.Resolved)}},void 0,s()("span",{},void 0,s()(b.FormattedMessage,{id:"updateSidebarTabCommentsSegmentedControl.option.resolved",defaultMessage:"Resolved"}))))}const W=[A.F7.Unresolved,A.F7.Resolved],$={[A.F7.Unresolved]:w.oc0,[A.F7.Resolved]:w.Y7r},j=(0,b.defineMessages)({[A.F7.Unresolved]:{id:"updateSidebar.comments.mode.unresolvedOption",defaultMessage:"Open comments"},[A.F7.Resolved]:{id:"updateSidebar.comments.mode.resolvedOption",defaultMessage:"Resolved comments"}}),Y=(0,b.defineMessages)({[A.F7.Unresolved]:{id:"updateSidebar.comments.filter.button.unresolvedMode",defaultMessage:"Open"},[A.F7.Resolved]:{id:"updateSidebar.comments.filter.button.resolvedMode",defaultMessage:"Resolved"}});function q(){window.__c={n:"UpdateSidebarCommentsFilterControl"};return(0,l.O7)().device.isMobile?s()(z,{}):s()(J,{})}function J(){window.__c={n:"DesktopUpdateSidebarCommentsFilterControl"};const[e,t]=(0,r.useState)(!1),{commentsMode:o}=(0,c.Kw)(A.ZP),i=(0,c.VK)((()=>I.default.state.mainEditorCurrentBlockStore),[]),a=(0,c.VK)((()=>(0,E.gE)()),[]),d=(0,p.yK)((e=>({container:{display:"flex",flexDirection:"column"},commentsHeader:{display:"flex",justifyContent:"space-between",borderBottom:`1px solid ${e.regularDividerColor}`,alignItems:"center",pointerEvents:"auto"},label:{fontSize:14,color:e.regularTextColor,fontWeight:y.Z.fontWeight.medium,display:"flex",alignItems:"center",padding:"12px 12px 12px 16px"},toggleButton:{justifyContent:"center",display:"flex",color:e.mediumTextColor},toggleButtonContainer:{paddingLeft:12,paddingRight:8,display:"flex"},chevronIcon:{width:10,marginLeft:4,fill:e.lightIconColor},getNotifiedContainer:{paddingRight:6,paddingLeft:6}})),[]),l=(0,r.useCallback)((()=>s()(K.Z,{type:K.i.Vertical,initialFocus:void 0,sections:[{key:"commentFilter",render:e=>r.createElement(L.Z,e),items:W.map((e=>({key:e,render:t=>r.createElement(N.Z,n()({},t,{className:$[e],title:C.default.formatMessage(j[e]),right:s()("div",{style:{width:14,opacity:o===e?1:0}},void 0,(0,P.e)())})),action:()=>{D.setUpdateSidebarCommentsMode(e),t(!1)}})))}]})),[o]);return r.createElement(r.Fragment,null,s()("div",{style:d.container},void 0,"variant_2"===a&&i&&s()("div",{style:d.getNotifiedContainer},void 0,s()(R.n,{navigableBlock:i,from:"comments_tab",buttonPopupStore:U.Z})),s()("div",{style:d.commentsHeader,className:w.I9j},void 0,s()("div",{style:d.label},void 0,s()(b.FormattedMessage,{id:"updateSidebar.header.commentsLabel",defaultMessage:"Comments"})),s()("div",{style:d.toggleButtonContainer,className:w.CBT},void 0,s()(H.ZP,{popupType:H.ZP.PopupType.Popup,open:e,origin:s()(O.Z,{style:d.toggleButton,onClick:()=>{t(!0)}},void 0,C.default.formatMessage(Y[o]),(0,V.i)(d.chevronIcon)),placementToOrigin:H.ZP.Placement.Bottom,alignmentToOrigin:H.ZP.Alignment.Center,originGap:4,render:l,onDismiss:()=>{t(!1)}})))))}var X=o(21202),Q=o(77907),ee=o(35973),te=o(57559),oe=o(28992);const ie=r.forwardRef(((e,t)=>{window.__c={n:"UpdateSidebarDiscussionItem"};const{currentBlockStore:o,discussion:i,showAllRepliesAfterTimestamp:n,focused:a,isLast:d,location:u}=e,m=(0,c.VK)((()=>T.Z.state.open&&T.Z.state.discussionIds||[]),[]),g=(0,l.O7)();(0,r.useEffect)((()=>{var e;if(a){ee.Z.setState({source:"update_sidebar",discussionIds:[i.id]});const e=setTimeout((()=>{var e;(null===(e=ee.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&h.AM([i.id])}),1500);return()=>{clearTimeout(e)}}(null===(e=ee.Z.state)||void 0===e||null===(e=e.discussionIds)||void 0===e?void 0:e[0])===i.id&&ee.Z.setState({discussionIds:[]})}),[a,i,g]);const f=(0,c.VK)((()=>{var e;return(null===(e=ee.Z.state)||void 0===e?void 0:e.discussionIds)||[]}),[]),v=i.id,{parentId:y,currentSpaceId:b}=(0,c.VK)((()=>({parentId:i.getParentId(),currentSpaceId:i.getSpaceId()})),[i]),S=y?te.G.createChildStore(i,{table:X.iU,id:y}):void 0,C=m.includes(v),k=f.includes(v),x=(0,p.yK)((e=>({discussionContainer:{paddingTop:g.device.isMobile?4:10,borderBottom:d||g.device.isMobile?void 0:`1px solid ${e.regularDividerColor}`,transition:"background 300ms ease"},replyButton:{color:e.blueColor,marginLeft:23,fontSize:14},hoveredStyle:{background:"sidebar"===u?e.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===u?e.focusDiscussionBackground:void 0}})),[u,d,g]);if(!S||!b)return null;const Z=r.createElement("div",{className:`sidebar-discussion-${v} ${w.s$o}`,onClick:e.onClick,onMouseEnter:e.onMouseEnter,ref:t,style:{...x.discussionContainer,...a||k?x.hoveredStyle:{},...C?x.pressedStyle:{}}},s()(Q.LazyDiscussion,{store:i,blockStore:o,format:M.O2.Sidebar,isFirst:!1,isOnly:!1,showResolveButtonByDefaultIfPossible:!1,discussionLocation:"updates_sidebar",showAllRepliesAfterTimestamp:n}));return s()(oe.Z,{allowTextSelection:!0,title:Z,style:{marginLeft:-14,marginRight:-14,width:"calc(100% + 28px)",lineHeight:void 0,cursor:"pointer"}})}));function ne(e){window.__c={n:"UpdateSidebarDiscussionSection"};const{firstItemId:t}=e,o=(0,c.VK)((()=>{var e;return null===(e=ee.Z.state)||void 0===e?void 0:e.discussionIds.some((e=>e===t))}),[t]),i=(0,c.VK)((()=>T.Z.state.open&&T.Z.state.discussionIds&&T.Z.state.discussionIds.some((e=>e===t))),[t]),a=(0,p.yK)((t=>({hoveredStyle:{background:"sidebar"===e.location?t.hoveredDiscussionBackground:void 0},pressedStyle:{background:"sidebar"===e.location?t.focusDiscussionBackground:void 0},basicDesktopTitleStyle:{paddingLeft:16,paddingTop:16,marginBottom:0,marginTop:0,fontSize:12,transition:"background 300ms ease"},mobileTitleStyle:{fontSize:13,fontWeight:y.Z.fontWeight.medium,paddingBottom:0,textTransform:"unset",marginTop:-12}})),[e.location]);return r.createElement(L.Z,n()({desktopTitleStyle:{...a.basicDesktopTitleStyle,...o?a.hoveredStyle:{},...i?a.pressedStyle:{}},mobileTitleStyle:a.mobileTitleStyle,disableDesktopPadding:!0,disableMobileBorders:!0},e))}var ae=o(70268);const se=new F.Z;function re(e){window.__c={n:"UpdateSidebarTabComments"};const{timeMounted:t,location:o}=e,i=(0,l.O7)(),[a,F]=(0,r.useState)(!1),P=(0,c.VK)((()=>I.default.state.mainEditorCurrentBlockStore),[]),V=(0,c.VK)((()=>i.currentUser.id),[i]),D=(0,c.VK)((()=>(0,M.DF)({blockStore:P,ignoreAfterTime:t,currentUserId:V})),[P,t,V]),[E]=(0,c.AF)(A.ZP),R=(0,c.VK)((()=>(0,Z._c)(i)),[i]),U=(0,c.VK)((()=>T.Z.state.open&&T.Z.state.discussionIds||[]),[]),{resolved:N,unresolved:O}=(0,c.VK)((()=>(0,k.bB)(D)),[D]),H=E.commentsMode===A.F7.Unresolved,L=H?O:N,G=L.map((e=>e.id));(0,r.useEffect)((()=>{if("popup"===o&&a)return()=>{h.AM(G)}}),[o,G,a]);const z=(0,p.yK)((e=>({commentsEmptyStyle:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,position:"relative",background:e.contentBackground,marginRight:R?2:0,pointerEvents:"auto",paddingTop:10},commentsContentStyle:{position:"relative",minHeight:0,display:"flex",flexDirection:"column",background:e.contentBackground,marginRight:R?2:0,pointerEvents:"auto",height:"100%"},commentsIconStyle:{height:54,width:54,marginBottom:12,fill:e.mediumIconColor}})),[R]),W=(0,r.useRef)(null),$=(0,c.VK)((()=>(0,Z.Sx)(i)),[i]);(0,d.O)({active:$,closeHandler:S.LZ,ref:W});const j=(0,c.VK)((()=>{const e=f.vM(L,(e=>{const t=(0,M.Qg)({recordStore:e,currentUserId:V});return t?(0,u.$6)(t.getCreatedTime()):""}));return delete e[""],e}),[L,V]),Y=(0,c.VK)((()=>(0,M.W5)(L)),[L]);if((0,r.useEffect)((()=>{a||Y||F(!0)}),[a,Y]),!P||!j||!a)return s()(ae.B,{areaHeight:window.innerHeight});if(0===L.length)return s()("div",{style:z.commentsContentStyle},void 0,s()(q,{}),s()("div",{style:z.commentsEmptyStyle},void 0,g(z.commentsIconStyle),s()("div",{style:{fontWeight:y.Z.fontWeight.semibold,marginBottom:4}},void 0,s()(b.FormattedMessage,H?{id:"updateSidebar.commentContainer.emptyTitleUnresolved",defaultMessage:"No open comments yet"}:{id:"updateSidebar.commentContainer.emptyTitleResolved",defaultMessage:"No resolved comments yet"})),s()("div",{style:{width:200,alignSelf:"center"}},void 0,s()(b.FormattedMessage,H?{id:"updateSidebar.commentContainer.emptyUnresolved",defaultMessage:"Open comments on this page will appear here"}:{id:"updateSidebar.commentContainer.emptyResolved",defaultMessage:"Resolved comments on this page will appear here"}))));const J=Object.keys(j).sort().reverse(),X=J.map(((e,a)=>{const s=(0,u.ZV)({value:{type:"date",start_date:e},date_format:"relative",userTimeZone:(0,m.r)(),intl:C.default.getIntl(),allowRelativeDates:!0}),d=j[e];return{key:e,render:e=>r.createElement(ne,n()({title:s,firstItemId:d[0].id,location:o},e)),items:d.map(((e,s)=>({key:e.id,render:i=>r.createElement(ie,n()({},i,{currentBlockStore:P,discussion:e,isFirstInSection:0===s,location:o,isLast:s===d.length-1&&a===J.length-1,showAllRepliesAfterTimestamp:t})),action:()=>{h.en({discussionId:e.id,currentBlockStore:P,environment:i,analyticsFrom:"updates_sidebar",currentEl:W.current})}})))}})),Q=X.flatMap((e=>e.items)).findIndex((e=>U.includes(e.key.toString())));return r.createElement("div",{style:z.commentsContentStyle,ref:W},s()(q,{}),s()(B.Z,{type:_.Z.Y,style:{flexGrow:1,minHeight:0,transform:"translateZ(0px)",zIndex:1,overflow:"hidden auto",marginBottom:0},className:w.Xsh},void 0,s()(K.Z,{disableKeyboard:!0,store:se,type:K.i.Vertical,initialFocus:Q>=0?Q:void 0,scrollElIntoView:e=>{if(e instanceof Element){const t=e.getBoundingClientRect(),o=v.R6(i.device.isElectronMac),n=window.innerHeight,a=o+50,s=n-a;if(t.height>=s)return;const r=t.top>=a&&t.top<=n,d=r&&t.bottom>=n,l=t.bottom>=a&&t.bottom<=n,c=l&&t.top-a<0,p=r||l,u=.4*t.height;d&&Math.abs(t.top-n)<u?(0,x.Wr)(e,{edgeDist:n-t.height-a,animate:!0}):c&&Math.abs(t.bottom-a)<u?(0,x.Wr)(e,{edgeDist:0,animate:!0}):p||(0,x.Wr)(e,{edgeDist:0,animate:!0})}},sections:X})))}},50141:(e,t,o)=>{o.d(t,{n:()=>T});var i=o(23174),n=o.n(i),a=o(67294),s=o(86628),r=o(24405),d=o(82990),l=o(5366),c=o(4708),p=o(10434),u=o.n(p),m=o(480),g=o(90792),f=o(42853),v=o(62967),y=o(19719),b=o(48019),S=o(31945),h=o(78140),w=o(89728),M=o(72495),C=o(87279),k=o(98742),x=o(77080),Z=o(24764),_=o(57538);function I(e){var t;window.__c={n:"GetNotifiedDropdown"};const{blockStore:o,from:i,buttonPopupStore:l}=e,p=e.moreProminentStyling??!1,I=(0,m.O7)(),T=(0,s.VK)((()=>o.isPageBlock()),[o]),F=(0,s.VK)((()=>o.getFollowSettingsKey()),[o]),A=(0,s.VK)((()=>(0,c.m7)()),[]),K=(0,a.useCallback)((()=>y.Z8({environment:I,pageId:o.pointer.id,isCurrentlyFollowing:(0,_.Z)(F).following,from:"page_updates"===i?"page_updates":void 0})),[o.pointer.id,I,F,i]),B=(0,s.VK)((()=>x.default.checkGate("property_updates_notifications")?Z.CA({followSettingsKey:F,environment:I,blockStore:o,from:i,useCopyChanges:A}):Z.Zk({followSettingsKey:F,environment:I,blockStore:o,from:i})),[F,I,o,i,A]),P=(0,r.yK)((e=>({buttonContainer:{display:"flex",alignItems:"center",color:e.mediumTextColor,padding:p?"4px 10px":4,borderRadius:3,marginRight:p?0:4,fontSize:d.Z.fontSize.UIRegular.desktop},bellIcon:{width:14,height:14,marginRight:4},chevronIcon:{marginLeft:4,width:10,height:10},spacer:{flexGrow:1},footerLabel:{padding:12,backgroundColor:e.sidebarSecondaryBackground,boxShadow:`0 -1px 0 ${e.regularDividerColor}`,marginTop:1}})),[p]),V=null===(t=B.find((e=>Z.t0({key:e.action.analyticsName,userSelectedKey:F}))))||void 0===t?void 0:t.title;return T?n()(S.ZP,{popupType:S.Z4.Popup,alignmentToOrigin:S.vR.End,placementToOrigin:S.pO.Bottom,sameWidthAsOrigin:p,buttonPopupStore:l,render:e=>n()(h.Z,{menuType:C.og.Popup,minWidth:290,maxHeight:"50vh"},void 0,n()(b.Z,{context:{blocks:[],environment:I,publicEditMode:void 0},sections:[(0,v.$J)({key:"in-app-notifications-section",render:e=>a.createElement(M.Z,e),actions:B.map((e=>e.action))})],initialFocus:void 0,onAccept:()=>e.close()})),renderOrigin:e=>a.createElement(w.Z,u()({},(0,k.Z)(e,{onClick:K}),{style:P.buttonContainer}),(0,g.t)(P.bellIcon),V,p&&n()("div",{style:P.spacer}),(0,f.i)(P.chevronIcon))}):null}function T(e){window.__c={n:"GetNotifiedFor"};const{navigableBlock:t,from:o,buttonPopupStore:i}=e,a=(0,s.VK)((()=>(0,c.m7)()),[]),p=(0,s.VK)((()=>t.isPageBlock()),[t]),u=(0,r.yK)((e=>({label:{fontSize:d.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,fontWeight:d.Z.fontWeight.medium},container:{padding:"12px 8px 8px 10px"},border:{border:`1px solid ${e.outlineButtonBorder}`,borderRadius:3,marginTop:8}})),[]);return p?n()("div",{style:u.container},void 0,n()("div",{style:u.label},void 0,n()(l.FormattedMessage,a?{id:"UpdateSidebarTabUpdatesHeader.pageNotificationSettings.label",defaultMessage:"Page notification settings"}:{id:"UpdateSidebarTabUpdatesHeader.getNotifiedButton.label",defaultMessage:"Get notified for"})),n()("div",{style:u.border},void 0,n()(I,{blockStore:t,moreProminentStyling:!0,from:o,buttonPopupStore:i}))):null}},24764:(e,t,o)=>{o.d(t,{t0:()=>Z,Zk:()=>k,CA:()=>C});var i=o(10434),n=o.n(i),a=o(23174),s=o.n(a),r=o(67294),d=o(45433),l=o(98519),c=o(97880),p=o(5366),u=o(62967),m=o(57883),g=o(50906),f=o(9953),v=o(39699);function y(e){const{environment:t,key:o,selectedKey:i,following:n,followSettings:a,navigableBlockId:s,userId:r,spaceId:d,from:l}=e;v.createAndCommit({userAction:"UpdateSidebarFollowControl.setFollowing",environment:e.environment,canUndo:!1,perform:t=>{f.Ue({environment:e.environment,table:m.t0,args:{following:n,followSettings:a,navigableBlockId:s,userId:r,spaceId:d},inMemoryRecordCache:e.environment.defaultRecordCache.inMemoryRecordCache,transaction:t})}}),n?g.RJe(t,{from:"page_updates"}):g.ubm(t,{from:"page_updates"}),i!==o&&g.kLN(t,{from:l,navigableBlockId:s,oldSetting:i,newSetting:o})}var b=o(64964),S=o(93405),h=o(64369),w=o(80444),M=o(57538);function C(e){const{followSettingsKey:t,environment:o,blockStore:i,from:n,useCopyChanges:a}=e,r=x({key:"none",selectedKey:t,title:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.repliesAndMentions.label",defaultMessage:"Replies and @mentions"}:{id:"GetNotifiedDropdown.mentionsAndReplies.label",defaultMessage:"Only replies and @mentions"}),environment:o,blockStore:i,from:n}),l=x({key:"comments",selectedKey:t,title:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.allComments.label",defaultMessage:"All comments"}:{id:"GetNotifiedDropdown.allUpdatesComments.label",defaultMessage:"All updates"}),caption:a?void 0:s()(p.FormattedMessage,{id:"GetNotifiedDropdown.allComments.caption",defaultMessage:"All comments and @mentions"}),environment:o,blockStore:i,from:n}),c=x({key:"all",selectedKey:t,title:s()(p.FormattedMessage,{id:"GetNotifiedDropdown.allUpdates.label",defaultMessage:"All updates"}),caption:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.simpleAllUpdates.caption",defaultMessage:"All comments and property changes"}:{id:"GetNotifiedDropdown.allUpdates.caption",defaultMessage:"All comments, @mentions, and property changes"}),environment:o,blockStore:i,from:n}),u=i.getAssociatedCollectionStore();if(!u)return[l,r];const m=u.getDatabaseType();if(m===d.GL.tasks){return[c,x({key:"important",selectedKey:t,title:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.importantUpdatesTasks.label",defaultMessage:"Important updates"}:{id:"GetNotifiedDropdown.onlyImportantUpdatesTasks.label",defaultMessage:"Only important updates"}),caption:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.importantUpdatesTasks.caption",defaultMessage:"All comments and changes to Status, Assignee, or Due Date"}:{id:"GetNotifiedDropdown.onlyImportantUpdatesTasks.caption",defaultMessage:"All comments, @mentions, and changes to Status, Assignee, or Due Date"}),environment:o,blockStore:i,from:n}),r]}if(m===d.GL.projects){return[c,x({key:"important",selectedKey:t,title:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.importantUpdatesProjects.label",defaultMessage:"Important updates"}:{id:"GetNotifiedDropdown.onlyImportantUpdatesProjects.label",defaultMessage:"Only important updates"}),caption:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.importantUpdatesProjects.caption",defaultMessage:"All comments and changes to Status or Date"}:{id:"GetNotifiedDropdown.onlyImportantUpdatesProjects.caption",defaultMessage:"All comments, @mentions, and changes to Status or Date"}),environment:o,blockStore:i,from:n}),r]}return[c,x({key:"comments",selectedKey:t,title:s()(p.FormattedMessage,a?{id:"GetNotifiedDropdown.onlyCommentsAllComments.label",defaultMessage:"All comments"}:{id:"GetNotifiedDropdown.onlyComments.label",defaultMessage:"Only comments"}),caption:a?void 0:s()(p.FormattedMessage,{id:"GetNotifiedDropdown.onlyComments.caption",defaultMessage:"All comments and @mentions"}),environment:o,blockStore:i,from:n}),r]}function k(e){const{followSettingsKey:t,environment:o,blockStore:i,from:n}=e;return[x({key:"important",selectedKey:t,title:s()(p.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.allComments.label",defaultMessage:"All comments"}),caption:s()(p.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.allComments.caption",defaultMessage:"Notified of all comments and @mentions"}),environment:o,blockStore:i,from:n}),x({key:"none",selectedKey:t,title:s()(p.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.label",defaultMessage:"Replies and @mentions"}),caption:s()(p.FormattedMessage,{id:"inAppNotificationsFollowingOptionsHelpers.mentionsAndReplies.caption",defaultMessage:"Notified of comment replies and @mentions"}),environment:o,blockStore:i,from:n})]}function x(e){const{key:t,title:o,caption:i,selectedKey:a,environment:d,blockStore:c,from:p}=e,m=Z({key:t,userSelectedKey:a}),g={icon:{width:14,height:14},rightWrapper:i?{alignSelf:"flex-start",paddingTop:2}:{}};return{action:(0,u.cN)({key:t,displayName:void 0,analyticsName:t,validators:[],closeParentMenu:!0,action:()=>{const{currentUserRootStore:e}=w.default.state;if(e){const{following:o,followSettings:i}=(0,M.Z)(t),n=e.id,s=c.id,r=c.getSpaceId();y({environment:d,following:o,followSettings:i,navigableBlockId:s,spaceId:r,userId:n,from:p,key:t,selectedKey:a}),"inbox"!==p&&"more_menu"!==p||b.d4({item:{label:_(t)},undoFunc:()=>{const{following:e,followSettings:o}=(0,M.Z)(a);y({environment:d,following:e,followSettings:o,navigableBlockId:s,spaceId:r,userId:n,from:p,key:t,selectedKey:a})}})}},render:e=>r.createElement(S.Z,n()({},e,{title:s()(h.Z,{},void 0,o),caption:i,shouldWrapCaption:!0,right:m?(0,l.k)(g.icon):s()("div",{style:g.icon}),rightStyle:g.right}))}),title:o,isSelectedOption:m}}function Z(e){const{key:t,userSelectedKey:o}=e;return"important"===o||"comments"===o?"important"===t||"comments"===t:t===o}function _(e){switch(e){case"none":return s()(p.FormattedMessage,{id:"GetNotifiedDropdown.subscribedRepliesAndMentionsSuccess.snackbarMessage",defaultMessage:"Subscribed to replies and @mentions"});case"comments":return s()(p.FormattedMessage,{id:"GetNotifiedDropdown.subscribedAllCommentsSuccess.snackbarMessage",defaultMessage:"Subscribed to all comments"});case"important":return s()(p.FormattedMessage,{id:"GetNotifiedDropdown.subscribedImportantUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to important updates"});case"all":return s()(p.FormattedMessage,{id:"GetNotifiedDropdown.subscribedAllUpdatesSuccess.snackbarMessage",defaultMessage:"Subscribed to all updates"});default:(0,c.t1)(e)}}},88144:(e,t,o)=>{o.r(t),o.d(t,{GetNotifiedFor:()=>i.n,TopbarUpdatesMenu:()=>x,UpdateSidebar:()=>$e});var i=o(50141),n=o(10434),a=o.n(n),s=o(23174),r=o.n(s),d=o(67294),l=o(86628),c=o(24405),p=o(5366),u=o(84708),m=o(78140),g=o(480),f=o(80503),v=o(82990),y=o(43250),b=o(81258);const S=new(o(61766).Z);var h=o(7011),w=o(66957);function M(){return r()(p.FormattedMessage,{id:"updateSidebar.header.updatesLabel",defaultMessage:"Updates"})}function C(e){window.__c={n:"UpdateSidebarTabUpdatesHeader"};const t=(0,g.O7)(),{enablePageAnalytics:o,popOutMode:n,navigableBlock:a,inPeekView:s}=e,d=(0,c.yK)((e=>({updatesHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:n?0:f.R6(t.device.isElectronMac),paddingTop:4,width:n&&!s?"calc(100% - 2px)":"100%",background:s?e.popoverBackground:e.contentBackground,padding:"12px 12px 12px 16px",borderBottom:`1px solid ${e.regularDividerColor}`},label:{fontSize:14,color:e.regularTextColor,fontWeight:v.Z.fontWeight.medium}})),[n,t,s]),u=(0,l.VK)((()=>h.ZP.state.currentSubTab),[]),m=s?S:b.Z;return r()("div",{style:{...d.updatesHeaderStyle,...o?{padding:"0 6px"}:{}},className:y.cFM},void 0,r()(i.n,{navigableBlock:a,from:"page_updates",buttonPopupStore:m}),o?r()(w.Z,{tabs:[r()(M,{},"updates"),r()(p.FormattedMessage,{id:"updateSidebar.header.analyticsLabel",defaultMessage:"Analytics"},"analytics")],selectedIndex:u,onChange:e.onTabChange,style:{...d.label,padding:0,boxShadow:"none"},tabStyle:{padding:"12px 0"}}):r()("div",{style:d.label},void 0,r()(M,{})))}var k=o(87279);function x(e){window.__c={n:"TopbarUpdatesMenu"};const{blockStore:t,spaceStore:o}=e,i=function(e){const{spaceStore:t,blockStore:o}=e,i=(0,l.VK)((()=>{var e,t;return(null==o||null===(e=o.getModel())||void 0===e?void 0:e.isCollectionView())?null===(t=o.getCollectionPointer())||void 0===t?void 0:t.id:void 0}),[o]);if(!t)return;const n=o.id,a=t.id;return{navigableBlockId:n,collectionId:i,spaceId:a}}({blockStore:t,spaceStore:o});return i?r()(m.Z,{menuType:k.og.Popup,className:y.KLh,header:r()(C,{navigableBlock:t,enablePageAnalytics:!1,popOutMode:!0,inPeekView:!0})},void 0,d.createElement(u.Z,a()({key:t.id,empty:()=>r()(Z,{}),source:"updates_sidebar",navigableBlock:t},i))):null}function Z(){window.__c={n:"EmptyState"};const e=(0,c.yK)((e=>({container:{marginTop:64,textAlign:"center",paddingLeft:18,paddingRight:18,marginBottom:64},content:{fontSize:14,color:e.mediumTextColor,marginTop:4}})),[]);return r()("div",{style:e.container},void 0,r()("div",{style:e.content},void 0,r()("span",{},void 0,r()(p.FormattedMessage,{defaultMessage:"No edits in this page yet.",id:"topbar.updatesButton.emptyState"}))))}var _=o(74725),I=o(97880),T=o(51454),F=o(50906),A=o(74647),K=o(81598),B=o(23063),P=o(3553),V=o(55064),D=o(70268),E=o(69054),R=(o(21703),o(30120)),U=o(45010),N=o(45094),O=o(34859),H=o(80444),L=o(53336),G=o(30251),z=o(13991),W=o(7057),$=o(53877),j=o(83176),Y=o(82855),q=o(16880),J=o(84169),X=o(18442),Q=o(72126),ee=o(32056),te=o(54368),oe=o(77420),ie=o(19889),ne=o(62965),ae=o(16287),se=o(54642),re=o(25320),de=o(83420),le=o(20095),ce=o(65598),pe=o(18514),ue=o(41168),me=o(35314),ge=o(77907),fe=o(44904),ve=o(57559),ye=o(31945),be=o(73420),Se=o(68785),he=o(63296),we=o(70301),Me=o(64369),Ce=o(45653),ke=o(67579),xe=o(64536);const Ze=Date.now();function _e(e){let{store:t,spaceId:o,isDisabledForWorkspace:i}=e;window.__c={n:"PageAnalytics"};const[n,a]=(0,d.useState)("last_28_days"),[s,u]=(0,d.useState)({state:i?"disabled-for-workspace":"loading"}),f=(0,g.O7)(),v=(0,c.Fg)(),y=(0,l.VK)((()=>{const{currentSpaceStore:e}=H.default.state;return null==e?void 0:e.getName()}),[]),b=(0,l.VK)((()=>{switch(n){case"last_7_days":return 7;case"last_28_days":return 28;case"last_90_days":return 90;case"all_time":return}}),[n]);(0,d.useEffect)((()=>{i||async function(){const e=await se.getPageAnalytics(f,{pageId:t.id,spaceId:o,days:b});if("failed"===e.type)return void u({state:"empty"});const i=e.data.map((e=>{let{ds:t,total_views:o,unique_views:i}=e;return{ds:t,values:{total_views:o,unique_views:i}}}));i.filter((e=>{let{ds:t}=e;return $.OQ.isoToUnixMs(t,"UTC")??Ze<=Ze})).every((e=>{let{values:t}=e;return 0===t.total_views}))?u({state:"empty"}):u({state:"loaded",data:i})}()}),[f,t.id,i,o,b]);const S=(0,c.yK)((e=>({fullHeight:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},spinner:{width:32,height:32}})),[]);return"loading"===s.state?r()("div",{style:S.fullHeight},void 0,r()(Se.Z,{style:S.spinner})):"empty"===s.state?r()("div",{style:S.fullHeight},void 0,r()(Ee,{heading:r()(p.FormattedMessage,{id:"page_analytics.empty.heading",defaultMessage:"No page analytics yet"}),description:r()(p.FormattedMessage,{id:"page_analytics.empty.description",defaultMessage:"It may take some time for page view information to appear."})})):"disabled-for-workspace"===s.state?r()("div",{style:S.fullHeight},void 0,r()(Ee,{heading:r()(p.FormattedMessage,{id:"page_analytics.disabled.heading",defaultMessage:"Page viewership tracking is disabled"}),description:r()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16}},void 0,r()(p.FormattedMessage,y?{id:"page_analytics.disabled.description",defaultMessage:"Page viewership and analytics is turned off for all pages in {name}",values:{name:y}}:{id:"page_analytics.disabled.description.unnamed",defaultMessage:"Page viewership and analytics is turned off for all pages in your space"}),r()("a",{href:(0,pe.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:v.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"}},void 0,(0,J.m)({width:14,height:14}),r()(Me.Z,{isSmall:!0},void 0,r()(p.FormattedMessage,{id:"page_analytics.disabled.learnMore",defaultMessage:"Learn more"}))))})):r()("div",{style:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"100%"}},void 0,r()(be.sg,{grow:1,gap:16},void 0,r()(Te,{store:t,data:s.data,currentFilter:n,onChangeFilter:a}),r()(Ae,{store:t}),r()(De,{spaceId:o,store:t})),r()("div",{style:{borderTop:`1px solid ${v.regularDividerColor}`,padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,r()(ye.ZP,{renderOrigin:e=>{let{onClick:t}=e;return r()(he.Z,{onClick:t,icon:X.H},void 0,r()(p.FormattedMessage,{id:"page_analytics.timeseries.settings",defaultMessage:"Settings"}))},popupType:f.device.isMobile?ye.Z4.SlideUp:ye.Z4.Popup,render:()=>r()(m.Z,{menuType:k.og.Popup,width:460},void 0,r()("div",{style:Ie},void 0,r()(xe.PageAnalyticsPageOptOut,{store:t})))}),r()("a",{href:(0,pe.UY)("guides.pageAnalytics"),target:"_blank",style:{display:"flex",gap:4,color:v.regularTextColor,alignItems:"center",textDecoration:"none",cursor:"pointer"}},void 0,(0,J.m)({width:14,height:14}),r()(Me.Z,{isSmall:!0},void 0,r()(p.FormattedMessage,{id:"page_analytics.timeseries.learnMore",defaultMessage:"Learn more"})))))}const Ie={margin:"8px 16px",pointerEvents:"auto",cursor:"default"};function Te(e){window.__c={n:"PageAnalyticsGraph"};const[t,o]=(0,me.e)(),{blueLayer:i,yellowLayer:n}=(0,G.useTimeSeriesPalette)(),a=(0,d.useMemo)((()=>{if(0===e.data.length)return Ze;const t=$.OQ.isoToUnixMs(e.data[0].ds,"UTC")??Ze;return Math.min(t,Ze)}),[e.data]);return r()("div",{},void 0,r()(Fe,{store:e.store,data:e.data,currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter}),d.createElement("div",{ref:t,style:{...Ie,marginBottom:0}},r()(ge.LazyTimeSeries,{startDate:(0,W.$6)(a,!0),endDate:(0,W.$6)(Ze,!0),width:o,height:175,data:e.data,layers:[{key:"total_views",...i,renderLabel:e=>r()(p.FormattedMessage,{id:"page_analytics.timeseries.total_views",defaultMessage:"{views, plural, one {1 total view} other {{views} total views}}",values:{views:e}})},{key:"unique_views",...n,renderLabel:e=>r()(p.FormattedMessage,{id:"page_analytics.timeseries.unique_views",defaultMessage:"{uniqueViews, plural, one {1 unique view} other {{uniqueViews} unique views}}",values:{uniqueViews:e}})}]})))}function Fe(e){window.__c={n:"PageAnalyticsHeader"};const t=(0,p.useIntl)(),o=(0,d.useMemo)((()=>e.data.reduce(((e,t)=>{let{values:o}=t;return e+o.total_views}),0)),[e.data]);return r()("div",{style:{margin:"14px 16px",display:"flex",justifyContent:"space-between",alignItems:"center"}},void 0,r()(be.X2,{justifyContent:"space-between",alignItems:"center",grow:1},void 0,r()(be.X2,{gap:4},void 0,r()(Me.Z,{style:{fontWeight:500}},void 0,r()(p.FormattedMessage,{id:"page_analytics.timeseries.title",defaultMessage:"Views"})),r()(Me.Z,{isSecondaryColor:!0},void 0,r()(p.FormattedMessage,{id:"page_analytics.timeseries.totalViews",defaultMessage:"({totalViews} total)",values:{totalViews:(0,ee.uf)(o,"number_with_commas",t)}}))),r()(ke.f,{currentFilter:e.currentFilter,onChangeFilter:e.onChangeFilter})))}function Ae(e){window.__c={n:"PageAnalyticsViewers"};const{store:t}=e,{pageVisitStore:o,presenceStore:i}=(0,l.Kw)(H.default),n=(0,g.O7)();(0,d.useEffect)((()=>{re.Ri(n,{block:t,pageVisitStore:o,incremental:!1,limit:re.s4})}),[n,t,o]);const a=(0,l.VK)((()=>(0,le.AQ)(o,i)),[o,i]);if(0===a.length)return null;const s=a.map((e=>{let{userId:o,activityTimestampNearestMinuteMs:i}=e;return{actorStore:ve.U6.createChildStore(t,{id:o,table:ie.KJ}),timestamp:i}}));return r()("div",{style:{...Ie,display:"flex",flexDirection:"column",gap:12}},void 0,r()(Me.Z,{style:{fontWeight:500}},void 0,r()(p.FormattedMessage,{id:"page_analytics.viewers.title",defaultMessage:"Viewers"})),r()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,r()(Ke,{store:t,actorStores:s,collapsedLabel:r()(p.FormattedMessage,{id:"page_analytics.viewers.expand",defaultMessage:"Show more viewers"}),expandedLabel:r()(p.FormattedMessage,{id:"page_analytics.viewers.collapse",defaultMessage:"Show less viewers"})})))}function Ke(e){window.__c={n:"PageAnalyticsActorList"};const{store:t,actorStores:o,collapsedLabel:i,expandedLabel:n}=e,[a,s]=(0,d.useState)(!0),l=a?o.slice(0,5):o;return r()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,l.map((e=>{let{actorStore:o,timestamp:i}=e;return r()(Be,{store:t,actorStore:o,timestamp:i},o.id)})),o.length>5&&r()("button",{onClick:e=>{e.preventDefault(),s(!a)},style:{background:"none",border:"none",textAlign:"left",padding:0,marginTop:4}},"toggle",r()(Me.Z,{isSecondaryColor:!0,isSmall:!0,style:{display:"flex",gap:3,alignItems:"center"}},void 0,a?i:n,a?(0,Y.E)({width:12}):(0,q.R)({width:12}))))}function Be(e){window.__c={n:"PageAnalyticsActor"};const{actorStore:t,timestamp:o}=e,i=(0,p.useIntl)(),n=(0,d.useMemo)((()=>{const e=Date.now();return(0,W.tv)(Math.min(o??e,e),z.SP)}),[o]),a=(0,l.VK)((()=>t.getDisplayName(i)),[t,i]);return r()(be.X2,{alignItems:"center",justifyContent:"space-between"},void 0,r()(be.X2,{gap:4},void 0,r()(Pe,{actorStore:t}),r()(Me.Z,{style:{fontWeight:500}},void 0,a)),r()(Me.Z,{isSecondaryColor:!0},void 0,o?r()("span",{title:(0,W.Yx)(o,"medium_with_time",z.SP)},void 0,n):n))}function Pe(e){const{actorStore:t}=e;return t.table===oe.cZ?r()(we.Z,{botStore:t,size:18}):t.table===ie.KJ?r()(Ce.Z,{userStore:t,size:18}):t.table===te.y?r()(Ce.Z,{userStore:void 0,size:18}):void(0,I.t1)(t)}function Ve(e){const{environment:t,store:o,spaceId:i,hasAccessToEditors:n}=e,[,,a]=(0,l.AF)(void 0,fe.o),[s,r]=(0,d.useState)([]);(0,d.useEffect)((()=>{n&&ae.h(t,{store:a,activityIds:s,spaceId:i,filterActivityTypes:[],filterDateRange:{starting:void 0,ending:void 0},navigableBlockId:o.id})}),[s,a,i,o.id,t,n]);return(0,l.VK)((()=>{if(!n)return[];const e=a.state.activityIds;(0,ne.Z)(s,e)||r(e);const{currentSpaceStore:t}=H.default.state;if(!t)return[];const i=s.map((e=>(0,ce.No)(t,e,t.id))).flatMap((e=>{const t=e.getValue();return t?"top-level-block-created"!==t.type&&"top-level-block-deleted"!==t.type&&"block-edited"!==t.type?[]:function(e,t){var o;return Q.oA(null===(o=e.edits)||void 0===o?void 0:o.flatMap((e=>{var o;return null===(o=e.authors)||void 0===o?void 0:o.map((o=>({actorStore:(0,de.nc)({parentStore:t,pointer:o}),timestamp:e.timestamp})))})))}(t,o):[]})),d=Q.MR(i,"timestamp").reverse();return Q.mN(d,"userId")}),[s,a,n,o])}function De(e){window.__c={n:"PageAnalyticsEditors"};const{spaceId:t,store:o}=e,i=(0,g.O7)(),n=(0,l.VK)((()=>(0,ue.qb)(i,"business")||(0,ue.qb)(i,"enterprise")),[i]),a=Ve({environment:i,hasAccessToEditors:n,spaceId:t,store:o}),s=(0,l.VK)((()=>{const e=o.getCreatedByPointer(),t=o.getCreatedTime();if(e&&t)return{actorStore:(0,de.nc)({parentStore:o,pointer:e}),createdTime:t}}),[o]);return r()("div",{style:{...Ie,display:"flex",flexDirection:"column",gap:12}},void 0,r()(Me.Z,{style:{fontWeight:500}},void 0,r()(p.FormattedMessage,{id:"page_analytics.editors.title",defaultMessage:"Editors"})),s&&r()("div",{style:{display:"flex",flexDirection:"column",gap:10,marginBottom:6}},void 0,r()(Me.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500}},void 0,r()(p.FormattedMessage,{id:"page_analytics.editors.createdBy",defaultMessage:"Created by"})),r()(Be,{store:o,actorStore:s.actorStore,timestamp:s.createdTime})),n&&a.length>0&&r()("div",{style:{display:"flex",flexDirection:"column",gap:10}},void 0,r()(Me.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:500}},void 0,r()(p.FormattedMessage,{id:"page_analytics.editors.editedBy",defaultMessage:"Recently edited by"})),r()(Ke,{actorStores:a,store:o,collapsedLabel:r()(p.FormattedMessage,{id:"page_analytics.editors.expand",defaultMessage:"Show more editors"}),expandedLabel:r()(p.FormattedMessage,{id:"page_analytics.editors.collapse",defaultMessage:"Show less editors"})})))}function Ee(e){window.__c={n:"PageAnalyticsEmptyState"};const t=(0,c.yK)((e=>({column:{display:"flex",flexDirection:"column"},row:{display:"flex"},centered:{textAlign:"center",alignItems:"center",width:250},analyticsIcon:{position:"relative",top:-8,left:-4},secondaryIcon:{fill:e.mediumTextColor},settingsButton:{padding:"7.5px 10px",alignSelf:"center"},link:{cursor:"pointer",justifyContent:"center",alignItems:"center",padding:8,alignSelf:"center"}})),[]);return r()("div",{style:{...t.column,gap:24}},void 0,r()("div",{style:{...t.column,...t.centered,gap:4}},void 0,(0,j.z)({...t.secondaryIcon,...t.analyticsIcon,width:62,height:62}),r()(Me.Z,{isSecondaryColor:!0,style:{fontSize:16,fontWeight:500}},void 0,e.heading),r()(Me.Z,{isSecondaryColor:!0,style:{whiteSpace:"normal",overflow:"visible"}},void 0,e.description)))}function Re(e){let{enablePageAnalytics:t}=e;window.__c={n:"UpdateSidebarTabUpdates"};const o=(0,l.VK)((()=>H.default.state.mainEditorCurrentBlockStore),[]),i=(0,l.VK)((()=>{const e=R.ou.now().minus({years:1}).valueOf();return!!o&&o.getCreatedTime()<e}),[o]),n=(0,l.VK)((()=>H.default.state.currentSpaceStore),[]),a=(0,l.VK)((()=>!(null!=o&&o.canRead())),[o]),s=(0,g.O7)(),m=(0,l.VK)((()=>(0,N._c)(s)),[s]),f=(0,l.VK)((()=>{var e;const t=null==o?void 0:o.getModel();return o&&null!=t&&t.isCollectionView()?null===(e=o.getCollectionPointer())||void 0===e?void 0:e.id:void 0}),[o]),v=(0,l.VK)((()=>Boolean(null==n?void 0:n.getSettings().disable_page_analytics)),[n]),y=(0,c.yK)((e=>({updatesEmptyStyle:{flex:1,display:"flex",justifyContent:"center",flexDirection:"column",textAlign:"center",color:e.mediumTextColor,fontSize:14,background:e.contentBackground,marginRight:m?2:0,pointerEvents:"auto",height:"100%"},updatesNotEmptyStyle:{display:"flex",flexDirection:"column",flex:"1 1 0%",background:e.contentBackground,marginRight:m?2:0,pointerEvents:"auto",marginTop:1,height:"100%"}})),[m]),b=(0,l.VK)((()=>h.ZP.state.currentSubTab),[]);if(a)return r()(L.Z,{type:O.Z.Y,style:y.updatesEmptyStyle},void 0,r()("div",{style:{width:200,alignSelf:"center"}},void 0,r()(p.FormattedMessage,{id:"updateSidebar.commentContainer.restricted",defaultMessage:"You don't have permission to view the updates of this restricted page."})));if(n&&o)return d.createElement(L.Z,{type:O.Z.Y,ref:e=>{U.Z.UpdateSidebarScroller=e},style:y.updatesNotEmptyStyle},t&&r()("div",{style:{display:b===h.uF.Analytics?"block":"none",height:"100%"}},void 0,r()(_e,{spaceId:n.id,store:o,isDisabledForWorkspace:v})),r()("div",{style:{display:b===h.uF.Updates?"block":"none"}},void 0,r()(u.Z,{collectionId:f,navigableBlock:o,spaceId:n.id,source:"updates_sidebar",empty:e=>d.createElement(L.Z,{type:O.Z.Y,style:y.updatesEmptyStyle,ref:e=>{U.Z.UpdateSidebarScroller=e}},r()("div",{style:{width:200,alignSelf:"center"}},void 0,e.hasFiltersOn?r()(p.FormattedMessage,{id:"updateSidebar.updatesContainer.emptyAfterSearch",defaultMessage:"No updates match the requested filters."}):r()(p.FormattedMessage,i?{id:"updateSidebar.updatesContainer.emptyMaybePurged",defaultMessage:"There are no recent updates on this page. Page updates are retained for one year."}:{id:"updateSidebar.updatesContainer.empty",defaultMessage:"No updates on this page yet."})))},o.id)));throw new Error("Loaded sidebar without AppStore initialized.")}var Ue=o(38755),Ne=o(33784),Oe=o(38302),He=o(88923);function Le(e){window.__c={n:"UpdateSidebarContent"};const{currentTab:t}=e,o=(0,l.VK)((()=>H.default.state.mainEditorCurrentBlockStore),[]),i=(0,l.VK)((()=>H.default.state.currentSpaceStore),[]),n=(0,l.VK)((()=>H.default.state.renderPhase),[]),[a,s]=(0,d.useState)(!1),c=(0,d.useMemo)((()=>(new Date).getTime()),[]);if((0,d.useEffect)((()=>{a||"rendered"!==n||s(!0)}),[null==o?void 0:o.id,a,n]),!o||!i||!a)return r()(D.B,{areaHeight:window.innerHeight});switch(t){case h.gY.Comments:return r()(E.J,{timeMounted:c,location:"sidebar"});case h.gY.Updates:return r()(Re,{enablePageAnalytics:e.enablePageAnalytics});case h.gY.Assistant:return r()(K.QP,{});default:(0,I.t1)(t)}}function Ge(e){window.__c={n:"UpdateSidebar"};const t=(0,l.VK)((()=>({width:h.ZP.state.width,isAnimating:h.ZP.state.isAnimating})),[]),o=(0,g.O7)(),{shouldLoadSidebarComponents:i,isExpanded:n,popOutMode:a,closeSidebar:s}=e,p=(0,l.VK)((()=>n&&a&&!Oe.Z.state.isOpen&&!Ne.Z.state.open),[n,a]),u=(0,d.useRef)(null),m=(0,d.useMemo)((()=>[`.${y.zar}`,`.${y.hzx}`,`.${y.G6g}`,`.${y.K3y}`,`.${y.p0b}`,`.${y.mJW}`]),[]);(0,_.O)({active:p,closeHandler:s,ref:u,excludedSelectors:m});const v=f.R6(o.device.isElectronMac),b=(0,c.yK)((e=>({container:{flexGrow:0,flexShrink:0,zIndex:T.XB,borderLeft:(a?"unset":!n&&"1px solid rgba(0,0,0,0)")||`1px solid ${e.regularDividerColor}`,alignSelf:"flex-end",position:"absolute",right:0,top:0,height:"100vh",pointerEvents:"none"},popOutContainer:{boxShadow:e.mediumBoxShadow,background:e.popoverBackground,borderRadius:3,border:n?`1px solid ${e.regularDividerColor}`:void 0,height:`calc(100% - 20px - ${v}px)`,marginTop:v+10,marginRight:n?10:0},wrap:{height:"100%"},content:{position:"absolute",top:0,bottom:0,display:n?"flex":"none",flexDirection:"column",overflow:"visible",zIndex:T.XB,width:t.width}})),[t.width,v,a,n]);return i?d.createElement("aside",{"aria-hidden":!n||void 0,ref:u,style:{...b.container,...a?b.popOutContainer:{}},onMouseMove:()=>{t.isAnimating||h.ZP.setState({...h.ZP.state,mouseEntered:!0})},onMouseLeave:()=>{t.isAnimating||h.ZP.setState({...h.ZP.state,mouseEntered:!1})}},r()("div",{style:b.wrap},void 0,r()("div",{style:b.content},void 0,d.createElement(We,e)))):null}function ze(e){let{enablePageAnalytics:t,navigableBlock:o,onTabChange:i}=e;window.__c={n:"SidebarHeader"};const n=(0,g.O7)(),{popOutMode:a}=(0,l.VK)((()=>({popOutMode:(0,N._c)(n)})),[n]),s=(0,l.VK)((()=>h.ZP.state.currentTab),[]),d=(0,c.yK)((()=>({commentsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:a?0:f.R6(n.device.isElectronMac)}})),[n,a]);switch(s){case h.gY.Comments:return r()("div",{style:d.commentsHeaderStyle});case h.gY.Updates:return r()(C,{popOutMode:a,navigableBlock:o,enablePageAnalytics:t,onTabChange:i});case h.gY.Assistant:return r()("div",{style:d.commentsHeaderStyle})}}function We(e){window.__c={n:"SidebarActivityFeed"};const{isResizerHovered:t,isResizing:o,currentTab:i,expanded:n}=(0,l.VK)((()=>{const{isResizerHovered:e,isResizing:t,currentTab:o,expanded:i}=h.ZP.state;return{isResizerHovered:e,isResizing:t,currentTab:o,expanded:i}}),[]),{currentBlockStore:a}=e,s=(0,g.O7)(),{currentTabToRender:p,popOutMode:u}=(0,l.VK)((()=>({currentTabToRender:a.isCollectionView()&&!a.isCollectionViewPageWithContent()&&i!==h.gY.Assistant?h.gY.Updates:i,popOutMode:(0,N._c)(s)})),[a,i,s]),m=(0,l.VK)((()=>{const{currentSpaceStore:e}=H.default.state;return!(0,Ue.Cx)(e)}),[]),v=d.useCallback((e=>{F.Zmw(s,{tab:e===h.uF.Updates?"updates":"analytics",origin:He.default.state.open?"peek_view":"page"}),h.ZP.setState({...h.ZP.state,currentSubTab:e})}),[s]),b=(0,c.yK)((e=>({pane:{display:"flex",flexDirection:"column",height:"100%",position:"relative",pointerEvents:"none",maxHeight:"100%",backgroundColor:i===h.gY.Comments?void 0:"inherit"},resizerStyle:{position:"absolute",top:0,left:-3,bottom:0,right:0,height:"100vh",width:3,zIndex:-1,display:"block",transition:"box-shadow 300ms ease-in",...(t||o)&&n?{boxShadow:e.sidebarResizerBoxShadow}:{}},controlsHeaderStyle:{position:"relative",pointerEvents:"auto",marginTop:u?0:f.R6(s.device.isElectronMac),paddingTop:4,width:u?"calc(100% - 2px)":"100%",background:e.contentBackground,borderRadius:3,paddingBottom:1}})),[i,t,o,s,n,u]);return r()("div",{style:b.pane,className:y.zar},void 0,r()("div",{style:b.resizerStyle}),r()(ze,{enablePageAnalytics:m,navigableBlock:a,onTabChange:v}),r()(Le,{currentTab:p,enablePageAnalytics:m}),n&&r()(V.Z,{type:"update"}))}function $e(e){window.__c={n:"UpdateSidebarAnimatedWrapper"};const{isElectronMac:t,currentBlockStore:o}=e,i=(0,l.VK)((()=>({width:h.ZP.state.width,isAnimating:h.ZP.state.isAnimating,canRender:h.ZP.state.canRender})),[]),n=(0,l.VK)((()=>H.default.state.currentSpaceStore),[]),a=(0,d.useMemo)((()=>null==n?void 0:n.clone()),[n]),s=(0,g.O7)(),c=(0,l.VK)((()=>s.currentUser.isLoggedIn()&&(0,N.Sx)(s)),[s]),{isExpanded:p,popOutMode:u,closeSidebar:m}=(0,l.VK)((()=>({isExpanded:(0,N.Sx)(s),popOutMode:(0,N._c)(s),closeSidebar:()=>A.setUpdateExpand({environment:s,isExpanded:!1,from:"close_for_space"})})),[s]),[f,v]=(0,d.useState)(!1),[y,b]=(0,d.useState)(void 0);return(0,d.useEffect)((()=>{(void 0===y||y===o.id)&&p&&(v(!0),b(o.id))}),[y,o,p]),i.canRender&&a?r()(B.Z,{isVisible:!0,useCompositeLayer:!0,animationStyle:{width:c?i.width:0},render:()=>r()(P.Z,{store:a,droppable:!0,render:()=>r()(Ge,{isElectronMac:t,isFullyExpanded:!i.isAnimating,currentBlockStore:o,isExpanded:p,popOutMode:u,closeSidebar:m,shouldLoadSidebarComponents:f})},a.id),onAnimationStart:()=>{h.ZP.setState({...h.ZP.state,isAnimating:!0})},onAnimationEnd:()=>{h.ZP.setState({...h.ZP.state,isAnimating:!1})}}):null}}}]);