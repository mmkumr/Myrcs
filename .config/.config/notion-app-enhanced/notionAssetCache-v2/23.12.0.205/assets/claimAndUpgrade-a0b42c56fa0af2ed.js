"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6550],{48949:(e,t,a)=>{a.r(t),a.d(t,{default:()=>ve});var n=a(23174),r=a.n(n),o=a(86664),i=a(67294),s=a(480),d=a(86628),l=a(24405),p=a(8848),c=a(13148),u=a(5366),m=a(50906),g=a(19234),y=a(92785),v=a(31919),f=a(16100),S=a(62216),b=a(41168),h=a(52975),C=a(54642),M=a(47307),I=a(92625),A=a(64964),w=a(65544);const x=(0,u.defineMessages)({loading:{defaultMessage:"Claiming and upgrading workspace...",id:"spaceSubscriptionUpgradeModal.upgradeTargetSpace.loading"}});function Z(e){return"stripeToken"===(null==e?void 0:e.type)?e.value:void 0}function U(e){return"paymentMethodId"===(null==e?void 0:e.type)?e.value:void 0}async function O(e){const{environment:t,data:a,requestingSpaceId:n,paymentData:o}=e,i=h.Z.state;if(!i.open)return;const s=i.targetPlan;if(!s)return;const d=i.temporaryAddress;I.j({message:x.loading});const l=i.targetSpace.id,p=await C.claimAndUpgradeSpace(t,{requestingSpaceId:n,targetSpaceId:l,targetPlan:s,stripeToken:Z(o),paymentMethodId:U(o),customerName:d.name,businessName:d.businessName,addressLine1:d.addressLine1,addressCity:d.city,addressZip:d.zipCode,addressState:d.state,addressCountry:d.country,vatId:i.vatApplicable?i.temporaryVatCode:void 0});var c,g,y,v;(I.x(),"success"===p.type)?(h.Z.closeWithSuccess(),v=i.targetSpace.name,A.oV({label:r()(u.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.toast",defaultMessage:"Successfully claimed “{spaceName}“",values:{spaceName:v}})}),m.ICF(t,{previousOwners:i.targetSpace.admins.map((e=>e.id)),newOwners:t.currentUser.id?[t.currentUser.id]:[],targetSpaceId:l,verifiedDomain:i.targetSpace.creatorEmailDomain,memberCount:i.targetSpace.memberCount,costForUpgrade:null===(c=i.totalUpgradeCost)||void 0===c?void 0:c.amount,currencyCode:null===(g=i.totalUpgradeCost)||void 0===g?void 0:g.currencyCode,currentPlan:null===(y=b.XX(a))||void 0===y?void 0:y.plan,targetPlan:s})):(M.showError(p),function(e){const{environment:t}=e;h.Z.reset(),m.Xov(t)}({environment:t}))}async function B(e){const{environment:t,state:a,data:n,requestingSpaceId:r,stripe:o,elements:i,intl:s,paymentOptionAvailabilityStore:d}=e,l=a.temporaryPaymentMethod;m.PNo(t,{paymentMethod:l});const p=d.state.paymentRequest;if("native_payment_platform"===l&&p)return void p.show();h.Z.update((e=>({...e,payButtonState:"disabled"})));(function(e){const{environment:t,intl:a,state:n}=e;if(!S.vi())return!0;let r;n.temporaryAddress.country?"address_resolution_failed"!==n.taxCalculationError&&(0,g.A)(n.temporaryAddress)||(r=a.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})):r=a.formatMessage({id:"spaceSubscriptionUpgradeModal.billingAddress.missingCountryError",defaultMessage:"Invalid country. Please select the country from the dropdown menu."});r&&(h.Z.setState({...n,error:r}),m.VQs(t,{error:void 0,error_type:"address"}));return void 0===r})({environment:t,state:a,intl:s})&&await async function(e){const{environment:t,state:a,data:n,requestingSpaceId:r,stripe:o,elements:i,intl:s}=e;if(!i||!o)return void y.log({level:"error",from:"SpaceSubscriptionUpgradeModal",type:"StripeError",error:{miscDataString:"Stripe elements not initialized when user tried to upgrade"}});let d=a.paymentData;if(!d){const{error:e}=await i.submit();if(e)return m.VQs(t,{error:"could not submit form",error_type:"payment_method"}),void h.Z.setState({...a,error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})});const n=await o.createPaymentMethod({elements:i});if(n.error)return m.VQs(t,{error:n.error.message,error_type:"payment_method"}),void h.Z.setState({...a,error:f.translateStripeError(t,s,n.error)});if(!n.paymentMethod)return m.VQs(t,{error:"could not create token",error_type:"payment_method"}),void h.Z.setState({...a,error:s.formatMessage({id:"spaceSubscriptionUpgradeModal.payment.genericError",defaultMessage:"Your payment could not be processed. Please try again."})});d={type:"paymentMethodId",value:n.paymentMethod.id},h.Z.setState({...a,paymentData:d})}await O({environment:t,data:n,requestingSpaceId:r,paymentData:d})}({environment:t,state:a,data:n,requestingSpaceId:r,stripe:o,elements:i,intl:s});const c=h.Z.state;c.open&&h.Z.setState({...c,payButtonState:"enabled"})}async function F(e){const{requestingSpaceId:t,environment:a,state:n}=e;h.Z.update((e=>({...e,totalUpgradeCost:void 0,payButtonState:"disabled"})));const r=n.targetSpace.isActorInSpace?n.targetSpace.memberCount:n.targetSpace.memberCount+1,o=b.GD(n.temporaryBillingInterval),i=await C.getCostForSpaceUpgrade(a,{targetSpaceId:n.targetSpace.id,requestingSpaceId:t,subscriptionTier:"enterprise",billingInterval:o,memberCount:r});if("failed"===i.type)M.showError(i),h.Z.close();else{const e=i.data?v.n.fromValue({amount:i.data.totalCost,currencyCode:i.data.currencyCode}).zeroIfNegative():void 0;h.Z.update((t=>({...t,totalUpgradeCost:e,targetPlan:i.data.targetPlan,payButtonState:"enabled"})))}}var T=a(43250),_=a(69653),k=a(34859),D=a(80444),P=a(88632),E=a(45407),q=a(27242),V=a(30751),z=a(36488),N=a(50506),W=a(53336),H=a(71422),K=a(10644),L=a(93537),Y=a(58025),Q=a(65734),R=a(72126),j=a(8323),X=a(38479),G=a(16608),$=a(48209),J=a(40675);function ee(e){window.__c={n:"ClaimAndUpgradeBillingInfoForm"};const{paymentMethods:t}=e,a=(0,s.O7)(),n=(0,X.y)(),o=(0,i.useMemo)((()=>(0,R.Ds)((async()=>{await w.l_(a)}),3e3)),[a]),[l,p,c,m,g,y,v]=(0,d.VK)((()=>{let e,t,a,n,r=!1;const{state:o}=h.Z;return o.open&&(e=o.temporaryAddress,t=o.temporaryPaymentMethod,a=o.payButtonState,n=o.temporaryVatCode,r=o.vatApplicable),[(0,j.mq)(),e,t,n,a,r,S.o0()]}),[]),f=(0,i.useCallback)((async e=>{if(h.Z.state.open&&(h.Z.setAddressField(e),await o(),n)){const t=n.find((t=>t.countryCode===(null==e?void 0:e.country)));t&&h.Z.update((e=>({...e,vatApplicable:Boolean(t.vatApplicable)})))}}),[n,o]),b=(0,i.useCallback)((async e=>{h.Z.update((t=>({...t,temporaryVatCode:e}))),await o()}),[o]);return p&&c&&g?r()("div",{},void 0,r()(G.k,{paymentMethods:t,temporaryPaymentMethod:c,payButtonState:g,address:p,updateAddress:f}),"control"===v?r()(J.J,{address:p,availableCountries:n,shouldShowBusinessName:l,updateAddress:f}):null,r()($.n,{onChange:b,disabled:!0,tooltip:r()(u.FormattedMessage,{id:"claimAndUpgradeBillingInfoForm.disabledVatTooltip",defaultMessage:"You can add a VAT/GST number in the billing tab after upgrading."}),temporaryVatCode:m,vatApplicable:y})):null}var te=a(82990),ae=a(18514),ne=a(61519),re=a(43568),oe=a(74523),ie=a(68785),se=a(42045);function de(e){window.__c={n:"LineItem"};const{lineItemData:t,nameStyle:a,priceStyle:n,showZeroPrice:o}=e,i=(0,l.yK)((e=>({container:{marginTop:24},itemContainer:{display:"flex",justifyContent:"space-between",alignItems:"center",lineHeight:1,minHeight:18},name:{fontSize:12,color:e.mediumTextColor,...a||void 0},price:{fontSize:12,color:"promotion"===t.type?"#53A83F":e.regularTextColor,...n||void 0},caption:{fontSize:12,color:e.mediumTextColor},captionContainer:{display:"flex",flexDirection:"column"}})),[t,a,n]);let s="-";return t.price&&(t.price.amount>0||o)&&(s=r()(se.W,{cost:t.price.toMoneyValue(),trailingZeroDisplay:"stripIfInteger"})),r()("div",{style:i.itemContainer},void 0,r()("div",{style:i.captionContainer},void 0,r()("span",{style:i.name},void 0,t.name),t.subtitle&&r()("span",{style:i.caption},void 0,t.subtitle)),"calculating"===t.type?r()(ie.Z,{}):r()("span",{style:i.price},void 0,s))}function le(e){var t;window.__c={n:"ClaimAndUpgradeOrderSummary"};const{state:a}=e,n=(0,l.yK)((e=>({container:{display:"flex",flexDirection:"column"},header:{fontSize:16,color:e.regularTextColor,fontWeight:te.Z.fontWeight.semibold,marginBottom:10},couponLink:{fontSize:12},helpButton:{marginLeft:0,marginTop:-4,marginBottom:12},helpButtonInner:{fontSize:12}})),[]),o=a.calculatingTax||null===(t=v.n.sum(a.totalUpgradeCost,a.taxAmount))||void 0===t?void 0:t.zeroIfNegative();return r()("div",{style:n.container},void 0,r()("label",{style:n.header},void 0,r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.header",defaultMessage:"Order summary"})),void 0!==a.totalUpgradeCost?i.createElement(i.Fragment,null,r()(ce,{totalCostForUpgrade:a.totalUpgradeCost,memberCount:a.targetSpace.memberCount}),r()(oe.Z,{style:n.helpButton,buttonStyle:n.helpButtonInner,title:r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.helpButton.label",defaultMessage:"Learn more about prorated charges"}),href:(0,ae.UY)("guides.billingAndPayment"),analyticsFrom:"invoices"}),r()(pe,{state:a}),r()(ne.Z,{size:14}),r()(de,{showZeroPrice:!0,lineItemData:{price:o,type:"standard",name:r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.orderTotal",defaultMessage:"Total"})},priceStyle:{fontSize:20}})):r()(ue,{}))}function pe(e){return i.createElement(i.Fragment,null,r()(de,{showZeroPrice:!0,lineItemData:{type:"standard",name:r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.subTotal",defaultMessage:"Subtotal"}),price:e.state.totalUpgradeCost}}),r()(de,{lineItemData:{type:e.state.calculatingTax?"calculating":"standard",name:r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.tax.title",defaultMessage:"Tax"}),price:e.state.taxAmount,subtitle:e.state.taxAmount||0===e.state.taxAmount?void 0:r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.lineItems.tax.subtitle",defaultMessage:"if applicable"})}}))}function ce(e){window.__c={n:"SpaceUpgradeCostOrder"};const{totalCostForUpgrade:t,memberCount:a}=e,n=(0,l.yK)((e=>({container:{display:"flex",justifyContent:"space-between",marginBottom:6},item:{},title:{fontSize:14},subtitle:{color:e.mediumTextColor,fontSize:12},price:{fontSize:14,color:e.regularTextColor}})),[]);return r()("div",{style:n.container},void 0,r()("div",{style:n.item},void 0,r()("div",{style:n.title},void 0,r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.proratedChanges",defaultMessage:"Prorated charges"})),r()("div",{style:n.subtitle},void 0,r()(u.FormattedMessage,{id:"claimAndUpgradeOrderSummary.proratedChangesCaption",defaultMessage:"All charges due to claim and upgrade the workspace ({memberCount, plural, one {{memberCount} member} other {{memberCount} members}}).",values:{memberCount:a}}))),r()("div",{style:n.price},void 0,r()(se.W,{cost:t,trailingZeroDisplay:"stripIfInteger"})))}function ue(){return i.createElement(i.Fragment,null,r()(re.Z,{paragraphs:[{lineHeight:18,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:0},{lineHeight:14,lineMargin:4,sectionWidths:[100,40],repeat:1,sectionMargin:-2}]}),r()("div",{style:{display:"block",height:27}}),r()(re.Z,{paragraphs:[{lineHeight:16,lineMargin:1,sectionWidths:[100],repeat:2,sectionMargin:4}]}),r()(re.Z,{paragraphs:[{lineHeight:14,lineMargin:0,sectionWidths:[30],repeat:1,sectionMargin:4}]}),r()(ne.Z,{size:14}),r()(re.Z,{paragraphs:[{lineHeight:24,lineMargin:4,sectionWidths:[100],repeat:1,sectionMargin:1}]}))}function me(){return(0,l.yK)((e=>({closeButton:{display:"flex",alignItems:"center",justifyContent:"center",position:"absolute",top:21,right:20,width:22,height:22,padding:0,borderRadius:"50%",border:"none",background:"light"===e.mode?p.FN.light.gray[75]:p.FN.dark.gray[500],zIndex:10},closeButtonIcon:{width:12,height:12,fill:"light"===e.mode?p.FN.light.gray[400]:p.FN.dark.gray[800]},modal:{background:"dark"===e.mode?"#191919":e.popoverBackground,borderRadius:12,width:750,maxHeight:760,display:"flex"},modalContent:{flex:1,maxWidth:"60%",display:"flex",flexDirection:"column",position:"relative",borderRadius:"12px 0 0 12px"},modalContentBody:{padding:"36px 42px 50px 42px",display:"flex",flexDirection:"column"},modalContentSidebar:{flex:1,maxWidth:"40%",background:"dark"===e.mode?"#202020":e.sidebarSecondaryBackground,borderLeft:`1px solid ${e.lightDividerColor}`,padding:"20px 29px 50px 27px",display:"flex",flexDirection:"column"}})),[])}function ge(e){window.__c={n:"ModalContentWrapper"};const{state:t,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:i}=e,{subscriptionTier:s,onlyShowAddOn:l,calculatingTax:p,temporaryBillingInterval:c,taxAmount:u,addOnFeature:m,coupon:g}=t,y=(0,d.VK)((()=>{var e;return(null===(e=t.totalUpgradeCost)||void 0===e?void 0:e.currencyCode)??V.Z.selectedCurrencyCode}),[t]),{payAmount:v}=b.uN({subscriptionTier:s,promo:t.appliedPromo,currencyCode:y,data:a,onlyShowAddOn:l,calculatingTax:p,billingInterval:c??"year",taxAmount:null==u?void 0:u.amount,addOnFeature:m,coupon:g}),S=(0,f.useElementsOptions)({type:"subscription",amount:v.amount,currency:v.currencyCode});return r()(o.Elements,{stripe:(0,f.getStripe)(),options:S},void 0,r()(ye,{state:t,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:i}))}function ye(e){window.__c={n:"ModalContent"};const{state:t,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:l}=e,p=(0,s.O7)(),g=(0,u.useIntl)(),y=me(),v=(0,o.useStripe)(),f=(0,o.useElements)(),[S,C]=(0,d.VK)((()=>[P.Z.state.online,l.state.availablePaymentMethods]),[l]),[M,I,A,x]=(0,d.VK)((()=>{const e=h.Z.state;return e.open?[e.subscriptionTier,e.temporaryBillingInterval,e.addOnFeature,e.coupon]:[]}),[]);if(!t.open||!M||!I)return null;if(!S)return r()(K.Z,{});const Z=_.Lp(t),U=b.E$({state:t,availablePaymentMethods:C});return i.createElement(i.Fragment,null,r()("div",{style:y.modalContent},void 0,r()(W.Z,{type:k.Z.Y,showScrollToBottomIndicator:!0},void 0,r()("div",{style:y.modalContentBody},void 0,r()(Q.Q,{subscriptionTier:t.subscriptionTier,onlyShowAddOn:t.onlyShowAddOn,addOnFeature:t.addOnFeature,type:q.U.TargetSpace}),r()(H.Z,{subscriptionTier:M,billingInterval:I,addOnFeature:A,canAddAI:!1,coupon:x,onChangeBillingInterval:e=>{h.Z.update((t=>({...t,temporaryBillingInterval:e}))),m.FRI(p,{billingInterval:e}),async function(e){const{environment:t,spaceId:a,state:n}=e;await F({requestingSpaceId:a,environment:t,state:n}),await w.l_(t)}({environment:p,spaceId:n,state:h.Z.state})}}),r()(Y.g,{state:t,paymentOptionAvailabilityStore:l}),r()(ee,{paymentMethods:U})))),r()("div",{style:y.modalContentSidebar},void 0,r()(W.Z,{type:k.Z.Y},void 0,r()(le,{state:t}),r()(L.f,{state:t,paymentOptionAvailabilityStore:l,products:Z,onClickUpgrade:()=>B({environment:p,intl:g,state:t,stripe:v,elements:f,data:a,requestingSpaceId:n,paymentOptionAvailabilityStore:l})}))),r()("button",{style:y.closeButton,onClick:()=>{h.Z.close()}},void 0,(0,c.U)(y.closeButtonIcon)))}const ve=function(e){window.__c={n:"ClaimAndUpgradeModal"};const{data:t,spaceStore:a}=e,n=(0,d.VK)((()=>h.Z.state),[]),o=(0,s.O7)(),l=(0,u.useIntl)(),p=me(),c=(0,i.useMemo)((()=>new E.Z),[]);return(0,i.useEffect)((()=>{var e;const{state:a}=h.Z;if(!a.open)return;const n=null===(e=D.default.state.currentSpaceStore)||void 0===e?void 0:e.id;n&&F({environment:o,state:a,requestingSpaceId:n});const{currentUserStore:r}=D.default.state,i=null!=r&&r.isDefined()?r.getModel():void 0;if(i){const e=i.getDisplayName(l);var s;if(h.Z.setState({...a,temporaryAddress:{...a.temporaryAddress,name:e}}),"subscribed_admin"===t.type||"unsubscribed_admin"===t.type)h.Z.setState({...a,appliedPromo:null===(s=t.customerData)||void 0===s?void 0:s.stripe.promo})}}),[]),r()(N.Z,{ariaLabelledBy:T.BaY,ariaDescribedBy:T.qr0,open:n.open,preventHideChildrenWhileOpening:!0,innerStyle:p.modal,render:()=>r()(z.Z,{capture:!0,allowEsc:!0,render:()=>n.open?r()(ge,{state:n,data:t,requestingSpaceId:a.id,paymentOptionAvailabilityStore:c}):null})})}}}]);