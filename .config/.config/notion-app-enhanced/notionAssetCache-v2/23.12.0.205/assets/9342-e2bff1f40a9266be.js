"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9342],{22711:(e,t,n)=>{n.d(t,{C:()=>a,DP:()=>l,LN:()=>i,Lm:()=>c,Ow:()=>r,dt:()=>d});var o=n(50906),s=n(54642);async function i(e,t){const n=await s.getConnectedAppsStatus(e,{spaceId:t});if("failed"===n.type){const e=n.error;return console.error(e),{drive:[],evernote:void 0,trello:void 0,asana:void 0,confluence:void 0}}return n.data}async function a(e,t){await s.disconnectTrello(e,{}),await t.refresh(),o.qJZ(e,{integration_name:"trello"})}async function r(e,t){await s.disconnectAsana(e,{}),await t.refresh(),o.qJZ(e,{integration_name:"asana"})}async function c(e,t){await s.disconnectEvernote(e,{}),await t.refresh(),o.qJZ(e,{integration_name:"evernote"})}async function l(e,t,n){await s.disconnectConfluence(e,{spaceId:n}),await t.refresh()}async function d(e,t,n){await s.disconnectMonday(e,{spaceId:n}),await t.refresh()}},83805:(e,t,n)=>{n.d(t,{B:()=>M,e:()=>w});var o=n(515),s=n(64002),i=n(5366),a=n(50906),r=n(47307),c=n(95477),l=n(68821),d=n(91924),u=n(53833),g=n(90365),p=n(47593),h=n(67940),m=n(92083),f=n(54642),v=n(92625),S=n(15356);const y=(0,i.defineMessages)({authenticatingWithEvernote:{id:"evernoteActions.authenticatingWithEvernote.loadingMessage",defaultMessage:"Authenticating with Evernote…"},titleMessage:{defaultMessage:"Evernote login",id:"evernoteActions.loginPopupModal.title"}});async function w(e){const{environment:t,requestStore:n}=e,i=(0,d.eC)(t);let u=(0,o.Qp)(c.default.domainBaseUrl,{authType:i,userId:t.currentUser.id});u=i.redirectToAuth?u:await(0,d.HU)(t,u);const w=await S.M(t,{width:580,height:700,url:u,titleMessage:y.titleMessage});if(!w)return;const b=s.Qc(w),C=b.query.oauth_token,A=b.query.oauth_verifier;if(!C||!A)return;v.j({message:y.authenticatingWithEvernote});const Z=await f.authWithEvernote(t,{requestToken:C,verifier:A}),I=h.Z.getOrCreateFlowId();if("failed"===Z.type)return a.a1y(t,{import_source:"evernote",data:{import_type:"api",status:"failure",error:Z.error,userId:t.currentUser.id},flowId:I}),console.error(Z.error),r.showError(Z),void v.x();a.a1y(t,{import_source:"evernote",data:{import_type:"api",status:"success",userId:t.currentUser.id},flowId:I}),a.L3B(t,{integration_name:"evernote"}),await n.refresh(),g.Z.setState({open:!0}),(0,l.c)()?m.Z.setState({...m.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):p.Z.setState({open:!0}),await M({environment:t,requestStore:n}),v.x()}async function M(e){const{environment:t,requestStore:n}=e;try{u.Z.setState({...u.Z.state,isFetchingNotebooks:!0,showLoader:!0});const e=await f.getEvernoteNotebooks(t,{});if(await n.refresh(),"success"===e.type){u.Z.setState({...u.Z.state,notebooksResponse:e.data,isFetchingNotebooks:!1,showLoader:!1});const{userInfo:t,notebooks:n}=e.data;return{userInfo:t,notebooks:n}}return console.error(e.error),{notebooks:[],userInfo:void 0}}catch(o){return console.error(o),{notebooks:[],userInfo:void 0}}}},52192:(e,t,n)=>{n.d(t,{M:()=>w,u:()=>M});var o=n(515),s=n(64002),i=n(5366),a=n(50906),r=n(47307),c=n(95477),l=n(68821),d=n(91924),u=n(47593),g=n(82066),p=n(92083),h=n(81676),m=n(54642),f=n(84908),v=n(92625),S=n(15356);const y=(0,i.defineMessages)({authenticatingWithTrello:{id:"trelloActions.authenticatingWithTrello.loadingMessage",defaultMessage:"Authenticating with Trello…"},titleMessage:{defaultMessage:"Trello login",id:"trelloActions.loginPopupModal.title"}});async function w(e){const{environment:t,requestStore:n}=e,i=(0,d.eC)(t);let h=(0,o.ae)(c.default.domainBaseUrl,{authType:i,userId:t.currentUser.id,isElectronDevice:t.device.isElectron});if(h=i.redirectToAuth?h:await(0,d.HU)(t,h),t.device.isElectron)return void f.openExternalUrl(h);const w=await S.M(t,{width:580,height:700,url:h,titleMessage:y.titleMessage});if(!w)return;const b=s.Qc(w),C=b.query.oauth_token,A=b.query.oauth_verifier;if(!C||!A)return;v.j({message:y.authenticatingWithTrello});const Z=await m.authWithTrello(t,{requestToken:C,verifier:A});"failed"===Z.type?(console.error(Z.error),r.showError(Z),v.x()):(a.L3B(t,{integration_name:"trello"}),await n.refresh(),g.Z.setState({open:!0}),(0,l.c)()?p.Z.setState({...p.Z.state,open:!0,currentTab:"imports",highlightedSetting:void 0,defaultSubtab:void 0}):u.Z.setState({open:!0}),await M(t,n),v.x())}async function M(e,t){h.Z.setState({...h.Z.state,isFetchingBoards:!0,showLoader:!0});const n=await m.getTrelloBoards(e,{});return await t.refresh(),"success"===n.type?(h.Z.setState({...h.Z.state,boardsResponse:n.data,isFetchingBoards:!1,showLoader:!1}),n.data):(console.error(n.error),{boards:[]})}},73084:(e,t,n)=>{n.d(t,{Z:()=>$});var o=n(23174),s=n.n(o),i=n(10434),a=n.n(i),r=(n(57658),n(67294)),c=n(83355),l=n(480),d=n(86628),u=n(49085),g=n(8848),p=n(35840),h=n(27006),m=n(21202),f=n(29369),v=n(5366),S=n(94507),y=n(65452),w=n(28020),M=n(98165),b=n(38755),C=n(80444),A=n(57559),Z=n(2834),I=n(52275),P=n(60458),k=n(31278),x=n(76798),T=n(14694);class _ extends Z.Z{renderComponent(){const{nestingLevel:e}=this.props;return r.createElement(I.Z,a()({},this.props,{title:s()(T.Z,{childrenStyle:_.sidebarChildrenStyle,left:this.renderLeftCheckbox(),icon:this.renderIcon(),style:{marginLeft:8*e}},void 0,this.renderTitle())}))}renderLeftCheckbox(){return s()(P.Z,{size:16,checked:this.props.isChecked,onClick:this.props.onClick})}renderIcon(){const{store:e,isMobile:t}=this.props,n=e.getIcon();return s()(k.Z,{disabled:!0,icon:n,title:void 0,isEmptyPage:e.isEmptyPage(),size:t?24:20,pageIconStyle:{fill:this.theme.mediumIconColor}})}renderTitle(){return s()(x.Z,{store:this.props.store})}}_.sidebarChildrenStyle={display:"flex",alignItems:"center"};const E=_;var B=n(68894),F=n(68785),L=n(32163),D=n(53437),N=n(72495),q=n(59054),U=n(97880),W=n(31299),z=n(87279),G=n(78140),O=n(43765),R=n(11470),j=n(78948);function H(e){window.__c={n:"OauthPageSearchResults"};const{spaceId:t,onSelectPage:n,query:o,source:i,findSelectedBlockAncestorId:c}=e,d=(0,l.O7)();let u=null;const[{status:g,value:p}]=(0,q.r5)((async()=>await W.D7({environment:d,query:o,limit:10,requireEditPermissions:!0,spaceId:t,excludeTemplates:!0,source:i,boostRecentlyViewedPages:!1})),[d,o,t,i],{debounce:W.vp});if("idle"===g||"pending"===g)u=s()(N.Z,{},void 0,s()(j.Z,{}));else{const e=((null==p?void 0:p.results)||[]).map((e=>{let{id:t}=e;const o=new A.G(d,{table:m.iU,id:t});return function(e){const{store:t,environment:n,alreadySelectedAncestorId:o,onSelectPage:i}=e;if(o&&o===t.id)return{key:t.id,action:()=>{},render:e=>r.createElement(R.Z,a()({},e,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:s()(v.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.bySelf.message",defaultMessage:"Already added"})}))};if(o){const e=new A.G(n,{table:m.iU,id:o});return{key:t.id,action:()=>{},render:n=>r.createElement(R.Z,a()({},n,{store:t,hidePath:!0,disabled:!0,style:{opacity:.5},caption:s()(v.FormattedMessage,{id:"oauthPageSearchResults.disabledResult.byAncestor.message",defaultMessage:"Already added via {ancestorPageName}",values:{ancestorPageName:s()(x.Z,{store:e,style:{display:"inline"}})}})}))}}const c=t.getRole();return c&&h.zz(c)?{key:t.id,action:()=>i(t.id),render:e=>r.createElement(R.Z,a()({store:t,hidePath:!1},e))}:void 0}({store:o,alreadySelectedAncestorId:c(o),environment:d,onSelectPage:n})})).filter(U.$K);u=0===e.length?s()(N.Z,{},void 0,s()(O.Z,{title:s()(v.FormattedMessage,{id:"oauthPageSearchResults.noResults.placeholder",defaultMessage:"No results"})})):function(e){return s()(L.Z,{type:L.i.Vertical,initialFocus:void 0,sections:[{key:"results",items:e,render:e=>r.createElement(N.Z,e)}]})}(e)}const f={menuType:z.og.Popup};return r.createElement(G.Z,f,u)}class V extends c.Z{constructor(){super(...arguments),this.storeTypes={selectedBlockIdsStore:u.default.createClass({}),searchStore:u.default.createClass({open:!1,query:void 0})},this.getPageSection=(e,t,n)=>{const o=n.filter((e=>h.zz(e.getRole()||"none")));return{key:e,render:e=>r.createElement(N.Z,e),items:[this.getPageSectionHeader(t,o),...0===o.length?[this.getEmptyState()]:o.map((e=>this.getPageItem(e,1)))]}},this.getPageItem=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,{device:o}=this.environment,s=Boolean(n.state[e.id]);return{key:e.id,action:()=>this.handleClickPage(e.id,s),render:n=>r.createElement(E,a()({},n,{isMobile:o.isMobile,store:e,isChecked:s,disabled:!1,nestingLevel:t}))}},this.getPageSectionHeader=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores,o=t.length>0&&t.every((e=>n.state[e.id]));return{key:e,action:()=>this.handleClickSection(t),render:t=>r.createElement(I.Z,a()({},t,{title:s()(T.Z,{left:s()(P.Z,{onClick:t.onClick,checked:o,size:16}),style:this.getSectionHeaderStyle()},void 0,e)}))}},this.getEmptyState=()=>({key:"empty",action:()=>{},render:e=>r.createElement(I.Z,a()({},e,{title:s()(T.Z,{style:{fontSize:14,color:this.theme.mediumTextColor,padding:"2px 32px"}},void 0,s()(v.FormattedMessage,{id:"oauthAuthorizationPage.selectPageStep.empty",defaultMessage:"No pages inside"}))}))}),this.handleClickPage=(e,t)=>{const{selectedBlockIdsStore:n}=this.stores;n.setState({...n.state,[e]:!t})},this.handleClickSection=e=>{const{selectedBlockIdsStore:t}=this.stores,n=e.every((e=>t.state[e.id]));t.setState({...t.state,...e.reduce(((e,t)=>(e[t.id]=!n,e)),{})})},this.handleSearchQueryChange=e=>{const t=this.stores.searchStore.state,n=e.length>0;this.stores.searchStore.setState({...t,query:e,open:n})},this.handleSearchCancel=()=>{const e=this.stores.searchStore.state;this.stores.searchStore.setState({...e,open:!1,query:void 0})},this.findSelectedBlockAncestorId=e=>{const{selectedBlockIdsStore:t}=this.stores;if(t.state[e.id])return e.id;const n=M.fJ(e).find((e=>e.table===m.iU&&Boolean(t.state[e.value.id])));return n?n.value.id:void 0}}renderComponent(){const{intl:e}=this.props,{searchStore:t,selectedBlockIdsStore:n}=this.stores,o=(0,w.k_)(this.environment).state;if(!o)return s()(F.Z,{style:{alignSelf:"center"}});const{allSharedPagesStores:i,showWorkspaceSection:c,showTeamSection:l,showSharedSection:d,showPrivateSection:u,showOnlyPrivateSection:g}=o,{currentSpaceViewStore:h,currentSpaceStore:S}=C.default.state;if(!h||!S)return;const y=[];if(l){const e=h.getTeamsStores();y.push(...e.map((e=>[e,e.getTeamPagesStores().filter(K)])))}const M=h.getWorkspacePages().filter(K),Z=h.getPrivatePages(this.environment).filter(K),I=Object.keys(n.state).filter((e=>n.state[e])).map((e=>new A.G(this.environment,{table:m.iU,id:e}))).filter((e=>e.getSpaceId()===S.id&&e.isNavigableBlock()&&!e.isTopLevelPrivatePage({spaceStore:S,environment:this.environment})&&!e.isTopLevelWorkspacePage(S.id)&&!(e.getParentTable()===f.e0)&&!i.some((t=>t.id===e.id)))),P=(0,b.rn)(this.environment,S),k=[];if(I.length>0&&k.push({key:"manual",render:e=>r.createElement(N.Z,a()({},e,{title:s()(T.Z,{style:this.getSectionHeaderStyle()},void 0,s()(v.FormattedMessage,{id:"oauthAuthorizationPage.selectPagesStep.pagePicker.manuallyAddedPagesSection.title",defaultMessage:"Manually added"})),isTitleUppercase:!0})),items:I.map((e=>this.getPageItem(e,0)))}),c&&k.push(this.getPageSection("workspace",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.workspaceSection.title",defaultMessage:"Workspace"}),M)),l)for(const[s,a]of y){const e=s.id,t=s.getName();e&&void 0!==t&&k.push(this.getPageSection(`team-${e}`,t,a))}if(d&&k.push(this.getPageSection("shared",e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.sharedSection.title",defaultMessage:"Shared"}),i)),u){const t=g?P||"":e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.privateSection.title",defaultMessage:"Private"});k.push(this.getPageSection("private",t,Z))}const x=this.getSearchIconStyle();return r.createElement(r.Fragment,null,s()(D.GI,{origin:s()(B.ZP,{style:{marginBottom:8},itemMarginLeft:0,itemMarginRight:0,focus:!0,focusAfterAnimation:!0,value:t.state.query||"",onChange:e=>{this.handleSearchQueryChange(e.target.value)},placeholder:e.formatMessage({id:"oauthAuthorizationPage.selectPagesStep.pagePicker.search.placeholder",defaultMessage:"Search for pages in {workspaceName}"},{workspaceName:P}),inputLeft:(0,p.R)(x)}),sameWidthAsOrigin:!0,popupType:D.GI.PopupType.Popup,open:t.state.open,render:()=>s()(H,{spaceId:S.id,onSelectPage:e=>this.handleClickPage(e,!1),query:t.state.query||"",source:"oauth",findSelectedBlockAncestorId:this.findSelectedBlockAncestorId}),onDismiss:this.handleSearchCancel}),s()("div",{style:this.getPageListStyle()},void 0,s()(L.Z,{type:L.i.Vertical,sections:k,initialFocus:void 0})))}getSectionHeaderStyle(){return{textTransform:"uppercase",fontSize:12,fontWeight:600,color:g.ZP.mediumTextColor,padding:"2px 0"}}getPageListStyle(){return{alignItems:"left",width:"100%",height:380,borderWidth:1,borderStyle:"solid",borderColor:g.ZP.contentBorder,borderRadius:4,overflowY:"auto"}}getSearchIconStyle(){return{width:14,height:14,marginLeft:8,marginRight:8,flexGrow:0,flexShrink:0,fill:g.ZP.mediumIconColor}}}function K(e){return e.isDefined()&&"copy_indicator"!==e.getType()}V.displayName="BotAccessPagePicker";const $=function(e){window.__c={n:"BotAccessPagePickerWrapper"};const t=(0,l.O7)(),n=(0,d.VK)((()=>{var e;return null===(e=C.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),o=t.currentUser.id,s=(0,v.useIntl)();return(0,d.VK)((()=>{n&&o&&(y.h({environment:t,spaceId:n,userId:o}),S.I({environment:t,spaceId:n,userId:o}))}),[t,n,o]),r.createElement(V,a()({intl:s},e))}},94512:(e,t,n)=>{n.d(t,{Z:()=>f});var o=n(23174),s=n.n(o),i=n(67294),a=n(480),r=n(24405),c=n(97880),l=n(82990),d=n(5366),u=n(50906),g=n(61519),p=n(74420),h=n(89728),m=n(23189);function f(e){window.__c={n:"ConnectedAppsSettingsDiscoverSection"};const{apps:t,numberOfConnectedApps:n}=e,o=(0,a.O7)(),[r,l]=(0,i.useState)(!1),p=t.filter((e=>!e.shouldHideInDiscover)),f=p.length>3&&!r,S=r?p:p.slice(0,3);return i.createElement(i.Fragment,null,s()(m.Z,{large:!0,divider:"full"},void 0,s()("div",{style:{display:"flex",justifyContent:"space-between",height:28}},void 0,s()(d.FormattedMessage,{id:"connectionsSettings.discoverNewConnectionsSection.title",defaultMessage:"Discover new connections"}))),s()("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:32}},void 0,S.map((e=>"string"==typeof e.logo&&e.onConnect&&s()(v,{appName:e.appName,caption:e.caption,shouldShowNewBadge:e.shouldShowNewBadge,logo:e.logo,onConnect:e.onConnect},e.id))).filter((e=>(0,c.$K)(e)))),f&&s()(h.Z,{style:{marginTop:10,gap:10,marginLeft:-8},isGray:!0,onClick:()=>{r||(l(!0),u.EUq(o,{numberOfConnectedApps:n}))}},void 0,s()(d.FormattedMessage,{id:"connectedAppsSettings.discoverNewAppSection.showAll.label",defaultMessage:"Show all"})),s()(g.Z,{size:16}))}function v(e){window.__c={n:"ConnectedAppsSettingsDiscoverItem"};const{appName:t,caption:n,logo:o,shouldShowNewBadge:i,onConnect:a}=e,c=(0,r.yK)((e=>({card:{display:"flex",flexDirection:"column",width:160},image:{width:32,height:32,borderRadius:3},topRow:{display:"flex",alignItems:"center",marginTop:8},title:{fontWeight:l.Z.fontWeight.medium,fontSize:14},caption:{marginTop:2,fontWeight:l.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12,maxHeight:72,overflow:"hidden"},button:{marginLeft:-8,marginTop:3}})),[]);return s()("div",{style:c.card},void 0,s()("img",{style:c.image,src:o}),s()("div",{style:c.topRow},void 0,s()("div",{style:c.title},void 0,t),i&&s()(p.Z,{})),s()("div",{style:c.caption},void 0,n),s()("div",{style:c.button},void 0,s()(h.Z,{isBlue:!0,onClick:a},void 0,s()(d.FormattedMessage,{id:"connectedAppSettingsDiscoverItem.connectButton.label",defaultMessage:"Connect"}))))}},70578:(e,t,n)=>{n.d(t,{Z:()=>m});var o=n(23174),s=n.n(o),i=n(67294),a=n(480),r=n(9999),c=n(84169),l=n(5366),d=n(89101),u=n(50906),g=n(18514),p=n(16354),h=n(89728);function m(){window.__c={n:"ConnectionsSettingsLinks"};const e=(0,a.O7)();return i.createElement(i.Fragment,null,s()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:`${d._j.integrations}/all`,external:!0,onClick:()=>{u.uyp(e,{from:"integration-settings",href:`${d._j.integrations}/all`})}},void 0,s()(h.Z,{icon:r.J,isSmall:!0,isLightGray:!0},void 0,s()(l.FormattedMessage,{id:"connectionsSettingsLinks.connectionsGallery",defaultMessage:"Browse connections in Gallery"}))),s()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:d._j.myIntegrations,external:!0,onClick:()=>{u.YYl(e,{from:"integration-settings",href:d._j.myIntegrations})}},void 0,s()(h.Z,{icon:r.J,isSmall:!0,isLightGray:!0},void 0,s()(l.FormattedMessage,{id:"connectionsSettingsLinks.manageConnections",defaultMessage:"Develop or manage integrations"}))),s()(p.Z,{style:{display:"flex",marginLeft:-6},className:"notion-print-ignore",href:(0,g.UY)("guides.publicAPI"),external:!0},void 0,s()(h.Z,{icon:c.m,isSmall:!0,isLightGray:!0},void 0,s()(l.FormattedMessage,{id:"connectionsSettingsLinks.helpCenter",defaultMessage:"Learn more about connections"}))))}},38493:(e,t,n)=>{n.d(t,{Z:()=>Ie,O:()=>Ze});var o=n(23174),s=n.n(o),i=(n(57658),n(67294)),a=n(83355),r=n(41892),c=n(15070),l=n(77657),d=n(74181),u=n(72126),g=n(77420),p=n(15047),h=n(90965),m=n(97880),f=n(5366),v=n(50906),S=n(54642),y=n(515),w=n(64002),M=n(47307),b=n(95477),C=n(68821),A=n(91924),Z=n(46190),I=n(47593),P=n(92625),k=n(15356);const x=(0,f.defineMessages)({authenticatingWithAsana:{id:"asanaActions.authenticatingWithAsana.loadingMessage",defaultMessage:"Authenticating with Asana…"},titleMessage:{defaultMessage:"Asana login",id:"asanaActions.loginWithAsanaPopupModal.title"}});var T=n(76463),_=n(22711),E=n(91584),B=n(83805),F=n(42631),L=n(52192),D=n(61202);var N=n(38755),q=n(34859),U=n(80444),W=n(88632),z=n(30874),G=n(57559),O=n(72087),R=n(78291),j=n(94512),H=n(70578),V=n(68785),K=n(77137),$=n(53336),J=n(64369),Y=n(27386),Q=n(23189),X=n(31278),ee=n(40235),te=n(10434),ne=n.n(te),oe=n(480),se=n(86628),ie=n(49085),ae=n(8848),re=n(87279),ce=n(41168),le=n(24736),de=n(73084),ue=n(42922),ge=n(52275),pe=n(31945),he=n(78140),me=n(32163),fe=n(63296),ve=n(72495),Se=n(42782);function ye(e){window.__c={n:"UserConnectionsSettingsActionMenu"};const{botId:t,canSelectPageAccess:n,onConnect:o,onDisconnect:a}=e,[r,c]=(0,i.useState)(!1),[l]=(0,i.useState)(ie.default.createValue({})),d=(0,se.VK)((()=>U.default.state.currentSpaceStore),[]),u=(0,oe.O7)(),p=(0,oe.Fy)(),{data:h}=(0,se.VK)((()=>R.default.state),[]),m=[];if(n){const e=(h?(0,ce.NM)(h):[]).find((e=>e.botId===t)),n=(null==e?void 0:e.pageIds.reduce(((e,t)=>(e[t]=!0,e)),{}))??{};d&&(r||(l.setState(n),c(!0)),m.push({key:"actions for user guest connections",render:e=>i.createElement(ve.Z,e),items:[{key:"update selected pages",render:(e,o)=>i.createElement(Se.Z,ne()({},e,{onFocus:o.onFocus,disableDefaultClick:!0,renderOrigin:e=>i.createElement(ge.Z,ne()({},e,{title:s()(f.FormattedMessage,{id:"userConnectionsSettings.actionMenu.selectPages.label",defaultMessage:"Access selected pages"})})),renderExtension:(e,o)=>{return s()("div",{style:{width:400,padding:20}},void 0,s()(de.Z,{selectedBlockIdsStore:l}),(i={leftText:s()(f.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.cancel",defaultMessage:"Cancel"}),leftAction:()=>{l.setState(n),o.close()},rightText:s()(f.FormattedMessage,{id:"userConnectionsSettings.actionMenu.pagePicker.update",defaultMessage:"Update access"}),rightAction:()=>{!function(e){const{botId:t,currentSpaceStore:n,environment:o,selectedBlockIdsStore:s,currentAccessedPages:i}=e,a=[],r=[],c=s.state;Object.keys(c).forEach((e=>{i.hasOwnProperty(e)&&!c[e]?a.push(e):!i.hasOwnProperty(e)&&c[e]&&r.push(e)}));const l=G.t1.createChildStore(n,{table:g.cZ,id:t});T.jX({environment:o,currentSpaceStore:n,botStore:l,pages:a}),T.jX({environment:o,currentSpaceStore:n,botStore:l,pages:r,addPermission:!0})}({selectedBlockIdsStore:l,environment:u,currentSpaceStore:d,botId:t,currentAccessedPages:n}),o.close()}},s()("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8,marginTop:24}},void 0,s()(fe.Z,{isLarge:!0,onClick:i.leftAction,style:{height:32}},void 0,i.leftText),s()(ue.Z,{isLarge:!0,onClick:i.rightAction},void 0,i.rightText))));var i}})),action:()=>{}}]}))}const v=[];return o&&v.push({key:"connect account",render:e=>i.createElement(ge.Z,ne()({},e,{title:s()(f.FormattedMessage,{id:"userConnectionsSettings.actionMenu.connectAccount.label",defaultMessage:"Connect another account"}),onClick:o})),action:o}),v.push({key:"disconnect account",render:e=>i.createElement(ge.Z,ne()({},e,{title:s()("div",{style:{color:ae.ZP.red}},void 0,s()(f.FormattedMessage,{id:"userConnectionsSettings.actionMenu.disconnectAccount.label",defaultMessage:"Disconnect account"})),onClick:()=>{a()}})),action:()=>a()}),m.push({key:"actions for all user connections",render:e=>i.createElement(ve.Z,e),items:v}),s()(pe.ZP,{popupType:p.isMobile?pe.Z4.SlideUp:pe.Z4.Popup,renderOrigin:e=>i.createElement(le.Z,ne()({},e,{isMobile:p.isMobile})),render:()=>s()(he.Z,{menuType:p.isMobile?re.og.ActionSheet:re.og.Popup},void 0,s()(me.Z,{type:me.i.Vertical,sections:m,initialFocus:void 0}))})}function we(e){const{userConnections:t}=e;return s()(ee.Z,{columns:[{key:"connection",header:s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection"}),style:{width:"40%"}},{key:"access",header:s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.title",defaultMessage:"Access"}),style:{width:"40%"}},{key:"more",header:void 0,style:{width:"5%"}}],rows:Me(t)})}function Me(e){const t=[];return e.forEach((e=>{const{account:n,onDisconnect:o}=e;if(Array.isArray(n)){const s=n.map((t=>be({connection:{...e,onDisconnect:()=>{o(t)}},account:t})));t.push(...s)}else t.push(be({connection:e,account:n}))})),t}function be(e){const{account:t,connection:{id:n,appName:o,canSelectPageAccess:i,capabilities:a,logo:r,onConnect:c,onDisconnect:l}}=e,d=void 0!==t&&"string"!=typeof t,u=d?t.accountName:t,g=d?t.accountId:n;return{key:`${n}-${u}`,columns:[s()(Ce,{accountName:u,connectionLogo:r,connectionName:o},"connection-title"),a,s()(ye,{botId:g,canSelectPageAccess:i,connectionName:o,onConnect:c,onDisconnect:l},"connection-action-menu")]}}function Ce(e){const{accountName:t,connectionLogo:n,connectionName:o}=e;return s()("div",{style:{display:"flex",alignItems:"center",marginRight:12}},void 0,"string"==typeof n?s()("img",{src:n,style:{height:28}}):s()(X.Z,{disabled:!0,icon:n,title:o,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),s()("div",{style:{marginLeft:15}},void 0,s()(J.Z,{},void 0,o),t&&s()(J.Z,{isSmall:!0},void 0,t)))}class Ae extends a.Z{constructor(){super(...arguments),this.storeTypes={requestStore:O.Z},this.loadConnections=async e=>{const{currentSpaceStore:t}=U.default.state;return{guestBotIds:await this.fetchUserGuestBotIds(),connectionStatus:await _.LN(e,null==t?void 0:t.id)}},this.fetchUserGuestBotIds=async()=>{const{currentSpaceStore:e,currentUserStore:t}=U.default.state;if(!e||!t||!R.default.state.data)return[];return(await T.Yw({environment:this.environment,table:p.bx,id:e.id,type:"guest"})).botIds.filter((n=>G.t1.createChildStore(e,{table:g.cZ,id:n}).getCreatedById()===t.id))}}renderComponent(){return W.Z.state.online?s()(K.Z,{request:this.environment,performRequest:this.loadConnections,requestStore:this.stores.requestStore,render:(e,t)=>null!=t&&t.connectionStatus?this.renderConnectedAppsSettings(t.guestBotIds):s()("div",{style:Ae.loadingWrapStyle},void 0,s()(V.Z,{}))}):this.renderOfflineMessage()}renderOfflineMessage(){return s()(Y.Z,{},void 0,s()(J.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,s()(f.FormattedMessage,{id:"connectedAppsSettings.offline.message",defaultMessage:"Please go online to manage connecting to apps."})))}renderConnectedAppsSettings(e){const{connected:t,discover:n}=this.getAppsByCategory(e),o=t.length>0;return s()("div",{style:this.getWrapStyle()},void 0,s()($.Z,{style:Ae.scrollerStyle,type:q.Z.Y},void 0,o&&i.createElement(i.Fragment,null,s()(Q.Z,{large:!0,divider:"full",style:{borderBottom:"none",marginBottom:0}},void 0,s()(f.FormattedMessage,{id:"connectionsSettings.connectionsSection.title",defaultMessage:"My connections"})),s()(we,{userConnections:t})),s()("div",{style:{marginTop:o?32:void 0}},void 0,s()(j.Z,{apps:n,numberOfConnectedApps:t.length})),s()("div",{style:{marginTop:8}},void 0,s()(H.Z,{}))))}async handleDriveAuth(){v.SOV(this.environment,{integration_name:"google",from:"connected_apps"}),await E.qN(this.environment),await _.LN(this.environment),await this.stores.requestStore.refresh()}handleDisconnectDrive(e){const{intl:t}=this.props;M.showDialog({message:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.message",defaultMessage:"Disconnecting disables file preview on Google Drive files embedded in all of your workspaces. It would not delete your embeds from Notion, so you can re-connect at anytime."}),showCancel:!0,keepFocus:!0,items:[{label:t.formatMessage({id:"connectedAppsSettings.disconnectGoogleDriveModal.disconnectButton.label",defaultMessage:"Disconnect"}),color:"red",onAccept:async()=>{await S.disconnectDrive(this.environment,{googleUserId:e.accountId}),await _.LN(this.environment),await this.stores.requestStore.refresh()}}]})}getAppsByCategory(e){const t=u.vM([...this.getExternalIntegrations(),...this.getLegacyConnectedApps()],(e=>e.account&&e.account.length>0?"connected":"discover"));return{connected:[...this.getUserGuestIntegrations(e),...t.connected||[]],discover:t.discover||[]}}shouldShowGoogleDriveLegacyApp(){const{integrations:{state:e}}=z.Z;return!e.some((e=>e.id===l.f3))}getLegacyConnectedApps(){var e;const{intl:t}=this.props,n=this.stores.requestStore;let o=!1;const{currentSpaceStore:i}=U.default.state,a=null===(e=n.state.result)||void 0===e?void 0:e.connectionStatus,c=(null==a?void 0:a.drive)&&(null==a?void 0:a.drive.length)>0,l=this.shouldShowGoogleDriveLegacyApp();if(l){const e=null==i?void 0:i.getBotSettingsStore().getValue();o=!(0,h.CJ)(e)||Boolean((null==e?void 0:e.integration_approval_statuses)&&e.integration_approval_statuses[d._o])}const u=s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.legacyImporter",defaultMessage:"Can only add pages"});return[...l&&(o||c)?[{id:"drive",appName:"Google Drive",caption:t.formatMessage({id:"connectedAppsSettings.googleDrive.caption",defaultMessage:"Find and embed your files."}),shouldHideConnectAccount:!o,shouldHideInDiscover:!l,logo:r.Z.images.import.googleDrivePng,account:null==a?void 0:a.drive,capabilities:s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.googleDrive",defaultMessage:"Can embed content"}),canSelectPageAccess:!1,onConnect:()=>this.handleDriveAuth(),onDisconnect:e=>{e&&this.handleDisconnectDrive(e)}}]:[],{id:"evernote",appName:"Evernote",caption:t.formatMessage({id:"connectedAppsSettings.evernote.caption",defaultMessage:"Import notebooks."}),logo:r.Z.images.import.evernotePng,account:null==a?void 0:a.evernote,capabilities:u,canSelectPageAccess:!1,onConnect:()=>B.e({environment:this.environment,requestStore:n}),onDisconnect:()=>_.Lm(this.environment,n)},{id:"trello",appName:"Trello",caption:t.formatMessage({id:"connectedAppsSettings.trello.caption",defaultMessage:"Import your boards."}),logo:r.Z.images.import.trelloPng,shouldHideInDiscover:!0,account:null==a?void 0:a.trello,capabilities:u,canSelectPageAccess:!1,onConnect:()=>L.M({environment:this.environment,requestStore:n}),onDisconnect:()=>_.C(this.environment,n)},{id:"asana",appName:"Asana",caption:t.formatMessage({id:"connectedAppsSettings.asana.caption",defaultMessage:"Import tasks from boards and lists."}),logo:r.Z.images.import.asanaPng,shouldHideInDiscover:!0,account:null==a?void 0:a.asana,capabilities:u,canSelectPageAccess:!1,onConnect:()=>async function(e){const{environment:t,requestStore:n}=e,o=(0,A.eC)(t);let s=(0,y.s1)(b.default.domainBaseUrl,{authType:o,userId:t.currentUser.id});s=o.redirectToAuth?s:await(0,A.HU)(t,s);const i=await k.M(t,{width:580,height:800,url:s,titleMessage:x.titleMessage});if(!i)return;const a=w.Qc(i);if(!a.query.code||!a.query.state)return;P.j({message:x.authenticatingWithAsana});const r=await S.authWithAsana(t,{code:a.query.code,encryptedState:a.query.state});"failed"===r.type?(console.error(r.error),M.showError(r),P.x()):(v.L3B(t,{integration_name:"asana"}),await n.refresh(),Z.Z.setState({open:!0}),(0,C.c)()||I.Z.setState({open:!0}),P.x())}({environment:this.environment,requestStore:n}),onDisconnect:()=>_.Ow(this.environment,n)},...null!=i&&i.id?[{id:"confluence",appName:"Confluence",caption:t.formatMessage({id:"connectedAppsSettings.confluence.caption",defaultMessage:"Import Spaces from Confluence."}),logo:r.Z.images.import.confluencePng,shouldHideInDiscover:!0,account:null==a?void 0:a.confluence,capabilities:u,canSelectPageAccess:!1,onDisconnect:()=>_.DP(this.environment,n,i.id)}]:[]]}getUserGuestIntegrations(e){const{currentSpaceStore:t}=U.default.state;if(!t||(0,N.Cx)(t))return[];return e.map((e=>{const n=G.t1.createChildStore(t,{table:g.cZ,id:e}),o=n.getName(),i=n.getIntegrationId();if(!n.getAlive()||!o||!i)return;const a=n.getIntegrationPointer(),r=n.getIcon(),c=r&&a?{pointer:a,icon:r}:void 0;return{id:n.id,appName:o,caption:void 0,account:void 0,logo:c,capabilities:s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.userGuest",defaultMessage:"Can {capabilities} content",values:{capabilities:s()(f.FormattedList,{value:Ze(n.getCapabilities()),type:"conjunction"})}}),canSelectPageAccess:!0,onDisconnect:async()=>{await M.confirmUserAction({message:s()("span",{},void 0,s()(f.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"})),acceptLabel:s()(f.FormattedMessage,{id:"userConnectionsSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&await T.P0({environment:this.environment,botId:n.id,onSuccess:()=>{}})}}})).filter(m.$K)}getExternalBotCapabilities(e){const t=[s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.previewLinks",defaultMessage:"preview links"},"previewLinks")];return function(e){return!!e.info.original_url_patterns&&e.info.original_url_patterns.some((e=>{var t;return null===(t=e.additional_types)||void 0===t?void 0:t.collection}))}(e)&&t.push(s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.syncDatabases",defaultMessage:"sync databases"},"syncedDatabase")),t}getExternalIntegrations(){const{currentSpaceStore:e}=U.default.state;if(!e||!e.canEdit())return[];const t=e.getBotSettingsStore().getValue(),n=e.id,{integrations:{state:o},bots:{state:a},externalAuthentications:{state:r}}=z.Z,d=e.canAdmin(),p=l.Gw,S={[l.U9]:1,[p]:2};o.sort(((e,t)=>(S[e.id]??1/0)-(S[t.id]??1/0)));const y=[l.U9];return o.map((o=>{if(!o.info.icon)return;if(!d&&y.includes(o.id))return;const p=a.filter((e=>e.integration_id===o.id)),m=u.oA(p.map((e=>{const t=r.find((t=>t.parent_id===e.id));if(t)return{accountId:e.id,accountName:t.account_name}}))),S=(0,h.hU)({spaceBotSettings:t,integrationId:o.id,env:"production"}),w=m.length>0;if(!S&&!w)return;if(!w&&o.id===l.Dv)return;const b=!S,C=s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.external",defaultMessage:"Can {capabilities}",values:{capabilities:s()(f.FormattedList,{value:this.getExternalBotCapabilities(o),type:"conjunction"})}}),A=(0,c.ms)(o.capabilities),Z=o.capabilities.inherit_creator_permissions,I=A&&!Z;return{id:o.id,appName:o.name,caption:o.info.tagline,logo:o.info.icon,account:m,shouldHideConnectAccount:b,shouldShowNewBadge:!o.info.hide_new_badge,capabilities:i.createElement(i.Fragment,null,s()("div",{},void 0,C),A?s()("div",{},void 0,s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.accessColumn.externalWithCapabilities",defaultMessage:"Can {capabilities} content",values:{capabilities:s()(f.FormattedList,{value:Ze(o.capabilities),type:"conjunction"})}})):null),canSelectPageAccess:I,onConnect:async()=>{await F.hM({environment:this.environment,integration:o,spaceId:n,from:"connected_apps_settings"}),D.pJ({environment:this.environment})},onDisconnect:async t=>{const n=a.find((e=>e.id===(null==t?void 0:t.accountId)));if(n){const i=G.t1.createChildStore(e,{table:g.cZ,id:n.id,spaceId:n.space_id}),a=null!=t&&t.accountName?s()(f.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for {accountName}?",values:{accountName:t.accountName}}):s()(f.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.withoutAccountName.confirmationMessage",defaultMessage:"Are you sure you want to revoke access for this account?"});await M.confirmUserAction({message:s()("span",{},void 0,a),acceptLabel:s()(f.FormattedMessage,{id:"connectedAppSettings.deleteExternalAuthorization.confirmDelete.label",defaultMessage:"Yes"})})&&(await T.P0({environment:this.environment,botId:i.id,onSuccess:()=>{}}),v.lLm(this.environment,{integrationId:o.id}))}}}})).filter(m.$K)}getWrapStyle(){return{display:"flex",flexDirection:"column",height:"100%",width:"sidebar-modal"===this.props.location?"100%":"auto"}}}function Ze(e){const t=[];return null!=e&&e.read_content&&t.push(s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.readContent",defaultMessage:"view"})),null!=e&&e.insert_content&&t.push(s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.insertContent",defaultMessage:"insert"})),null!=e&&e.update_content&&t.push(s()(f.FormattedMessage,{id:"userConnectionsSettings.connectionsTable.botAccess.updateContent",defaultMessage:"update"})),t}Ae.displayName="UserConnectionsSettings",Ae.loadingWrapStyle={alignItems:"center",display:"flex",flexDirection:"column",flex:1,height:"100%",justifyContent:"center"},Ae.scrollerStyle={height:"100%",padding:"36px 60px"};const Ie=(0,f.injectIntl)(Ae)},41623:(e,t,n)=>{n.d(t,{Nq:()=>s,f_:()=>i,yh:()=>a});var o=n(15070);function s(e,t){const n=t.getAlive(),s=(0,o.hA)(t),i=Boolean(!t.getIntegrationId()),a=Boolean(t.getIntegrationId()),r=Boolean(e.currentUser.id===t.getParentId());return n&&s&&(a&&r||i)}function i(e){return e.getAlive()&&(0,o.hA)(e)&&Boolean(e.getIntegrationId())}function a(e){const{externalIntegrationStoreState:t,integrationId:n}=e;if(!t.loaded)return;const s=t.externalAuthentications.map((e=>{let{parent_id:t}=e;return t})),i=new Set(s),a=t.bots.filter((e=>e.alive&&i.has(e.id)&&(0,o.U9)(e)&&e.integration_id===n));return a.length?a[0]:void 0}},53833:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(49085);class s extends o.default{getInitialState(){return{notebooksResponse:{notebooks:[]},isFetchingNotebooks:!0,showLoader:!1}}}const i=new s},46190:(e,t,n)=>{n.d(t,{Z:()=>o});const o=new(n(61766).Z)},90365:(e,t,n)=>{n.d(t,{Z:()=>o});const o=new(n(61766).Z)},82066:(e,t,n)=>{n.d(t,{Z:()=>o});const o=new(n(61766).Z)},81676:(e,t,n)=>{n.d(t,{Z:()=>i});var o=n(49085);class s extends o.default{getInitialState(){return{boardsResponse:{boards:[]},isFetchingBoards:!0,showLoader:!1}}}const i=new s}}]);