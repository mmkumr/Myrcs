"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8575],{54281:(e,t,r)=>{r.d(t,{$o:()=>Y,Fv:()=>X,IL:()=>G,J4:()=>E,KA:()=>B,Nf:()=>q,_p:()=>Q,cQ:()=>N,f$:()=>A,fX:()=>M,j2:()=>z,k2:()=>$,mg:()=>J,mz:()=>U,oP:()=>O,tF:()=>H,td:()=>Z,x:()=>W});r(57658);var o=r(30120),n=r(1302),i=r(15145),a=r(45433),s=r(87916),l=r(53877),c=r(42875),m=r(15157),p=r(72126),d=r(97880),u=r(75079),S=r(65742),f=r(78316),y=r(88632),v=r(77080),g=r(57559),h=r(27724),_=r(50906),C=r(8406),b=r(49865),P=r(75134),T=r(5149),x=r(76427),w=r(96802),I=r(9953),L=r(79978),k=r(75018),R=r(24677),V=r(21325),D=r(98104),F=r(39699);function z(e){const{collectionViewStore:t,collectionContextStore:r,timelineState:o,environment:n}=e,i=n.currentUser.id,a=(0,S.B8)(t.id),s=(0,S.pQ)(t,n),l=r.permissionScopes.state,c=p.Ds((()=>{if(o.destroyed)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,S.al)(o)};m.Z.set({userId:i,key:a,value:e})}),1e3),d=p.Ds((()=>{if(o.destroyed||!y.Z.state.online||!n.currentUser.isLoggedIn()||!l.canConfigureBlock)return;const e={zoomLevel:o.zoomLevel.state,centerTimestamp:(0,S.al)(o)},r=t.getFormat().timeline_preference;p.Xy(r,e)||F.createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:n,perform:r=>{w.FH({stores:[t],update:{timeline_preference:e},transaction:r})}})}),5e3);o.savePreference=()=>{c(),d()},q({timelineState:o,environment:n,...s})}function q(e){const{timelineState:t,zoomLevel:r,centerTimestamp:o,environment:i}=e,{savePreference:a}=t,s=i.WindowSizeStore.state.width+2*S.Ge,l=(0,S.x2)(r,s),c=o-l/2,m=o+l/2;t.zoomLevel.setState(r),t.currentRange.setState({startTimestamp:c,endTimestamp:m}),n.default.afterNextFlush((()=>{B({timelineState:t,centerTimestamp:o}),a&&a()}))}function B(e){const{timelineState:t,centerTimestamp:r}=e,{horizontalScroller:o,outerSizeObserver:n}=t;if(!o)return;const i=t.zoomLevel.state,{startTimestamp:a,endTimestamp:s}=t.currentRange.state,l=n.rect.state.width;if(l===(0,S.e$)(i,s-a))return;const c=(0,S.e$)(i,r-a)-l/2;o.scrollLeft=c,t.scrollLeft.setState(c)}function O(e){const{environment:t,store:r,query:o,date:n,schema:i,transaction:a}=e,{timeline_by:s}=o;if(!s)return;const l=(0,S.TW)({store:r,dateValue:n,query:o,schema:i}),c=r.getPropertyValue(s),m=o.timeline_by_end?r.getPropertyValue(o.timeline_by_end):void 0;return I.sW({store:r.getPropertiesStore(),data:l,transaction:a}),P.H({environment:t,store:r,dateProperty:{id:s,newValue:(null==l?void 0:l[s])??[],oldValue:c},otherDateProperty:o.timeline_by_end?{id:o.timeline_by_end,newValue:(null==l?void 0:l[o.timeline_by_end])??[],oldValue:m}:void 0}),r}function X(e){var t;const{environment:r,timelineState:n,collectionStore:i,collectionContextStore:a,store:s,query:m,groupFormat:p,transaction:d}=e,u=n.zoomLevel.state,f=(0,S.al)(n),{snapUnit:y,getDateRangePlaceholderDuration:v}=S.BJ[u],{timeline_by:g}=m;if(!g)return;const h=null===(t=a.groupsStore.getGroupState(p))||void 0===t?void 0:t.resultsStore.state;if(!h)return;const _=o.ou.fromMillis(f),C=(0,S.DS)(_,y),P=(0,S.DS)(v(_),y),T=(0,S.AZ)({startValue:(0,l.Lg)((0,c.r)()),snapUnit:y,desiredStart:C,desiredEnd:P});return O({environment:r,store:s,query:m,schema:i.getSchema(),date:T,transaction:d}),b.$T({environment:r,collectionStore:i,before:!0,store:h[0],insertStores:[s],collectionContextStore:a,groupsPointer:p?[p]:[],transaction:d}),s}function A(e){const{type:t,timelineState:r,store:o,startX:n,query:i,schema:a,intl:s,environment:l}=e,{horizontalScroller:c}=r,{startTimestamp:m}=r.currentRange.state;if(!c)return;R.Ys({environment:l,store:o});const d=c.scrollLeft,{stores:u}=h.default.state,f=p.oA(u.map((e=>{const t=(0,S.bk)({store:e,query:i,schema:a,userId:l.currentUser.id,intl:s});if(t)return{startValue:t,store:e}})));r.dragState.setState({type:t,startStore:o,stores:f.map((e=>{let{store:t}=e;return t})),startValues:f.map((e=>{let{startValue:t}=e;return t})),temporaryValues:f.map((e=>{let{startValue:t}=e;return t})),startX:n,startStartTimestamp:m,startScrollLeft:d})}function E(e){const{timelineState:t,store:r,startX:o,startY:n,schema:i,collectionContextStore:a,verticalScroller:s}=e,{horizontalScroller:l}=t,{startTimestamp:c}=t.currentRange.state;if(!l||!s)return;const m=l.scrollLeft,p=s.scrollTop,d=(0,S.YE)(a,r,i);t.drawState.setState({startStore:r,startDependencyRelationPointers:d,temporaryDependencyRelationPointers:[...d],startX:o,startY:n,startScrollLeft:m,startScrollTop:p,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function Z(e){const{timelineState:t,currentX:r}=e,{horizontalScroller:o}=t,n=t.zoomLevel.state,i=t.dragState.state,{startTimestamp:a}=t.currentRange.state;if(!i||!o)return;const{type:s,startStartTimestamp:c,startValues:m,startScrollLeft:u,startX:f,startStore:y,stores:v}=i,g=S.BJ[n],{snapUnit:h}=g,_=o.scrollLeft-u+(r-f)+(0,S.e$)(n,a-c),C=(0,S.x2)(n,_),b=m[v.indexOf(y)];let P;if(s===S.px.LeftResizer){const{start:e}=(0,S.XO)(b,h),t=e.plus(C);P=m.map((e=>{const r=(0,S.AZ)({startValue:e,snapUnit:h,desiredStart:t});return(0,l.gW)(r)}))}else if(s===S.px.RightResizer){const{end:e}=(0,S.XO)(b,h),t=e.plus(C);P=m.map((e=>{const r=(0,S.AZ)({startValue:e,snapUnit:h,desiredEnd:t});return(0,l.Qq)(r)}))}else s===S.px.ItemDrag?P=m.map((e=>{const{start:t,end:r}=(0,S.XO)(e,h),o=t.plus(C),n=o.plus(r.valueOf()-t.valueOf());return(0,S.AZ)({startValue:e,snapUnit:h,desiredStart:o,desiredEnd:n})})):(0,d.t1)(s);p.Xy(i.temporaryValues,P)||t.dragState.setState({...i,temporaryValues:P})}function U(e){const{timelineState:t,currentX:r,currentY:o,verticalScroller:n}=e,i=t.drawState.state,a=t.zoomLevel.state,{startTimestamp:s}=t.currentRange.state,{horizontalScroller:l}=t;if(!i||!l||!n)return;const{startDependencyRelationPointers:c,startStore:m,startX:d,startY:u,startScrollLeft:f,startScrollTop:y,startStartTimestamp:v}=i,g=l.scrollLeft,h=n.scrollTop,_=g-f+(r-d)+(0,S.e$)(a,s-v),C=h-y+(o-u),b=t.hoveredItem.state;if(b&&b!==m&&!c.some((e=>e.id===b.id))){const e=[...c,{table:"block",id:b.id,spaceId:b.getSpaceId()}];p.Xy(i.temporaryDependencyRelationPointers,e)||t.drawState.setState({...i,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...i,temporaryDependencyRelationPointers:[...c],xOffsetPx:_,yOffsetPx:C})}function M(e){const{environment:t,timelineState:r,query:o,schema:n,transaction:i}=e,a=r.dragState.state,{timeline_by:s}=o;if(!a||!s)return;const{temporaryValues:l,stores:c}=a;l.forEach(((e,r)=>{const a=c[r];O({environment:t,store:a,query:o,schema:n,transaction:i,date:e})})),r.dragState.setState(void 0)}function Y(e){var t;const{timelineState:r,environment:o,transaction:n,collectionContextStore:i,isFullScreen:a,isRootChild:s}=e,l=r.drawState.state,c=r.dateRangePlaceholder.state;if(!l)return;const{startStore:m,startDependencyRelationPointers:p,temporaryDependencyRelationPointers:d}=l;if(!m)return void r.drawState.setState(void 0);let f;if(c.active){const{date:e,store:t,parentStore:a,groupFormat:s,newTimelineItemProps:l,existingTimelineItemProps:p}=c;if(t&&p){const{query:r,schema:i}=p;O({environment:o,store:t,query:r,schema:i,date:e,transaction:n}),f={table:"block",id:t.id,spaceId:m.getSpaceId()}}else if(l){const{query:r,schema:c,isFullScreen:p,canEditTimelineItems:d,subitemPath:u}=l,S=J({environment:o,date:e,store:t,parentStore:a,query:r,schema:c,isFullScreen:p,groupFormat:s,canEditTimelineItems:d,collectionContextStore:i,subitemPath:u,transaction:n,from:"timeline_complete_draw"});S&&(f={table:"block",id:S.id,spaceId:m.getSpaceId()})}r.dateRangePlaceholder.setState({active:!1})}else f=d.find((e=>!p.includes(e)));const y=(0,S._e)(i);if(y){const{property:e}=y;f&&(L.hE({environment:o,propertyWithInverse:y,sourceStore:m,destStore:g.G.createChildStore(m,f),position:{type:"after"},transaction:n}),C.rv({environment:o,collectionContextStore:i,block_id:m.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),r.drawState.setState(void 0)}else T.wl({item:{type:v.default.checkGate("dependency_date_shifting_by_space")?"dependencies":"arrowsBy"},collectionSettingsStore:i.settingsStore}),r.drawState.setState({...l,tryToCompleteDrawnArrow:!0});const h=null===(t=f)||void 0===t?void 0:t.id;h&&_.LEn(o,{...(0,u.Pn)(i),...(0,S.Ii)({environment:o,collectionContextStore:i,timelineState:r,isFullScreen:a,isRootChild:s}),dependenciesPropertyID:null==y?void 0:y.property,blockedByStoreID:m.id,blockingStoreID:h})}function N(e){const{timelineState:t,environment:r}=e;t.dragState.state&&(t.dragState.setState(void 0),R.ZH(r))}function W(e){const{timelineState:t,environment:r}=e;t.drawState.state&&(t.drawState.setState(void 0),R.ZH(r))}function $(e){const{stores:t,collectionViewStore:r,schema:o,transaction:n}=e,i=r.getType(),a=r.getQuery(o),s=[];a&&("calendar"===i?a.calendar_by&&s.push(a.calendar_by):"timeline"===i&&(a.timeline_by&&s.push(a.timeline_by),a.timeline_by_end&&s.push(a.timeline_by_end)));for(const l of t)for(const e of s)I.sO({store:l.getPropertyStore(e),value:void 0,transaction:n})}function G(e){const{dependency:t,collectionContextStore:r,environment:o,timelineState:n,isFullScreen:i,isRootChild:a}=e,s=(0,S._e)(r),l=r.collectionStore();if(!s||!l)return;const{property:c}=s,{store:m,relationPointer:p}=t,d=m.getSchema()[c];d&&"relation"===d.type&&(F.createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:o,perform:e=>{L.Bl({environment:o,propertyWithInverse:s,sourceStore:m,destStore:g.G.createChildStore(m,p),transaction:e}),C.rv({environment:o,block_id:p.id,property:c,property_type:d.type,from:"timeline",collectionContextStore:r,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),_.lfq(o,{...(0,u.Pn)(r),...(0,S.Ii)({environment:o,collectionContextStore:r,timelineState:n,isFullScreen:i,isRootChild:a}),dependenciesPropertyID:c,blockedByStoreID:m.id,blockingStoreID:p.id}))}function H(e){const{collectionViewStore:t,newProperty:r,transaction:o}=e;w.FH({stores:[t],update:{timeline_arrows_by:{property:r}},transaction:o})}function Q(e){var t;const{collectionContextStore:r,relationPropertyId:o,transaction:n}=e,i=r.collectionStore();if(!i)return;const l=o?i.getSchema()[o]:void 0,c="relation"===(null==l?void 0:l.type)&&l.property&&"relation"===(null===(t=i.getSchema()[l.property])||void 0===t?void 0:t.type)?l.property:void 0;w.FH({stores:[i],update:{collection_default_arrows_by:o,...i.getFormat().app_config_uri===s.iS?{app_uri_map:{...i.getFormat().app_uri_map?i.getFormat().app_uri_map:{},[a.Es.BlockingRelation]:o,[a.Es.BlockedRelation]:c}}:{}},transaction:n})}function J(e){const{environment:t,transaction:r,date:o,parentStore:n,query:a,schema:s,isFullScreen:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:p,from:d}=e;if(!V.M_(t))return;const u=c?[c]:[],S=p.groupsStore.getGroupState(u);if(!S)return;if(n)return function(e){const{environment:t,transaction:r,date:o,store:n,parentStore:a,query:s,schema:l,groupFormat:c,canEditTimelineItems:m,collectionContextStore:p,subitemPath:d}=e;if(!n||!a)return;const u=c?[c]:[],S=b.yk({environment:t,collectionContextStore:p,groupsPointer:u,store:n,before:!1,collectionStore:a,transaction:r,subitemPath:d,subitemInsertDirection:"into"});if(S){if(O({environment:t,store:S,query:s,schema:l,date:o,transaction:r}),t.device.isMobile)k.navigateToBlock({environment:t,store:S,pageVisitSource:i.tY.Create});else if(S&&m){const e=S.getBlockTitleStore();D.N_({store:e})}return S}}(e);p.searchQuery.state&&x.Ug({searchQuery:"",collectionContextStore:p,isFullScreen:l});const y=b.IW({environment:t,collectionContextStore:p,groupsPointer:u,coerce:!0,initializeDefaultTemplate:!0,transaction:r,from:d});if(!y)return;const v=y.coercionSucceeded,g=y.newStore;if(O({environment:t,store:g,query:a,schema:s,date:o,transaction:r}),t.device.isMobile)k.navigateToBlock({environment:t,store:g,pageVisitSource:i.tY.Create});else if(v&&m){const e=g.getBlockTitleStore();D.NX({store:e})}else k.peekBlock({environment:t,store:g,peekMode:(0,f.kr)(p.collectionViewStore()),resultsStore:null==S?void 0:S.resultsStore,collectionContextStore:p,pageVisitSource:i.tY.Create});return g}},69872:(e,t,r)=>{r.d(t,{L:()=>S,Z:()=>y});var o=r(10434),n=r.n(o),i=r(23174),a=r.n(i),s=r(67294),l=r(83355),c=r(39068),m=r(52821),p=r(87279),d=r(52275),u=r(28992);let S=function(e){return e[e.Name=0]="Name",e[e.Type=1]="Type",e}({});class f extends l.Z{renderComponent(){const{name:e,type:t,icon:r}=this.props.propertySchema,o=this.props.format===S.Name?e:m.SO[t],{theme:i}=this;return this.props.locked?s.createElement(u.Z,n()({title:o,icon:a()(c.ZP,{icon:r,type:t,size:this.environment.device.isMobile?18:16,theme:i,style:{fill:i.regularIconColor}})},this.props)):s.createElement(d.Z,n()({title:o,icon:a()(c.ZP,{icon:r,type:t,size:this.environment.device.isMobile?18:16,theme:i,style:{fill:i.regularIconColor,marginLeft:6,marginRight:2}})},this.props))}}f.displayName="PropertyMenuItem",f.DisplayFormat=S,f.contextTypes={...p.mw,...l.w};const y=f},40745:(e,t,r)=>{r.d(t,{M:()=>i});var o=r(23174),n=r.n(o);r(67294);const i=(0,r(45238).I)("arrowDown",{viewBox:"0 0 16 16",svg:n()("path",{d:"M8 1.57715C7.5625 1.57715 7.25488 1.88477 7.25488 2.33594V10.8262L7.30957 12.3027L5.50488 10.2861L3.95312 8.75488C3.82324 8.625 3.63184 8.53613 3.42676 8.53613C3.0166 8.53613 2.70898 8.85059 2.70898 9.26758C2.70898 9.46582 2.78418 9.64355 2.94141 9.80762L7.44629 14.3193C7.59668 14.4697 7.79492 14.5586 8 14.5586C8.20508 14.5586 8.40332 14.4697 8.55371 14.3193L13.0586 9.80762C13.2158 9.64355 13.291 9.46582 13.291 9.26758C13.291 8.85059 12.9902 8.53613 12.5801 8.53613C12.3682 8.53613 12.1836 8.625 12.0469 8.75488L10.4951 10.2861L8.69043 12.2959L8.74512 10.8262V2.33594C8.74512 1.88477 8.44434 1.57715 8 1.57715Z"})})}}]);