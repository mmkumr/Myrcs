"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9765],{37252:(e,s,a)=>{a.r(s),a.d(s,{InjectThirdPartyScripts:()=>P,useThirdPartyScripts:()=>Z});var t=a(67294),i=a(13991),r=a(480),n=a(86628),o=a(72126),d=(a(57658),a(29450)),l=a(66673),c=a(65454),u=a(4615);const p="a2a8e2144b2bbbb4074a",g="901895b8-45c7-40c8-ba91-626cfc6739b3";function m(){var e,s,a;if(!window._cio)for(window._cio=[],e=function(e){return function(){window._cio.push([e].concat(Array.prototype.slice.call(arguments,0)))}},s=["load","identify","sidentify","track","page","on","off","reset"],a=0;a<s.length;a++)window._cio[s[a]]=e(s[a])}var f=a(7250),S=a(93724),y=a(49902),v=a(50906),I=a(75018),w=a(95477),b=a(15010),R=a(58455),E=a(80444),_=a(61893),k=a(74055),h=a(77080),C=a(3418),K=a(69454),V=a(7339),T=a(77907);function Z(){const e=(0,r.O7)(),s=(0,r.Fy)(),{currentUser:a}=e,Z=(0,n.VK)((()=>{var e;return null===(e=E.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]),P=(0,n.VK)((()=>V.C.state.ready),[]);!function(e){let{isEnabled:s,isLoggedIn:a,userId:i,onMessageOpened:r,onMessageDismissed:n,onMessageError:o,onMessageAction:f}=e;(0,t.useEffect)((()=>{s&&(0,d.hasPermissionForThirdPartyServiceBrowser)("customer_io")&&("cio-tracker"in window||(m(),(0,c.ZP)("https://assets.customer.io/assets/track.js",{id:"cio-tracker",attributes:{"data-site-id":p,"data-use-array-params":"true","data-in-app-org-id":g,"data-use-in-app":"true","data-auto-track-page":"false"}})))}),[s]);const S=(0,l.D9)(i);(0,t.useEffect)((()=>{S!==i&&(m(),a&&void 0!==i?(window._cio.identify({id:(0,u.cj)(i)}),r&&window._cio.on("in-app:message-opened",r),n&&window._cio.on("in-app:message-dismissed",n),f&&window._cio.on("in-app:message-action",f),window._cio.on("in-app:message-error",o)):window._cio.reset())}),[a,i,S,r,n,o,f])}({isEnabled:(0,n.VK)((()=>a.isLoggedIn()&&P&&h.default.checkGate("customerio")),[a,P]),isLoggedIn:a.isLoggedIn(),userId:a.id,onMessageOpened:s=>{k.Z.state.suppressReason?v.EKj(e,{message_id:s.detail.messageId,reason:k.Z.state.suppressReason}):(k.Z.setState({...k.Z.state,isVisible:!0}),v.IMV(e,{message_id:s.detail.messageId}))},onMessageDismissed:s=>{k.Z.setState({...k.Z.state,isVisible:!1}),v.x91(e,{message_id:s.detail.messageId})},onMessageError:s=>{v.ybK(e,{message_id:s.detail.messageId})},onMessageAction:s=>{if(s.detail.actionValue.startsWith("relative_url=")){const a=s.detail.actionValue.split("relative_url=")[1];I.navigate({environment:e,url:a})}s.detail.message.dismiss()}}),(0,y.kI)({...(0,n.VK)((()=>{const e=R.default.state.isSprigEnabled&&_.Z.state.permission.performance&&h.default.checkGate("sprig")&&s.isDesktop,{currentUserSettingsStore:a,currentSpaceStore:t,currentUserStore:i}=E.default.state,r=null==i?void 0:i.getEmail(),n=a?(0,b.e2)(a):null,o=Boolean(null==t?void 0:t.canAdmin());return{isEnabled:e,userEmail:r,userDaysSinceSignup:n??0,userDomainType:(0,b.JF)(),isSpaceAdmin:o}}),[s]),isLoggedIn:a.isLoggedIn(),userId:a.id,spaceId:Z,sprigConfig:w.default.sprig}),(0,f.oG)({getLocale:(0,t.useCallback)((()=>i.SP),[]),analyticsSettings:(0,n.VK)((()=>o.ei(R.default.state,["isIntercomEnabled","intercomAppId","intercomUserHash","noIntercomUserId","user_id","user_email"])),[]),onVisibilityChange:(0,t.useCallback)((s=>{K.Z.updateShouldResizeWebview(e,s,"v1"),s?C.Z.addNamedPopup("intercom"):C.Z.removeNamedPopup("intercom")}),[e])}),function(e){var s;const{userId:a,spaceId:i,getErrorsSampleRate:r,getTracesSampleRate:n,getReplaysSessionSampleRate:o,getReplaysOnErrorSampleRate:d}=e,l=(0,T.useDependency)(T.deps.sentry);(0,t.useEffect)((()=>{if(!l.value)return;const{Sentry:e,sentryInitializeFull:s}=l.value;s({Sentry:{...e,isFullSDK:!0},config:w.default,getErrorsSampleRate:r,getTracesSampleRate:n,getReplaysSessionSampleRate:o,getReplaysOnErrorSampleRate:d})}),[l.value,r,n,o,d]);const c=null===(s=l.value)||void 0===s?void 0:s.Sentry;(0,t.useEffect)((()=>{c&&c.setUser(a?{id:a}:null)}),[c,a]),(0,t.useEffect)((()=>{c&&c.setTag("space.id",i)}),[c,i])}({userId:a.id,spaceId:Z,getErrorsSampleRate:(0,t.useCallback)((()=>h.default.getConfigKey("sentry","errorsSampleRate")),[]),getTracesSampleRate:(0,t.useCallback)((()=>h.default.getConfigKey("sentry","tracesSampleRate-v0")),[]),getReplaysSessionSampleRate:(0,t.useCallback)((()=>h.default.getConfigKey("sentry","replaysSessionSampleRate-v0")),[]),getReplaysOnErrorSampleRate:(0,t.useCallback)((()=>h.default.getConfigKey("sentry","replaysOnErrorSampleRate-v0")),[])}),(0,S.useConfigurePalette)({userId:a.id,spaceId:Z,pageType:(0,n.VK)((()=>{var e;return null===(e=E.default.state.mainEditorCurrentBlockStore)||void 0===e?void 0:e.getType()}),[])})}function P(){return window.__c={n:"InjectThirdPartyScripts"},Z(),null}}}]);