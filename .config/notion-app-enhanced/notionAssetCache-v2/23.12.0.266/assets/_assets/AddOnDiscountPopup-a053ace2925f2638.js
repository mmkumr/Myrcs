"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,n)=>{n.d(t,{Cl:()=>l,Kj:()=>f,jw:()=>m,k2:()=>c,v5:()=>p});n(21703);var o=n(72126),a=n(4615),r=n(896),s=n(50906),i=n(80444),d=n(21273),u=n(63423);function c(){u.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,a.ZP)(),tax:0})}function p(){u.Z.setState({open:!1})}function l(e){const t=u.Z.state;t.open&&u.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,r.$v)(e)?e:void 0})}function f(){u.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,a.ZP)(),tax:0})}function m(e){var t;if(!d.Z.isQnAOnlyEnabled())throw new Error("Not available");const n=function(){var e;const t=null===(e=i.default.state.currentSpaceStore)||void 0===e?void 0:e.getAdminIds();if(!t||0===t.length)throw new Error("No admins found in the current space");return(0,o.UP)(t)}(),a=null===(t=i.default.state.currentSpaceStore)||void 0===t?void 0:t.getName();s.bfr(e,{admin_id:n,space_name:a})}},71487:(e,t,n)=>{n.d(t,{A:()=>u,y:()=>d});var o=n(31412),a=n(54642),r=n(47307),s=n(33929);const i=(0,o.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function d(e,t){const{customerId:n,offerType:o}=t,s=await a.getCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===o?t.newPlan:void 0,offerType:o});if("failed"===s.type)r.showError(s);else{const e=s.data;if(e.offerType===o)return e.coupon}}async function u(e,t){const{customerId:n,coupon:o,offerType:d}=t;if(!o)return void r.showErrorMessage(s.default.formatMessage(i.invalidCoupon));const u=await a.applyCustomerOffer(e,{customerId:n,newPlan:"downgrade_flow"===d?t.newPlan:void 0,offerType:d,coupon:o});"failed"===u.type&&r.showError(u)}},74011:(e,t,n)=>{n.r(t),n.d(t,{AddOnDiscountPopup:()=>O});var o=n(67294),a=n(480),r=n(86628),s=n(24405),i=n(92595),d=n(11751),u=n(3791),c=n(896),p=n(31412),l=n(50906),f=n(39699),m=n(37181),g=n(38755),v=n(77907),w=n(80444),S=n(78291),_=n(80671),y=n(71487),h=n(70060),P=n(43163),A=n(88893),b=n(35057),C=n(85893);function O(){window.__c={n:"AddOnDiscountPopup"};const e=(0,a.O7)(),[t,n]=o.useState(void 0);(0,o.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=w.default.state;t&&f.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:O,currentSpaceStore:I}=(0,r.VK)((()=>w.default.state),[]),M=(0,r.VK)((()=>S.default.state.data),[]);(0,o.useEffect)((()=>{!async function(){var t;if(!I)return;if(!M)return;if(!(0,A.GJ)(M))return;if("unsubscribed_admin"!==M.type&&"subscribed_admin"!==M.type)return;if("stripe"!==(null===(t=M.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!M.customerData.stripe.isSubscribed)return;const o=A.XX(M);if((0,u.de)(null==o?void 0:o.addOns))return;const a=null!=o&&o.customerId?await y.y(e,{offerType:"add_on_upgrade_flow",customerId:o.customerId}):void 0;(0,c.pp)(a)&&n(a)}()}),[e,I,M]);const x=(0,o.useCallback)((()=>{O&&(f.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:O,transaction:e,data:{seen_ai_discount_popup:!0}})}}),l.Sh9(e))}),[O,e]),D=(0,o.useCallback)((()=>{t&&(_.k2(),_.Cl(t))}),[t]),E=(0,r.VK)((()=>!(!(0,c.pp)(t)||!(0,h.px)(e,(0,b.zt)())||(0,g.CV)(I))),[t,e,I]),k=(0,s.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return E?(0,C.jsx)(v.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:d.t,iconStyle:k.icon,header:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,c.pp)(t)?(0,P.o)(t):void 0}}),description:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:O,allowExternalMouseEvents:!0,onDismiss:x,onTryFeatureClick:D,isUserEligible:E,onPopupSeen:()=>l.Cdl(e),onLearnMore:()=>{t&&D(),x()},ctaMessage:(0,C.jsx)(p.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,n)=>{n.d(t,{o:()=>s});n(67294);var o=n(97880),a=n(31412),r=n(85893);function s(e){switch(e){case"ai_fifty_percent":return(0,r.jsx)(a.FormattedMessage,{id:"addOnUpgrade.confirmation.costSection.specialDiscounts.fiftyPercent",defaultMessage:"50%"});default:(0,o.t1)(e)}}},63423:(e,t,n)=>{n.d(t,{Z:()=>r});var o=n(49085);class a extends o.default{getInitialState(){return{open:!1}}}const r=new a}}]);