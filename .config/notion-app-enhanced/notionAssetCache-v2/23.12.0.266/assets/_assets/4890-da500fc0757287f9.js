"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[4890],{87636:(e,t,o)=>{o.d(t,{Z:()=>v});var i=o(67294),s=o(13991),n=o(480),r=o(24405),a=o(22491),l=o(97880),d=o(82990),h=o(17311),g=o(23063),p=o(64921),c=o(26388),u=o(85893);function m(e){window.__c={n:"ActionMenuGroupButton"};const{button:t,isLast:o}=e,s=(0,r.yK)((e=>({button:{display:"flex",alignItems:"center",padding:"4px 6px",fontWeight:d.Z.fontWeight.medium,borderRight:`1px solid ${e.regularDividerColor}`,color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor},buttonLast:{borderRight:"none"},buttonHovered:{background:e.whiteButtonHoveredBackground},buttonPressed:{background:e.whiteButtonPressedBackground}})),[]);return i.cloneElement(t,{...(0,a.iv)(t.props.style,s.button,o&&s.buttonLast),hoveredStyle:(0,a.iv)(s.buttonHovered,o&&s.buttonLast).style,pressedStyle:s.buttonPressed})}const v=function(e){let{children:t,isVisible:o,position:v,style:C}=e;window.__c={n:"ActionMenuGroup"};const S=(0,n.O7)(),M=(0,r.yK)((e=>({container:{color:e.actionMenuButtonTextColor,fill:e.actionMenuButtonTextColor,fontSize:12,background:e.whiteButtonBackground,boxShadow:e.lightBoxShadow,display:"flex",whiteSpace:"nowrap",borderRadius:h.Z.borderRadius,maxWidth:"calc(100% - 16px)",minHeight:24,overflow:"hidden",pointerEvents:S.device.isMobile?"auto":"none",opacity:S.device.isMobile?1:0,fontFamily:d.Z.getCompositeFontFamily(s.SP).sans,position:"absolute",right:h.Z.horizontal.small,bottom:h.Z.vertical.small,zIndex:2},containerHover:{pointerEvents:"auto",opacity:1},containerTop:{top:h.Z.vertical.small,bottom:void 0}})),[S]),f=i.Children.toArray(t).filter(l.$K),y=f.length;return(0,u.jsx)(g.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,u.jsx)("div",{...(0,a.iv)(M.container,C,o&&M.containerHover,"top"===v&&M.containerTop),children:f.map(((e,t)=>{const o=t===y-1;if(e&&"object"==typeof e&&"type"in e){if(e.type===c.Z&&i.isValidElement(e))return i.cloneElement(e,{render:(t,i)=>{const s=e.props.render(t,i);return(0,u.jsx)(m,{isLast:o,button:s},e.key)}});if(e.type===p.Z&&i.isValidElement(e))return(0,u.jsx)(m,{isLast:o,button:e},e.key)}}))})})}},74169:(e,t,o)=>{o.d(t,{Z:()=>F});var i=o(67294),s=o(83355),n=o(72126),r=o(31412),a=o(47307),l=o(96802),d=o(27153),h=o(39699),g=o(53471),p=o(33929),c=o(94841),u=o(49085);const m="loadingLocalImage",v="uploading",C="loaded";class S extends u.default{getInitialState(){return{loadingMode:C}}}const M=S;var f=o(31792),y=o(87636),b=o(23063),w=o(64921),x=o(12981),R=o(65107),P=o(68785),D=o(32854),Z=o(81865),j=o(97496),I=o(56282),L=o(85893);const k=(0,r.defineMessages)({embedPlaceholder:{defaultMessage:"Paste an image linkâ€¦",id:"pageCover.embedType.placeholder"}});class U extends s.Z{constructor(){super(...arguments),this.lastProxiedUrl=void 0,this.storeTypes={imageUploadStore:M,mouseStore:f.Z},this.handleLoadComplete=()=>{this.stores.imageUploadStore.reset()},this.renderControl=e=>{let{isVisible:t,isRepositioning:o,handleCancelClick:i,handleRepositionClick:s,handleSavePositionClick:n}=e;if(this.props.disabled||this.stores.imageUploadStore.state.loadingMode!==C)return;const{device:a}=this.environment,{isMobile:l}=a,d=(0,c.WE)(this.props.store);return(0,L.jsx)(b.Z,{isVisible:!0,animationStyle:{width:T(this.props.store),opacity:t?1:0},render:()=>(0,L.jsx)("div",{style:{position:d?"absolute":"relative",pointerEvents:t?"auto":"none",maxWidth:"100%",top:d?48:void 0},children:(0,L.jsxs)(y.Z,{isVisible:t,position:"bottom",style:{marginRight:this.props.paddingRight,marginLeft:this.props.paddingLeft},children:[!o&&(0,L.jsx)(w.Z,{style:{...j.Z.actionButtonStyle,...l&&{borderRight:"none"}},onClick:this.handleChangeCoverClick,children:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Change cover",id:"pageCover.changeCover.text"})}),!o&&!l&&(0,L.jsx)(w.Z,{style:{...j.Z.actionButtonStyle,borderRight:"none"},onClick:e=>s(e,this.lastProxiedUrl),children:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Reposition",id:"pageCover.reposition.text"})}),o&&!l&&(0,L.jsx)(w.Z,{style:j.Z.actionButtonStyle,onClick:n,children:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Save position",id:"pageCover.savePosition.text"})}),o&&!l&&(0,L.jsx)(w.Z,{style:{...j.Z.actionButtonStyle,borderRight:"none"},onClick:i,children:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Cancel",id:"pageCover.reposition.cancelText"})})]})})})},this.handleFlushTemporaryPosition=e=>{let{imagePosition:t,reset:o}=e;h.createAndCommit({userAction:"PageCover.handleFlushTemporaryPosition",environment:this.environment,perform:e=>{l.Mp({store:this.props.store,coverPosition:t,transaction:e}),o()}})},this.handleChangeCoverClick=e=>{const{intl:t,store:o}=this.props;this.stores.mouseStore.reset();const i=e.target.getBoundingClientRect();d.$(this.environment,{originGap:3,originRect:i,isSmallWidth:!1,popupWidth:540,maxHeight:485,title:t.formatMessage({defaultMessage:"Page cover",id:"pageCover.mobileMenu.title"}),onDelete:this.handleDelete,currentTab:"gallery",tabs:[{type:"gallery",onChange:this.handleGalleryChange},{type:"file",fileUpload:!1,imageUpload:!0,videoUpload:!1,caption:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Images wider than {idealImageWidth} pixels work best.",id:"pageCover.fileType.caption",values:{idealImageWidth:1500}}),onUpload:e=>{this.props.store.getCoverStore()&&g.cT({environment:this.environment,file:e,bucket:"secure",record:o.pointer,onStart:this.handleUploadStart,onProgress:this.handleUploadProgress,onComplete:this.handleUploadComplete,onError:()=>{a.showErrorMessage(t.formatMessage({defaultMessage:"Upload failed",id:"pageCover.errorDialogMessage.uploadFailed"}))}})}},{type:"embed",title:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Link",id:"pageCover.embedType.title"}),inputPlaceholder:p.default.formatMessage(k.embedPlaceholder),caption:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Works with any image from the web.",id:"pageCover.embedType.caption"}),buttonText:(0,L.jsx)(r.FormattedMessage,{defaultMessage:"Submit",id:"pageCover.embedType.buttonText"}),onChange:this.handleEmbedLinkChange},{type:"unsplash",onChange:this.handleGalleryChange}]})},this.handleUploadComplete=e=>{this.updatePageCover({url:e,position:.5})},this.handleGalleryChange=e=>{const{url:t,position:o}=e;this.updatePageCover({url:t,position:n.hj(o)?o:.5});const{device:i}=this.environment;i.isMobile&&d.Z()},this.handleEmbedLinkChange=e=>{this.updatePageCover({url:e,position:.5}),d.Z()},this.coverWithRecordStore=this.createComputedStore((()=>this.props.store.getCover()),!0),this.updatePageCover=async e=>{const{url:t,position:o}=e,{serverCommitResult:i}=h.createAndCommit({userAction:"PageCover.updatePageCover",environment:this.environment,perform:e=>{l.fs({store:this.props.store,url:t,position:o,transaction:e})}});await i,this.stores.imageUploadStore.state.loadingMode===v&&this.stores.imageUploadStore.setState({loadingMode:"downloading",dataURL:this.stores.imageUploadStore.state.dataURL,uploadProgress:100})},this.handleUploadStart=e=>{const{file:t,name:o,size:i}=e;if(d.Z(),this.stores.imageUploadStore.setState({loadingMode:m,file:t,name:o,size:i}),t.type.indexOf("image")>=0){const e=new FileReader;e.onload=e=>{this.stores.imageUploadStore.state.loadingMode===m&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:0,loadingMode:v,dataURL:e.target.result})},e.readAsDataURL(t)}},this.handleUploadProgress=e=>{const{progressPercent:t}=e;this.stores.imageUploadStore.state.loadingMode===v&&this.stores.imageUploadStore.setState({...this.stores.imageUploadStore.state,uploadProgress:t})},this.handleDelete=()=>{d.Z(),h.createAndCommit({userAction:"PageCover.handleDelete",environment:this.environment,perform:e=>{l.MF({store:this.props.store,transaction:e})}})}}renderComponent(){const e=this.coverWithRecordStore.getState();if(!e)return;const t=this.stores.imageUploadStore.state,o=(0,c.WE)(this.props.store),s=t.loadingMode!==C&&t.loadingMode!==m;return(0,L.jsx)(I.Z,{mouseStore:this.stores.mouseStore,onFlushTemporaryPosition:this.handleFlushTemporaryPosition,renderControl:this.renderControl,source:"page",store:this.props.store,style:{display:"flex",flexDirection:"column",alignItems:"center",height:this.props.height,cursor:"default"},dragMessageContainerStyle:o?{top:56}:void 0,render:o=>(0,L.jsxs)(i.Fragment,{children:[(0,L.jsx)(Z.Z,{url:e.cover,isAuthenticated:!0,permissionRecord:e.pointer,width:this.props.proxyWidth,render:(e,i)=>{this.lastProxiedUrl=i;const n={width:"100%",height:this.props.height,objectFit:"cover",opacity:s?.5:1,objectPosition:`center ${100*(1-(o.imagePosition||0))}%`,borderRadius:0},r={width:"100%",height:this.props.height};return(0,L.jsx)(R.B,{src:i,placeholderSrc:s?t.dataURL:void 0,placeholderBehavior:s?"force-show-placeholder":"show-placeholder-if-loading-src",containerStyle:r,imageStyle:n,onLoadComplete:this.handleLoadComplete})}}),s&&(0,L.jsxs)("div",{style:x.Z.loadingContainerStyle,children:[(0,L.jsx)(P.Z,{style:{width:16,height:16,marginRight:4}}),(0,L.jsx)("div",{style:{minWidth:30,textAlign:"right"},children:(0,L.jsx)(D.Z,{percentage:t.uploadProgress})})]})]})})}}U.displayName="PageCover";const F=(0,r.injectIntl)(U);function T(e){let t;return t=!!e.isFullWidth()?"100%":900,t}},56282:(e,t,o)=>{o.d(t,{Z:()=>x});o(67294);var i=o(73935),s=o(83355),n=o(13991),r=o(6740),a=o(49085),l=o(12137),d=o(8848),h=o(22491),g=o(72126),p=o(82990),c=o(63143),u=o(31412),m=o(24677),v=o(31792),C=o(27724);class S extends a.default{getInitialState(){return{showFadeInAnimation:!1,isRepositioning:!1}}}const M=S;var f=o(23063),y=o(6685),b=o(85893);class w extends s.Z{constructor(){super(...arguments),this.storeTypes={focusStore:a.default.createClass(!1),mouseStore:v.Z,withImageRepositioningStore:M},this.renderDraggable=()=>(0,b.jsx)(y.Z,{onDraggableDragStart:this.handleDragStart,onDraggableDragMove:this.handleDragMove,onDraggableDragEnd:this.handleDragEnd,onDraggableDragCancel:this.handleDragCancel,disabled:!this.isRepositioning(),render:e=>(0,b.jsx)("div",{...(0,h.iv)(this.getDragContainerStyle()),...e,children:this.props.render({imagePosition:this.getRenderedCoverPosition(),isRepositioning:this.isRepositioning(),showFadeInAnimation:!1})})}),this.shouldBeActiveStore=this.createComputedStore((()=>0===C.default.state.stores.length)),this.handleFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,r.E)(t)&&this.stores.focusStore.setState(!0)},this.handleBlur=e=>{this.stores.focusStore.setState(!1)},this.handleMouseMove=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!0})},this.handleMouseLeave=e=>{this.mouseStore.setState({...this.mouseStore.state,mouseEntered:!1})},this.handleMouseMoveThrottled=(0,g.P2)(this.handleMouseMove,100),this.handleMouseLeaveDebounced=(0,g.Ds)(this.handleMouseLeave,100),this.handleWindowMouseDown=e=>{const t=i.findDOMNode(this);t&&!t.contains(e.target)&&this.isRepositioning()&&this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.mouseStore.reset(),this.stores.withImageRepositioningStore.reset()}})},this.handleRepositionClick=(e,t)=>{m.ZH(this.environment);const o=new Image;o.onload=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,isRepositioning:!0,image:o})},t&&(o.src=t)},this.handleCancelClick=e=>{this.stores.withImageRepositioningStore.reset()},this.handleSavePositionClick=e=>{this.props.onFlushTemporaryPosition({imagePosition:this.getRenderedCoverPosition(),reset:()=>{this.stores.withImageRepositioningStore.reset()}})},this.handleDragStart=e=>{const t=this.isRepositioning(),{image:o}=this.stores.withImageRepositioningStore.state;if(o&&t){const e=i.findDOMNode(this);if(e&&e instanceof Element){const t=e.getBoundingClientRect().width/o.width*o.height,i=this.getRenderedCoverPosition();this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:t,startDragRenderedPosition:i})}}},this.handleDragMove=e=>{if(this.isRepositioning()){const{startDragRenderedPosition:t,startDragImageScreenHeight:o}=this.stores.withImageRepositioningStore.state,i=e.diffY/(o||0)+(t||0);this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,temporaryPosition:(0,g.NM)((0,l.Z)(i,0,1),4)})}},this.handleDragEnd=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})},this.handleDragCancel=()=>{this.stores.withImageRepositioningStore.setState({...this.stores.withImageRepositioningStore.state,startDragImageScreenHeight:void 0,startDragRenderedPosition:void 0})}}didMount(){super.didMount(),window.addEventListener("mousedown",this.handleWindowMouseDown)}willUnmount(){super.willUnmount(),window.removeEventListener("mousedown",this.handleWindowMouseDown)}willMountOrUpdate(){this.isRepositioning()&&!this.shouldBeActiveStore.state&&this.stores.withImageRepositioningStore.reset()}renderComponent(){const{device:e}=this.environment,{style:t}=this.props,{isMobile:o}=e,i=this.isRepositioning(),{mouseEntered:s}=this.mouseStore.state,n=this.stores.focusStore.state;return(0,b.jsxs)("div",{onFocus:this.handleFocus,onBlur:this.handleBlur,onMouseEnter:this.handleMouseMoveThrottled,onMouseMove:this.handleMouseMoveThrottled,onMouseLeave:this.handleMouseLeaveDebounced,...(0,h.iv)({position:"relative",width:"100%"},t),children:[this.renderDraggable(),this.renderDragMessage(),this.props.renderControl({handleRepositionClick:this.handleRepositionClick,handleSavePositionClick:this.handleSavePositionClick,handleCancelClick:this.handleCancelClick,isVisible:o||s||n||i,isRepositioning:i})]})}renderDragMessage(){const{isRepositioning:e}=this.stores.withImageRepositioningStore.state;if(!this.props.small)return(0,b.jsx)(f.Z,{isVisible:!0,animationStyle:{opacity:e?1:0},render:()=>{return(0,b.jsx)("div",{...(0,h.iv)((t=this.props.dragMessageContainerStyle,{background:d.ZP.blackWithAlpha(.4),borderRadius:4,color:d.ZP.white,fontSize:12,fontFamily:p.Z.getCompositeFontFamily(n.SP).sans,width:180,left:"calc(50% - 90px)",padding:"0.3em 1.5em 0.3em",pointerEvents:"none",position:"absolute",top:"calc(50% - 10px)",textAlign:"center",...t??{}})),"aria-hidden":!e,children:(0,b.jsx)(u.FormattedMessage,{defaultMessage:"Drag image to reposition",id:"withImageRepositioning.dragImage.text"})});var t}})}isRepositioning(){return this.stores.withImageRepositioningStore.state.isRepositioning}getRenderedCoverPosition(){const{temporaryPosition:e}=this.stores.withImageRepositioningStore.state;return(0,g.hj)(e)?e:function(e,t){if("gallery"===e||"board"===e){const e=t.getFormat().card_cover_position;if((0,g.hj)(e))return e}const o=.5;if(t.isCollectionView()){const e=t.getCollectionViewCollectionStore();if(e){const t=e.getFormat().collection_cover_position;return(0,c.z4)(t)?o:t}}const i=t.getFormat().page_cover_position;if((0,g.hj)(i))return i;return o}(this.props.source,this.props.store)}get mouseStore(){return this.props.mouseStore||this.stores.mouseStore}getDragContainerStyle(){return{width:"100%",cursor:this.isRepositioning()?"move":"inherit"}}}w.displayName="WithImageRepositioning";const x=w},82356:(e,t,o)=>{o.d(t,{l:()=>n});o(67294);var i=o(45238),s=o(85893);const n=(0,i.I)("import",{viewBox:"0 0 16 16",svg:(0,s.jsx)("path",{d:"M13.291 14.5723C13.291 14.1484 12.9902 13.834 12.5732 13.834H8.06836C8.24609 13.8203 8.42383 13.7314 8.56055 13.5947L13.0586 9.08301C13.2158 8.91895 13.291 8.74121 13.291 8.54297C13.291 8.12598 12.9902 7.81836 12.5801 7.81836C12.3682 7.81836 12.1836 7.90039 12.0469 8.03711L10.4951 9.56836L8.69043 11.585L8.75195 10.1084V1.61133C8.75195 1.16016 8.44434 0.852539 8 0.852539C7.5625 0.852539 7.25488 1.16016 7.25488 1.61133V10.1084L7.30957 11.5781L5.50488 9.56836L3.95312 8.03711C3.82324 7.90039 3.63184 7.81836 3.42676 7.81836C3.0166 7.81836 2.70898 8.12598 2.70898 8.54297C2.70898 8.74121 2.78418 8.91895 2.94141 9.08301L7.44629 13.5947C7.58301 13.7314 7.75391 13.8203 7.93848 13.834H3.44043C3.0166 13.834 2.70898 14.1484 2.70898 14.5723C2.70898 14.9893 3.0166 15.3037 3.44043 15.3037H12.5732C12.9902 15.3037 13.291 14.9893 13.291 14.5723Z"})})},70663:(e,t,o)=>{o.d(t,{h:()=>n});o(67294);var i=o(45238),s=o(85893);const n=(0,i.I)("replace",{viewBox:"0 0 16 16",svg:(0,s.jsx)("path",{d:"M3.26465 3.96094C2.95996 4.26562 2.979 4.66553 3.23291 4.8877C3.49316 5.12256 3.86133 5.12256 4.16602 4.83057C5.11182 3.80225 6.48291 3.15479 8 3.15479C10.6851 3.15479 12.856 5.12891 13.2051 7.66162H12.2466C11.7642 7.66162 11.6309 8.01709 11.9102 8.41064L13.4209 10.5435C13.6494 10.8608 13.9985 10.8608 14.2334 10.5435L15.7441 8.41699C16.0298 8.02344 15.8965 7.66162 15.4077 7.66162H14.519C14.1445 4.44336 11.3516 1.85986 8 1.85986C6.13379 1.85986 4.43262 2.68506 3.26465 3.96094ZM0.249512 8.42334C-0.0297852 8.81689 0.097168 9.17871 0.585938 9.17871H1.4873C1.85547 12.397 4.64844 14.9805 8 14.9805C9.87256 14.9805 11.5737 14.1553 12.748 12.873C13.0464 12.5684 13.0273 12.1685 12.7734 11.9399C12.5132 11.7051 12.1514 11.7114 11.8403 12.0034C10.9009 13.0381 9.52979 13.6855 8 13.6855C5.32129 13.6855 3.14404 11.7178 2.79492 9.17871H3.74707C4.22949 9.17871 4.36279 8.82324 4.0835 8.42969L2.57275 6.29688C2.34424 5.97949 1.99512 5.97949 1.7666 6.29688L0.249512 8.42334Z"})})}}]);