"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9350,71],{68500:(e,t,o)=>{o.d(t,{Z:()=>D});o(67294);var r=o(83355),i=o(66897),n=o(14714),s=o(99036),a=o(75e3),l=o(72126),c=o(4615),d=o(23014),p=o(21202),u=o(6287),h=o(97880),m=o(5366),g=o(47307),y=o(31299),S=o(66890),f=o(87279),x=o(886),v=o(33846),C=o(29798),b=o(35661),w=o(42922),M=o(52275),j=o(36488),I=o(74194),P=o(68894),_=o(78140),k=o(32163),T=o(43765),F=o(11470),Z=o(77137),A=o(72495),R=o(86765),V=o(97680),B=o(85893);class O extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:v.Z,menuListStore:C.Z,collectionContextStore:x.Z},this.performRelationSearchRequest=async e=>{const{groupBy:t,schema:o,parentStore:r}=this.props,i=o[t.property];if(!i||!(0,s.p_)(i))return;const n=i.collection_pointer;if(!n)return;const a=b.NW.createChildStore(r,{table:u.v,id:n.id});if(await a.load(),!a.isDefined())return;const l=a.getSpaceId();return(await y.df({environment:this.environment,query:e,collectionId:n.id,spaceId:l,excludeTemplates:!0,source:"collection_group_value",limit:20,includePublicPagesWithoutExplicitAccess:!1,boostRecentlyViewedPages:!1})).results.map((e=>({table:p.iU,id:e,spaceId:l})))},this.handleTextInputChange=e=>{const{inputStore:t,menuListStore:o}=this.stores;t.setState({...t.state,inputValue:e.target.value}),o.setState({...o.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleTextInputKeydown=e=>{if(13===e.keyCode)this.acceptTextInputValue();else if(27===e.keyCode){var t,o;null===(t=(o=this.props).onClose)||void 0===t||t.call(o)}},this.handleMenuClickRight=()=>{this.acceptTextInputValue()},this.handleClickSubmitButton=()=>{this.acceptTextInputValue()},this.performUserSearchRequest=async e=>(await y.Yu({environment:this.environment,query:e,membersOnly:!1})).slice(0,20)}willMount(e){var t;super.willMount(e);const{inputStore:o}=this.stores,{groupFormat:r}=this.props;r&&("select"===r.value.type||"multi_select"===r.value.type)&&r.value.value?o.setState({...o.state,inputValue:r.value.value}):r&&(0,n.R7)(r.value)&&"exact"===(null===(t=r.value.value)||void 0===t?void 0:t.type)&&o.setState({...o.state,inputValue:r.value.value.value})}renderComponent(){const{groupFormat:e,onClose:t}=this.props;let o;return o=this.environment.device.isPhone?{menuType:f.og.Modal,title:e?(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Rename group",id:"codeBlock.databaseEditGroupMenu.renameGroupTitle"}):(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Add a group",id:"codeBlock.databaseEditGroupMenu.addGroupTitle"}),left:(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Cancel",id:"codeBlock.databaseEditGroupMenu.cancelButton.label"}),right:(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Done",id:"codeBlock.databaseEditGroupMenu.doneButton.label"}),onClickRight:this.handleMenuClickRight,onClickLeft:t}:{menuType:f.og.Popup,width:this.isTextInputType()?300:240,maxHeight:"50vh"},(0,B.jsx)(j.Z,{capture:!0,render:e=>(0,B.jsx)(_.Z,{...o,...e,children:this.renderMenuInner()})})}renderMenuInner(){const{groupBy:e,schema:t}=this.props;if(t[e.property])return"select"===e.type||"multi_select"===e.type?this.renderTextInput():"person"===e.type?this.renderPersonValue():"relation"===e.type?this.renderRelationValue():(0,n.HB)(e.type)?this.renderTextInput():void("number"!==e.type&&"status"!==e.type&&"date"!==e.type&&"formula"!==e.type&&"checkbox"!==e.type&&"created_time"!==e.type&&"last_edited_time"!==e.type&&"created_by"!==e.type&&"last_edited_by"!==e.type&&"last_visited_time"!==e.type&&"location"!==e.type&&(0,h.t1)(e.type))}renderTextInput(){const{intl:e,groupFormat:t}=this.props,{inputValue:o}=this.stores.inputStore.state,r=t?e.formatMessage({id:"database.collectionEditGroupMenu.renameGroupLabel.placeholder",defaultMessage:"Rename group"}):e.formatMessage({id:"database.collectionEditGroupMenu.newGroupLabel.placeholder",defaultMessage:"New group"});return this.environment.device.isPhone?(0,B.jsx)(A.Z,{children:(0,B.jsx)(P.ZP,{value:o,focus:!0,selectAll:!0,showClearButton:!1,focusInitial:!0,placeholder:r,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown})}):(0,B.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 10px",width:"100%",background:this.theme.inputBackground},children:[(0,B.jsx)(I.Z,{value:o,focus:!0,selectAll:!0,focusInitial:!0,placeholder:r,onChange:this.handleTextInputChange,onKeyDown:this.handleTextInputKeydown,format:I.B.Transparent}),(0,B.jsxs)(w.Z,{onClick:this.handleClickSubmitButton,children:[(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Done",id:"database.collectionEditGroupMenu.submitButton.label"}),(0,a.U)({height:14,width:14,fill:"currentColor",marginLeft:6,marginTop:2})]})]})}renderPersonValue(){const{currentGroups:e,intl:t}=this.props,{inputValue:o}=this.stores.inputStore.state;return(0,B.jsx)(Z.Z,{request:o,performRequest:this.performUserSearchRequest,debounce:y.vp,render:(r,s,a)=>{s||(s=[]);const c=l.oA(s.map((t=>({key:t.id,render:e=>(0,B.jsx)(V.Z,{actor:(0,i.dp)(t),...e}),action:()=>{const{onChange:o,groupFormat:r}=this.props,i={type:"person",value:{table:"notion_user",id:t.id}};var s,a;r&&l.Xy(i,r.value)?null===(s=(a=this.props).onClose)||void 0===s||s.call(a):e.some((e=>(0,n.we)(i,e.value)))?g.showErrorMessage(this.renderGroupAlreadyExistsMessage()):o({newGroupValue:i})}}))));let d;return d=a&&s&&0===c.length?(0,B.jsx)(A.Z,{children:(0,B.jsx)(T.Z,{title:(0,B.jsx)(m.FormattedMessage,{defaultMessage:"No results",id:"database.noPersonSearchResults.message"})})}):(0,B.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,B.jsx)(A.Z,{...e}),items:c}],store:this.stores.menuListStore}),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(A.Z,{children:(0,B.jsx)(P.ZP,{value:o,focus:!0,placeholder:t.formatMessage({defaultMessage:"Search for a person…",id:"database.searchPerson.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),d]})}})}getCreateNewPageMenuListItem(){const{parentStore:e,schema:t,groupBy:o}=this.props,{inputValue:r}=this.stores.inputStore.state,i=t[o.property];if(!i||"relation"!==i.type)return null;const n=s.j0(i);if(!n)return null;const a=b.NW.createChildStore(e,n);return a.isDefined()&&r.length>0?{key:"new-page",render:e=>(0,B.jsx)(M.Z,{title:(0,B.jsx)(R.Z,{targetCollectionStore:a,title:r}),...e}),action:()=>{const{onChange:e}=this.props,t={table:p.iU,id:(0,c.ZP)(),spaceId:a.getSpaceId()};e({newGroupValue:{type:"relation",value:t},newPage:{id:t.id,spaceId:t.spaceId,name:r}})}}:null}getMenuListItemsForRelatedRecords(e,t){var o;const{currentGroups:r,parentStore:i}=this.props,s=null===(o=this.context.collectionContextStore)||void 0===o?void 0:o.relativeVariableStore.state,a=s&&s[t.id],c=e=>{const o=b.NW.createChildStore(i,t);if(!o.isDefined())return;const r=o.getFormat().app_config_uri;return r&&e?d.qB[r][e].formattedMessage:void 0};return e.map((e=>{const t=b.G.createChildStore(i,e);if(t.isTemplate())return;const o=a?(0,d.P8)(t.id,a):void 0;return{key:t.id,render:e=>(0,B.jsx)(F.Z,{store:t,titlePrefix:c(o),...e}),action:()=>{const{onChange:t,groupFormat:i}=this.props;let s={type:"relation",value:e};var a,c;(o&&(s={type:"relation",value:{type:"relative",value:{type:"builtin",variable:o}}}),i&&l.Xy(s,i.value))?null===(a=(c=this.props).onClose)||void 0===a||a.call(c):r.some((e=>(0,n.we)(s,e.value)))?g.showErrorMessage(this.renderGroupAlreadyExistsMessage()):t({newGroupValue:s})}}}))}renderRelationValue(){const{intl:e,parentStore:t,schema:o,groupBy:r}=this.props,{inputValue:i}=this.stores.inputStore.state,n=o[r.property];if(!n||"relation"!==n.type)return;const a=s.j0(n);if(!a)return;return b.NW.createChildStore(t,a).isDefined()?(0,B.jsx)(Z.Z,{request:i,performRequest:this.performRelationSearchRequest,debounce:y.vp,render:(t,o,r)=>{o||(o=[]);const n=l.oA([...this.getMenuListItemsForRelatedRecords(o,a),this.getCreateNewPageMenuListItem()]);let s;return s=r&&o&&0===n.length?(0,B.jsx)(A.Z,{children:(0,B.jsx)(T.Z,{title:(0,B.jsx)(m.FormattedMessage,{defaultMessage:"No results",id:"database.noRelationSearchResults.message"})})}):(0,B.jsx)(k.Z,{type:k.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,B.jsx)(A.Z,{...e}),items:n}],store:this.stores.menuListStore}),(0,B.jsxs)(B.Fragment,{children:[(0,B.jsx)(A.Z,{children:(0,B.jsx)(P.ZP,{value:i,focus:!0,placeholder:e.formatMessage({defaultMessage:"Type to search...",id:"database.searchRelation.placeholder"}),onChange:e=>{this.stores.inputStore.setState({...this.stores.inputStore.state,inputValue:e.target.value}),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})}})}),s]})}}):void 0}renderGroupAlreadyExistsMessage(){return(0,B.jsx)(m.FormattedMessage,{defaultMessage:"Group already exists.",id:"database.groupExistsAlreadyError.message"})}acceptTextInputValue(){const{onChange:e,currentGroups:t,groupBy:o,groupFormat:r}=this.props,{inputStore:i}=this.stores,s=i.state.inputValue.trim().replace(/,/g,"");let a;var c,d,p,u,h,m;("select"===o.type||"multi_select"===o.type?a={type:o.type,value:s}:(0,n.aB)(o)&&(a={type:o.type,value:{type:"exact",value:s}}),a)?s?r&&l.Xy(a,r.value)?null===(c=(d=this.props).onClose)||void 0===c||c.call(d):t.some((e=>a&&(0,n.we)(a,e.value)))?g.showErrorMessage(this.renderGroupAlreadyExistsMessage()):e({newGroupValue:a}):null===(p=(u=this.props).onClose)||void 0===p||p.call(u):null===(h=(m=this.props).onClose)||void 0===h||h.call(m)}isTextInputType(){const{groupBy:e}=this.props;return"select"===e.type||"multi_select"===e.type||(0,n.HB)(e.type)}}O.displayName="CollectionEditGroupMenu",O.contextTypes={...r.w,...S.xm};const D=(0,m.injectIntl)(O)},26055:(e,t,o)=>{o.d(t,{Z:()=>E});o(67294);var r=o(83355),i=o(66897),n=o(15145),s=o(14714),a=o(99036),l=o(80951),c=o(84619),d=o(7057),p=o(53877),u=o(42875),h=o(89767),m=o(32056),g=o(23014),y=o(97880),S=o(82990),f=o(5366),x=o(5149),v=o(88990),C=o(26991),b=o(45433),w=o(29376);var M=o(78316),j=o(84210),I=o(33929),P=o(80444),_=o(61766),k=o(35661),T=o(68500),F=o(97180),Z=o(64921),A=o(31945),R=o(60458),V=o(84076),B=o(31278),O=o(76798),D=o(26388),N=o(92864),L=o(10009),K=o(22084),W=o(85893);class q extends r.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:_.Z},this.renderEditPopup=()=>{const{schema:e,currentGroups:t,groupBy:o,groupFormat:r}=this.props,i=this.groupParentStore.state;if(i)return(0,W.jsx)(T.Z,{groupFormat:r,groupBy:o,currentGroups:t,schema:e,onChange:e=>{var t,o;this.stores.buttonPopupStore.reset(),null===(t=(o=this.props).onChange)||void 0===t||t.call(o,e)},onClose:()=>{var e,t;this.stores.buttonPopupStore.reset(),null===(e=(t=this.props).onClose)||void 0===e||e.call(t)},parentStore:i})},this.groupParentStore=this.createComputedStore((()=>{const{collectionContextStore:e,groupFormat:t}=this.props,o=e.groupsStore.getGroupState(t);return null==o?void 0:o.groupUiParentStore})),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,groupFormat:t}=this.props,o=this.groupParentStore.state,r=e[t.property];if(r&&(0,a.p_)(r)&&o)return(0,w.ke)(r,o)}))}renderGroupType(e,t){return"select"===e.type||"multi_select"===e.type?this.renderSelectValue():"status"===e.type?this.renderStatusValue():(0,s.pd)(e.type)?this.renderPersonValue(e):"relation"===e.type?this.renderRelationValue(e):"location"===e.type?this.renderLocationValue(e):(0,s.A1)(e.type)?this.renderDateValue(e):(0,s.HB)(e.type)?this.renderTextValue(e):"number"===e.type?this.renderNumberValue(e,"number"===t.type?t:void 0):"checkbox"===e.type?this.renderCheckboxValue(e):void(0,y.t1)(e.type)}renderComponent(){const{groupFormat:e,schema:t}=this.props,o=e.value,r=void 0===o.value,i=t[e.property];if(i){if(r)return this.renderEmptyGroupLabel();if("formula"===o.type){if("formula"!==o.type)return;const e=o.value;if(!e)return;return this.renderGroupType(e,i)}return this.renderGroupType(o,i)}}renderEmptyGroupLabel(){const{groupFormat:e,schema:t,isHiddenGroup:o,collectionContextStore:r}=this.props,i=t[e.property],n=r.collectionStore(),s=this.groupParentStore.state;if(!i)return;const{name:l}=i;let c=!1;return null!=n&&n.isDefined()&&(0,a.p_)(i)&&s&&(c=function(e){const{collectionStore:t,property:o,propertySchema:r,parentStore:i}=e;let n=!1;if(null!=t&&t.isDefined()){const e=t.getPropertyMapping();n=(null==e?void 0:e[b.Es.TaskToSprintRelation])===o}return(0,w.ke)(r,i)===b.p$||n}({collectionStore:n,property:e.property,propertySchema:i,parentStore:s})),c?(0,W.jsx)(G,{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Backlog (No {name})",values:{name:l},id:"database.sprintDatabaseView.uncategorizedGroupLabel"})}):(0,W.jsx)(G,{style:this.props.style,uncategorizedIconStyle:this.props.uncategorizedIconStyle,isHiddenGroup:o,formattedLabelMessage:(0,W.jsx)(f.FormattedMessage,{defaultMessage:"No {name}",values:{name:l},id:"database.boardView.uncategorizedColumnTitle"})})}renderSelectValue(){var e;const{groupFormat:t,schema:o}=this.props,r=o[t.property];if(!r||!a.cu(r))return;const i=t.value;if(null===(e=r.options)||void 0===e||!e.length||void 0===i.value||i.type!==r.type)return;const n=(0,l.i7)(r.options,i.value);return n?(0,W.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,W.jsx)(Z.Z,{style:{...q.personTokenStyle,...this.props.style},disabled:this.props.disabled,...e,children:(0,W.jsx)(K.a,{format:c.l.Medium,isSingle:!0,value:n.value,color:n.color,showRemoveButton:!1})})}):void 0}renderStatusValue(){const{groupFormat:e,schema:t}=this.props,o=t[e.property];if(!o||"status"!==o.type)return;const r=e.value;if(r.type!==o.type)return;const{value:i}=r;if(!i)return;const n=o.options??[],s=o.groups??[];if("by_group"===i.type){const e=s.find((e=>e.name===i.group));return e&&(0,W.jsx)(F.r_,{group:e,style:{fontWeight:500},showIcon:!0,showColor:!0})}if("by_option"===i.type){const e=(0,l.i7)(n,i.option),t=e&&s.find((t=>{var o;return null===(o=t.optionIds)||void 0===o?void 0:o.includes(e.id)}));return e&&(0,W.jsx)("span",{style:{fontWeight:500,lineHeight:"normal",overflow:"hidden"},children:(0,W.jsx)(K.F,{format:c.l.Medium,isSingle:!0,value:e.value,color:e.color,showRemoveButton:!1,groupColor:null==t?void 0:t.color})})}(0,y.t1)(i)}renderPersonValue(e){if(!(0,s.q6)(e))return;const{value:t}=e;if(!t)return;const o=this.groupParentStore.state;if(!o)return;const r=(0,i.Hl)({pointer:t,getRecordValue:o.getRecordValue});return r.asActor?(0,W.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,W.jsx)(Z.Z,{style:{...q.personTokenStyle,...this.props.style},disabled:this.props.disabled,...e,children:(0,W.jsx)(N.ZP,{format:N.ZP.Format.Medium,actor:r,showRemoveButton:!1,isSingle:!0,disableAvatarTooltip:this.props.isHiddenGroup,shouldShrink:!0})})}):void 0}renderLocationValue(e){const t=this.groupParentStore.state;if("location"!==e.type)return;if(!e.value)return;if(!t)return;const o=k.NW.createChildStore(t,e.value);return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsx)(B.Z,{disabled:!0,icon:o.getIcon(),size:20,isEmptyPage:!1,style:{marginTop:2,marginRight:6}}),(0,W.jsx)(O.Z,{store:o,underline:!0,style:{fontWeight:S.Z.fontWeight.medium}})]})}renderRelationValue(e){const{schema:t,groupFormat:o,collectionContextStore:r}=this.props,i=this.groupParentStore.state;if(!i)return;if("relation"!==e.type)return;const l=t[o.property];if(!l||"relation"!==l.type)return;const c=a.j0(l);if(!c)return;const d=k.NW.createChildStore(i,c);if(d.isDefined()&&e.value){if((0,s.t2)(e.value)){var p;const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;const o=I.default.formatMessage(v.sY.tasksCurrentSprintV2ViewNamePrefix),s=I.default.formatMessage(v.sY.tasksNextSprintV2ViewNamePrefix),a=e.value.value.variable,l=null===(p=g.qB[t])||void 0===p?void 0:p[a];if(null!=d&&d.isDefined()){const e=(0,C.As)(r,a,c,d);if(!e)return(0,W.jsx)("div",{style:{fontWeight:S.Z.fontWeight.medium},children:null==l?void 0:l.formattedMessage});const{mainEditorCurrentBlockStore:t}=P.default.state,p=M.mb({store:e,mainEditorCurrentBlockStore:t,collectionContextStore:r})??(0,j.ZP)({store:e,pageVisitSource:n.tY.LinkInPage});if(e)return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)("div",{style:{fontWeight:S.Z.fontWeight.medium,marginBottom:.25},children:["current"===a?o:s,":"]}),(0,W.jsx)(V.Z,{style:{...this.props.style,marginLeft:1},innerStyle:{...q.personTokenStyle},href:p,onClick:()=>{x.E3({collectionSettingsStore:r.settingsStore})},children:(0,W.jsx)(L.Z,{format:N.ZP.Format.Medium,blockId:e.id,isSingle:!0,shouldShrink:!0,parentStore:i})})]})}return(0,W.jsx)("div",{style:{fontWeight:S.Z.fontWeight.medium,marginBottom:.25},children:null==l?void 0:l.formattedMessage})}if((0,s.RA)(e.value)){const t=k.G.createChildStore(i,e.value),{mainEditorCurrentBlockStore:o}=P.default.state,s=M.mb({store:t,mainEditorCurrentBlockStore:o,collectionContextStore:r})??(0,j.ZP)({store:t,pageVisitSource:n.tY.LinkInPage});return(0,W.jsx)(V.Z,{style:this.props.style,innerStyle:{...q.personTokenStyle},href:s,onClick:()=>{x.E3({collectionSettingsStore:r.settingsStore})},children:(0,W.jsx)(L.Z,{format:N.ZP.Format.Medium,blockId:e.value.id,isSingle:!0,shouldShrink:!0,parentStore:i})})}}}renderDateValue(e){if((0,s.Mc)(e)&&e.value)return(0,W.jsx)("div",{style:{...q.personTokenStyle,...S.Z.textOverflowStyle,...this.props.style},children:this.renderDateGroupValue(e.value)})}renderDateGroupValue(e){if("today"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Today",id:"database.collectionGroupValue.dateGroup.today"});if("yesterday"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Yesterday",id:"database.collectionGroupValue.dateGroup.yesterday"});if("last_7_days"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Last 7 days",id:"database.collectionGroupValue.dateGroup.last7Days"});if("last_30_days"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Last 30 days",id:"database.collectionGroupValue.dateGroup.last_30Days"});if("tomorrow"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Tomorrow",id:"database.collectionGroupValue.dateGroup.tomorrow"});if("next_7_days"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Next 7 days",id:"database.collectionGroupValue.dateGroup.next7Days"});if("next_30_days"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Next 30 days",id:"database.collectionGroupValue.dateGroup.next30Days"});if("day"===e.type){const t=(0,p.NK)(e.range,(0,u.r)(),this.props.intl.locale);return(0,d.ZW)(t.start,"medium")}if("week"===e.type){const t=(0,p.NK)(e.range,(0,u.r)(),this.props.intl.locale),o=(0,d.ZW)(t.start,"month_short"),r=(0,d.ZW)(t.start,"day"),i=t.start.year,n=(0,d.ZW)(t.end,"month_short"),s=(0,d.ZW)(t.end,"day"),a=t.end.year;return i!==a?(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay} {startYear} - {endMonth} {endDay} {endYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndYear",values:{startMonth:o,startDay:r,endMonth:n,endDay:s,startYear:i,endYear:a}}):o!==n?(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay} - {endMonth} {endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.differingStartAndEndMonth",values:{startMonth:o,startDay:r,endMonth:n,endDay:s,startYear:i}}):(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Week of {startMonth} {startDay}-{endDay} {startYear}",id:"database.collectionGroupValue.dateGroup.week.sameStartAndEndMonth",values:{startMonth:o,startDay:r,endDay:s,startYear:i}})}if("month"===e.type){const t=(0,p.NK)(e.range,(0,u.r)(),this.props.intl.locale);return(0,d.ZW)(t.start,"month_year_short")}if("year"===e.type){return(0,p.NK)(e.range,(0,u.r)(),this.props.intl.locale).start.year.toString()}(0,y.t1)(e)}renderTextValue(e){if((0,s.R7)(e)&&void 0!==e.value){const t=this.renderTextGroupValue(e.value);return"exact"===e.value.type?(0,W.jsx)(A.ZP,{render:this.renderEditPopup,disabled:this.props.disabled,buttonPopupStore:this.stores.buttonPopupStore,popupType:this.environment.device.isMobile?A.Z4.SlideUp:A.Z4.Popup,originGap:4,renderOrigin:e=>(0,W.jsx)(Z.Z,{style:{...q.selectStyle,...S.Z.textOverflowStyle,...this.props.style},disabled:this.props.disabled,...e,children:t})}):(0,W.jsx)("div",{style:q.selectStyle,children:t})}}renderTextGroupValue(e){return"other"===e.type?(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Other",id:"database.collectionGroupValue.textGroup.other"}):"alphabet_prefix"===e.type||"exact"===e.type?e.value:void(0,y.t1)(e)}renderNumberValue(e,t){if("number"!==e.type||!e.value)return;const o=(null==t?void 0:t.number_format)||m.dk;return(0,W.jsx)("div",{style:{...q.personTokenStyle,...this.props.style},children:this.renderNumberGroupValue(e.value,o)})}renderNumberGroupValue(e,t){if("out_of_range"===e.type)return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Out of range",id:"database.collectionGroupValue.numberGroup.outOfRange"});if("range"===e.type){const o=m.uf(e.start,t,this.props.intl),r=m.uf(e.end,t,this.props.intl);return(0,W.jsx)(f.FormattedMessage,{defaultMessage:"{start} to {end}",id:"database.collectionGroupValue.numberGroup.range",values:{start:o,end:r}})}(0,y.t1)(e)}renderCheckboxValue(e){if("checkbox"===e.type)return(0,W.jsx)("div",{style:{...q.checkboxStyle,...this.props.style},children:(0,W.jsx)(R.Z,{checked:e.value,size:14,disabled:!0})})}}q.displayName="CollectionGroupValue",q.selectStyle={overflow:"hidden",padding:3,borderRadius:3,fontWeight:S.Z.fontWeight.medium},q.personTokenStyle={overflow:"hidden",padding:3,paddingRight:6,borderRadius:3,fontWeight:S.Z.fontWeight.medium},q.checkboxStyle={padding:3,paddingRight:6};const E=(0,f.injectIntl)(q);function G(e){const{isHiddenGroup:t}=e;return t?(0,W.jsx)(z,{...e,tooltipEvents:void 0}):(0,W.jsx)(D.Z,{renderTooltip:()=>(0,W.jsx)(f.FormattedMessage,{defaultMessage:"Any items with an empty <b>{name}</b> property will go here. This group cannot be removed.",values:{name:null,b:e=>(0,W.jsx)("span",{style:{fontWeight:S.Z.fontWeight.semibold},children:e})},id:"database.boardView.uncategorizedColumnTooltip"}),style:{width:240},textWrap:!0,render:t=>(0,W.jsx)(z,{...e,tooltipEvents:t})})}function z(e){const t={display:"flex",alignItems:"center",fontSize:14,lineHeight:1.2,paddingLeft:2,paddingRight:4,whiteSpace:"nowrap",overflow:"hidden",fontWeight:S.Z.fontWeight.medium},{style:o,uncategorizedIconStyle:r,tooltipEvents:i,formattedLabelMessage:n}=e;return(0,W.jsxs)("div",{style:{...t,paddingLeft:0,...o},...i,children:[(0,h.R)({width:14,marginLeft:6,marginRight:6,...r}),(0,W.jsx)("span",{style:{...S.Z.textOverflowStyle},children:n})]})}},75498:(e,t,o)=>{o.d(t,{Z:()=>p});var r=o(83355),i=o(1302),n=o(49085),s=o(72126),a=o(71644),l=o(97880),c=o(45264);class d extends r.Z{constructor(){super(...arguments),this.reducerId=this.props.id,this.instanceId=(0,a.ZP)(),this.localResultStoreChangeIsQueued=!1,this.storeTypes={resultStore:n.default.createClass(void 0)},this.handleLocalResultStoreChange=()=>{this.localResultStoreChangeIsQueued||(this.localResultStoreChangeIsQueued=!0,i.default.afterNextFlush(this.dequeueLocalResultStoreChange))},this.dequeueLocalResultStoreChange=()=>{const{resultStore:e}=this.stores;if(this.localResultStoreChangeIsQueued=!1,!this.componentIsMounted)return;const t=this.getCurrentResult();s.Xy(t,e.state)||e.setState(t)}}willMount(e){const{collectionContextStore:t}=e;t.remoteResult.addListener(this.handleLocalResultStoreChange),t.localResultStore.addListener(this.handleLocalResultStoreChange),this.updateReducer(e),this.handleLocalResultStoreChange()}willUpdate(e){this.updateReducer(e)}willUnmount(){super.willUnmount();const{collectionContextStore:e,groupsPointer:t}=this.props;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:void 0,collectionContextStore:e,groupsPointer:t}),e.remoteResult.removeListener(this.handleLocalResultStoreChange),e.localResultStore.removeListener(this.handleLocalResultStoreChange)}renderComponent(){const{render:e}=this.props;if(e)return e(this.stores.resultStore)}updateReducer(e){const{reducer:t,collectionContextStore:o,groupsPointer:r}=e;c.$D({reducerId:this.reducerId,instanceId:this.instanceId,reducer:t,collectionContextStore:o,groupsPointer:r})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.localResultStore.state,o=e.remoteResult.state,r=t&&"reducer"===t.type?t.reducerResults[this.reducerId]:void 0,i=o&&"reducer"===o.type?o.reducerResults[this.reducerId]:void 0;return this.getResultFromLocalAndRemote(r,i)}getResultFromLocalAndRemote(e,t){const{collectionContextStore:o,reducer:r}=this.props,i=o.reducers.state,n=o.remoteResult.state;if(o.isClientModeEnabled.state)return e;if("aggregation"===r.type||"groups"===r.type){if(null!=n&&n.reducerResults[this.reducerId])return n.reducerResults[this.reducerId];return Boolean(n&&"reducer"===n.type&&s.sE(n.reducerResults,((e,t)=>{const o=i[t];return Boolean(o&&"results"===o.reducer.type&&!o.reducer.searchQuery&&"results"===e.type&&e.hasMore&&s.Xy(r.filter,o.reducer.filter))})))?e:t}if("results"===r.type){const r=o.wasCreatedThisSession.state;if((Boolean(n&&"reducer"===n.type&&n.reducerResults[this.reducerId])||r)&&e&&"results"===e.type){return{...e,hasMore:t&&"results"===t.type?t.hasMore:e.hasMore}}return t}throw(0,l.t1)(r)}}d.displayName="CollectionReducerRequest";const p=d},8132:(e,t,o)=>{o.d(t,{p:()=>u});var r=o(67294),i=o(5366),n=o(4615),s=o(44866),a=o(42917),l=o(24006),c=o(26388),d=o(85893);const p=(0,i.defineMessages)({autoUpdateExplanationMessage:{defaultMessage:"Keep values updated with the latest edits to pages",id:"database.CollectionSettingsPropertyAiAutofill.autoUpdateExplanationMessage"},onlyWithAiAddOnMessage:{defaultMessage:"Only with Notion AI add-on",id:"database.CollectionSettingsPropertyAiAutofill.onlyWithAiAddOnMessage"},updateOnPageEdits:{defaultMessage:"Auto-update on page edits",id:"database.viewSettings.propertyTab.aiAutofill.updateOnPageEdits"}});function u(e){let{collectionContextStore:t,environment:o,setAiInference:u,aiInference:h,doesUserHaveAIAddOn:m}=e;window.__c={n:"CollectionSettingsAiAutofillAutoUpdateToggle"};const g=(0,r.useRef)((0,n.ZP)()),y=(0,r.useCallback)((()=>{if(!t.collectionStore())return;if(!h)return;if(!(m||null!=h&&h.auto_update_on_edit))return void s.triggerAiAutofillUpsell({environment:o,from:"ai_autofill_on_page_edit"});const e={...h,auto_update_on_edit:!h.auto_update_on_edit};u(e)}),[t,h,m,u,o]);return h?(0,d.jsx)(c.Z,{renderTooltip:()=>(0,d.jsxs)("div",{style:{width:159},children:[(0,d.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,d.jsx)(i.FormattedMessage,{...p.autoUpdateExplanationMessage})}),!m&&(0,d.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,d.jsx)(i.FormattedMessage,{...p.onlyWithAiAddOnMessage})})]}),render:e=>(0,d.jsx)(a.Z,{title:(0,d.jsx)(i.FormattedMessage,{...p.updateOnPageEdits}),showChevron:!1,right:(0,d.jsx)(l.Z,{inputId:g.current,on:!!h.auto_update_on_edit,onClick:y,disabled:!1,noColor:!1}),onClick:y,disabled:!1,textWrapperStyle:{minWidth:"auto"},...e})}):null}},49670:(e,t,o)=>{o.d(t,{V:()=>j,Z:()=>I});o(67294);var r=o(83355),i=o(49085),n=o(34296),s=o(45433),a=o(47453),l=o(4615),c=o(82990),d=o(5366),p=o(8406),u=o(5149),h=o(45264),m=o(94419),g=o(39699),y=o(93959),S=o(89014),f=o(83319),x=o(13005),v=o(42917),C=o(71846),b=o(72495),w=o(85893);class M extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass("")},this.searchSessionId="",this.handleNewCollectionClick=()=>{const{collectionContextStore:e,collectionSettingsStore:t}=this.props;p.wd({environment:this.environment,collectionContextStore:e,action:"select_new_collection"});const o=this.stores.inputStore.state;u.E3({collectionSettingsStore:t});const r=e.collectionViewStore(),i=e.collectionViewBlockStore();r&&i&&u.nr({environment:this.environment,selectedDBType:s.br,collectionName:o,collectionContextStore:e,collectionViewBlockStore:i,collectionViewStore:r,useTemporaryRecordCache:!1,baseViewType:"table"})},this.handleSourcePickerAccept=e=>{const{collectionContextStore:t,collectionSettingsStore:o}=this.props;g.createAndCommit({userAction:"CollectionSettingsCreateViewSource.handleSourcePickerAccept",environment:this.environment,perform:o=>{h.yc({environment:this.environment,collectionContextStore:t,collectionStore:e,transaction:o});const r=t.collectionViewStore(),i=t.collectionViewBlockStore(),n=e.getParentBlockStore();r&&n&&null!=i&&i.isDefined()&&(0,y.h7)(i)&&m.BE({parent:n.getCollectionViewsStore(),insert:r,transaction:o})}}),j({collectionStore:e,collectionContextStore:t,collectionSettingsStore:o})}}renderComponent(){const{collectionContextStore:e,collectionSettingsStore:t}=this.props,{inputStore:o}=this.stores,r=e.collectionViewBlockStore(),i=e.collectionStore();if(!r)return;const s=e.getCollectionViewBlockSourceState(),l=o.state;return(0,w.jsx)(x.ZP,{...this.props,title:(0,w.jsx)(d.FormattedMessage,{defaultMessage:"Select data source",id:"database.viewSettings.createViewSourceTab.title"}),handleClose:()=>{p.tW({environment:this.environment,eventName:"abandoned_search",queryLength:l.length,sessionId:this.searchSessionId,source:n.S.Source}),u.E3({collectionSettingsStore:t})},footer:"uninitialized"===s&&(0,w.jsx)(b.Z,{topBorder:!0,children:(0,w.jsx)(v.Z,{icon:a.R,isGray:!0,title:l?(0,w.jsx)(d.FormattedMessage,{defaultMessage:"New database “{filterText}”",id:"database.viewSettings.createViewSourceTab.newCollectionWithNameButton.title",values:{filterText:(0,w.jsx)("span",{style:{...c.Z.textOverflowStyle,fontWeight:c.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"},children:l})}}):(0,w.jsx)(d.FormattedMessage,{defaultMessage:"New database",id:"database.viewSettings.createViewSourceTab.newCollectionButton.title"}),onClick:this.handleNewCollectionClick})}),children:(0,w.jsx)(C.Z,{collectionContextStore:e,selectedCollectionStore:i,parentStore:r,onAccept:this.handleSourcePickerAccept,context:n.S.Source,inputStore:o,searchSessionId:this.searchSessionId})})}willMount(){this.searchSessionId=(0,l.ZP)()}}async function j(e){const{collectionStore:t,collectionContextStore:o,collectionSettingsStore:r}=e,i=o.collectionViewBlockStore(),n=o.collectionViewStore(),s=t.getParentBlockStore();if(!i||!s||!n)return;await Promise.all([...s.getCollectionViewStores().map((e=>e.load())),...i.getCollectionViewStores().map((e=>e.load()))]);(0,f.g)({collectionStore:t,sourceCollectionViewBlockStore:s,currentCollectionViewBlockStore:i,currentCollectionViewStore:n,constraints:(0,S.x)(n.id)}).length>0?u.H4({collectionSettingsStore:r,item:{type:"duplicateExistingView"}}):u.H4({collectionSettingsStore:r,item:{type:"createView"}})}M.displayName="CollectionSettingsCreateViewSource";const I=(0,d.injectIntl)(M)},83319:(e,t,o)=>{o.d(t,{Z:()=>A,g:()=>Z});o(57658),o(67294);var r=o(83355),i=o(26263),n=o(49085),s=o(56666),a=o(47453),l=o(72126),c=o(5366),d=o(8406),p=o(5149),u=o(45264),h=o(9953),m=o(39699),g=o(78316),y=o(33929),S=o(89014),f=o(29798),x=o(35661),v=o(73657),C=o(13005),b=o(42917),w=o(1136),M=o(45669),j=o(52275),I=o(68894),P=o(32163),_=o(72495),k=o(85893);const T=(0,c.defineMessages)({inputPlaceholder:{defaultMessage:"Search for a view…",id:"database.viewSettings.duplicateExistingViewTab.inputPlaceholder"}});class F extends r.Z{constructor(){super(...arguments),this.temporaryRecordCache=new i.Z({name:"CollectionSettingsDuplicateExistingView"}),this.lastDuplicatedViewId=void 0,this.originalCollectionPointer=void 0,this.didAccept=!1,this.preselectedViewPointer=void 0,this.storeTypes={inputStore:n.default.createClass(""),menuListStore:f.Z,limitStore:n.default.createClass(!0)},this.handlePreviewCollectionView=e=>{this.duplicateViewSettings(e,!0)},this.handlePreviewCollectionViewDebounced=l.Ds(this.handlePreviewCollectionView,500),this.handleMenuListStoreChange=()=>{const e=this.stores.menuListStore.state,{device:t}=this.environment;if(void 0===e.focus.indexGlobal||t.isMobile)return;const o=this.getCurrentResult().viewStores[e.focus.indexGlobal];o&&this.handlePreviewCollectionViewDebounced(o)},this.handleDuplicateViewAccept=e=>{const{collectionSettingsStore:t,collectionContextStore:o}=this.props;this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),d.wd({environment:this.environment,collectionContextStore:o,action:"click_duplicate_view"}),this.duplicateViewSettings(e,!1),p.wl({collectionSettingsStore:t,item:{type:"main",selectViewNameInitial:!0}}),this.didAccept=!0},this.handleNewEmptyViewClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props;d.wd({environment:this.environment,collectionContextStore:t,action:"click_new_empty_view"}),p.E3({collectionSettingsStore:e}),p.H4({collectionSettingsStore:e,item:{type:"createView"}}),this.didAccept=!0}}willMount(e){const{collectionContextStore:t}=e,{device:o}=this.environment,r=t.collectionStore(),i=t.collectionViewStore();if(!i)return;const n=(0,S.x)(i.id);this.preselectedViewPointer=null==n?void 0:n.viewPointer,this.originalCollectionPointer=null==r?void 0:r.pointer,this.environment.defaultRecordCache.inMemoryRecordCache.addCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.addListener(this.handleMenuListStoreChange);const{viewStores:s}=this.getCurrentResult(),[a]=s;!o.isMobile&&a&&this.duplicateViewSettings(a,!0)}willUnmount(){if(this.environment.defaultRecordCache.inMemoryRecordCache.removeCacheOverride(this.temporaryRecordCache),this.stores.menuListStore.removeListener(this.handleMenuListStoreChange),!this.didAccept){const{viewStores:e}=this.getCurrentResult(),t=this.lastDuplicatedViewId?e.find((e=>e.id===this.lastDuplicatedViewId)):e[0];if(!t)return;this.duplicateViewSettings(t,!1)}}renderComponent(){const{inputStore:e,menuListStore:t,limitStore:o}=this.stores,{device:r}=this.environment,i=e.state,{viewStores:n,showMore:d}=this.getCurrentResult(),p=l.oA(n.map((e=>{const t=e.getType(),o=e.getFormat().collection_view_icon;if(!t||"page"===t)return;const r=e.getName(),i=e.id;return{key:i,render:e=>{var n;return(0,k.jsx)(j.Z,{...e,title:(0,k.jsx)(M.Z,{collectionViewType:t,collectionViewName:r}),icon:(0,k.jsx)(w.F,{color:"regular",viewIcon:o,viewType:t,style:{marginRight:6}}),checkState:(null===(n=this.preselectedViewPointer)||void 0===n?void 0:n.id)===i})},action:()=>{this.handleDuplicateViewAccept(e)}}})));if(d>0){const e={key:"showMore",render:e=>(0,k.jsx)(j.Z,{...e,icon:(0,s.o)({width:16,height:16,color:this.theme.mediumTextColor}),style:{color:this.theme.mediumTextColor},title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.duplicateExistingViewTab.showMore.title",values:{showMore:d}})}),action:()=>{o.setState(!1)}};p.push(e)}return(0,k.jsxs)(C.ZP,{...this.props,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"Copy an existing view",id:"database.viewSettings.duplicateExistingViewTab.title"}),footer:(0,k.jsx)(_.Z,{topBorder:!0,children:(0,k.jsx)(b.Z,{icon:a.R,isGray:!0,title:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"New empty view",id:"database.viewSettings.duplicateExistingViewTab.newEmptyViewButton.title"}),onClick:this.handleNewEmptyViewClick})}),children:[(d>0||i)&&(0,k.jsx)(_.Z,{children:(0,k.jsx)(I.ZP,{focusInitial:!r.isMobile||void 0,value:i,onChange:r=>{e.setState(r.target.value),t.setState({focus:{section:0,indexLocal:0,indexGlobal:0}}),o.setState(!0)},placeholder:y.default.formatMessage(T.inputPlaceholder),showClearButton:!0})}),p.length>0&&(0,k.jsx)(P.Z,{type:P.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>(0,k.jsx)(_.Z,{...e}),items:p}],store:t}),0===p.length&&(0,k.jsx)(v.Z,{caption:(0,k.jsx)(c.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.duplicateExistingViewTab.noResultsTitle"})})]})}getCurrentResult(){const{collectionContextStore:e}=this.props,t=e.collectionViewBlockStore(),o=e.collectionStore(),r=e.collectionViewStore();if(!t||!o||!r)return{viewStores:[],showMore:0};const{inputStore:i,limitStore:n}=this.stores,s=i.state,a=o.getParentBlockStore();if(!t||!a)return{viewStores:[],showMore:0};let l=Z({collectionStore:o,sourceCollectionViewBlockStore:a,currentCollectionViewBlockStore:t,currentCollectionViewStore:r,constraints:(0,S.x)(r.id)}),c=0;return s?l=l.filter((e=>(0,g.D)(e,s))):n.state&&(c=l.length-7,l=l.slice(0,7)),{viewStores:l,showMore:c}}duplicateViewSettings(e,t){if(e.id===this.lastDuplicatedViewId&&t)return;this.lastDuplicatedViewId=e.id;const{collectionContextStore:o}=this.props,r=o.collectionViewStore(),i=e.getType();if(!r||!i)return;const n=e.getName(),s=e.getPageSort(),a=e.getFormat(),l=e.getKeyStore("query2").getValue();let c=r;t&&(c=r.clone(this.temporaryRecordCache)),m.createAndCommit({userAction:"CollectionSettingsDuplicateExistingView.duplicateViewSettings",environment:this.environment,perform:e=>{h.sW({store:c,data:{name:n,type:i,page_sort:s,format:{...a,collection_pointer:this.originalCollectionPointer},query2:l},transaction:e})}}),u.Ip({collectionContextStore:o})}}function Z(e){const{collectionStore:t,sourceCollectionViewBlockStore:o,currentCollectionViewBlockStore:r,currentCollectionViewStore:i,constraints:n}=e;let s=l.mN([...r.getCollectionViewStores(),...o.getCollectionViewStores()],(e=>e.id)).filter((e=>{var o;return(null===(o=e.getCollectionStore())||void 0===o?void 0:o.id)===t.id&&e.id!==i.id&&"page"!==e.getType()}));if(null!=n&&n.viewType&&(s=[...s.filter((e=>e.getType()===n.viewType)),...s.filter((e=>e.getType()!==n.viewType))]),null!=n&&n.viewPointer){const{id:e}=n.viewPointer,t=s.find((t=>t.pointer.id===e))||x.Xr.createChildStore(o,n.viewPointer);s=[t,...s.filter((t=>t.pointer.id!==e))]}return s}F.displayName="CollectionSettingsDuplicateExistingView";const A=(0,c.injectIntl)(F)},53787:(e,t,o)=>{o.d(t,{Z:()=>A});var r=o(67294),i=o(480),n=o(86628),s=o(24405),a=o(84169),l=o(72126),c=o(27006),d=o(5366),p=o(8406),u=o(12534),h=o(29376),m=o(4023),g=o(86825),y=o(26388),S=o(85893);function f(e){window.__c={n:"CollectionSettingsAutoRelateSwitch"};const{temporaryAutoRelateState:t,handleAutoRelateToggle:o,collectionContextStore:r,targetCollectionStore:i,autoRelate:l,hasInverseRelation:c}=e,p=(0,n.VK)((()=>r.collectionStore()),[r]),u=(0,n.VK)((()=>Boolean(null==p?void 0:p.isSyncedCollection())),[p]),h=(0,n.VK)((()=>(null==p?void 0:p.getFormat().bot_id)||i.getFormat().bot_id),[p,i]),f=(0,n.VK)((()=>!!h&&(u||!u&&c)),[h,u,c]),x=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),v=(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Automatically Relate",id:"database.viewSettings.setupRelationTab.autoRelate.title"}),(0,S.jsx)(y.Z,{render:e=>(0,S.jsx)("div",{...e,children:(0,a.m)(x.helpIcon)}),style:{width:200},placement:m.u.Bottom,textWrap:!0,renderTooltip:()=>(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Relations will automatically populate based on links found in page properties.",id:"database.viewSettings.setupRelationTab.autoRelateTooltip"})})]});return f?(0,S.jsx)(g.Z,{title:v,on:t?t.enabled:!!l&&(null==l?void 0:l.enabled),focused:!1,onClick:()=>o(h),textWrapperStyle:{opacity:1}}):null}var x=o(40113),v=o(95474),C=o(19871),b=o(42696),w=o(82990),M=o(31278),j=o(76798),I=o(72495),P=o(64369);function _(e){window.__c={n:"CollectionSettingsRelationVisualizer"};const{collectionContextStore:t,targetCollectionStore:o,propertySchema:r,propertyName:i,temporaryInverseState:a,hasInverseRelation:l,inverseRelationName:c,isInitialPropertyName:p}=e,u=(0,d.useIntl)(),m=(0,n.VK)((()=>t.collectionStore()),[t]),g=a?a.hasInverseRelation:l,y=(0,n.VK)((()=>Boolean(m&&o.id===m.id)),[m,o]),f=(0,n.VK)((()=>{const e=a?a.inverseName:c;return e||(null!=m&&m.isDefined()?h.aI(u,{sourceCollection:m.getModel(),isSelfRelation:y,targetCollectionStore:o,createUnique:!0}):"")}),[m,u,c,y,a,o]),x=(0,n.VK)((()=>null!=m&&m.isDefined()?f===h.aI(u,{sourceCollection:m.getModel(),isSelfRelation:y,targetCollectionStore:o,createUnique:!1}):void 0),[m,u,f,y,o]),v=Boolean(!y&&p&&(!g||g&&x)),C=(0,s.yK)((e=>({preview:{background:e.inputBackground,marginLeft:14,marginRight:14,padding:v?"42px 12px":12,boxShadow:e.inputBoxShadow,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center"},condensedView:{height:22,display:"flex",justifyContent:"center",alignItems:"center"},condensedProperties:{width:33,height:g?20:10,margin:"0px 12px",display:"flex",flexDirection:"column",justifyContent:"center"},databasesRow:{height:22}})),[v,g]);return m?(0,S.jsx)(I.Z,{title:(0,S.jsx)(P.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Preview",id:"database.viewSettings.setupRelationTab.relationVisualizer.title"})}),disableMobileBorders:!0,children:(0,S.jsx)("div",{style:C.preview,children:v?(0,S.jsxs)("div",{style:C.condensedView,children:[(0,S.jsx)(T,{collectionStore:m,condensedView:!0}),(0,S.jsxs)("div",{style:C.condensedProperties,children:[(0,S.jsx)(k,{propertyName:i||(null==r?void 0:r.name),condensedView:!0}),g&&(0,S.jsx)(k,{propertyName:f,condensedView:!0,isInverse:!0})]}),(0,S.jsx)(T,{collectionStore:o,condensedView:!0,isTarget:!0})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(k,{propertyName:i||(null==r?void 0:r.name),bidirectional:y&&!g}),(0,S.jsxs)("div",{style:C.databasesRow,children:[(0,S.jsx)(T,{collectionStore:m}),(0,S.jsx)(T,{collectionStore:o,isTarget:!0})]}),g&&(0,S.jsx)(k,{propertyName:f,isInverse:!0})]})})}):null}function k(e){window.__c={n:"RelationVisualizerProperty"};const{propertyName:t,bidirectional:o,isInverse:r,condensedView:i}=e,n=(0,s.yK)((e=>({propertyLabel:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:200,alignSelf:"center",color:e.mediumTextColor,fill:e.mediumIconColor},arrow:{width:136,height:25,alignSelf:"center",transform:r?"rotate(180deg)":void 0,margin:r?"6px 12px 0px 6px":"0px 6px 6px 6px",opacity:.3,fill:e.regularIconColor},smallArrow:{height:8,paddingLeft:1,marginTop:r?2:void 0,display:"inherit",transform:r?"rotate(180deg)":void 0,opacity:.3,fill:e.regularIconColor}})),[r]),a=(0,S.jsx)("div",{style:n.propertyLabel,children:t||""});return(0,S.jsxs)(S.Fragment,{children:[!r&&!i&&a,i?(0,v.p)(n.smallArrow):o?(0,C.G)(n.arrow):(0,x.h)(n.arrow),r&&!i&&a]})}function T(e){window.__c={n:"RelationVisualizerDatabase"};const{collectionStore:t,condensedView:o,isTarget:r}=e,i=(0,n.VK)((()=>t.getIcon()),[t]),a=(0,s.yK)((e=>({wrapper:{display:"flex",alignItems:"center",padding:2,color:e.mediumTextColor,fill:e.mediumIconColor,position:o?void 0:"absolute",left:o?void 0:r?"72%":"28%",transform:o?void 0:"translate(-50%, 0)",width:"fit-content"},icon:{marginRight:4,width:12,height:12},title:{fontSize:12,wordBreak:"break-word",...w.Z.textOverflowStyle,maxWidth:100}})),[o,r]);return(0,S.jsxs)("div",{style:a.wrapper,children:[i?(0,S.jsx)(M.Z,{icon:i,isEmptyPage:!1,size:12,disabled:!0,style:a.icon}):(0,b.t)(a.icon),(0,S.jsx)(j.Z,{store:t,style:a.title})]})}var F=o(42922),Z=o(68894);function A(e){window.__c={n:"CollectionSettingsInverseRelationConfig"};const{collectionContextStore:t,property:o,propertyName:l,targetCollectionStore:x,onSubmit:v,buttonContents:C,isInitialPropertyName:b,temporaryInverseState:w,setTemporaryInverseState:M,from:P}=e,k=(0,i.O7)(),T=(0,n.VK)((()=>o?h.KV(t,o):void 0),[t,o]),Z=(0,n.VK)((()=>t.collectionStore()),[t]),A=(0,n.VK)((()=>Boolean(Z&&Z.id===x.id)),[Z,x]),V=(0,n.VK)((()=>Boolean(o?h.OP(t,o,x):void 0)),[t,o,x]),B=(0,n.VK)((()=>{if("relation"!==(null==T?void 0:T.type))return"";const e=T.property;if(!e||e===o)return"";const t=x.getRole();if(!t||!c.YX(t))return"";const r=x.getSchema()[e];return(null==r?void 0:r.name)||""}),[x,o,T]),O=(0,n.VK)((()=>"relation"===(null==T?void 0:T.type)&&T.autoRelate?T.autoRelate:{enabled:!1}),[T]),D=(0,n.VK)((()=>Boolean(h.gZ(x))),[x]),N=(0,n.VK)((()=>Boolean((null==Z?void 0:Z.getDatabaseType())&&o&&(null==Z?void 0:Z.isTypedProperty(o)))),[Z,o]),L=(0,n.VK)((()=>t.contextType),[t]),K=(0,s.yK)((e=>({errorLabel:{margin:"0px 14px",color:e.errorText},helpIcon:{width:16,fill:e.lightIconColor,marginLeft:6}})),[]),W=(0,r.useMemo)((()=>w?w.hasInverseRelation:V),[w,V]),q=(0,r.useMemo)((()=>w?w.inverseName:B),[w,B]),E=(0,r.useMemo)((()=>w?w.autoRelate:O),[w,O]),G=(0,r.useCallback)((()=>{const e=null!=Z&&Z.isSyncedCollection()?E:W?{enabled:!1}:E;M({hasInverseRelation:!W,inverseName:W?void 0:q,autoRelate:e}),o&&p.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===L?"page_properties":"view_settings",action:W?"relation_toggle_inverse_off":"relation_toggle_inverse_on",is_self_relation:A})}),[M,W,q,E,t,Z,o,L,A,k]),z=(0,r.useCallback)((e=>{M({hasInverseRelation:!0,inverseName:e.target.value,autoRelate:E})}),[M,E]),U=(0,r.useCallback)((e=>{const r=null!=E&&E.enabled?{enabled:!1}:{enabled:!0,bot_id:e};M({hasInverseRelation:W,inverseName:q,autoRelate:r}),o&&p.$q({environment:k,collectionContextStore:t,property:o,from:"collectionPage"===L?"page_properties":"view_settings",action:r.enabled?"auto_relation_toggle_on":"auto_relation_toggle_off"})}),[o,M,t,L,q,W,E,k]),H=(0,r.useCallback)((e=>{(0,u.ZP)({event:e,context:u.Af.CollectionSettingsClick,callback:v})}),[v]),$=(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",whiteSpace:"pre"},children:[A?(0,S.jsx)(d.FormattedMessage,{id:"database.viewSettings.setupRelationTab.selfRelation.reverse",defaultMessage:"Separate directions"}):(0,S.jsx)(d.FormattedMessage,{id:"database.viewSettings.setupRelationTab.relation.reverse",defaultMessage:"Show on {databaseName}",values:{databaseName:(0,S.jsx)(j.Z,{style:{display:"inline"},store:x})}}),(0,S.jsx)(y.Z,{render:e=>(0,S.jsx)("div",{...e,children:(0,a.m)(K.helpIcon)}),style:{width:200},placement:m.u.Bottom,textWrap:!0,renderTooltip:()=>!D||N?(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Cannot edit target database.",id:"database.viewSettings.setupRelationTab.inverseDisabledWarning.title"}):A?(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Create separate properties for each direction of a two-way relation. Useful for modeling Parent task/Sub-tasks, Blocked by/Blocking, and more.",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip.selfRelation"}):(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Create a property on {databaseName} showing backlinks to the current database",id:"database.viewSettings.setupRelationTab.inverseRelationTooltip",values:{databaseName:(0,S.jsx)(j.Z,{style:{display:"inline"},store:x})}})})]});return(0,S.jsxs)(S.Fragment,{children:[!(A&&V)&&!P&&(0,S.jsx)(g.Z,{title:$,on:W,focused:!1,onClick:G,disabled:!D||A&&V||N,textWrapperStyle:{opacity:1}}),(0,S.jsx)(R,{collectionContextStore:t,targetCollectionStore:x,isSelfRelation:A,temporaryInverseState:w,hasInverseRelation:V,inverseRelationName:B,disabled:!D||N,onChange:z,from:P}),(0,S.jsx)(f,{handleAutoRelateToggle:U,temporaryAutoRelateState:null==w?void 0:w.autoRelate,collectionContextStore:t,autoRelate:O,targetCollectionStore:x,hasInverseRelation:W}),(()=>{if("relation"!==(null==T?void 0:T.type))return!0;if(w){if(w.hasInverseRelation!==V)return!0;if(w.inverseName&&w.inverseName!==B)return!0;if(w.autoRelate&&w.autoRelate.enabled!==O.enabled)return!0}return!1})()&&(0,S.jsx)(I.Z,{children:(0,S.jsx)(F.Z,{style:{display:"flex",margin:"6px 12px 0px 12px"},onClick:H,children:C})}),"subitem"!==P&&"timeline_arrows_by"!==P&&(0,S.jsx)(_,{propertySchema:T,propertyName:l,collectionContextStore:t,targetCollectionStore:x,temporaryInverseState:w,hasInverseRelation:V,inverseRelationName:B,isInitialPropertyName:b})]})}function R(e){window.__c={n:"CollectionSettingsInverseRelationName"};const{collectionContextStore:t,targetCollectionStore:o,isSelfRelation:r,temporaryInverseState:i,hasInverseRelation:s,inverseRelationName:a,disabled:c,onChange:p,from:u}=e,m=(0,d.useIntl)(),g=(0,n.VK)((()=>{const e=t.collectionStore();return null!=e&&e.isDefined()?h.aI(m,{sourceCollection:e.getModel(),isSelfRelation:r,targetCollectionStore:o,createUnique:!0,from:u}):m.formatMessage({id:"database.viewSettings.setupRelationTab.inverseRelationName.placeholder",defaultMessage:"Related to target"})}),[t,m,r,o,u]);return(i?i.hasInverseRelation:s)?(0,S.jsx)(I.Z,{title:!u&&(0,S.jsx)(P.Z,{isSmall:!0,isSecondaryColor:!0,children:(0,S.jsx)(d.FormattedMessage,{defaultMessage:"Related property on {databaseName}",id:"database.viewSettings.setupRelationTab.inverseRelationNameInput.title",values:{databaseName:(0,S.jsx)(j.Z,{style:{display:"inline"},store:o})}})}),children:(0,S.jsx)(Z.ZP,{value:"subitem"!==u&&"timeline_arrows_by"!==u?(null==i?void 0:i.inverseName)||a:g,placeholder:g,onChange:p,onBlur:l.yR,onSubmit:l.yR,focusInitial:!1,selectAll:!1,disabled:c})}):null}},16257:(e,t,o)=>{o.d(t,{C:()=>g,U:()=>y});var r=o(67294),i=o(480),n=o(99036),s=o(5366),a=o(8406),l=o(45264),c=o(39699),d=o(52821),p=o(85893);function u(e,t,o){return"1"===e?"relation"===t?o&&!0===o?(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 item",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.connectedRelation"}):(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 page",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne.relation"}):(0,p.jsx)(s.FormattedMessage,{defaultMessage:"1 {type}",id:"database.viewSettings.collectionPropertyLimitHelpers.limitOne",values:{type:d.SO[t]}}):"no_limit"===e?(0,p.jsx)(s.FormattedMessage,{defaultMessage:"No limit",id:"database.viewSettings.collectionPropertyLimitHelpers.noLimit"}):void 0}function h(e,t,o){return{key:e,title:u(e,t,o)}}var m=o(13709);function g(e){window.__c={n:"CollectionSettingsLimitOptions"};const{property:t,propertySchema:o,collectionContextStore:s}=e,d=(0,i.O7)(),u=(0,r.useCallback)((e=>{const r=s.collectionStore();if(!r||!(0,n.en)(o))return;const i={...o,limit:Number(e)?1:void 0};c.createAndCommit({userAction:"CollectionSettingsLimitOptions.handleLimitChange",environment:d,perform:e=>{l.xO({environment:d,collectionStore:r,update:{[t]:i},transaction:e})}});const p=Number(e)?`${o.type}_toggle_limit_on`:`${o.type}_toggle_limit_off`;a.$q({environment:d,collectionContextStore:s,property:t,from:"view_settings",action:p})}),[s,d,t,o]);return(0,n.en)(o)?"relation"===o.type&&o.connectedRelation?(0,p.jsx)(y,{propertyType:o.type,connectedRelation:!0,selectedKey:o.limit?"1":"no_limit",onChange:u}):(0,p.jsx)(y,{propertyType:o.type,selectedKey:o.limit?"1":"no_limit",onChange:u}):null}function y(e){const{propertyType:t,selectedKey:o,connectedRelation:r,onChange:i}=e;return(0,p.jsx)(m.Z,{title:(0,p.jsx)(s.FormattedMessage,{defaultMessage:"Limit",id:"database.viewSettings.collectionPropertyLimitHelpers.limit"}),selectedKey:o,popupStyle:{minWidth:190},options:[h("1",t,r),h("no_limit",t)],onChange:i})}},26122:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var r=o(83355),i=o(49085),n=o(27153),s=o(33929),a=o(68894),l=o(23321),c=o(85893);class d extends r.Z{constructor(){super(...arguments),this.storeTypes={inputStore:i.default.createClass("")},this.handleBlur=()=>{this.props.onBlur(this.stores.inputStore.state)},this.handleSubmit=()=>{this.props.onSubmit(this.stores.inputStore.state)},this.showMediaPicker=e=>{if(!this.props.iconButton)return;const t=s.default.getIntl(),{onSubmit:o,enforceIconColor:r,includeEmojiTab:i}=this.props.iconButton;n.$(this.environment,{originRect:e.target.getBoundingClientRect(),originGap:3,popupHeight:l.ZP.desktopIconPickerOnlyPopupHeight,popupWidth:l.ZP.desktopIconPickerOnlyPopupWidth,showArrow:!0,title:t.formatMessage({defaultMessage:"Icon",id:"mediaPicker.tabs.icon"}),currentTab:"icon",tabs:i?[{type:"emoji",onChange:(e,t)=>{o(e),t&&t.keepVisible||n.Z()}},{type:"icon",enforceIconColor:r,onChange:(e,t)=>{o(e),t&&t.keepVisible||n.Z()}}]:[{type:"icon",enforceIconColor:r,onChange:(e,t)=>{o(e),t&&t.keepVisible||n.Z()}}],onDelete:()=>{o(),n.Z()}})}}willMount(e){super.willMount(e),this.stores.inputStore.setState(e.initialValue)}willUnmount(){const{initialValue:e,onBlur:t}=this.props,o=this.stores.inputStore.state;e!==o&&t(o)}renderComponent(){const{placeholder:e,focusInitial:t,selectAll:o,disabled:r,inputOuterStyle:i,iconButton:n}=this.props,{inputStore:s}=this.stores,l=s.state;return(0,c.jsx)(a.ZP,{focusInitial:t,selectAll:o,value:l,onChange:e=>{s.setState(e.target.value)},onBlur:this.handleBlur,onSubmit:this.handleSubmit,placeholder:e,disabled:r,textWrapperStyle:{opacity:r?.7:void 0},inputOuterStyle:i,left:n&&(0,c.jsx)(a.DO,{icon:n.icon,iconStyle:n.iconStyle,onClick:this.showMediaPicker,disabled:r})})}}d.displayName="CollectionSettingsNameInput";const p=d},65326:(e,t,o)=>{o.d(t,{mJ:()=>Et,ZP:()=>Gt,sY:()=>Lt});o(57658),o(21703);var r=o(67294),i=o(73935),n=o(83355),s=o(1302),a=o(480),l=o(24405),c=o(49085),d=o(99036),p=o(80951),u=o(8848),h=o(39068),m=o(79362),g=o(5257),y=o(88437),S=o(44643),f=o(55964),x=o(84169),v=o(44495),C=o(16184),b=o(37612),w=o(72050),M=o(108),j=o(3791),I=o(97880),P=o(82990),_=o(5366),k=o(50906),T=o(8406),F=o(16956),Z=o(5149),A=o(87085),R=o(45264),V=o(96802),B=o(80402),O=o(39699),D=o(58449),N=o(93959),L=o(52821),K=o(43224),W=o(78316),q=o(99417),E=o(19124),G=o(75081),z=o(33929),U=o(18514),H=o(77546),$=o(85644),Y=o(67695),Q=o(61766),X=o(77080),J=o(33846),ee=o(35661),te=o(78291),oe=o(13162),re=o(59187),ie=o(8132),ne=o(86628),se=o(98963),ae=o(9953),le=o(93174),ce=o(68910),de=o(68894),pe=o(72495),ue=o(85893);function he(e){window.__c={n:"CollectionSettingsButtonOptions"};const{collectionContextStore:t,propertySchema:o,propertyId:i}=e,n=(0,a.O7)(),s=n.currentUser.id,l=(0,ne.Kw)(t.permissionScopes),c=(0,ne.VK)((()=>t.collectionStore()),[t]),d=(0,ne.VK)((()=>o.automation_id&&c?ee.Mz.createChildStore(c,{table:se.cv,id:o.automation_id,spaceId:c.getSpaceId()}):void 0),[c,o]),p=(0,ne.VK)((()=>null==d?void 0:d.getTrigger()),[d]),u=(0,r.useMemo)((()=>{if(d)return new ce.L({type:"button_property",persisted:!0,automationStore:d,collectionContextStore:t,propertyId:i,propertySchema:o,intl:z.default.getIntl(),parentRecordStore:d,currentUserId:s})}),[i,o,d,t,s]),h=(0,ne.VK)((()=>(null==d?void 0:d.getNameStore().getValue())??""),[d]),m=(0,r.useCallback)((e=>{if(!d)return;const t=e.currentTarget.value;O.createAndCommit({userAction:"CollectionSettingsButtonOptions.setName",environment:n,perform:e=>{ae.sO({store:d.getNameStore(),transaction:e,value:t})}})}),[d,n]);return c&&d&&p&&"button"===p.type&&u?(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(pe.Z,{topBorder:!0,title:(0,ue.jsx)(_.FormattedMessage,{id:"database.buttonProperty.label",defaultMessage:"Label"}),children:(0,ue.jsx)(de.ZP,{disabled:!l.canConfigureCollection,placeholder:z.default.formatMessage(me.inputPlaceholder),value:h,onChange:m})}),(0,ue.jsxs)(pe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{id:"database.buttonProperty.actions",defaultMessage:"Actions"}),children:[(0,ue.jsx)(le.C,{contextStore:u,disabled:!l.canConfigureCollection,suppressErrors:!0,onActionAdded:()=>{},buttonPlacement:void 0}),(0,ue.jsx)("div",{})]})]}):null}const me=(0,_.defineMessages)({inputPlaceholder:{defaultMessage:"Type a name for this button...",id:"database.buttonProperty.label.inputPlaceholder"}});var ge=o(13991),ye=o(40506),Se=o(11843),fe=o(13709);class xe extends n.Z{constructor(){super(...arguments),this.handleDateFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),i=this.getPropertySchema();if(!r||!i)return;const n={...i,date_format:e};O.createAndCommit({userAction:"CollectionSettingsDateOptions.handleDateFormatChange",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:r,update:{[o]:n},transaction:e})}}),T.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_format"})},this.handleClockFormatChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),i=this.getPropertySchema();if(!r||!i)return;const n=this.getTimeFormatOptions()[e],s={...i,time_format:n};O.createAndCommit({userAction:"CollectionSettingsDateOptions.handleClockFormatChange",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:r,update:{[o]:s},transaction:e})}}),T.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"date_change_time_format"})},this.getTimeFormatOptions=()=>(0,Se.E)(ge.SP).time}renderComponent(){const{intl:e}=this.props,t=this.getPropertySchema();if(!t)return;const o=t.date_format||ye.sF,r=t.time_format||ye.c_,i=this.getClockFormatFromTimeFormat(r);return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(fe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Date format",id:"database.viewSettings.dateOptions.dateFormat"}),selectedKey:o,popupStyle:{minWidth:190},options:ye.Zy.map((t=>({key:t,title:e.formatMessage(ye.fy[t])}))),onChange:this.handleDateFormatChange}),(0,ue.jsx)(fe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Time format",id:"database.viewSettings.dateOptions.timeFormat"}),selectedKey:i,popupStyle:{minWidth:190},options:ye.L7.map((t=>({key:t,title:e.formatMessage(ye.Fi[t])}))),onChange:this.handleClockFormatChange})]})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o)return"date"===o.type||"created_time"===o.type||"last_edited_time"===o.type||"last_visited_time"===o.type?o:void 0}getClockFormatFromTimeFormat(e){const t=this.getTimeFormatOptions();for(const o in t)if(t[o]===e)return o;return"12h"}}xe.displayName="CollectionSettingsDateOptions";const ve=(0,_.injectIntl)(xe);var Ce=o(22686);function be(e){window.__c={n:"CollectionSettingsDefaultPersonPicker"};const{collectionContextStore:t,property:o,propertySchema:i}=e,n=(0,a.O7)(),s=(0,r.useCallback)((e=>{const r={...i,default:"created_by"===e?"created_by":void 0},s=t.collectionStore();if(!s)return;const a=[],l={pointer:s.pointer,command:"update",path:["schema",o],args:{default:e}};a.push(l),R.HW({environment:n,collectionStore:s,performTransaction:e=>{for(const t of a)O.applyOperation({store:(0,ee.Kv)(s,t.pointer),operation:t,transaction:e})}}),O.createAndCommit({userAction:"CollectionSettingsDefaultPersonPicker.handleChange",environment:n,perform:e=>{R.xO({environment:n,collectionStore:s,update:{[o]:r},transaction:e})}})}),[t,n,o,i]);return(0,ue.jsx)(fe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Default",id:"CollectionSettingsDefaultPersonPicker.default.title"}),selectedKey:i.default?"created_by":"no_default",popupStyle:{minWidth:190},options:[{key:"no_default",title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"No default",id:"CollectionSettingsDefaultPersonPicker.options.noDefault"})},{key:"created_by",title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Created by",id:"CollectionSettingsDefaultPersonPicker.options.creator"}),icon:(0,Ce.f)({width:16})}],onChange:s})}var we=o(21202),Me=o(17809),je=o(77907),Ie=o(42917),Pe=o(31945),_e=o(53437),ke=o(41389),Te=o(72589);class Fe extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:Q.Z},this.renderPopup=e=>{const{collectionContextStore:t,collectionSettingsStore:o,property:r}=this.props,i=t.collectionStore();if(!i)return;const n=t.normalizedSchemaStore.state,s=n[r];if("formula"!==(null==s?void 0:s.type))return;const a=i.pointer.spaceId,l=Array.from(t.resultSet.state.blockIds.values())[0],c=l?ee.G.createChildStore(i,{table:we.iU,id:l,spaceId:a}):void 0,d=Boolean(i.getDatabaseType()&&i.isTypedProperty(r));if((0,Me.V1)()){const t=null==o?void 0:o.getState().fromBlock;return(0,ue.jsx)(je.DependencyConsumer,{dependency:je.deps.formulas,children:o=>(0,ue.jsx)(Te.Z,{handleClose:e.close,property:r,getRecordModel:i.getRecordModel,propertySchema:s,collectionStore:i,handleSave:this.handleFormula2CodeChange,formulas:o,disabled:d,blockStore:t,analyticsFrom:"view_settings"})})}return(0,ue.jsx)(ke.default,{property:r,schema:n,analyticsFrom:"view_settings",exampleBlock:null==c?void 0:c.getModel(),disabled:d,onChange:this.handleFormulaChange,onClickCancel:e.close})},this.handleFormula2CodeChange=e=>{const{newValue:t,newType:o,propertySchema:r,property:i,collectionStore:n}=e,s=t?{...r,formula2:{code:t,result_type:o},version:"v2"}:{...r,formula2:void 0,version:"v2"};O.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:n,update:{[i]:s},transaction:e})}})},this.handleFormulaChange=e=>{let{propertySchema:t,close:o}=e;const{collectionContextStore:r,property:i}=this.props,n=r.collectionStore();n&&(O.createAndCommit({userAction:"CollectionSettingsFormulaOptions.handleFormulaChange",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:n,update:{[i]:t},transaction:e})}}),o&&this.stores.buttonPopupStore.reset(),T.$q({environment:this.environment,collectionContextStore:r,property:i,from:"view_settings",action:"formula_edit"}))}}renderComponent(){const{device:e}=this.environment,{buttonPopupStore:t}=this.stores;return(0,ue.jsx)(Pe.ZP,{popupType:e.isMobile?_e.kQ.SlideUp:_e.kQ.Popup,alignmentToOrigin:Pe.vR.End,renderOrigin:e=>(0,ue.jsx)(Ie.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Formula",id:"database.viewSettings.formulaOptions.title"}),right:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Edit",id:"database.viewSettings.formulaOptions.edit"}),showChevron:!0,rotateChevron:t.state.open,...e}),render:this.renderPopup,buttonPopupStore:t})}}Fe.displayName="CollectionSettingsFormulaOptions";const Ze=(0,_.injectIntl)(Fe);var Ae=o(21269),Re=o(16257),Ve=o(13005),Be=o(26122),Oe=o(35011),De=o(34299),Ne=o(78106),Le=o(42853),Ke=o(32056),We=o(66890),qe=o(16187),Ee=o(64921),Ge=o(74194),ze=o(85248),Ue=o(78942),He=o(24006),$e=o(58573),Ye=o(15157),Qe=o(87279),Xe=o(29798),Je=o(52275),et=o(78140),tt=o(32163);class ot extends n.Z{constructor(){super(...arguments),this.storeTypes={numberFormatFilterStore:c.default.createClass(""),menuListStore:Xe.Z},this.handleNumberFormatFilterChange=e=>{this.stores.numberFormatFilterStore.setState(e.target.value),this.stores.menuListStore.setState({...this.stores.menuListStore.state,focus:{section:0,indexLocal:0,indexGlobal:0}})},this.handleNumberFormatChange=e=>{const{collectionStore:t,property:o,schema:r,onClose:i}=this.props,n=r[o];if(!n)return;if("number"!==n.type&&"formula"!==n.type)return;const s={...n,number_format:e,..."percent"===e&&void 0!==(null==n?void 0:n.show_as)?{show_as:{...null==n?void 0:n.show_as,maxValue:1}}:{}};"number"===n.type&&(0,Ke.b3)(e)&&Ye.Z.set({userId:this.environment.currentUser.id,key:ot.localLastUsedCurrencyPreferenceKey,value:e}),O.createAndCommit({userAction:"NumberFormatMenu.handleNumberFormatChange",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:t,update:{[o]:s},transaction:e})}}),null==i||i()}}renderComponent(){const{device:e}=this.environment;let t;t=e.isMobile?{menuType:Qe.og.ActionSheet}:{menuType:Qe.og.Popup};const o=!e.isMobile&&(0,ue.jsx)(pe.Z,{isInput:!0,children:(0,ue.jsx)(de.ZP,{value:this.stores.numberFormatFilterStore.state,onChange:this.handleNumberFormatFilterChange,focus:!0,focusAfterAnimation:!0,placeholder:z.default.getIntl().formatMessage({defaultMessage:"Filter formats…",id:"blockPropertyValue.filterForNumberFormats.placeholder"}),preventCaptureDeleteWhenEmpty:!0})});return(0,ue.jsx)(et.Z,{...t,header:o,children:(0,ue.jsx)(tt.Z,{type:tt.i.Vertical,initialFocus:0,sections:[{key:0,render:e=>(0,ue.jsx)(pe.Z,{...e}),items:this.getMenuItems()}],store:this.stores.menuListStore})})}getMenuItems(){const e=Ye.Z.get({userId:this.environment.currentUser.id,key:ot.localLastUsedCurrencyPreferenceKey});return(0,$e.ZP)(this.stores.numberFormatFilterStore.state,(0,Ke.jD)(e),(e=>e)).map((e=>({key:e,render:t=>this.renderMenuItem(e,t),action:()=>this.handleNumberFormatChange(e)})))}renderMenuItem(e,t){return(0,ue.jsx)(Je.Z,{...t,title:(0,Ke.Bo)(z.default.getIntl(),e)})}}ot.displayName="NumberFormatMenu",ot.localLastUsedCurrencyPreferenceKey="LastUsedCurrency";const rt=ot;var it=o(9050);function nt(e){let{collectionContextStore:t,property:o}=e;window.__c={n:"CollectionSettingsNumberOptions"};const{propertySchema:r,numberFormat:i}=(0,ne.VK)((()=>{const e=t.collectionStore(),r=t.normalizedSchemaStore.state[o];if(!r||!e)return{};if("number"===r.type)return{propertySchema:r,numberFormat:r.number_format??Ke.dk};if("formula"===r.type)return"number"===(0,Oe.mm)(r)||r.formula2&&(0,Me.V1)()&&"number"===(0,Ne.aL)(r.formula2.result_type).type?{propertySchema:r,numberFormat:r.number_format??Ke.dk}:{};if("rollup"===r.type){var i;if(r.aggregation&&"show_unique"!==r.aggregation){var n;const i=null===(n=(0,De.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===n?void 0:n.targetPropertySchema;if(void 0===(null==i?void 0:i.type))return{};const s=(0,qe.SD)(r.aggregation,(0,qe.SD)(r.aggregation,"number_format"in i?i.number_format:void 0));return s?{propertySchema:r,numberFormat:s}:{}}const s=null===(i=(0,De.gT)({property:o,schema:t.normalizedSchemaStore.state,getRecordModel:e.getRecordModel}))||void 0===i?void 0:i.targetPropertySchema;if("number"===(null==s?void 0:s.type)||"formula"===(null==s?void 0:s.type)&&"number"===(0,Oe.r9)(s))return{propertySchema:r,numberFormat:s.number_format??Ke.dk}}return{}}),[t,o]);if(!r)return null;const n="rollup"!==r.type;return(0,ue.jsxs)(ue.Fragment,{children:[n?(0,ue.jsx)(st,{numberFormat:i,property:o}):null,(0,ue.jsx)(at,{property:o,propertySchema:r,numberFormat:i})]})}function st(e){let{numberFormat:t,property:o}=e;window.__c={n:"NumberFormatSection"};const r=(0,We.Y$)(),i=(0,ne.qz)(void 0,Q.Z),n=(0,_.useIntl)(),s=(0,a.O7)();return(0,ue.jsx)(Pe.ZP,{popupType:s.device.isMobile?_e.kQ.SlideUp:_e.kQ.Popup,alignmentToOrigin:Pe.vR.End,renderOrigin:e=>(0,ue.jsx)(Ie.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Number format",id:"database.viewSettings.numberOptions.numberFormat"}),right:(0,ue.jsx)("span",{style:{...P.Z.textOverflowStyle},children:(0,Ke.Bo)(n,Ke.dX.find((e=>e===t))??Ke.dk)}),showChevron:!0,rotateChevron:i.state.open,...e}),render:e=>{const t=r.collectionStore(),i=r.normalizedSchemaStore.state;if(t)return(0,ue.jsx)(rt,{collectionStore:t,property:o,schema:i,onClose:e.close})},buttonPopupStore:i})}function at(e){let{property:t,propertySchema:o,numberFormat:i}=e;window.__c={n:"NumberShowAsSection"};const{show_as:n}=o,s=(0,We.Y$)(),c=(0,a.O7)(),d=(0,l.Fg)(),p=r.useRef({color:(null==n?void 0:n.color)??"green",maxValue:(null==n?void 0:n.maxValue)??100,showValue:(null==n?void 0:n.showValue)??!0}),h={type:(null==n?void 0:n.type)??"number",color:(null==n?void 0:n.color)??p.current.color,maxValue:(null==n?void 0:n.maxValue)??p.current.maxValue,showValue:(null==n?void 0:n.showValue)??p.current.showValue},m=(0,l.yK)((e=>({card:{boxSizing:"content-box",height:36,flex:1,margin:1,boxShadow:`0 0 0 1px ${e.regularDividerColor}`,color:e.mediumTextColor,borderRadius:3,display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",paddingLeft:12,paddingRight:12,paddingTop:6,paddingBottom:6,cursor:"pointer"},selectedCard:{boxShadow:`0 0 0 2px ${e.blueColor}`,color:e.blueColor},cardVisual:{height:20,marginBottom:4,width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},cardText:{lineHeight:1,fontSize:12},progressBar:{width:"100%"},showAsTypeOption:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",marginLeft:16,marginRight:16,marginTop:6,gap:12},extraOptionStyle:{display:"flex",flexDirection:"row",alignItems:"center",paddingLeft:16,paddingRight:16,gap:16,height:28,width:"100%"}})),[]),g=(0,r.useCallback)((e=>{const r=s.collectionStore();o&&r&&(O.createAndCommit({userAction:"CollectionSettingsProperty.handleNumberShowAsChange",environment:c,perform:i=>{R.xO({environment:c,collectionStore:r,update:{[t]:{...o,show_as:e}},transaction:i})}}),T.$q({environment:c,collectionContextStore:s,property:t,from:"view_settings",action:"number_change_show_as",number_show_as:(null==e?void 0:e.type)??"number"}))}),[s,c,t,o]),y=[{key:"number",visual:(0,ue.jsx)("div",{style:{fontSize:16,fontWeight:P.Z.fontWeight.medium},children:"42"}),text:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Number",id:"database.viewSettings.numberOptions.showAsNumber"})},{key:"bar",visual:(0,ue.jsx)(ze.k,{percentage:50,filledColor:"bar"===h.type?d.blueColor:d.regularDividerColor,unfilledColor:"bar"===h.type?d.accentColors.blue[50]:d.regularDividerColor,style:{width:"100%"}}),text:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Bar",id:"database.viewSettings.numberOptions.showAsBar"})},{key:"ring",visual:(0,ue.jsx)(Ue.e,{size:20,percentage:40,filledColor:"ring"===h.type?d.blueColor:d.regularDividerColor,unfilledColor:"ring"===h.type?d.accentColors.blue[50]:d.accentColors.gray[100],style:{width:"100%"}}),text:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Ring",id:"database.viewSettings.numberOptions.showAsRing"})}],S=(0,ue.jsx)("div",{style:m.showAsTypeOption,children:y.map((e=>{const t=h.type===e.key;return(0,ue.jsxs)(Ee.Z,{onClick:()=>{const t="number"===e.key?void 0:{type:e.key,color:h.color,maxValue:"percent"===i?1:h.maxValue,showValue:h.showValue};void 0!==t&&(p.current=t),g(t)},style:{...m.card,...t?m.selectedCard:{}},children:[(0,ue.jsx)("div",{style:m.cardVisual,children:e.visual}),(0,ue.jsx)("div",{style:m.cardText,children:e.text})]},e.key)}))}),f=e=>{const t="number"!==h.type?{...h,type:h.type,...e}:void 0;void 0!==t&&(p.current=t),g(t)},x="number"!==h.type?(0,ue.jsxs)("div",{style:m.extraOptionStyle,children:[(0,ue.jsx)("div",{style:{flex:6,fontSize:14},children:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Color",id:"database.viewSettings.numberOptions.color"})}),(0,ue.jsx)("div",{style:{display:"flex",flexWrap:"wrap",flex:6,gap:7},children:(0,ue.jsx)(Pe.ZP,{popupType:c.device.isMobile?Pe.Z4.SlideUp:Pe.Z4.Popup,renderOrigin:e=>(0,ue.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"end"},...e,children:(0,ue.jsx)(it.Z,{color:h.color,focused:!1,buttonStyle:{width:"auto",marginLeft:0,marginRight:0,borderRadius:3,color:d.lightTextColor},style:{minHeight:36},right:(0,Le.i)({width:12,height:12})})}),render:e=>{const t=u.AP.map((t=>(0,ue.jsx)(it.Z,{color:t,checkState:t===h.color,focused:!1,style:{width:"100%"},onClick:()=>{f({color:t}),e.close()}},t)));return(0,ue.jsx)("div",{style:{minWidth:150,paddingTop:8,paddingBottom:8},children:t})}})})]}):null,v="number"!==h.type?"percent"!==i&&(0,ue.jsxs)("div",{style:m.extraOptionStyle,children:[(0,ue.jsx)("div",{style:{flex:6,fontSize:14},children:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Divide by",id:"database.viewSettings.numberOptions.divideBy"})}),(0,ue.jsx)("div",{style:{flex:6},children:(0,ue.jsx)(Ge.Z,{value:h.maxValue.toString(),onChange:e=>{const t=e.target.value.replace(/[^0-9]/g,""),o=parseFloat(t);!isNaN(o)&&o>0&&f({maxValue:o})},inputStyle:{textAlign:"right"}})})]}):null,C="number"!==h.type?(0,ue.jsxs)("div",{style:m.extraOptionStyle,children:[(0,ue.jsx)("div",{style:{flex:6,fontSize:14},children:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Show number",id:"database.viewSettings.numberOptions.showValue"})}),(0,ue.jsx)("div",{style:{flex:6,display:"flex",justifyContent:"flex-end"},children:(0,ue.jsx)(He.Z,{on:h.showValue,onClick:()=>{f({showValue:!h.showValue})},disabled:!1})})]}):null,b=Boolean(x||v||C),w=(0,ue.jsxs)("div",{style:{backgroundColor:d.accentColors.gray[30],borderRadius:5,marginTop:b?12:0,marginLeft:b?14:0,marginRight:b?14:0,paddingTop:b?12:0,paddingBottom:b?12:0,maxHeight:b?1e3:0,transition:"max-height 0.5s ease-in-out",overflow:"hidden",display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[x,v,C]});return(0,ue.jsxs)(pe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Show as",id:"database.viewSettings.numberPercentOptions.showAs"}),topBorder:!0,disableMobileBorders:!0,children:[S,w,(0,ue.jsx)("div",{style:{marginTop:12,marginLeft:18,marginRight:18,fontSize:12,color:d.lightTextColor},children:(0,ue.jsx)(_.FormattedMessage,{id:"database.CollectionSettings.NumberOptions.applyAllViews",defaultMessage:"Changes apply to all views showing this property."})})]})}var lt=o(31869),ct=o(29376),dt=o(53787),pt=o(79892);function ut(e){window.__c={n:"CollectionSettingsRelationOptions"};const{collectionContextStore:t,property:o}=e,i=(0,a.O7)(),n=(0,_.useIntl)(),[s,l]=(0,r.useState)(void 0),c=(0,ne.VK)((()=>t.collectionStore()),[t]),u=(0,ne.VK)((()=>t.normalizedSchemaStore.state),[t]),h=(0,ne.VK)((()=>ct.KV(t,o)),[t,o]),m=h&&(0,d.NK)(h)?h.connectedRelation:void 0,g=(0,ne.VK)((()=>ht(t.collectionViewBlockStore(),h)),[t,h]),y=Boolean(g&&(null==c?void 0:c.id)===g.id),S=(0,ne.VK)((()=>Boolean(g&&(null==h?void 0:h.name)===ct.m8(n,{targetCollectionStore:g,isSelfRelation:y,sourceSchema:u,createUnique:!1}))),[h,n,g,y,u]),f=(0,ne.VK)((()=>t.contextType),[t]),x=(0,r.useCallback)((()=>{if(!s)return;const{hasInverseRelation:e,inverseName:r,autoRelate:a}=s;O.createAndCommit({userAction:"CollectionSettingsRelationOptions.handleEditRelation",environment:i,perform:s=>{lt.gy({environment:i,collectionContextStore:t,property:o,hasInverseRelation:e,inverseName:r,autoRelate:a,intl:n,transaction:s})}}),T.$q({environment:i,collectionContextStore:t,property:o,from:"collectionPage"===f?"page_properties":"view_settings",action:"relation_edit",is_self_relation:y,has_inverse:e,auto_relate:null==a?void 0:a.enabled}),l(void 0)}),[s,i,t,o,f,y,n]);if(!g)return null;const v=h&&!(0,p.gg)(h)&&!(0,p.ic)(h);return(0,ue.jsxs)(ue.Fragment,{children:[v&&(0,ue.jsx)(pt.Z,{isSelfRelation:y,collectionStore:g,showAs:"link",disabled:!0}),v&&(0,ue.jsx)(Re.C,{collectionContextStore:t,propertySchema:h,property:o}),!Boolean(m)&&(0,ue.jsx)(dt.Z,{collectionContextStore:t,targetCollectionStore:g,property:o,buttonContents:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Update relation",id:"database.viewSettings.editRelation.updateButton.title"}),temporaryInverseState:s,setTemporaryInverseState:l,isInitialPropertyName:S,onSubmit:x})]})}function ht(e,t){if("relation"!==(null==t?void 0:t.type))return;const o=null==t?void 0:t.collection_pointer;return o&&e?ee.NW.createChildStore(e,o):void 0}var mt=o(47453),gt=o(71644),yt=o(47307),St=o(84619),ft=o(4023),xt=o(73456),vt=o(22084);function Ct(e){window.__c={n:"CollectionSettingsSelectOptionRow"};const t=(0,a.O7)(),{isMobile:o}=(0,a.Fy)(),{property:i,option:n,statusGroup:s,propertySchema:c,isDefault:d,disabled:p}=e,u=(0,We.Y$)(),h=(0,ne.VK)((()=>{var e;return null===(e=u.collectionStore())||void 0===e?void 0:e.id}),[u]),m=(0,ne.qz)(void 0,Q.Z),g=(0,ne.VK)((()=>m.state.open),[m]),y=(0,r.useCallback)((()=>{m.setState({open:!0})}),[m]),S=(0,r.useCallback)((()=>{m.setState({open:!1})}),[m]),f=(0,r.useCallback)((e=>{const o=u.collectionStore();o&&R.HW({environment:t,collectionStore:o,performTransaction:t=>{for(const r of e)O.applyOperation({store:(0,ee.Kv)(o,r.pointer),operation:r,transaction:t})}})}),[u,t]),x=(0,l.yK)((()=>({defaultText:{fontSize:12,fontWeight:500,textTransform:"uppercase"}})),[]);return h?(0,ue.jsx)(xt.Z,{open:g,origin:(0,ue.jsx)(Ie.Z,{showDragHandle:!0,showChevron:!0,disabled:p,rotateChevron:g,title:"status"===c.type?(0,ue.jsx)(vt.F,{format:o?St.l.Large:St.l.Medium,value:n.value,color:n.color,descriptionTooltip:n.description,tooltipPlacement:ft.u.Left,showRemoveButton:!1,isSingle:!0,groupColor:null==s?void 0:s.color}):(0,ue.jsx)(vt.a,{format:o?St.l.Large:St.l.Medium,value:n.value,color:n.color,descriptionTooltip:n.description,tooltipPlacement:ft.u.Left,showRemoveButton:!1,isSingle:!0}),right:d?(0,ue.jsx)("span",{style:x.defaultText,children:(0,ue.jsx)(_.FormattedMessage,{id:"database.statusProperty.default",defaultMessage:"Default"})}):void 0,onClick:y}),option:n,property:i,propertySchema:c,statusGroup:s,collectionId:h,analyticsFrom:"view_settings",alignmentToOrigin:ft.v.End,onChange:f,onClose:S}):null}var bt=o(97180),wt=o(79131),Mt=o(73063),jt=o(3386);class It extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:J.Z,inputGroupIndexState:c.default.createClass(void 0)},this.handleAutoSortChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.collectionStore(),i=t.normalizedSchemaStore.state,n=this.getPropertySchema();if(!r||!n)return;if(!(0,d.cu)(n))return;const s=[{pointer:r.pointer,command:"update",path:["schema",o],args:{auto_sort_options:e}}];"alphabetical"!==e&&"reverse_alphabetical"!==e||s.push(...(0,W.L5)({collectionId:r.id,property:o,propertySchema:n,schema:i,isAscending:"alphabetical"===e})||[]),R.HW({environment:this.environment,collectionStore:r,performTransaction:e=>{for(const t of s)O.applyOperation({store:(0,ee.Kv)(r,t.pointer),operation:t,transaction:e})}}),T.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"select_change_auto_sort_options"})},this.handleNewOptionClick=e=>{this.stores.inputStore.setState({focus:!0,inputValue:""}),void 0!==e&&this.stores.inputGroupIndexState.setState(e)},this.handleInputChange=e=>{const t=e.target.value.replace(/,/g,"");this.stores.inputStore.setState({focus:!0,inputValue:t})},this.handleInputBlur=()=>{const e=this.environment.device.isPhone?this.stores.inputStore.state.inputValue:"";this.stores.inputStore.setState({focus:!1,inputValue:e})},this.handleInputSubmit=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),r=this.getPropertySchema();if(!r||!o)return;const i=r.options||[],n=this.stores.inputStore.state.inputValue;if(n){let e=(0,d.TL)(i);if("status"===r.type){var s;const t=null===(s=this.stores.inputGroupIndexState)||void 0===s?void 0:s.state;if(void 0!==t){var a;const o=null===(a=r.groups)||void 0===a||null===(a=a[t])||void 0===a?void 0:a.color;o&&(e=o)}}if(i.find((e=>e.value===n)))return yt.showErrorMessage(this.renderOptionAlreadyExistsMessage()),void this.handleInputBlur();const c={id:(0,gt.ZP)(),value:n,color:e};let p,u;if(p=(0,d.cu)(r)&&("alphabetical"===r.auto_sort_options||"reverse_alphabetical"===r.auto_sort_options)&&X.default.checkGate("collection_properties_select_auto_sort_options")?(0,W.Ch)({collectionId:o.id,property:t,propertySchema:r,newOption:c,isAscending:"alphabetical"===r.auto_sort_options}):{pointer:o.pointer,command:"keyedObjectListBefore",path:["schema",t,"options"],args:{value:c}},"status"===r.type){var l;const e=null===(l=this.stores.inputGroupIndexState)||void 0===l?void 0:l.state;void 0!==e&&(u={pointer:o.pointer,command:"listBefore",path:["schema",t,"groups",e,"optionIds"],args:{id:c.id}})}R.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{O.applyOperation({store:(0,ee.Kv)(o,p.pointer),operation:p,transaction:e}),u&&O.applyOperation({store:(0,ee.Kv)(o,u.pointer),operation:u,transaction:e})}})}this.stores.inputStore.setState({focus:!0,inputValue:""}),T.$q({environment:this.environment,collectionContextStore:e,property:t,from:"view_settings",action:"select_add_option"})},this.handleSelectDraggableListDrop=e=>{const{property:t,collectionContextStore:o}=this.props,r=o.normalizedSchemaStore.state,i=o.collectionStore();if(!i)return;const n=r[t];let s;if("status"===(null==n?void 0:n.type)){s=[[]];for(const t of e)t.startsWith("group-header-")?s.push([]):s[s.length-1].push(t)}else s=e;const a=(0,W.YL)({newOptions:s,collectionId:i.id,property:t,schema:r});if(a){if(n&&(0,d.cu)(n)){"manual"!==(n.auto_sort_options||"manual")&&a.push({pointer:i.pointer,command:"update",path:["schema",t],args:{auto_sort_options:"manual"}})}R.HW({environment:this.environment,collectionStore:i,performTransaction:e=>{for(const t of a)O.applyOperation({store:(0,ee.Kv)(i,t.pointer),operation:t,transaction:e})}})}T.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"select_options_reorder"})}}renderComponent(){var e,t;const{collectionContextStore:o,property:r,disabled:i,aIAutofillOption:n}=this.props,s=null===(e=o.collectionStore())||void 0===e?void 0:e.getSchema(),a=null===(t=o.collectionStore())||void 0===t?void 0:t.getFormat().app_config_uri,l=this.getPropertySchema();if(!s||!l)return;const{inputStore:c,inputGroupIndexState:d}=this.stores,p=c.state,u=d.state;if("status"===l.type){const e=l.groups??[];if(0===e.length)return;const t=l.options??[],o=e.map((e=>{const o=t.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));return{group:e,groupOptions:o}})),n=l.defaultOption,c=[...o[0].groupOptions.map((e=>e.value))];for(const{group:r,groupOptions:i}of o.slice(1))c.push({key:`group-header-${r.name}`,draggable:!1}),c.push(...i.map((e=>e.value)));const d=(0,N.Hw)(a,s,r)?{tooltipCaption:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"These options are core to the property and cannot be changed.",id:"database.viewSettings.selectOptions.disabledGroupMessage"})}:void 0,h=(s,a)=>{if(s.startsWith("group-header-")){const e=s.substring("group-header-".length),t=o.findIndex((t=>{let{group:o}=t;return o.name===e})),{group:r,groupOptions:n}=o[t];return this.renderSectionHeader((0,ue.jsx)(bt.r_,{disableGroup:d,group:r,showIcon:!1}),!p.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(t))),(0,ue.jsxs)(ue.Fragment,{children:[u===t&&this.renderNewOptionInput(),!p.focus&&0===n.length&&this.renderNewOptionItem(t)]}),i)}{const o=t.find((e=>e.value===s));if(!o)return;const a=e.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(o.id)}));return(0,ue.jsx)(Ct,{option:o,statusGroup:a,propertySchema:l,property:r,isDefault:o.value===n,disabled:i},o.value)}};return(0,ue.jsxs)(ue.Fragment,{children:[this.renderSectionHeader((0,ue.jsx)(bt.r_,{disableGroup:d,group:o[0].group}),!p.focus&&this.renderNewOptionButton((()=>this.handleNewOptionClick(0))),(0,ue.jsxs)(ue.Fragment,{children:[0===u&&this.renderNewOptionInput(),!p.focus&&0===o[0].groupOptions.length&&this.renderNewOptionItem(0)]}),i),(0,ue.jsx)(wt.ZP,{direction:"vertical",keys:c,renderKey:h,onDrop:this.handleSelectDraggableListDrop,disabled:i})]})}{const e=l.options??[],t=e.map((e=>e.value)),o=l.auto_sort_options||"manual";return[X.default.checkGate("collection_properties_select_auto_sort_options")&&(0,ue.jsx)(fe.Z,{title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Sort",id:"database.viewSettings.selectOptions.autoSort"}),selectedKey:o,options:[{key:"manual",title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Manual",id:"database.viewSettings.selectOptions.autoSort.none"})},{key:"alphabetical",title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Alphabetical",id:"database.viewSettings.selectOptions.autoSort.alphabetical"})},{key:"reverse_alphabetical",title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Reverse alphabetical",id:"database.viewSettings.selectOptions.autoSort.reverseAlphabetical"})}],onChange:this.handleAutoSortChange,popupStyle:{minWidth:190}},"autoSortMenuItem"),n,this.renderSectionHeader((0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Options",id:"database.viewSettings.selectOptions.title"}),!p.focus&&t.length>0&&this.renderNewOptionButton((()=>this.handleNewOptionClick())),this.renderNewOptionInput(),i),t.length>0&&(0,ue.jsx)(wt.ZP,{direction:"vertical",keys:t,renderKey:t=>{const o=e.find((e=>e.value===t));if(o)return(0,ue.jsx)(Ct,{option:o,property:r,propertySchema:l,isDefault:!1,statusGroup:void 0,disabled:i},o.value)},onDrop:this.handleSelectDraggableListDrop}),!p.focus&&0===t.length&&this.renderNewOptionItem()]}}renderSectionHeader(e,t,o,r){return(0,ue.jsx)(pe.Z,{topBorder:!0,title:e,desktopTitleStyle:{height:20},right:!r&&t,style:{width:"100%",paddingBottom:0},children:!r&&o})}renderNewOptionInput(){const{inputStore:e}=this.stores,t=e.state;if(t.focus)return(0,ue.jsx)(jt.Z,{capture:!0,onEsc:this.handleInputBlur,children:(0,ue.jsx)(de.ZP,{value:t.inputValue,focus:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Type a new option…",id:"database.viewSettings.selectOptions.newSelectOption.inputPlaceholder"}),style:{marginTop:2,marginBottom:8},onChange:this.handleInputChange,onBlur:this.handleInputBlur,onSubmit:this.handleInputSubmit,mobileKeyboardOnDismiss:this.handleInputSubmit})})}renderNewOptionItem(e){return(0,ue.jsx)(Je.Z,{icon:(0,mt.R)({width:14}),focused:!1,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.noOptions"}),style:{width:"100%"},onClick:()=>this.handleNewOptionClick(e)})}renderNewOptionButton(e){if(this.getPropertySchema())return(0,ue.jsx)(Mt.Z,{icon:mt.R,onClick:e,style:{width:20,height:20},ariaLabel:this.props.intl.formatMessage({defaultMessage:"Add an option",id:"database.viewSettings.selectOptions.addOption"})})}renderOptionAlreadyExistsMessage(){return(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Option already exists.",id:"database.optionExistsAlreadyError.message"})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&((0,d.cu)(o)||"status"===o.type))return o}}It.displayName="CollectionSettingsSelectOptions";const Pt=(0,_.injectIntl)(It);var _t=o(42283),kt=o(53866);const Tt=(0,_.defineMessages)({statusShowAsLabel:{id:"database.viewSettings.statusOptions.showAs",defaultMessage:"Show as"},statusCheckboxLabel:{id:"database.viewSettings.statusOptions.showAs.checkbox",defaultMessage:"Checkbox"},statusSelectLabel:{id:"database.viewSettings.statusOptions.showAs.select",defaultMessage:"Select"}});class Ft extends n.Z{constructor(){super(...arguments),this.handleShowAsChange=e=>{const{collectionContextStore:t,property:o}=this.props,r=t.formatStore();if(!r)return;const i=t.getPropertyFormatKey();i&&(O.createAndCommit({userAction:"CollectionSettingsStatusOptions.handleShowAsChange",environment:this.environment,perform:t=>{F.er({formatStore:r,formatKey:i,property:o,update:{statusShowAs:e,visible:!0},transaction:t})}}),T.$q({environment:this.environment,collectionContextStore:t,property:o,from:"view_settings",action:"status_change_format"}))},this.iconStyle={width:16,height:16,fill:this.theme.mediumIconColor}}renderComponent(){var e;const{collectionContextStore:t,property:o,disabled:r}=this.props;if(!this.getPropertySchema())return;const i=[{key:"checkbox",title:z.default.formatMessage(Tt.statusCheckboxLabel),icon:(0,_t.r)(this.iconStyle)},{key:"select",title:z.default.formatMessage(Tt.statusSelectLabel),icon:(0,kt.w)(this.iconStyle)}],n=(null===(e=t.getPropertyFormat(o))||void 0===e?void 0:e.statusShowAs)??"select";return(0,ue.jsx)(fe.Z,{title:z.default.formatMessage(Tt.statusShowAsLabel),selectedKey:n,popupStyle:{minWidth:190},options:i,onChange:e=>this.handleShowAsChange(e),disabled:r})}getPropertySchema(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];if(o&&"status"===o.type)return o}}Ft.displayName="CollectionSettingsStatusOptions";const Zt=(0,_.injectIntl)(Ft);var At=o(74420),Rt=o(31278),Vt=o(76798),Bt=o(32662),Ot=o(26388),Dt=o(64369),Nt=o(18145);const Lt=(0,_.defineMessages)({inputPlaceholder:{defaultMessage:"Property name",id:"database.viewSettings.propertyTab.propertyName"},autofillOffLabel:{defaultMessage:"Off",id:"database.viewSettings.propertyTab.autofillOffLabel"},autofillOnLabel:{defaultMessage:"On",id:"database.viewSettings.propertyTab.autofillOnLabel"},keptUpToDateWithNotionAITooltip:{defaultMessage:"Auto-updated by AI",id:"database.tableHeaderCell.tooltipAiAutofillDescription"}});class Kt extends n.Z{constructor(){super(...arguments),this.storeTypes={inputStore:c.default.createClass(""),propertyTypeButtonPopupStore:Q.Z,newSelectOptionInputStore:J.Z,addedPropertyDescriptionStore:c.default.createClass(!1)},this.renderLearnAboutRelationsMenuItem=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];let r;return r=(0,p.Kp)(o)?(0,ue.jsx)(Ae.Z,{href:(0,U.UY)("guides.githubRelation"),title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Learn about GitHub Pull Requests",id:"database.viewSettings.propertyTab.githubPrRelation.learnMoreButton.title"}),analyticsFrom:"view_settings_property_github_pr_relation"}):(0,ue.jsx)(Ae.Z,{href:(0,U.UY)("guides.relations"),title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Learn about relations",id:"database.viewSettings.propertyTab.relations.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"}),(0,ue.jsx)(pe.Z,{topBorder:!0,children:r})},this.handlePropertyTypeClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t}=this.props,o=this.getPropertySchema(),r=t.collectionStore();r&&Z.H4({collectionSettingsStore:e,item:{type:"propertyType",propertySchema:o,propertyTypes:(0,L.TP)({isSyncedCollection:r.isSyncedCollection(),collectionContextStore:t,environment:this.environment}),onAccept:this.handlePropertyTypeAccept}})},this.getAIInferencePathFromPropertySchema=e=>{switch(e.type){case"text":return"ai_inference";case"select":case"multi_select":return"select_ai_inference";default:(0,I.t1)(e)}},this.setAiInference=e=>{const{property:t,collectionContextStore:o}=this.props,r=o.collectionStore(),i=this.getPropertySchema();if(!i||!r||!(0,d.qQ)(i))return;const n=this.getAIInferencePathFromPropertySchema(i);if(!n)return;const s={pointer:r.pointer,command:"set",path:["schema",t,n],args:e};R.HW({environment:this.environment,collectionStore:r,performTransaction:e=>{O.applyOperation({store:(0,ee.Kv)(r,s.pointer),operation:s,transaction:e})}})},this.handleAiAutofillClick=()=>{const{collectionSettingsStore:e,collectionContextStore:t,property:o}=this.props,r=this.getPropertySchema();t.collectionStore()&&r&&Z.H4({collectionSettingsStore:e,item:{type:"propertyAiAutofill",propertySchema:r,property:o}})},this.handleAiAutofillToggle=()=>{const{collectionContextStore:e,property:t}=this.props,o=e.collectionStore(),r=this.getPropertySchema();if(!o||!r||!(0,d.cu)(r))return;const i=this.getAIInferencePathFromPropertySchema(r);if(!i)return;const n=(0,d.q3)(r),s=[];if(n)k._eA(this.environment,{type:"remove_ai_inference",ai_inference_type:n.type,collection_id:o.id}),s.push({pointer:o.pointer,command:"set",path:["schema",t,i],args:void 0});else{const e={type:r.type,auto_update_on_edit:!1,add_options:!1};k._eA(this.environment,{type:"set_ai_inference",ai_inference_type:e.type,collection_id:o.id}),s.push({pointer:o.pointer,command:"set",path:["schema",t,i],args:e})}R.HW({environment:this.environment,collectionStore:o,performTransaction:e=>{for(const t of s)O.applyOperation({store:(0,ee.Kv)(o,t.pointer),operation:t,transaction:e})}})},this.handlePropertyNameSubmit=e=>{if(this.shouldShowDuplicateError())return;const{property:t,collectionContextStore:o}=this.props,r=this.getCollectionStore();if(!r)return;const i=r.getSchema()[t];i&&i.name!==e&&(O.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyNameSubmit",environment:this.environment,perform:o=>{F.Bv({collectionStore:r,property:t,name:e,transaction:o})}}),T.$q({environment:this.environment,collectionContextStore:o,property:t,from:"view_settings",action:"rename"}))},this.handlePropertyIconSubmit=e=>{const{property:t,collectionContextStore:o}=this.props,r=this.getCollectionStore();r&&(O.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyIconSubmit",environment:this.environment,perform:o=>{F.OK({collectionStore:r,property:t,icon:e,transaction:o})}}),T.$q({environment:this.environment,collectionContextStore:o,property:t,icon:e,from:"view_settings",action:"change_icon"}))},this.handleToggleVisibilityClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=this.getPropertyFormat(),r=e.collectionViewStore(),i=e.normalizedFormatStore.state,n=this.getPropertySchema();if(!n)return;if(!(o&&r&&t&&n))return;const s={...i,[t]:this.getPropertyFormats().map((e=>e.property===o.property?{...o,visible:!o.visible}:e))};O.createAndCommit({userAction:"CollectionSettingsProperty.handleToggleVisibilityClick",environment:this.environment,perform:t=>{R.iG({collectionViewStore:r,update:{format:s},transaction:t});const i=this.getVisiblePropertyIndex();B.oz({environment:this.environment,collectionContextStore:e,currentIndex:i,entrypoint:"CollectionSettingsProperty",transaction:t,propertyAction:o.visible?"hide":"show"})}}),T.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_visibility",original_view_type:r.getType(),property_type:n.type})},this.handleTogglePropertyWrapClick=()=>{const{collectionContextStore:e,formatKey:t}=this.props,o=this.getPropertyFormat(),r=e.collectionViewStore(),i=e.normalizedFormatStore.state,n=this.getPropertySchema();n&&o&&r&&t&&n&&(B.K4({currentValue:this.wrapProperty.state,environment:this.environment,property:this.props.property,collectionViewStore:r,format:i,formatKey:t}),T.wd({environment:this.environment,collectionContextStore:e,action:"toggle_property_wrap",original_view_type:r.getType(),property_type:n.type}))},this.handleDuplicateClick=async()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o,formatKey:r}=this.props,i=this.getPropertyFormats(),n=this.getSchema(),s=this.getCollectionStore(),a=t.collectionViewStore(),l=null==s?void 0:s.getSpaceId();if(!s||!a||!l)return;const c=this.getPropertySchema();if(!c)return;const d=await(0,W.xy)({environment:this.environment,schema:n,property:e,properties:i,parentStore:s,spaceId:l});d&&(O.createAndCommit({userAction:"CollectionSettingsProperty.handleDuplicateClick",environment:this.environment,perform:e=>{R.xO({environment:this.environment,collectionStore:s,update:{[d.newProperty]:d.newPropertySchema},transaction:e});const o=this.getVisiblePropertyIndex();B.oz({environment:this.environment,collectionContextStore:t,currentIndex:o,entrypoint:"CollectionSettingsProperty",transaction:e,propertyAction:"duplicate"}),d.automationUpdate&&R.Ki({environment:this.environment,collectionStore:s,update:d.automationUpdate,transaction:e}),r&&V.FH({stores:[a],update:{[r]:d.newProperties},transaction:e})}}),Z.FK({collectionSettingsStore:o,item:{type:"property",property:d.newProperty,formatKey:r}}),T.wd({environment:this.environment,collectionContextStore:t,action:"duplicate_property",original_view_type:null==a?void 0:a.getType(),property_type:c.type}))},this.handleDeleteClick=async()=>{const{collectionContextStore:e,property:t}=this.props;await F.TI({environment:this.environment,collectionContextStore:e,property:t,handleDeleteAccept:this.handleDeleteAccept,theme:this.theme,from:"view_settings"})},this.handleDeleteAccept=()=>{const{property:e,collectionContextStore:t,collectionSettingsStore:o}=this.props,r=this.getPropertySchema(),i=this.getSchema(),n=this.getCollectionStore();r&&(n&&O.createAndCommitAsync({environment:this.environment,userAction:"CollectionSettingsProperty.handleDeleteAccept",waitForServerCommit:!1,perform:async o=>{await F.yV({environment:this.environment,collectionStore:n,schema:i,property:e,transaction:o});const r=this.getVisiblePropertyIndex();B.oz({environment:this.environment,collectionContextStore:t,currentIndex:r,entrypoint:"CollectionSettingsProperty",transaction:o,propertyAction:"delete"})}}),Z.z$({collectionSettingsStore:o}),T.wd({environment:this.environment,collectionContextStore:t,action:"delete_property",property_type:null==r?void 0:r.type}),T.y9({environment:this.environment,collectionContextStore:t,property_type:r.type,from:"view_settings",property:e}))},this.handleRollupPropertyMenuChange=e=>{const{property:t}=this.props,o=this.getCollectionStore();o&&O.createAndCommit({userAction:"CollectionSettingsProperty.handleRollupPropertyMenuChange",environment:this.environment,perform:r=>{R.xO({environment:this.environment,collectionStore:o,update:{[t]:e.propertySchema},transaction:r})}})},this.handlePropertyTypeAccept=e=>{const{property:t,collectionContextStore:o,collectionSettingsStore:r,formatKey:i}=this.props,n=this.getCollectionStore();n&&(T.$q({environment:this.environment,collectionContextStore:o,property:t,new_property_type:(0,d.TN)(e),from:"view_settings",action:"change_type"}),"relation"===e?Z.H4({collectionSettingsStore:r,item:{type:"selectRelationSource",property:t,formatKey:i}}):(O.createAndCommit({userAction:"CollectionSettingsProperty.handlePropertyTypeAccept",environment:this.environment,perform:o=>{F.LC({environment:this.environment,collectionStore:n,property:t,type:e,transaction:o})}}),Z.z$({collectionSettingsStore:r}),(0,d.XU)(e)&&A.K7({propertyType:e,propertyId:t,collectionContextStore:o})),this.stores.propertyTypeButtonPopupStore.reset())},this.wrapProperty=this.createComputedStore((()=>{var e;const{collectionContextStore:t}=this.props,o=t.collectionViewStore();return!!o&&(Boolean((null===(e=this.getPropertyFormat())||void 0===e?void 0:e.wrap)||o.getFormat().table_wrap)&&"timeline"!==o.getType())}))}didMount(){s.default.afterNextFlush((()=>{s.default.afterNextFlush((()=>{this.scrollTableCellIntoView()}))}))}renderComponent(){const{theme:e}=this,{property:t,collectionContextStore:o,selectNameInitial:r,formatKey:i}=this.props,n=this.getPropertySchema(),s=this.getPropertyFormat();if(!n)return;const a=o.collectionStore(),l="collectionTypedView"===o.contextType,c=i&&("title"!==t||(0,W.XO)({viewType:this.getCurrentViewType(),format:o.normalizedFormatStore.state})),u=i&&"title"!==t&&(0,W.w0)({viewType:this.getCurrentViewType()}),g=X.default.checkGate("property_descriptions")&&a,x=a&&a.getDatabaseType(),v=Boolean(x&&a&&a.isTypedProperty(t)),C=this.createComputedStore((()=>Boolean(a&&x&&N.cR((0,D.appConfigs)(),x,t,a)))),b=!(0,p.Kp)(n),j=l,I=l||(0,p.sh)({propertySchema:n,isTypedProperty:v}),P=L.Tr.includes(n.type)&&!(0,d.dx)(n)&&a,k=L.Tr.includes(n.type)&&a,T=c||P||k,F="collectionViewBlock"===o.contextType,Z=this.stores.addedPropertyDescriptionStore.state;return(0,ue.jsxs)(Ve.ZP,{...this.props,title:a?(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Edit property",id:"database.viewSettings.propertyTab.title"}):(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"View property",id:"database.viewSettings.propertyTab.title.viewProperty"}),unconstrainedWidth:F,children:[(0,ue.jsxs)(pe.Z,{children:[(0,ue.jsx)(Be.Z,{disabled:j,initialValue:n.name||"",placeholder:z.default.formatMessage(Lt.inputPlaceholder),onBlur:this.handlePropertyNameSubmit,onSubmit:this.handlePropertyNameSubmit,focusInitial:r,selectAll:r,inputStore:this.stores.inputStore,inputOuterStyle:F?{background:e.contentBackground}:void 0,iconButton:{icon:t=>(0,ue.jsx)(h.ZP,{type:n.type,icon:n.icon,size:16,theme:e,style:t}),iconStyle:{fill:m.Lr[e.mode].gray},enforceIconColor:"gray",onSubmit:this.handlePropertyIconSubmit}}),this.shouldShowDuplicateError()&&(0,ue.jsx)(Et,{propertyName:this.stores.inputStore.state})]}),(0,ue.jsxs)(pe.Z,{children:[b&&this.renderPropertyTypeMenuItem(I,v,x),l?null:(0,ue.jsxs)(ue.Fragment,{children:[(0,E.Zt)(this.environment)&&"text"===n.type&&this.renderAiAutofillMenuItem(),(0,d.cu)(n)&&this.renderSelectOptions(n),"status"===n.type&&this.renderStatusOptions(n),"formula"===n.type&&this.renderFormulaOptions(),"rollup"===n.type&&this.renderRollupOptions(),("date"===n.type||"created_time"===n.type||"last_edited_time"===n.type)&&this.renderDateOptions(),"relation"===n.type&&this.renderRelationOptions(),"person"===n.type&&this.renderPersonOptions(),this.renderNumberOptions(),"auto_increment_id"===n.type&&this.renderAutoIncrementId()]})]}),g&&(0,ue.jsx)(Wt,{propertySchema:n,property:t,collectionStore:a,addedPropertyDescription:Z}),"button"===n.type&&this.renderButtonOptions(),T&&(0,ue.jsxs)(pe.Z,{topBorder:!0,children:[g&&!Z&&(0,ue.jsx)(qt,{propertySchema:n,property:t,collectionStore:a,setAddedPropertyDescription:()=>this.stores.addedPropertyDescriptionStore.setState(!0)}),c&&s&&(null!=s&&s.visible?(0,ue.jsx)(Ie.Z,{icon:S.L,isPadded:!0,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Hide in view",id:"database.viewSettings.propertyTab.hideInViewButton.title"}),onClick:this.handleToggleVisibilityClick}):(0,ue.jsx)(Ie.Z,{icon:f.N,isPadded:!0,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Show in view",id:"database.viewSettings.propertyTab.showInViewButton.title"}),onClick:this.handleToggleVisibilityClick})),u&&s&&(this.wrapProperty.state?(0,ue.jsx)(Ie.Z,{icon:w.A,iconStyle:{transform:"scale(.8)"},isPadded:!0,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Don't wrap in view",id:"database.viewSettings.propertyTab.dontWrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick}):(0,ue.jsx)(Ie.Z,{icon:M.p,iconStyle:{transform:"scale(.7)"},isPadded:!0,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Wrap in view",id:"database.viewSettings.propertyTab.wrapInViewButton.title"}),onClick:this.handleTogglePropertyWrapClick})),P&&(0,ue.jsx)(Ie.Z,{icon:y.a,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Duplicate property",id:"database.viewSettings.propertyTab.duplicateButton.title"}),onClick:this.handleDuplicateClick}),k&&this.renderDeletePropertyMenuItem(C.state,x)]}),"formula"===n.type&&(0,ue.jsx)(pe.Z,{topBorder:!0,children:(0,ue.jsx)(Ae.Z,{href:(0,U.UY)("guides.formulas"),title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Learn about formulas",id:"database.viewSettings.propertyTab.formulas.learnMoreButton.title"}),analyticsFrom:"view_settings_property_formula"})}),"relation"===n.type&&this.renderLearnAboutRelationsMenuItem(),"rollup"===n.type&&(0,ue.jsx)(pe.Z,{topBorder:!0,children:(0,ue.jsx)(Ae.Z,{href:(0,U.UY)("guides.relations"),title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Learn about rollups",id:"database.viewSettings.propertyTab.rollups.learnMoreButton.title"}),analyticsFrom:"view_settings_property_relation"})})]})}renderPropertyTypeMenuItem(e,t,o){const{propertyTypeButtonPopupStore:r}=this.stores,i=this.props.collectionContextStore.collectionViewBlockStore(),n=this.getPropertySchema(),s=ht(i,n);if(!n)return;const a=null==s?void 0:s.getIcon(),{theme:l}=this,c=(0,p.gg)(n)||(0,p.ic)(n);return(0,ue.jsx)(Ot.Z,{placement:Ot.Z.Placement.Left,disableTooltip:!e,renderTooltip:e=>t?(0,ue.jsx)(_.FormattedMessage,{...e,defaultMessage:"{type} type is required for this property in {databaseType}.",id:"database.viewSettings.propertyTab.restrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:L.SO[n.type],databaseType:(0,G.Mn)(o)}}):(0,ue.jsx)(_.FormattedMessage,{...e,defaultMessage:"{type}'s type cannot be changed.",id:"database.viewSettings.propertyTab.untypedRestrictedProperty",description:"A tooltip to educate the users on why they can't change the type of this property.",values:{type:L.SO[n.type]}}),render:t=>(0,ue.jsx)(Ie.Z,{...t,disabled:e,rotateChevron:r.state.open,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Type",id:"database.viewSettings.propertyTab.propertyType"}),showChevron:!0,right:(0,ue.jsxs)(ue.Fragment,{children:[e?(0,ue.jsx)("div",{...t,children:(0,C.Q)({width:14,fill:l.regularIconColor})}):(0,ue.jsx)(h.ZP,{type:n.type,icon:void 0,size:16,theme:l}),(0,ue.jsx)(Bt.Z,{size:4}),c?(0,ue.jsxs)("div",{style:{color:e?l.darkTextColor:void 0,display:"flex",alignItems:"center"},children:[(0,ue.jsx)(Rt.Z,{icon:a,isEmptyPage:!1,size:20,disabled:!0}),(0,ue.jsx)(Vt.Z,{store:s,style:{display:"inline",wordBreak:"break-word",...P.Z.textOverflowStyle}})]}):(0,ue.jsx)("span",{style:{color:e?l.darkTextColor:void 0},children:L.SO[n.type]})]}),onClick:this.handlePropertyTypeClick})})}renderAiAutofillSwitcher(e){var t;if(!(0,E.KZ)())return;const{collectionSettingsStore:o,collectionContextStore:r,property:i}=this.props,n=this.getPropertySchema();if(!n)return;const s=(null===(t=te.default.state.data)||void 0===t?void 0:t.addOns)??[],a=(0,j.de)(s);return(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(Ie.Z,{title:(0,ue.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,ue.jsx)(At.Z,{style:{display:"inline-block"}})]}),showChevron:!1,right:(0,ue.jsx)(He.Z,{on:Boolean(e),onClick:this.handleAiAutofillToggle,disabled:!1,noColor:!1}),onClick:this.handleAiAutofillToggle}),e&&(0,ue.jsxs)(ue.Fragment,{children:[(0,ue.jsx)(ie.p,{collectionContextStore:r,environment:this.environment,setAiInference:this.setAiInference,aiInference:e,doesUserHaveAIAddOn:a}),(0,ue.jsx)(Ie.Z,{title:(0,ue.jsxs)("div",{style:{display:"flex",alignItems:"center",lineHeight:1.2},children:[(0,ue.jsx)(_.FormattedMessage,{id:"database.collectionsettings.aiAutofillOptions.more",defaultMessage:"More"}),(0,g.o)({fill:u.ZP.uiGray,width:12,height:12,marginLeft:4})]}),disabled:!1,onClick:()=>{Z.H4({collectionSettingsStore:o,item:{type:"propertyAiAutofill",propertySchema:n,property:i}})}})]})]})}renderAiAutofillMenuItem(){const e=this.getPropertySchema();if(!e||"text"!==e.type)return;const t=(0,d.q3)(e);let o;return t?"summarize"===t.type?o=q.Dr.autofillSummary:"extract"===t.type?o=q.Dr.autofillExtract:"custom"===t.type?o=q.Dr.autofillCustom:"translate"===t.type?o=q.Dr.autofillTranslate:(0,I.t1)(t):o=Lt.autofillOffLabel,(0,ue.jsx)(Ie.Z,{title:(0,ue.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"AI autofill",id:"database.viewSettings.propertyTab.aiAutofill.open"}),(0,ue.jsx)(At.Z,{style:{display:"inline-block"}})]}),showChevron:!0,right:z.default.formatMessage(o),onClick:this.handleAiAutofillClick})}renderSelectOptions(e){const{collectionSettingsStore:t,collectionContextStore:o,property:r}=this.props;return(0,ue.jsx)(Pt,{collectionSettingsStore:t,collectionContextStore:o,property:r,disabled:!1,aIAutofillOption:this.renderAiAutofillSwitcher(e.select_ai_inference)})}renderStatusOptions(e){var t;const{collectionSettingsStore:o,collectionContextStore:r,property:i}=this.props,n=N.Hw(null===(t=r.collectionStore())||void 0===t?void 0:t.getDatabaseType(),r.normalizedSchemaStore.state,i);return(0,ue.jsxs)(ue.Fragment,{children:[n?null:(0,ue.jsx)(Zt,{collectionContextStore:r,property:i,disabled:n}),(0,ue.jsx)(Pt,{collectionSettingsStore:o,collectionContextStore:r,property:i,disabled:n,aIAutofillOption:null})]})}renderRollupOptions(){const{property:e}=this.props,t=this.getCollectionStore(),o=this.getSchema();if(!t)return;const r=Boolean(t.getDatabaseType()&&t.isTypedProperty(e));return(0,ue.jsx)(Nt.Z,{disabled:r,context:Nt.t.ViewSettings,property:e,schema:o,analyticsFrom:"view_settings",parentStore:t,onChange:this.handleRollupPropertyMenuChange})}renderFormulaOptions(){const{collectionContextStore:e,collectionSettingsStore:t,property:o}=this.props;return(0,ue.jsx)(Ze,{collectionContextStore:e,collectionSettingsStore:t,property:o})}renderDateOptions(){const{collectionContextStore:e,property:t}=this.props;return(0,ue.jsx)(ve,{collectionContextStore:e,property:t})}renderNumberOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o)return"number"===o.type||"formula"===o.type||"rollup"===o.type?(0,ue.jsx)(nt,{collectionContextStore:e,property:t}):void 0}renderRelationOptions(){const{collectionContextStore:e,property:t}=this.props,o=e.normalizedSchemaStore.state[t];return(0,p.Kp)(o)?(0,ue.jsx)(re.Z,{collectionContextStore:e,property:t}):(0,ue.jsx)(ut,{collectionContextStore:e,property:t})}renderPersonOptions(){const e=this.renderLimitOptions(),t=(X.default.checkGate("default_person_property")||(0,$.iL)())&&this.renderDefaultPersonPicker();return(0,ue.jsxs)(ue.Fragment,{children:[e,t]})}renderDefaultPersonPicker(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"person"===o.type)return(0,ue.jsx)(be,{collectionContextStore:e,propertySchema:o,property:t})}renderButtonOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"button"===o.type)return(0,ue.jsx)(he,{collectionContextStore:e,propertySchema:o,propertyId:t})}renderLimitOptions(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o)return(0,ue.jsx)(Re.C,{collectionContextStore:e,propertySchema:o,property:t})}renderAutoIncrementId(){const{collectionContextStore:e,property:t}=this.props,o=this.getPropertySchema();if(o&&"auto_increment_id"===o.type){var r;const i=null===(r=e.collectionStore())||void 0===r?void 0:r.getRecordKeyStore(),n=null==i?void 0:i.getRecordKey();return(0,ue.jsx)(oe.Z,{uniqueIdProperty:{propertyId:t,propertySchema:o},prefixValue:n,collectionContextStore:e})}}renderDeletePropertyMenuItem(e,t){return(0,ue.jsx)(Ot.Z,{disableTooltip:!e,placement:Ot.Z.Placement.Left,renderTooltip:e=>(0,G.A7)(t,e),render:o=>(0,ue.jsx)(Ie.Z,{...o,isRed:!0,disabled:e,onClick:this.handleDeleteClick,icon:()=>e?(0,ue.jsx)("div",{...o,style:{display:"inline-flex"},children:(0,C.Q)({width:14,marginLeft:4,marginRight:4})}):(0,b.y)({width:14,marginLeft:4,marginRight:4}),title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Delete property",id:"database.viewSettings.propertyTab.deleteButton.title"}),caption:this.environment.device.isMobile&&e?(0,G.A7)(t):null})})}getCollectionStore(){const{collectionContextStore:e}=this.props;if(e.collectionViewBlockStore())return e.collectionStore()}getSchema(){const e=this.getCollectionStore();return e?e.getSchema():this.props.collectionContextStore.normalizedSchemaStore.state||{}}getPropertySchema(e){const t=e||this.props,{property:o}=t;return this.getSchema()[o]}getPropertyFormat(){const{property:e}=this.props,t=this.getPropertyFormats();return null==t?void 0:t.find((t=>t.property===e))}getPropertyFormats(){const{formatKey:e,collectionContextStore:t}=this.props;if(!e)return[];return t.normalizedFormatStore.state[e]||[]}getVisiblePropertyIndex(){const{property:e}=this.props,t=this.getPropertyFormats();if(0===t.length)return-1;return t.filter((e=>e.visible)).findIndex((t=>t.property===e))}shouldShowDuplicateError(){const{property:e}=this.props,{inputStore:t}=this.stores,o=this.getSchema(),r=t.state,i=Object.keys(o).find((t=>{var i;return t!==e&&(null===(i=o[t])||void 0===i?void 0:i.name)===r}));return Boolean(i)}getCurrentViewType(){const{collectionContextStore:e}=this.props,t=e.getViewType();if(!t)throw new Error("View type was not defined.");return t}scrollTableCellIntoView(){const{property:e,collectionContextStore:t}=this.props,o=t.collectionViewStore();if(!o||"table"!==o.getType())return;const r=Y.Z.findTableHeaderCell(t,e);if(!r)return;const n=i.findDOMNode(r),s=i.findDOMNode(this);if(!n||!s)return;const a=(0,H.xH)(n);if(!a)return;const l=s.getBoundingClientRect(),c=n.getBoundingClientRect().right+20-l.left;a.scrollLeft=a.scrollLeft+c}}function Wt(e){window.__c={n:"CollectionSettingsPropertyDescriptionSection"};const{propertySchema:t,property:o,collectionStore:i,addedPropertyDescription:n}=e,s=(0,a.O7)(),c=t.description,[d,p]=(0,r.useState)(t.description??""),u=(0,r.useRef)(d),h=(0,l.yK)((()=>({title:{display:"flex",alignItems:"center",gap:4,cursor:"default"},infoTooltip:{width:300,whiteSpace:"normal"},descriptionInput:{marginBottom:8}})),[]),m=(0,r.useCallback)((()=>{var e;const t=null==i||null===(e=i.getSchema())||void 0===e?void 0:e[o];void 0!==t&&t.description!==u.current&&O.createAndCommit({userAction:"CollectionSettingsProperty.handleDescriptionChange",environment:s,perform:e=>{R.xO({environment:s,collectionStore:i,update:{[o]:{...t,description:u.current.length>0?u.current:void 0}},transaction:e})}})}),[i,s,o,u]),g=(0,r.useRef)(m);return g.current=m,(0,r.useEffect)((()=>()=>g.current()),[g]),void 0!==c||n?(0,ue.jsx)(pe.Z,{topBorder:!0,title:(0,ue.jsxs)("span",{style:h.title,children:[(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Description",id:"database.viewSettings.propertyTab.description.title"}),(0,ue.jsx)(Ot.Z,{placement:Ot.Z.Placement.Bottom,render:e=>(0,ue.jsx)("div",{...e,children:(0,x.m)({width:12})}),renderTooltip:e=>(0,ue.jsx)("div",{...e,style:h.infoTooltip,children:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Descriptions provide extra information about this property to users. They appear when hovering over property names.",id:"database.viewSettings.propertyTab.description.tooltip"})})})]}),children:(0,ue.jsx)(de.ZP,{value:d,onChange:e=>{p(e.target.value),u.current=e.target.value},onBlur:m,onSubmit:m,placeholder:"",focusInitial:n,disabled:!1,style:h.descriptionInput,textarea:!0,textareaSubmitOnEnter:!0,maxlength:K.p})}):(0,ue.jsx)(ue.Fragment,{})}function qt(e){window.__c={n:"CollectionSettingsAddPropertyDescription"};const{propertySchema:t,property:o,collectionStore:i,setAddedPropertyDescription:n}=e,s=(0,a.O7)(),l=t.description,c=(0,r.useCallback)((()=>{O.createAndCommit({userAction:"CollectionSettingsProperty.handleAddDescriptionClick",environment:s,perform:e=>{R.xO({environment:s,collectionStore:i,update:{[o]:{...t,description:""}},transaction:e})}}),n()}),[i,s,o,t,n]);return void 0!==l?(0,ue.jsx)(ue.Fragment,{}):(0,ue.jsx)(Ie.Z,{icon:v.D,isPadded:!1,title:(0,ue.jsx)(_.FormattedMessage,{defaultMessage:"Add description",id:"database.viewSettings.propertyTab.addDescription.title"}),onClick:c})}function Et(e){return(0,ue.jsx)(Dt.Z,{isMultiline:!0,style:{paddingTop:8,marginLeft:16,marginRight:16,color:u.ZP.red,...e.styles},children:(0,ue.jsx)(_.FormattedMessage,{id:"database.viewSettings.propertyTab.duplicatePropertyNameError",defaultMessage:"A property named {propertyName} already exists in this database.",values:{propertyName:e.propertyName}})})}Kt.displayName="CollectionSettingsProperty";const Gt=(0,_.injectIntl)(Kt)},79892:(e,t,o)=>{o.d(t,{Z:()=>g});o(67294);var r=o(480),i=o(86628),n=o(24405),s=o(15145),a=o(82990),l=o(5366),c=o(84210),d=o(42917),p=o(84076),u=o(31278),h=o(76798),m=o(85893);function g(e){window.__c={n:"CollectionSettingsRelationTarget"};const{isSelfRelation:t,collectionStore:o,showAs:g,disabled:y,onClick:S}=e,f=(0,i.VK)((()=>Boolean(o)),[o]),x=(0,i.VK)((()=>null==o?void 0:o.getIcon()),[o]),v=(0,i.VK)((()=>{if(t)return;const e=null==o?void 0:o.getParentBlockStore();return e&&(0,c.ZP)({store:e,pageVisitSource:s.tY.LinkInPage})}),[o,t]),C=(0,r.Fy)(),b=(0,n.yK)((e=>({linkBox:{display:"flex",alignItems:"center"},linkTitle:{color:e.regularTextColor,fontWeight:a.Z.fontWeight.semibold,fontSize:14,marginLeft:4*(C.isRetina?.5:1),wordBreak:"break-word",...a.Z.textOverflowStyle},chevronTitle:{display:"inline",wordBreak:"break-word",...a.Z.textOverflowStyle}})),[C]),w=(0,m.jsx)(u.Z,{icon:x,isEmptyPage:!1,size:20,disabled:!0});return(0,m.jsx)(d.Z,{title:(0,m.jsx)(l.FormattedMessage,{defaultMessage:"Related to",id:"database.viewSettings.editRelation.targetLink.title"}),showChevron:"chevron"===g,onClick:S,disabled:y,right:t?(0,m.jsx)(l.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettings.editRelation.selfRelationTarget.title"}):"link"===g&&v?(0,m.jsxs)(p.Z,{href:v,innerStyle:b.linkBox,children:[w,(0,m.jsx)(h.Z,{store:o,underline:!0,style:b.linkTitle,maxLength:15})]}):f?(0,m.jsxs)(m.Fragment,{children:[w,(0,m.jsx)(h.Z,{store:o,style:b.chevronTitle})]}):(0,m.jsx)(l.FormattedMessage,{defaultMessage:"No target",id:"database.viewSettings.editRelation.noTarget.title"}),rightStyle:{flexShrink:1},textWrapperStyle:{flexShrink:0}})}},40121:(e,t,o)=>{o.d(t,{P:()=>q,Z:()=>G});o(67294);var r=o(83355),i=o(49085),n=o(49019),s=o(47453),a=o(72126),l=o(51454),c=o(5366),d=o(8406),p=o(40778),u=o(5149),h=o(45264),m=o(24677),g=o(98104),y=o(97004),S=o(68641),f=o(13273),x=o(34859),v=o(61766),C=o(51774),b=o(28398),w=o(58814),M=o(19699),j=o(8298),I=o(22109),P=o(29651),_=o(82990),k=o(33338),T=o(53437),F=o(85893);class Z extends r.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:i.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return(0,F.jsx)(C.P,{context:S.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;d.wd({environment:this.environment,collectionContextStore:e,action:"click_sort"}),u.wl({collectionSettingsStore:t,item:{type:"sort"}})},this.handlePopupDismiss=e=>{if(e&&(0,f.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;u.E3({collectionSettingsStore:t})}}willUnmount(){u.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return(0,F.jsx)(T.ZP,{popupType:e.isMobile?T.ZP.PopupType.SlideUp:T.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){const{collectionContextStore:e}=this.props,t=e.currentSortsStore.state,o=e.localStateDiffStore.state,r=t[0],i=e.permissionScopes.state,n=e.normalizedSchemaStore.state,s=r?n[r.property]:void 0;let a;return a=1===t.length?r&&"descending"===r.direction?(0,j.N)({width:12,marginRight:4,fill:this.theme.blueColor}):(0,P.w)({width:12,marginRight:4,fill:this.theme.blueColor}):(0,I.T)({width:16,marginRight:4,fill:this.theme.blueColor}),(0,F.jsx)(k.Z,{on:!0,hasDiff:Boolean(i.canConfigureBlock&&o.sorts),icon:a,title:(0,F.jsx)("span",{style:{marginTop:-1,maxWidth:220,..._.Z.textOverflowStyle},children:1===t.length&&s?s.name:(0,F.jsx)(c.FormattedMessage,{defaultMessage:"{sortCount} sorts",id:"database.filterBar.sorts.label",values:{sortCount:t.length}})}),onClick:this.handleClick})}}Z.displayName="CollectionViewFilterBarSort";const A=(0,c.injectIntl)(Z);var R=o(98597),V=o(23063),B=o(37601),O=o(79131),D=o(21199),N=o(1743),L=o(74194),K=o(89728),W=o(53336);let q=function(e){return e[e.FilterBar=0]="FilterBar",e[e.SettingsFilters=1]="SettingsFilters",e}({});class E extends r.Z{constructor(){super(...arguments),this.storeTypes={createFilterSettingsStore:i.default.createClass({open:!1,stack:[]}),saveControlMoreActionsButtonPopupStore:v.Z},this.renderPropertyFilter=e=>{const{collectionContextStore:t}=this.props;return(0,F.jsx)(M.Z,{id:e.id,context:q.FilterBar,collectionContextStore:t,collectionSettingsStore:t.getFilterBarItemSettingsStore(e)},e.id)},this.renderViewSettingsPopup=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;return(0,F.jsx)(C.P,{context:S.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleNewFilterPopupClick=()=>{const{collectionContextStore:e}=this.props,{createFilterSettingsStore:t}=this.stores;d.wd({environment:this.environment,collectionContextStore:e,action:"click_new_filter"}),u.wl({collectionSettingsStore:t,item:{type:"createFilter"}})},this.handlePopupDismiss=e=>{const{createFilterSettingsStore:t}=this.stores;e&&(0,f.yT)(e.target)||u.E3({collectionSettingsStore:t})},this.handleSearchClick=()=>{const{collectionContextStore:e}=this.props;g.ZH(this.environment),m.ZH(this.environment),h.wG(),e.searchOpen.setState(!0),e.searchQuery.setState(""),d.wd({environment:this.environment,collectionContextStore:e,action:"click_mobile_search"})},this.handleSearchQueryChange=e=>{const{collectionContextStore:t}=this.props;t.searchQuery.setState(e.target.value)},this.handleSearchBlur=()=>{const{collectionContextStore:e}=this.props;e.searchQuery.state||this.handleSearchClearButtonClick()},this.handleSearchClearButtonClick=()=>{const{collectionContextStore:e}=this.props;e.searchOpen.setState(!1),e.searchQuery.setState("")},this.handleFiltersDrop=e=>{const{collectionContextStore:t}=this.props;if(!t.collectionViewBlockStore())return;const o=t.currentPropertyFiltersStore.state,r=a.oA(e.map((e=>o.find((t=>t.id===e)))));p.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:r}}}),d.wd({environment:this.environment,collectionContextStore:t,action:"reorder_filters"})},this.handleClick=e=>{const{collectionContextStore:t}=this.props;t.filtersBarOpen.setState(!0)},this.localStateHasChangesStore=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props;return(0,y.Nq)(e)}))}renderComponent(){const{collectionContextStore:e}=this.props,{device:t}=this.context.environment,{isPhone:o}=t,r=o&&e.searchOpen.state,i=e.currentPropertyFiltersStore.state,n=e.currentSortsStore.state,s=this.localStateHasChangesStore.state,a=this.props.collectionContextStore.shouldShowSource.state?8:12,c=e.filterBarSortSettingsStore.state.open,d=n.length>0||c,p=e.permissionScopes.state.canConfigureBlock?e.currentCombinatorFilterStore.state:void 0;return(0,F.jsxs)("div",{style:{width:"100%",zIndex:l._Y},onClick:this.handleClick,children:[(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[r&&this.renderMobileSearchInput(),!r&&(0,F.jsx)("div",{style:{position:"relative",flexGrow:0,overflow:"hidden"},children:(0,F.jsx)(W.Z,{type:x.Z.X,style:{display:"flex",alignItems:"center",paddingTop:a,paddingBottom:t.isPhone?12:8},showLeftRightOverlay:!t.isPhone,children:o?(0,F.jsxs)(F.Fragment,{children:[this.renderMobileSearchButton(),d&&this.renderSort(),d&&!t.isPhone&&this.renderDivider(),p&&this.renderCombinatorFilter(),this.renderPropertyFilters(i),this.renderAddFilterButton()]}):(0,F.jsxs)(F.Fragment,{children:[d&&this.renderSort(),d&&!t.isPhone&&this.renderDivider(),p&&this.renderCombinatorFilter(),this.renderPropertyFilters(i),this.renderAddFilterButton()]})})}),(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center",paddingTop:4,marginLeft:"auto"},children:[!o&&s&&this.renderSaveControl(),!o&&this.renderCompleteSprintButton()]})]}),o&&!r&&(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:4},children:[s&&this.renderSaveControl(),this.renderCompleteSprintButton()]})]})}renderSaveControl(){const{collectionContextStore:e,showHoverActionsStore:t}=this.props;return(0,F.jsx)(b.ZP,{context:b.R1.FilterBar,collectionContextStore:e,showHoverActionsStore:t,moreActionsButtonPopupStore:this.stores.saveControlMoreActionsButtonPopupStore})}renderPropertyFilters(e){const{collectionContextStore:t}=this.props;if(t.permissionScopes.state.canConfigureBlock){const t=e.map((e=>e.id));return(0,F.jsx)(O.ZP,{direction:"horizontal",keys:t,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:t=>{const o=e.find((e=>e.id===t));if(o)return this.renderPropertyFilter(o)},style:{display:"flex",flexShrink:0},onDrop:this.handleFiltersDrop})}return e.map(this.renderPropertyFilter)}renderCombinatorFilter(){const{collectionContextStore:e}=this.props;return(0,F.jsx)(w.Z,{context:q.FilterBar,collectionSettingsStore:e.filterBarCombinatorFilterSettingsState,collectionContextStore:e})}renderSort(){const{collectionContextStore:e}=this.props;return(0,F.jsx)(A,{collectionContextStore:e,collectionSettingsStore:e.filterBarSortSettingsStore},"sort")}renderDivider(){return(0,F.jsx)("div",{style:{borderRight:`1px solid ${this.theme.regularDividerColor}`,height:24,marginRight:12,marginLeft:8}})}renderAddFilterButton(){const{showHoverActionsStore:e}=this.props,t=this.stores.createFilterSettingsStore.state.open,o=e.state||t;return(0,F.jsx)(T.ZP,{open:t,popupType:this.environment.device.isMobile?T.kQ.SlideUp:T.kQ.Popup,origin:(0,F.jsx)(V.Z,{isVisible:!0,animationStyle:{opacity:o?1:0},render:()=>(0,F.jsx)(K.Z,{icon:s.R,isSmall:!0,isLightGray:!0,hovered:t,onClick:this.handleNewFilterPopupClick,style:{fontSize:14},children:(0,F.jsx)(c.FormattedMessage,{defaultMessage:"Add filter",id:"database.filterBar.addButton.title"})})}),render:this.renderViewSettingsPopup,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,onDismiss:this.handlePopupDismiss})}renderCompleteSprintButton(){const{collectionContextStore:e}=this.props,t=e.getCompleteSprintButtonContext.state;if(t)return(0,F.jsx)(R.v,{collectionContextStore:e,completeSprintAutomationContext:t})}renderMobileSearchInput(){const{collectionContextStore:e,intl:t}=this.props,o=e.searchQuery.state;return(0,F.jsx)(N.Z,{capture:!0,children:(0,F.jsx)(D.Z,{capture:!0,render:e=>(0,F.jsx)("div",{...e,style:{width:"100%",paddingTop:this.environment.device.isMobile?8:12,paddingBottom:6},children:(0,F.jsx)(k.Z,{wrapStyle:{width:"100%"},innerStyle:{width:"100%"},icon:(0,n.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(L.Z,{format:L.B.Transparent,value:o,placeholder:t.formatMessage({defaultMessage:"Type to search…",id:"database.filterBar.mobileSearch.placeholder"}),onChange:this.handleSearchQueryChange,autoComplete:"on",autoCorrect:"on",onBlur:this.handleSearchBlur,onClearButtonClick:this.handleSearchClearButtonClick,showClearButton:!0,focus:!this.environment.device.isIOS||void 0,focusInitial:!0,inputStyle:{height:"100%"}}),(0,F.jsx)(B.Z,{show:!0})]})})})})})}renderMobileSearchButton(){return(0,F.jsx)(k.Z,{wrapStyle:{display:"flex",alignItems:"center"},icon:(0,n.e)({width:14,fill:this.theme.mediumIconColor,marginRight:6}),hideChevron:!0,title:(0,F.jsx)("span",{style:{marginTop:-1,color:this.theme.mediumTextColor},children:(0,F.jsx)(c.FormattedMessage,{defaultMessage:"Search",id:"database.filterBar.search.title"})}),onClick:this.handleSearchClick},"search")}}E.displayName="CollectionViewFilterBar";const G=(0,c.injectIntl)(E)},58814:(e,t,o)=>{o.d(t,{Z:()=>f});o(67294);var r=o(83355),i=o(49085),n=o(21197),s=o(82990),a=o(5366),l=o(8406),c=o(40778),d=o(5149),p=o(68641),u=o(13273),h=o(51774),m=o(33338),g=o(53437),y=o(85893);class S extends r.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:i.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;return(0,y.jsx)(h.P,{context:p.HV.FilterBar,collectionContextStore:e,collectionSettingsStore:t,hideDesktopHeader:!0})},this.handleClick=()=>{const{collectionContextStore:e}=this.props,{collectionSettingsStore:t}=this.stores;this.getFilter()&&(d.wl({collectionSettingsStore:t,item:{type:"filter"}}),l.wd({environment:this.environment,collectionContextStore:e,action:"click_combinator_filter"}))},this.handlePopupDismiss=e=>{var t;if(e&&(0,u.yT)(e.target))return;const{collectionContextStore:o}=this.props,{collectionSettingsStore:r}=this.stores;d.E3({collectionSettingsStore:r});const i=this.getFilter();i&&0===(null===(t=i.filters)||void 0===t?void 0:t.length)&&c.iU({environment:this.environment,collectionContextStore:o,temporaryState:{...o.temporaryState.state,combinatorFilter:{value:void 0}}})},this.hasFilterDiff=this.createComputedStore((()=>{const{collectionContextStore:e}=this.props,t=e.localStateDiffStore.state;return Boolean(t.combinatorFilter)}))}willUnmount(){d.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores;return(0,y.jsx)(g.ZP,{popupType:e.isMobile?g.ZP.PopupType.SlideUp:g.ZP.PopupType.Popup,open:t.state.open,origin:this.renderOrigin(),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderOrigin(){var e;const{environment:t}=this,o=this.getFilter();if(o)return(0,y.jsx)(m.Z,{icon:(0,n.Q)({width:void 0,height:t.device.isMobile?14:12,fill:this.theme.blueColor,marginRight:6}),title:(0,y.jsx)("span",{style:this.getTitleStyle(),children:(0,y.jsx)(a.FormattedMessage,{defaultMessage:"{ruleCount, plural, one {{ruleCount} rule} other {{ruleCount} rules}}",id:"database.filterBar.advancedFilterRulesCount.title",values:{ruleCount:(null===(e=o.filters)||void 0===e?void 0:e.length)||0}})}),on:!0,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick},"combinator")}getFilter(){return this.props.collectionContextStore.currentCombinatorFilterStore.state}getTitleStyle(){return{maxWidth:180,...s.Z.textOverflowStyle}}}S.displayName="CollectionViewFilterBarCombinatorFilter";const f=(0,a.injectIntl)(S)},19699:(e,t,o)=>{o.d(t,{Z:()=>q});o(67294);var r=o(83355),i=o(49085),n=o(76205),s=o(39068),a=o(82990),l=o(5366),c=o(8406),d=o(40778),p=o(5149),u=o(93959),h=o(97004),m=o(75079),g=o(13273),y=o(18245),S=o(62644),f=o(40121),x=o(33338),v=o(15070),C=o(99036),b=o(40506),w=o(76725),M=o(72126),j=o(23014),I=o(21202),P=o(77420),_=o(6287),k=o(19889),T=o(97880),F=o(7928),Z=o(17335),A=o(29376),R=o(35661),V=o(76798),B=o(89845),O=o(85893);class D extends r.Z{constructor(){super(...arguments),this.renderSeparator=e=>(0,O.jsx)("span",{style:{whiteSpace:"pre"},children:(0,O.jsx)(l.FormattedMessage,{defaultMessage:", ",id:"database.filterValue.commaSeparator"})},e),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,propertyFilter:t,parentStore:o}=this.props,r=e[t.property];if(r&&(0,C.p_)(r))return(0,A.ke)(r,o)}))}renderComponent(){const{valueOnly:e,propertyFilter:t,style:o}=this.props,{filter:r}=t,i=(0,n.a_)(r)?r.subfilter:r,s=(0,n.h6)(i)&&!(0,n.mv)(r),a={...o,maxWidth:void 0};return(0,O.jsx)("span",{style:(0,n.gE)(i)?a:o,children:(0,O.jsx)(l.FormattedMessage,{defaultMessage:"{propertyName}{colonSeparator} {filterOperator} {propertyValue}",id:"database.filterBarFilterValue.title",values:{propertyName:e?void 0:this.renderPropertyName(),colonSeparator:e||s?void 0:":",filterOperator:this.renderFilterOperator(),propertyValue:this.renderValue()}})})}renderPropertyName(){const{propertyFilter:e,schema:t}=this.props,o=t[e.property];if(o)return(0,O.jsx)("span",{style:{fontWeight:a.Z.fontWeight.medium},children:o.name})}renderFilterOperator(){const{propertyFilter:e}=this.props,{filter:t}=e,o=(0,n.a_)(t)?t.subfilter:t;if((0,n.Ly)(o))return"string_contains"===o.operator||"string_is"===o.operator?void 0:"string_does_not_contain"===o.operator||"string_is_not"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.h6)(o))return(0,Z.WC)(o.operator);if((0,n.XA)(o)){if("checkbox_is_not"===o.operator)return this.renderNotOperatorMessage()}else{if((0,n.dx)(o))return"enum_is"===o.operator?void 0:"enum_is_not"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.NU)(o))return"enum_contains"===o.operator?void 0:"enum_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.r2)(o))return"status_is"===o.operator?void 0:"status_is_not"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.e)(o))return"relation_contains"===o.operator?void 0:"relation_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.Gb)(o))return"person_contains"===o.operator?void 0:"person_does_not_contain"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);if((0,n.Mp)(o)){if("location_is"===o.operator)return;if("location_is_not"===o.operator)return this.renderNotOperatorMessage()}else if((0,n.gE)(o)){if("date_is"===o.operator)return;if("date_is_after"===o.operator)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"After",id:"database.filterValue.dateType.dateIsAfter.title"});if("date_is_before"===o.operator)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Before",id:"database.filterValue.dateType.dateIsBefore.title"});if("date_is_on_or_after"===o.operator)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"On or after",id:"database.filterValue.dateType.dateIsOnOrAfter.title"});if("date_is_on_or_before"===o.operator)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"On or before",id:"database.filterValue.dateType.dateIsOnOrBefore.title"});if(!(0,n.TQ)(o))return(0,Z.WC)(o.operator);{const e=o.value;if(!e.value||"exact"!==e.type||!(0,b.gR)(e.value))return(0,Z.ip)(e);if(e.value.start_date&&e.value.end_date)return;if(e.value.start_date)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Starting",id:"database.filterValue.dateType.starting.title"});if(e.value.end_date)return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Ending",id:"database.filterValue.dateType.ending.title"})}}else{if((0,n.Jw)(o))return"verification_is"===o.operator?void 0:"verification_is_not"===o.operator?this.renderNotOperatorMessage():(0,Z.WC)(o.operator);(0,T.t1)(o)}}}renderNotOperatorMessage(){return(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Not",id:"database.filterBarFilterValue.notOperator"})}renderValue(){const{propertyFilter:e,schema:t,intl:o,parentStore:r}=this.props,{filter:i}=e,s=(0,n.a_)(i)?i.subfilter:i;if((0,n.vR)(s))if((0,n.Ly)(s)||(0,n.h6)(s)){const e=s.value.value;if(void 0!==e)return(0,O.jsx)("span",{children:e})}else if((0,n.XA)(s)){const e=s.value.value;if(!0===e)return(0,O.jsx)("span",{children:(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Checked",id:"database.filterValue.checkboxType.checked.title"})});if(!1===e)return(0,O.jsx)("span",{children:(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Unchecked",id:"database.filterValue.checkboxType.unchecked.title"})})}else{if((0,n.dx)(s)||(0,n.NU)(s)){const e=(0,n.dx)(s)?(0,n.mg)(s):(0,n.qC)(s),t=M.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(t,this.renderSeparator)})}if((0,n.r2)(s)){const e=(0,n.wB)(s),t=M.oA(e.map((e=>{let{value:t}=e;return t})));if(0===t.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(t,this.renderSeparator)})}if((0,n.e)(s)){const e=(0,n.YO)(s),t=M.oA(e.map(((e,t)=>{if(!e.value)return;const o=e.type;if("exact"===o){const t=R.G.createChildStore(r,{table:I.iU,id:e.value});return(0,O.jsx)(V.Z,{style:{display:"inline"},store:t},e.value)}if("relative"===o){var i;const o=this.getRelatedCollectionAppConfigUri.state;if(!o)return;return(0,O.jsx)("span",{children:null===(i=j.qB[o])||void 0===i||null===(i=i[e.value.variable])||void 0===i?void 0:i.formattedMessage},t)}(0,T.t1)(o)})));return(0,w.Z)(t,this.renderSeparator)}if((0,n.Gb)(s)){const e=(0,n.R8)(s),t=M.oA(e.map(((e,t)=>{if("relative"===e.type)return(0,O.jsx)("span",{children:(0,O.jsx)(l.FormattedMessage,{defaultMessage:"Me",id:"database.filterValue.personType.firstPersonPropertyValue.title"})},t);if(e.value){const i=e.value;if(i.table===k.KJ){const e=R.t1.createChildStore(r,{table:i.table,id:i.id});return(0,O.jsx)("span",{children:(0,F.Nz)(o,e.getModel())},t)}if(i.table===P.cZ){const e=R.t1.createChildStore(r,{table:i.table,id:i.id});return(0,O.jsx)("span",{children:(0,v.Mh)(e.getModel())},t)}}})));return(0,w.Z)(t,this.renderSeparator)}if((0,n.Mp)(s)){const e=(0,n.u0)(s),t=M.oA(e.map((e=>{if(e.value){const t=e.value,o=R.t1.createChildStore(r,{table:_.v,id:t});return(0,O.jsx)(V.Z,{style:{display:"inline"},store:o},t)}})));return(0,w.Z)(t,this.renderSeparator)}if((0,n.gE)(s)){const o=t[e.property],r=(o&&"date"===o.type?o.date_format:void 0)||b.sF;let i;if("exact"===s.value.type){const e=s.value;if(e.value)if((0,b.J_)(e.value))i=e.value;else if((0,b.gR)(e.value)){const t=(0,b.Gc)(e.value);t&&(i=t.value)}}else if(!(0,n.TQ)(s))return(0,Z.x)(s.value);if(i)return(0,O.jsx)(B.Z,{style:{display:"inline"},value:i,dateFormat:r,shortenDateAndRange:!0})}else{if((0,n.Jw)(s)){const e=(0,n.fl)(s).filter((e=>{let{value:t}=e;return Boolean(t)})).map(Z.cq);if(0===e.length)return;return(0,O.jsx)("span",{children:(0,w.Z)(e,this.renderSeparator)})}(0,T.t1)(s)}}}}D.displayName="CollectionViewFilterValue";const N=(0,l.injectIntl)(D);var L=o(53437),K=o(26388);class W extends r.Z{constructor(){super(...arguments),this.storeTypes={collectionSettingsStore:i.default.createClass({open:!1,stack:[]})},this.renderPopup=()=>{var e;const{collectionContextStore:t}=this.props,o=this.getFilter();if(!o)return;const r=o.filter,i=t.normalizedSchemaStore.state,n=t.collectionViewStore(),s=t.permissionScopes.state;if(!n)return;const a=null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type;return(0,O.jsx)(S.ZP,{collectionViewId:n.id,propertyFilter:r,schema:i,parentStore:n,onChange:e=>this.handleValueChange(e,a),onClose:this.handleFilterValueMenuClose,onDelete:this.handleDeleteFilter,onAddToCombinatorFilter:this.handleAddToCombinatorFilter,context:S.Qv.PropertyFilter,allowAddingToCombinatorFilter:s.canConfigureBlock,allowRelativeDateFilter:!0,allowRelativePersonFilter:!0})},this.handleClick=()=>{var e;const{collectionContextStore:t}=this.props,{collectionSettingsStore:o}=this.stores,r=this.getFilter();r&&(p.wl({collectionSettingsStore:o,item:{type:"filter"}}),c.wd({environment:this.environment,collectionContextStore:t,action:"click_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[r.filter.property])||void 0===e?void 0:e.type}))},this.handleValueChange=(e,t)=>{var o;const{collectionContextStore:r}=this.props,i=this.getFilter();if(!i)return;const n=null===(o=r.remoteResult.state)||void 0===o?void 0:o.sizeHint,s=y.default.mark("collections.update_filter_lag");y.default.measureAfterNextFlush(s,{environment:this.environment,getData:()=>m.Y5({from:"property_filter",property_type:t,collectionContextStore:r,sizeHintAtStart:n})});const a=i.filter,l=r.currentPropertyFiltersStore.state.map((t=>{if(t.id===i.id){return{...i,filter:{...a,filter:e}}}return t}));d.iU({environment:this.environment,collectionContextStore:r,temporaryState:{...r.temporaryState.state,propertyFilters:{value:l}}}),c.wd({environment:this.environment,collectionContextStore:r,action:"update_property_filter",original_view_type:void 0,property_type:t})},this.handlePopupDismiss=e=>{if(e&&(0,g.yT)(e.target))return;const{collectionSettingsStore:t}=this.stores;p.E3({collectionSettingsStore:t})},this.handleFilterValueMenuClose=()=>{const{collectionSettingsStore:e}=this.stores;p.E3({collectionSettingsStore:e})},this.handleDeleteFilter=()=>{var e;const{collectionContextStore:t}=this.props,o=this.getFilter();if(!o)return;const r=t.currentPropertyFiltersStore.state.filter((e=>e.id!==o.id));d.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:r}}}),c.wd({environment:this.environment,collectionContextStore:t,action:"delete_property_filter",original_view_type:void 0,property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[o.filter.property])||void 0===e?void 0:e.type})},this.handleAddToCombinatorFilter=()=>{var e;const{collectionContextStore:t,context:o}=this.props,r=this.getFilter();if(!r)return;const{combinatorFilter:i,propertyFilters:n}=(0,h.Gz)(t,r);d.iU({environment:this.environment,collectionContextStore:t,temporaryState:{...t.temporaryState.state,propertyFilters:{value:n},combinatorFilter:{value:i}}});const s=o===f.P.FilterBar?t.filterBarCombinatorFilterSettingsState:t.filterOptionsCombinatorFilterSettingsState;p.wl({collectionSettingsStore:s,item:{type:"filter"}}),c.wd({environment:this.environment,collectionContextStore:t,action:"merge_filter_into_combinator",property_type:null==t||null===(e=t.collectionStore())||void 0===e||null===(e=e.getSchema()[r.filter.property])||void 0===e?void 0:e.type})},this.hasFilterDiff=this.createComputedStore((()=>{const{id:e,collectionContextStore:t}=this.props,o=t.localStateDiffStore.state;return o.filters.updated.includes(e)||o.filters.added.includes(e)}))}willUnmount(){p.E3({collectionSettingsStore:this.stores.collectionSettingsStore})}renderComponent(){const{device:e}=this.environment,{collectionSettingsStore:t}=this.stores,o=this.getFilter(),r=Boolean(o&&(0,u.EE)(o.id));return(0,O.jsx)(L.ZP,{popupType:e.isMobile?L.ZP.PopupType.SlideUp:L.ZP.PopupType.Popup,open:t.state.open,origin:r?this.renderReadOnlyOrigin():this.renderOrigin(void 0,!1),onDismiss:this.handlePopupDismiss,disableMouseCapture:!0,enableOutsideClickDismiss:!0,originGap:4,render:this.renderPopup})}renderReadOnlyOrigin(){return(0,O.jsx)(K.Z,{placement:K.Z.Placement.Bottom,render:e=>this.renderOrigin(e,!0),renderTooltip:()=>(0,O.jsx)(l.FormattedMessage,{id:"database.filterBarPropertyFilter.cannotConfigure",defaultMessage:"This filter cannot be modified on this view."})})}renderOrigin(e,t){const{collectionContextStore:o}=this.props,{device:r}=this.environment,i=this.getFilter(),a=o.normalizedSchemaStore.state,l=o.collectionViewStore();if(!l||!i)return;const c=i.filter,d=!(0,n.Oo)(c),p=a[c.property],{theme:u}=this;return(0,O.jsx)(x.Z,{icon:p&&(0,O.jsx)(s.ZP,{type:p.type,icon:p.icon,size:r.isMobile?18:16,theme:u,style:{fill:d?u.blueColor:u.mediumIconColor,marginRight:6}}),title:d?(0,O.jsx)(N,{propertyFilter:c,schema:a,style:this.getTitleStyle(),parentStore:l}):(0,O.jsx)("span",{style:this.getTitleStyle(),children:null==p?void 0:p.name}),on:d,hasDiff:this.hasFilterDiff.state,onClick:this.handleClick,disabled:t,hideChevron:t,...e},i.id)}getFilter(){const{id:e,collectionContextStore:t}=this.props;return t.currentPropertyFiltersStore.state.find((t=>t.id===e))}getTitleStyle(){return{maxWidth:180,...a.Z.textOverflowStyle}}}W.displayName="CollectionViewFilterBarPropertyFilter";const q=(0,l.injectIntl)(W)},98597:(e,t,o)=>{o.d(t,{v:()=>ut});var r=o(67294),i=o(480),n=o(86628),s=o(24405),a=o(5366),l=o(82990),c=o(50906),d=o(27370),p=o(97004),u=o(75079),h=o(64856),m=o(80444),g=o(65089),y=(o(21703),o(63123)),S=o(49085),f=o(15145),x=o(99036),v=o(45433),C=(o(57658),o(30541),o(21202)),b=o(77420),w=o(19889),M=o(70203),j=o(97880);class I{}I.text=e=>new k(e),I.mentionDate=e=>new F(e),I.mentionUser=e=>new Z(e),I.mentionGroup=(e,t)=>new B(e,t),I.mentionBot=e=>new Z(e),I.mentionPage=e=>new Z(e),I.mentionTemplateVariable=e=>new A(e),I.mentionFormulaContextVariable=e=>new R(e),I.mentionFormulaPagePropertyVariable=e=>new V(e),I.mentionCitation=e=>new O(e),I.equation=e=>new T(e),I.concat=e=>new P(e);class P{constructor(e){this.build=()=>{const e=[];for(const t of this.tokens){const o=t.build();e.push(o[0])}return e},this.tokens=e}}class _{constructor(e){this.styles={},this.highlight=void 0,this.linkData=void 0,this.bold=()=>(this.styles[M.GKr.Bold]=!0,this),this.italic=()=>(this.styles[M.GKr.Italic]=!0,this),this.strike=()=>(this.styles[M.GKr.Strike]=!0,this),this.code=()=>(this.styles[M.GKr.Code]=!0,this),this.underline=()=>(this.styles[M.GKr.Underline]=!0,this),this.color=e=>(this.highlight=e,this),this.link=e=>(this.linkData=e,this),this.build=()=>{const e=[];for(const t of(0,j.Yd)(this.styles))e.push([t]);return this.highlight&&e.push([M.GKr.Highlight,this.highlight]),this.linkData&&e.push([M.GKr.Link,this.linkData]),this.onBuild(e)},this.onBuild=e}}class k extends _{constructor(e){super((t=>{if(this.url&&t.unshift(M.edl(this.url)),t.length>0){return[[e,t]]}return[[e]]})),this.url=void 0,this.link=e=>(this.url=e,this)}}class T extends _{constructor(e){super((t=>[M.qZ6(e,t)]))}}class F extends _{constructor(e){super((t=>{let o;"date"in e?o=this.getDateAnnotationData(e.date):"time"in e?o=this.getTimeAnnotationData(e.time,e.timeZone):(0,j.t1)(e);const r=M.pZr(o);return[M.YCD(r,t)]})),this.getDateString=e=>e.toISOString().split("T")[0],this.getTimeString=e=>e.toISOString().split("T")[1].slice(0,5)}getDateAnnotationData(e){if(Array.isArray(e)){const[t,o]=e;return{type:"daterange",start_date:this.getDateString(t),end_date:this.getDateString(o)}}return{type:"date",start_date:this.getDateString(e)}}getTimeAnnotationData(e,t){if(Array.isArray(e)){const[t,o]=e;return{type:"datetimerange",start_date:this.getDateString(t),start_time:this.getTimeString(t),end_date:this.getDateString(o),end_time:this.getTimeString(o),time_zone:"Etc/GMT"}}return{type:"datetime",start_date:this.getDateString(e),start_time:this.getTimeString(e),time_zone:t??"Etc/GMT"}}}class Z extends _{constructor(e){super((t=>{let o;return e.table===w.KJ?o=M.tEo(e.id):e.table===b.cZ?o=M.CbB(e.id):e.table===C.iU?o=M.$0A(e.id,e.spaceId):(0,j.t1)(e),[M.YCD(o,t)]}))}}class A extends _{constructor(e){super((t=>{const o=M.WBu({type:e});return[M.YCD(o,t)]}))}}class R extends _{constructor(e){super((t=>{const o=M._QF(e);return[M.YCD(o,t)]}))}}class V extends _{constructor(e){super((t=>{const o=M.kbv(e);return[M.YCD(o,t)]}))}}class B extends _{constructor(e,t){super((o=>{const r=M.XIB(e,t);return[M.YCD(r,o)]}))}}class O extends _{constructor(e){super((t=>{const o=M.hNu(e);return[M.YCD(o,t)]}))}}var D=o(78106),N=o(4615),L=o(23014),K=o(6287);const W=(0,a.defineMessages)({nextSprintName:{id:"structuredAutomations.createNextSprint.nextSprintName",defaultMessage:"Sprint"}});function q(e){const{createNextSprintActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:r,intl:i,spaceId:n,getCurrentSprintActionId:s,sprintStatusPropertyId:a,sprintUniqueIdPropertyId:l}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:X({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,incrementBy:1,intl:i})},action:"replace"},[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:["title",a],collection:o},space_id:n}}function E(e){const{getCurrentSprintActionId:t,sprintCollectionPointer:o,sprintCollectionSchema:r,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:L.qB[v.p$].current.reducer.getCombinatorFilter(r),collection:o},space_id:i}}function G(e){const{getLargestUniqueIdSprintActionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:r,spaceId:i}=e;return{id:t,type:"query_collection",config:{filter:void 0,collection:o,sort:[{property:r,direction:"descending"}],limit:1},space_id:i}}function z(e){const{createFutureSprintActionId:t,sprintCollectionPointer:o,sprintStatusFutureOptionName:r,intl:i,spaceId:n,getLargestUniqueIdSprintActionId:s,sprintStatusPropertyId:a,sprintUniqueIdPropertyId:l,incrementBy:c}=e;return{id:t,type:"create_page",config:{values:{title:{value:{type:"formula",value:X({actionId:s,sprintCollectionPointer:o,sprintUniqueIdPropertyId:l,intl:i,incrementBy:c})},action:"replace"},[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:["title",a],collection:o},space_id:n}}function U(e){const{updateFutureSprintToNextActionId:t,sprintCollectionPointer:o,sprintStatusNextOptionName:r,sprintStatusFutureOptionName:i,spaceId:n,sprintStatusPropertyId:s,sprintUniqueIdPropertyId:a}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:i}}}]},sort:[{property:a,direction:"ascending"}],limit:1},values:{[s]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:[s]},space_id:n}}function H(e){const{moveIncompleteTasksActionId:t,createNextSprintActionId:o,taskCollectionPointer:r,taskStatusCompleteGroupName:i,spaceId:n,nextSprintInput:s,taskStatusPropertyId:a,taskSprintRelationPropertyId:l}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:r,filter:{operator:"and",filters:[{property:a,filter:{operator:"status_is_not",value:{type:"is_group",value:i}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:l}]}},properties:[l],values:{[l]:{value:{type:"simple",value:"pointer"===s.type?I.mentionPage(s.pointer).build():I.mentionFormulaContextVariable({id:(0,D.Kd)({source:"action",action_id:o,action_output_type:"page"})}).build()},action:"replace"}}},space_id:n}}function $(e){const{moveIncompleteTasksToBacklogActionId:t,taskCollectionPointer:o,taskStatusCompleteGroupName:r,spaceId:i,taskStatusPropertyId:n,taskSprintRelationPropertyId:s}=e;return{id:t,type:"update_pages",config:{target:{type:"collection",collection:o,filter:{operator:"and",filters:[{property:n,filter:{operator:"status_is_not",value:{type:"is_group",value:r}}},{filter:{operator:"relation_contains",value:{type:"relative",value:{type:"builtin",variable:"current"}}},property:s}]}},properties:[s],values:{[s]:{value:void 0,action:"remove"}}},space_id:i}}function Y(e){const{updateCurrentSprintToPastActionId:t,getCurrentSprintActionId:o,sprintStatusPastOptionName:r,spaceId:i,sprintStatusPropertyId:n}=e;return{id:t,type:"update_pages",config:{target:{id:(0,D.Kd)({source:"action",action_id:o,action_output_type:"pages"}),type:"variable"},values:{[n]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"}},properties:[n]},space_id:i}}function Q(e){const{updateNextSprintToCurrentActionId:t,createNextSprintActionId:o,sprintStatusCurrentOptionName:r,spaceId:i,nextSprintInput:n,nextSprintDateRange:s,sprintStatusPropertyId:a,sprintDatePropertyId:l}=e;return{id:t,type:"update_pages",config:{target:"pointer"===n.type?{type:"page",page:n.pointer}:{id:(0,D.Kd)({source:"action",action_id:o,action_output_type:"page"}),type:"variable"},values:{[a]:{value:{type:"simple",value:[[`"${r}"`]]},action:"replace"},[l]:{value:{type:"simple",value:[(0,M.YCD)(["d",s])]},action:"replace"}},properties:[a,l]},space_id:i}}function X(e){const{actionId:t,sprintCollectionPointer:o,sprintUniqueIdPropertyId:r,incrementBy:i,intl:n}=e;return I.concat([I.text(`"${n.formatMessage(W.nextSprintName)}" + " " + format(`),I.mentionFormulaContextVariable({id:(0,D.Kd)({source:"action",action_id:t,action_output_type:"pages"})}),I.text(".first()."),I.mentionFormulaPagePropertyVariable({collection:o,property:r}),I.text('.split("-").at(-1).toNumber()'),I.text(`+${i})`)]).build()}var J=o(8848),ee=o(84619),te=o(40506),oe=o(7057),re=o(36591),ie=o(42853),ne=o(47453),se=o(29477),ae=o(606),le=o(149),ce=o(63143),de=o(45264),pe=o(75018),ue=o(2553),he=o(87279),me=o(37034),ge=o(29376),ye=o(58484),Se=o(35661),fe=o(97039),xe=o(78030),ve=o(42922),Ce=o(52275),be=o(31945),we=o(36596),Me=o(78140),je=o(32163),Ie=o(40721),Pe=o(89728),_e=o(31278),ke=o(76798),Te=o(72495),Fe=o(83264),Ze=o(50506),Ae=o(53437),Re=o(85893);function Ve(e){window.__c={n:"DefaultPopupOrModalFunctional"};const{isOpen:t,onDismiss:o,render:r,origin:n,style:s,innerStyle:a,ariaLabel:l,ariaLabelledBy:c}=e,{isMobile:d}=(0,i.Fy)();return d?(0,Re.jsx)(Ae.ZP,{ariaLabel:l,ariaLabelledBy:c,open:t,popupType:Ae.ZP.PopupType.SlideUp,origin:n,onDismiss:o,render:r,style:s}):(0,Re.jsx)(Ze.Z,{ariaLabel:l,ariaLabelledBy:c,open:t,preventHideChildrenWhileOpening:!0,render:r,onDismiss:o,style:s,innerStyle:a})}var Be=o(85567);const Oe=(0,a.defineMessages)({completedPercentSummary:{id:"completeAutomationSprintModal.sprintSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} total tasks"},selectNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectNextSprintLabel",defaultMessage:"Next sprint"},selectDatesForNextSprintLabel:{id:"completeAutomationSprintModal.sprintSummary.selectDatesForNextSprintLabel",defaultMessage:"Start and end dates"},nextSprintDatesLabel:{id:"completeAutomationSprintModal.sprintSummary.nextSprintDatesLabel",defaultMessage:"Next sprint dates"},cancelButton:{id:"completeAutomationSprintModal.sprintSummary.cancel",defaultMessage:"Cancel"},fallbackSprintName:{id:"completeAutomationSprintModal.sprintName.placeholder",defaultMessage:"Sprint"}});function De(e){let{onDismiss:t,...o}=e;window.__c={n:"CompleteSprintAutomationModal"};const{isOpen:n}=o,s=(0,i.O7)(),a=(0,r.useId)(),l=e=>{t();let r=!1;(0,j.Kn)(e)&&(0,j.$K)(e.clickedCancel)&&(r=!0===e.clickedCancel),c.$Xl(s,{...(0,u.Pn)(o.taskCollectionContextStore),action:r?"cancel_modal":"dismiss_modal"})};return(0,Re.jsx)(Ve,{ariaLabelledBy:a,isOpen:n,onDismiss:()=>l(),render:()=>(0,Re.jsx)(Ne,{...o,onDismiss:l,titleAriaId:a})})}function Ne(e){window.__c={n:"SprintSummaryModal"};const{completeSprintAutomationContext:t,setIsLoading:o,taskCollectionContextStore:s,onDismiss:l,completeSprintAutomationState:d,onAutomationComplete:p,titleAriaId:h}=e,{sprintCollectionStore:m}=t,{currentSprintId:g,querySprintsResult:f,currentSprintTaskSummary:b}=d,w=(0,a.useIntl)(),M=(0,i.O7)(),{isMobile:I}=(0,i.Fy)(),P=(0,n.VK)((()=>m.getSpaceId()),[m]),_=(0,n.VK)((()=>{if(g)return Se.G.createChildStore(m,{id:g,table:C.iU,spaceId:m.getSpaceId()})}),[g,m]),k=(0,n.VK)((()=>_?(0,me.vU)({intl:w,environment:M,store:_,untitledFallback:Oe.fallbackSprintName}):w.formatMessage(Oe.fallbackSprintName)),[_,w,M]),T=(0,n.VK)((()=>Ge({sprintDateRange:Ee({sprintBlockStore:_,sprintCollectionStore:m}),intl:w})),[_,m,w]),[F,Z]=r.useState(),A=(0,n.VK)((()=>S.default.createValue("complete_sprint_and_move_incomplete_tasks_to_next_sprint")),[]),R=(0,n.VK)((()=>{if("pointer"!==(null==F?void 0:F.type))return;return Ee({sprintBlockStore:Se.G.createChildStore(m,F.pointer),sprintCollectionStore:m})}),[F,m]),[V,B]=r.useState(void 0),O=r.useMemo((()=>{if(V&&(0,te.h)(V))return V}),[V]),D=r.useMemo((()=>{if(!f)return;const{nextSprintIds:e,futureSprintIds:t}=f;return e.length>0?e:t}),[f]),L=(0,n.VK)((()=>{if(void 0===D)return;const e=D[0];return e?{type:"pointer",pointer:{id:e,table:C.iU,spaceId:P}}:{type:"actionId"}}),[D,P]);r.useEffect((()=>{L&&Z(L)}),[L,Z]),r.useEffect((()=>{B(R)}),[R,B]);const W=r.useCallback((async()=>{if(l(),!F||!O)return;o(!0);const e=0===(null==b?void 0:b.incompleteTaskCount)?"complete_sprint":A.state,r=function(e){var t,o,r,i,n,s,a;const{sprintCollectionValue:l,nextSprintInput:c,intl:d,nextSprintDateRange:p}=e,u=l.space_id,h={id:l.id,table:K.v,spaceId:u},m=(0,N.ZP)(),g=(0,N.ZP)(),y=(0,N.ZP)(),S=(0,N.ZP)(),f=(0,N.ZP)(),C=(0,N.ZP)(),b=(0,N.ZP)(),w=(0,x.oC)(l),M=null===(t=l.format)||void 0===t||null===(t=t.app_uri_map)||void 0===t?void 0:t[v.b0.StatusV2];if(!M)return{error:{message:`${v.b0.StatusV2} not found.`}};const I=null===(o=l.format)||void 0===o||null===(o=o.app_uri_map)||void 0===o?void 0:o[v.b0.UniqueId];if(!I)return{error:{message:`${v.b0.UniqueId} not found.`}};const P=null===(r=l.format)||void 0===r||null===(r=r.app_uri_map)||void 0===r?void 0:r[v.b0.Dates];if(!P)return{error:{message:`${v.b0.Dates} not found.`}};const _=w[M];if(!_||"status"!==_.type)return{error:{message:`${v.b0.StatusV2} not found.`}};const k=null===(i=_.options)||void 0===i||null===(i=i.find((e=>e.id===v.J1)))||void 0===i?void 0:i.value,T=null===(n=_.options)||void 0===n||null===(n=n.find((e=>e.id===v.SF)))||void 0===n?void 0:n.value,F=null===(s=_.options)||void 0===s||null===(s=s.find((e=>e.id===v.YE)))||void 0===s?void 0:s.value,Z=null===(a=_.options)||void 0===a||null===(a=a.find((e=>e.id===v.eH)))||void 0===a?void 0:a.value;if(!(k&&T&&F&&Z))return{error:{message:`Could not find required options for ${v.b0.StatusV2}.`}};const A="pointer"===c.type?1:2;if("complete_sprint"===e.type)return{value:[G({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:h,sprintUniqueIdPropertyId:I,spaceId:u}),E({getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintCollectionSchema:w,spaceId:u}),..."pointer"===c.type?[]:[q({createNextSprintActionId:b,getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintStatusNextOptionName:F,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})],Y({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:m,sprintStatusPastOptionName:k,sprintStatusPropertyId:M,spaceId:u}),Q({updateNextSprintToCurrentActionId:y,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:T,sprintStatusPropertyId:M,spaceId:u,nextSprintDateRange:p,sprintDatePropertyId:P}),z({createFutureSprintActionId:f,sprintCollectionPointer:h,sprintStatusFutureOptionName:Z,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I,incrementBy:A}),U({updateFutureSprintToNextActionId:S,sprintCollectionPointer:h,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:Z,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})]};if("complete_sprint_and_move_incomplete_tasks_to_next_sprint"===e.type){var R,V,B;const{taskCollectionValue:t}=e,o={id:t.id,table:K.v,spaceId:t.space_id},r=(0,N.ZP)(),i=null===(R=t.format)||void 0===R||null===(R=R.app_uri_map)||void 0===R?void 0:R[v.Es.Status];if(!i)return{error:{message:`${v.Es.Status} not found.`}};const n=null===(V=t.format)||void 0===V||null===(V=V.app_uri_map)||void 0===V?void 0:V[v.Es.TaskToSprintRelation];if(!n)return{error:{message:`${v.Es.TaskToSprintRelation} not found.`}};const s=(0,x.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${v.Es.Status} not found.`}};const a=null===(B=s.groups)||void 0===B||null===(B=B.find((e=>e.id===v.uS)))||void 0===B?void 0:B.name;return a?{value:[G({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:h,sprintUniqueIdPropertyId:I,spaceId:u}),E({getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintCollectionSchema:w,spaceId:u}),..."pointer"===c.type?[]:[q({createNextSprintActionId:b,getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintStatusNextOptionName:F,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})],H({moveIncompleteTasksActionId:r,createNextSprintActionId:b,nextSprintInput:c,taskCollectionPointer:o,taskStatusCompleteGroupName:a,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:n}),Y({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:m,sprintStatusPastOptionName:k,spaceId:u,sprintStatusPropertyId:M}),Q({updateNextSprintToCurrentActionId:y,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:T,spaceId:u,sprintStatusPropertyId:M,nextSprintDateRange:p,sprintDatePropertyId:P}),z({createFutureSprintActionId:f,sprintCollectionPointer:h,sprintStatusFutureOptionName:Z,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I,incrementBy:A}),U({updateFutureSprintToNextActionId:S,sprintCollectionPointer:h,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:Z,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})]}:{error:{message:`Could not find required group for ${v.Es.Status}.`}}}if("complete_sprint_and_move_incomplete_tasks_to_backlog"===e.type){var O,D,L;const{taskCollectionValue:t}=e,o={id:t.id,table:K.v,spaceId:t.space_id},r=(0,N.ZP)(),i=null===(O=t.format)||void 0===O||null===(O=O.app_uri_map)||void 0===O?void 0:O[v.Es.Status];if(!i)return{error:{message:`${v.Es.Status} not found.`}};const n=null===(D=t.format)||void 0===D||null===(D=D.app_uri_map)||void 0===D?void 0:D[v.Es.TaskToSprintRelation];if(!n)return{error:{message:`${v.Es.TaskToSprintRelation} not found.`}};const s=(0,x.oC)(t)[i];if(!s||"status"!==s.type)return{error:{message:`${v.Es.Status} not found.`}};const a=null===(L=s.groups)||void 0===L||null===(L=L.find((e=>e.id===v.uS)))||void 0===L?void 0:L.name;return a?{value:[G({getLargestUniqueIdSprintActionId:C,sprintCollectionPointer:h,sprintUniqueIdPropertyId:I,spaceId:u}),E({getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintCollectionSchema:w,spaceId:u}),..."pointer"===c.type?[]:[q({createNextSprintActionId:b,getCurrentSprintActionId:m,sprintCollectionPointer:h,sprintStatusNextOptionName:F,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})],$({moveIncompleteTasksToBacklogActionId:r,taskCollectionPointer:o,taskStatusCompleteGroupName:a,spaceId:u,taskStatusPropertyId:i,taskSprintRelationPropertyId:n}),Y({updateCurrentSprintToPastActionId:g,getCurrentSprintActionId:m,sprintStatusPastOptionName:k,spaceId:u,sprintStatusPropertyId:M}),Q({updateNextSprintToCurrentActionId:y,createNextSprintActionId:b,nextSprintInput:c,sprintStatusCurrentOptionName:T,spaceId:u,sprintStatusPropertyId:M,nextSprintDateRange:p,sprintDatePropertyId:P}),z({createFutureSprintActionId:f,sprintCollectionPointer:h,sprintStatusFutureOptionName:Z,getLargestUniqueIdSprintActionId:C,intl:d,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I,incrementBy:A}),U({updateFutureSprintToNextActionId:S,sprintCollectionPointer:h,sprintStatusNextOptionName:F,sprintStatusFutureOptionName:Z,spaceId:u,sprintStatusPropertyId:M,sprintUniqueIdPropertyId:I})]}:{error:{message:`Could not find required group for ${v.Es.Status}.`}}}return(0,j.t1)(e.type)}({type:e,sprintCollectionValue:t.sprintCollectionValue,taskCollectionValue:t.taskCollectionValue,nextSprintInput:F,nextSprintDateRange:O,intl:w});if(c.$Xl(M,{...(0,u.Pn)(s),action:"complete_sprint",currentSprintTaskSummary:d.currentSprintTaskSummary,completeSprintActionType:e,nextSprintDateRange:O,nextSprintInput:F}),le.x.isFail(r))throw new Error(r.error.message);await ue.oS({environment:M,store:t.blockStore,clientContext:{type:"structured_automation",persisted:!1,intl:w,parentRecordStore:t.blockStore,actions:r.value,parentPointer:t.blockStore.getSpaceShardedPointer()}}),p(),await Promise.all([de.dj(M,s,{src:"complete_sprint_automation",queuedTimestamp:Date.now()}),(0,se.Vs)(1e3)]),o(!1)}),[t,s,M,w,o,l,F,A,O,null==b?void 0:b.incompleteTaskCount,p,d.currentSprintTaskSummary]),X=We({isMobile:I}),{status:J}=(0,y.V)({value:d,validateLoaded:e=>!1===e.isLoading,waitTimeInMs:1*ce.hM});if("pending"!==J&&d.isLoading)return(0,Re.jsx)(Le,{titleAriaId:h,onDismiss:l,sprintCollectionStore:m});if(d.isLoading)return(0,Re.jsx)(Ke,{titleAriaId:h,onDismiss:l});const{incompleteTaskCount:ee}=d.currentSprintTaskSummary,oe=Boolean(F)&&Boolean(O),re=void 0!==D&&D.length>0;return(0,Re.jsxs)("div",{style:X.modalContainer,children:[(0,Re.jsx)("div",{style:X.header,id:h,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.title",defaultMessage:"{sprintName} summary",values:{sprintName:k}})}),(0,Re.jsx)(qe,{currentSprintFormattedDateRange:T,currentSprintTaskSummary:b}),re&&(0,Re.jsxs)("div",{style:X.flexRow,children:[w.formatMessage(Oe.selectNextSprintLabel),(0,Re.jsx)(Ye,{nextSprintInput:F,setNextSprintInput:Z,completeSprintAutomationContext:t,sprintPageIds:D})]}),(0,Re.jsxs)("div",{style:X.flexRow,children:[re?w.formatMessage(Oe.selectDatesForNextSprintLabel):w.formatMessage(Oe.nextSprintDatesLabel),(0,Re.jsx)(Xe,{sprintDateRange:V,setSprintDateRange:B})]}),ee>0&&(0,Re.jsxs)("div",{style:X.flexRow,children:[(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksLabel",defaultMessage:"{incompleteTaskCount, plural, one {{incompleteTaskCount} incomplete task} other {{incompleteTaskCount} incomplete tasks}}",values:{incompleteTaskCount:ee}}),(0,Re.jsx)(Ue,{actionTypeStore:A})]}),(0,Re.jsx)(ve.Z,{disabled:!oe,onClick:()=>{W()},style:X.button,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButton",defaultMessage:"Complete {sprintName}",values:{sprintName:k}})}),(0,Re.jsx)(Pe.Z,{onClick:()=>l({clickedCancel:!0}),style:X.button,children:w.formatMessage(Oe.cancelButton)})]})}function Le(e){window.__c={n:"MissingCurrentSprintError"};const{onDismiss:t,sprintCollectionStore:o,titleAriaId:r}=e,s=(0,i.O7)(),l=(0,a.useIntl)(),{isMobile:c}=(0,i.Fy)(),d=(0,n.VK)((()=>o.getParentBlockStore()),[o]),p=We({isMobile:c});return(0,Re.jsxs)("div",{style:p.modalContainer,children:[(0,Re.jsx)("div",{style:p.header,id:r,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.title",defaultMessage:"No current sprint found"})}),(0,Re.jsx)(ve.Z,{onClick:()=>{d&&pe.navigateToBlock({environment:s,store:d,pageVisitSource:f.tY.LinkInPage})},style:{...p.button,marginTop:24},children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.missingCurrentSprint.navigateToSprintsDatabase",defaultMessage:"Fix in Sprints database"})}),(0,Re.jsx)(Pe.Z,{onClick:t,style:p.button,children:l.formatMessage(Oe.cancelButton)})]})}function Ke(e){window.__c={n:"LoadingStatePlaceholder"};const{onDismiss:t,titleAriaId:o}=e,r=(0,a.useIntl)(),{isMobile:n}=(0,i.Fy)(),s=We({isMobile:n});return(0,Re.jsxs)("div",{style:s.modalContainer,children:[(0,Re.jsx)("div",{style:s.header,id:o,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.titlePlaceholder",defaultMessage:"Sprint summary"})}),(0,Re.jsx)("div",{style:s.subheader,children:(0,Re.jsx)(we.Z,{style:s.subheaderShimmer})}),(0,Re.jsxs)("div",{style:s.flexRow,children:[r.formatMessage(Oe.selectNextSprintLabel),(0,Re.jsx)(we.Z,{style:s.flexRowShimmerBox1})]}),(0,Re.jsxs)("div",{style:s.flexRow,children:[r.formatMessage(Oe.selectDatesForNextSprintLabel),(0,Re.jsx)(we.Z,{style:s.flexRowShimmerBox2})]}),(0,Re.jsxs)("div",{style:s.flexRow,children:[(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.incompleteTasksPlaceholder",defaultMessage:"Incomplete tasks"}),(0,Re.jsx)(we.Z,{style:s.flexRowShimmerBox3})]}),(0,Re.jsx)(ve.Z,{disabled:!0,onClick:()=>{},style:s.button,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.completeSprintButtonPlaceholder",defaultMessage:"Complete sprint"})}),(0,Re.jsx)(Pe.Z,{onClick:t,style:s.button,children:r.formatMessage(Oe.cancelButton)})]})}function We(e){let{isMobile:t}=e;return(0,s.yK)((e=>{const o={height:44,borderRadius:8,display:"flex",alignItems:"center",width:void 0},r={...o,marginTop:12,marginBottom:18};return{modalContainer:{width:400,display:"flex",fontSize:t?l.Z.fontSize.UIRegular.mobile:l.Z.fontSize.UIRegular.desktop,flexDirection:"column",justifyContent:"center",padding:20},header:{display:"flex",alignItems:"center",justifyContent:"center",fontSize:t?18:16,fontWeight:l.Z.fontWeight.semibold},subheader:{display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,marginBottom:16,gap:8},separator:{height:2,width:2,borderRadius:2,backgroundColor:e.lightIconColor},flexRow:{display:"flex",...t?{flexDirection:"column",fontSize:14,color:e.mediumTextColor}:{justifyContent:"space-between",alignItems:"center",height:24,marginBottom:16}},completedTaskGroup:{display:"flex",gap:4},button:{display:"flex",alignItems:"center",justifyContent:"center",marginTop:8,...t&&o},subheaderShimmer:{borderRadius:3,marginTop:6,width:200,height:16,...t&&{height:22}},flexRowShimmerBox1:{borderRadius:3,width:60,height:16,...t&&r},flexRowShimmerBox2:{borderRadius:3,width:80,height:16,...t&&r},flexRowShimmerBox3:{borderRadius:3,width:140,height:16,...t&&r},dropdownButton:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:4,...t&&{...r,border:`1px solid ${e.accentColors.gray[50]}`,justifyContent:"space-between"}},dropdownChevronIcon:{color:e.lightIconColor,width:12,height:"auto"}}}),[t])}function qe(e){window.__c={n:"SprintSummarySubheader"};const{currentSprintFormattedDateRange:t,currentSprintTaskSummary:o}=e,{isMobile:r}=(0,i.Fy)(),n=(0,a.useIntl)(),s=We({isMobile:r}),l=o?n.formatMessage(Oe.completedPercentSummary,{completedTaskCount:o.completedTaskCount,totalTaskCount:o.totalTaskCount}):void 0,c=t&&o?(0,Re.jsxs)(Re.Fragment,{children:[t,(0,Re.jsx)("div",{style:s.separator}),l]}):t||l;return void 0===c?null:(0,Re.jsx)("div",{style:s.subheader,children:c})}function Ee(e){const{sprintBlockStore:t,sprintCollectionStore:o}=e;if(!t)return;const r=o.getPropertyMapping(),i=null==r?void 0:r[v.b0.Dates];if(!i)return;const n=t.getPropertyValue(i);if(!n)return;const s=(0,M.nai)(n)[0];return s?(0,te.Ls)(s):void 0}function Ge(e){const{sprintDateRange:t,intl:o}=e;if(t&&(0,te.h)(t))return(0,oe.ZV)({value:t,allowRelativeDates:!1,shortenDateAndRange:!0,displayInUserTimezone:!0,intl:o})}const ze={complete_sprint_and_move_incomplete_tasks_to_next_sprint:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToNextSprintOption",defaultMessage:"Move to next sprint"}),complete_sprint_and_move_incomplete_tasks_to_backlog:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.moveToBacklogOption",defaultMessage:"Move to backlog"}),complete_sprint:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.keepInThisSprintOption",defaultMessage:"Keep in current sprint"})};function Ue(e){window.__c={n:"SelectIncompleteTaskAutomationPopupButton"};const{actionTypeStore:t}=e,{isMobile:o}=(0,i.Fy)(),r=(0,n.VK)((()=>t.state),[t]),s=We({isMobile:o});return(0,Re.jsx)(be.ZP,{popupType:o?be.Z4.SlideUp:be.Z4.Popup,alignmentToOrigin:be.vR.Start,placementToOrigin:be.pO.Bottom,render:e=>(0,Re.jsx)($e,{actionTypeStore:t,buttonPopupParent:e}),renderOrigin:e=>(0,Re.jsxs)(Pe.Z,{...e,style:s.dropdownButton,children:[ze[r],(0,ie.i)(s.dropdownChevronIcon)]})})}const He=["complete_sprint_and_move_incomplete_tasks_to_next_sprint","complete_sprint_and_move_incomplete_tasks_to_backlog","complete_sprint"];function $e(e){window.__c={n:"AutomationActionOptionsMenu"};const{actionTypeStore:t,buttonPopupParent:o}=e,{isMobile:r}=(0,i.Fy)(),a=(0,s.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4}})),[]),l=(0,n.VK)((()=>He.map((e=>{const r=e===t.state;return{key:e,action:()=>{t.setState(e),o.close()},render:t=>(0,Re.jsx)(Ce.Z,{...t,title:ze[e],right:r&&(0,re.e)(a.checkIcon)})}}))),[t,a.checkIcon,o]);let c;return c=r?{menuType:he.og.ActionSheet}:{menuType:he.og.Popup,maxHeight:"50vh",minWidth:230},(0,Re.jsx)(Me.Z,{...c,children:(0,Re.jsx)(je.Z,{type:je.i.Vertical,initialFocus:0,sections:[{key:"sprint_automations",items:l,render:e=>(0,Re.jsx)(Te.Z,{...e})}]})})}function Ye(e){window.__c={n:"SelectSprintPopupButton"};const{nextSprintInput:t,completeSprintAutomationContext:o,setNextSprintInput:r,sprintPageIds:l}=e,{sprintCollectionStore:c}=o,{isMobile:d}=(0,i.Fy)(),p=(0,i.O7)(),u=(0,a.useIntl)(),h=(0,n.VK)((()=>{if(void 0===t)return(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.empty",defaultMessage:"Select sprint"});if("actionId"===t.type)return(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSelect.newSprint",defaultMessage:"New sprint"});if("pointer"===t.type){const e=Se.G.createChildStore(c,t.pointer);return(0,me.vU)({intl:u,environment:p,store:e,untitledFallback:Oe.fallbackSprintName})}(0,j.t1)(t)}),[t,u,c,p]),m=We({isMobile:d}),g=(0,s.yK)((e=>({button:{...void 0===t&&{color:e.lightTextColor}}})),[t]),y={...m.dropdownButton,...g.button};return 0===l.length||1===l.length?(0,Re.jsx)(Pe.Z,{style:y,disabled:!0,children:h}):(0,Re.jsx)(be.ZP,{popupType:d?be.Z4.SlideUp:be.Z4.Popup,alignmentToOrigin:be.vR.Start,placementToOrigin:be.pO.Bottom,render:e=>(0,Re.jsx)(Qe,{buttonPopupParent:e,completeSprintAutomationContext:o,sprintPageIds:l,nextSprintInput:t,setNextSprintInput:r}),renderOrigin:e=>(0,Re.jsxs)(Pe.Z,{...e,style:y,children:[h,(0,ie.i)(m.dropdownChevronIcon)]})})}function Qe(e){window.__c={n:"SelectSprintDropdown"};const{sprintPageIds:t,completeSprintAutomationContext:o,buttonPopupParent:l,nextSprintInput:c,setNextSprintInput:d}=e,{sprintCollectionStore:p}=o,{isMobile:u}=(0,i.Fy)(),h=(0,n.VK)((()=>p.getSpaceId()),[p]),m=(0,n.VK)((()=>(0,ge.U1)({collectionStore:o.taskCollectionStore,property:v.Es.TaskToSprintRelation}).filter((e=>e.visible&&("title"===e.property||o.sprintCollectionSchema[e.property])))),[o]),g=(0,n.VK)((()=>new ye.Z),[]),y=(0,s.yK)((e=>({checkIcon:{color:e.lightIconColor,width:12,height:"auto",marginLeft:4},plusIcon:{color:e.lightIconColor,width:12,height:"auto"},createSprintRow:{display:"flex",gap:4},sprintRow:{display:"flex",maxHeight:22,alignItems:"center"},recordTitle:{...u&&{marginRight:12}}})),[u]),S="purple",f=(0,s.Fg)(),x=(0,J.KR)(f,S),b=r.useMemo((()=>{const e="actionId"===(null==c?void 0:c.type);return{key:"new_sprint",action:()=>{d({type:"actionId"}),l.close()},render:t=>(0,Re.jsx)(Ce.Z,{...t,icon:(0,ne.R)(y.plusIcon),title:(0,Re.jsxs)("div",{style:y.createSprintRow,children:[(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNew",defaultMessage:"New sprint"}),(0,Re.jsx)(Be.Z,{isRound:!0,showRemoveButton:!1,value:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.selectSprintDropdown.createNewToken",defaultMessage:"Next"}),format:ee.l.Medium,isSingle:!0,color:x.textColor,backgroundColor:x.backgroundColor,showColoredDot:S})]}),right:e&&(0,re.e)(y.checkIcon)})}}),[c,l,d,y,x]),w=(0,n.VK)((()=>t.map((e=>{const t={id:e,table:C.iU,spaceId:h},o=Se.G.createChildStore(p,t),r=o.getIcon(),i="pointer"===(null==c?void 0:c.type)&&ae.dr.isEqual(c.pointer,t);return{key:e,action:()=>{d({type:"pointer",pointer:t}),l.close()},render:e=>(0,Re.jsx)(Ce.Z,{...e,icon:r&&(0,Re.jsx)(_e.Z,{disabled:!0,icon:r,isEmptyPage:!1,size:20}),title:(0,Re.jsx)("div",{style:y.sprintRow,children:m.map((e=>"title"===e.property?(0,Re.jsx)(ke.Z,{store:o,style:y.recordTitle},"title"):(0,Re.jsx)(fe.Z,{store:o,property:e.property,disabled:!1,locked:!1,format:xe.C.Relation,tableWrap:!1,blockPropertyValueOverlayStore:g,collectionStore:p},e.property))).filter(j.$K)}),right:i&&(0,re.e)(y.checkIcon)})}}))),[p,g,l,c,m,h,d,y,t]),M=[{key:"sprints",items:r.useMemo((()=>w.length>0?w:[b]),[w,b]),render:e=>(0,Re.jsx)(Te.Z,{...e})}];let I;return I=u?{menuType:he.og.ActionSheet}:{menuType:he.og.Popup,maxHeight:"50vh",minWidth:230},(0,Re.jsx)(Me.Z,{...I,children:(0,Re.jsx)(je.Z,{type:je.i.Vertical,initialFocus:0,sections:M})})}function Xe(e){window.__c={n:"SelectNextSprintDate"};const{sprintDateRange:t,setSprintDateRange:o}=e,l=(0,a.useIntl)(),{isMobile:c}=(0,i.Fy)(),d=r.useMemo((()=>Ge({sprintDateRange:t,intl:l})),[t,l]),p=We({isMobile:c}),u=(0,s.yK)((e=>({button:{...!d&&{color:e.lightTextColor}}})),[d]),h=(0,n.VK)((()=>d||(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.nextSprintDate.placeholder",defaultMessage:"Select dates"})),[d]);return(0,Re.jsx)(be.ZP,{popupType:c?be.Z4.SlideUp:be.Z4.Popup,alignmentToOrigin:be.vR.Start,placementToOrigin:be.pO.Bottom,render:e=>(0,Re.jsx)(Je,{sprintDateRange:t,setSprintDateRange:o,onDismiss:()=>{e.close()}}),renderOrigin:e=>(0,Re.jsxs)(Pe.Z,{...e,style:{...p.dropdownButton,...u.button},children:[h,(0,ie.i)(p.dropdownChevronIcon)]})})}function Je(e){window.__c={n:"SprintDateRangePicker"};const{sprintDateRange:t,setSprintDateRange:o,onDismiss:n}=e,{isMobile:s}=(0,i.Fy)(),l=r.useMemo((()=>({starting:null!=t&&t.start_date?{type:"date",start_date:t.start_date}:void 0,ending:null!=t&&t.end_date?{type:"date",start_date:t.end_date}:void 0})),[t]);let c;return c=s?{menuType:he.og.Modal,right:(0,Re.jsx)(Ie.DoneMenuText,{}),onClickRight:n}:{menuType:he.og.Popup,maxHeight:"50vh",paddingTop:6},(0,Re.jsxs)(Me.Z,{...c,children:[(0,Re.jsx)(Te.Z,{children:(0,Re.jsx)(Fe.Z,{title:void 0,disableMenuWrap:!0,allowRelativeRangeFilter:!0,value:l,onUpdate:e=>{var t,r;if(e.error)return;const i={...l,...e.value},n=null===(t=i.starting)||void 0===t?void 0:t.start_date,s=null===(r=i.ending)||void 0===r?void 0:r.start_date;o({type:"daterange",start_date:n,end_date:s})},onDismiss:n})}),(0,Re.jsx)(Te.Z,{topBorder:!0,children:(0,Re.jsx)(Ce.Z,{focused:!1,onClick:()=>{o(void 0)},title:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintModal.sprintSummary.datePicker.clear",defaultMessage:"Clear"})})})]})}var et=o(42875),tt=o(59054),ot=o(54642),rt=o(88990);function it(e){if(!e)return;const t=e.getPropertyMapping(),o=null==t?void 0:t[v.Es.TaskToSprintRelation];if(!o)return;return rt.Ws.filter.property=o,{...rt.Ws.filter,property:o}}class nt extends S.default{getInitialState(){return{isLoading:!0,currentSprintId:void 0,querySprintsResult:void 0,currentSprintTaskSummary:void 0}}updateCurrentSprint(e){const{querySprintsResult:t,currentSprintTaskSummary:o}=this.state;void 0!==e&&void 0!==t&&void 0!==o?this.setState({isLoading:!1,currentSprintId:e,querySprintsResult:t,currentSprintTaskSummary:o}):e?this.setState({...this.state,currentSprintId:e}):this.setState({...this.state,isLoading:!0,currentSprintId:e})}updateNextAndFutureSprints(e){const{currentSprintId:t,currentSprintTaskSummary:o}=this.state;void 0!==t&&void 0!==e&&void 0!==o?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:e,currentSprintTaskSummary:o}):e?this.setState({...this.state,querySprintsResult:e}):this.setState({...this.state,isLoading:!0,querySprintsResult:e})}updateCurrentSprintTaskSummary(e){const{currentSprintId:t,querySprintsResult:o}=this.state;void 0!==t&&void 0!==o&&void 0!==e?this.setState({isLoading:!1,currentSprintId:t,querySprintsResult:o,currentSprintTaskSummary:e}):e?this.setState({...this.state,currentSprintTaskSummary:e}):this.setState({...this.state,isLoading:!0,currentSprintTaskSummary:e})}}const st=nt;function at(e){window.__c={n:"CompleteSprintAutomationButtonLoader"};const{taskCollectionContextStore:t,completeSprintAutomationContext:o,children:s,isModalOpen:a}=e,{sprintCollectionStore:l}=o,c=l.id,d=(0,i.O7)(),p=(0,n.VK)((()=>new st),[]),u=(0,n.VK)((()=>p.state),[p]),h=(0,n.VK)((()=>{var e;const o=t.relativeVariableStore.state;return null==o||null===(e=o[c])||void 0===e?void 0:e.current}),[c,t]);r.useEffect((()=>{p.updateCurrentSprint(h)}),[h,p]);const[{value:m}]=(0,tt.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:r}=e,{sprintCollectionStore:i}=r,n=function(e){var t,o;const{sprintCollectionStore:r,sprintCollectionSchema:i}=e,n=r.getPropertyMapping(),s=null==n?void 0:n[v.b0.StatusV2];if(!s)return;const a=i[s];if(!a||"status"!==a.type)return;const l=null===(t=a.options)||void 0===t||null===(t=t.find((e=>e.id===v.YE)))||void 0===t?void 0:t.value,c=null===(o=a.options)||void 0===o||null===(o=o.find((e=>e.id===v.eH)))||void 0===o?void 0:o.value;if(!l||!c)return;const d=L.qB[v.p$].next.reducer.getCombinatorFilter(i);if(!d)return;const p={type:"results",filter:d,limit:5},u={type:"results",filter:{operator:"and",filters:[{property:s,filter:{operator:"status_is",value:{type:"is_option",value:c}}}]},limit:5};return{[v.YE]:p,[v.eH]:u}}(r),s=i.getPropertyMapping(),a=null==s?void 0:s[v.b0.Dates],l=null==s?void 0:s[v.b0.UniqueId];if(!n||!a||!l)return;const c={type:"reducer",userId:o.currentUser.id,userTimeZone:(0,et.r)(),searchQuery:void 0,sort:[{property:a,direction:"ascending"},{property:l,direction:"ascending"}],reducers:n},d=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],p=i.getSpaceId();if(!d)return;const u=await ot.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:p},collectionView:{id:d.id,spaceId:p},loader:c},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==u.type)return;const h=u.data.result.reducerResults[v.YE],m=u.data.result.reducerResults[v.eH];if("results"!==h.type||"results"!==m.type)return;const g=h.blockIds,y=m.blockIds;return{nextSprintIds:g,futureSprintIds:y}}({environment:d,completeSprintAutomationContext:o})),[h,d,o]);r.useEffect((()=>{p.updateNextAndFutureSprints(m)}),[m,p]);const[{value:g}]=(0,tt.r5)((async()=>await async function(e){var t;const{environment:o,completeSprintAutomationContext:r}=e,{taskCollectionStore:i}=r,n=function(e){var t;if(!e)return;const o=e.getPropertyMapping(),r=it(e);if(!r)return;const i=null==o?void 0:o[v.Es.Status];if(!i)return;const n=e.getSchema()[i];if(!n||"status"!==n.type)return;const s=null===(t=n.groups)||void 0===t||null===(t=t.find((e=>(null==e?void 0:e.id)===v.uS)))||void 0===t?void 0:t.name;return s?{type:"aggregation",filter:{operator:"and",filters:[r]},aggregation:{aggregator:{operator:"count_per_group",groupName:s},property:i}}:void 0}(i);if(!n)return;const s=it(i);if(!s)return;const a={type:"reducer",filter:{operator:"and",filters:[s]},userId:o.currentUser.id,userTimeZone:(0,et.r)(),searchQuery:"",sort:[],reducers:{completed_tasks_in_current_sprint:n}},l=null===(t=i.getParentBlockStore())||void 0===t?void 0:t.getCollectionViewStores()[0],c=i.getSpaceId();if(!l)return;const d=await ot.queryCollection(o,{source:{type:"collection",id:i.id,spaceId:c},collectionView:{id:l.id,spaceId:c},loader:a},void 0,{src:"complete_sprint_modal_sprint_picker"});if("success"!==d.type)return;return function(e){if(!e)return;if("aggregation"!==e.type)return;if("text"!==e.aggregationResult.type)return;const t=e.aggregationResult.value,o=null==t?void 0:t.split("/");if(!o||2!==o.length)return;const r=Number(o[0]),i=Number(o[1]);return{completedTaskCount:r,incompleteTaskCount:i-r,totalTaskCount:i,completedTaskPercent:0===i?0:r/i}}(d.data.result.reducerResults.completed_tasks_in_current_sprint)}({environment:d,completeSprintAutomationContext:o})),[h,d,o,a]);return r.useEffect((()=>{p.updateCurrentSprintTaskSummary(g)}),[g,p]),(0,Re.jsx)(Re.Fragment,{children:s({completeSprintAutomationState:u,onAutomationComplete:()=>{p.reset()}})})}var lt=o(56247);function ct(e){const{percentage:t}=e;return(0,Re.jsx)(lt.b,{numberValue:t,numberFormat:void 0,numberShowAs:{type:"ring",maxValue:1,color:"blue",showValue:!1},shouldRenderTooltip:!1,progressSize:15})}var dt=o(68785),pt=o(63296);function ut(e){window.__c={n:"CompleteSprintAutomationButton"};const{collectionContextStore:t,completeSprintAutomationContext:o}=e,s=(0,i.O7)(),[a,l]=r.useState(!1),[p,g]=r.useState(!1),y=r.useCallback((()=>{g(!1)}),[g]),S=(0,n.VK)((()=>m.default.state.currentUserSettingsStore),[]),f=()=>{g(!0);"complete-sprint-button-tooltip"===(0,h.wF)(S,"sprints-onboarding")&&d.tutorialGoToNextStep(s,"sprints-onboarding"),c.$Xl(s,{...(0,u.Pn)(t),action:"open_modal"})};return(0,Re.jsx)(at,{completeSprintAutomationContext:o,taskCollectionContextStore:t,isModalOpen:p,children:e=>{let{completeSprintAutomationState:r,onAutomationComplete:i}=e;return(0,Re.jsxs)(Re.Fragment,{children:[(0,Re.jsx)(De,{completeSprintAutomationContext:o,isOpen:p,onDismiss:y,setIsLoading:l,taskCollectionContextStore:t,completeSprintAutomationState:r,onAutomationComplete:i}),(0,Re.jsx)(ht,{taskCollectionContextStore:t,onClick:f,isLoading:a,currentSprintTasksInView:r.currentSprintTaskSummary})]})}})}function ht(e){window.__c={n:"SprintSummaryAndButton"};const{currentSprintTasksInView:t,taskCollectionContextStore:o,onClick:c,isLoading:d}=e,{isPhone:u}=(0,i.Fy)(),h=r.useRef(null),y=(0,n.VK)((()=>(0,p.Nq)(o)),[o]),S=function(e){const{isPhone:t}=e;return(0,s.yK)((e=>({icon:{fill:e.accentColors.blue[400]},button:{height:26,marginLeft:8,fontWeight:l.Z.fontWeight.medium,...t&&{flexGrow:1,borderRadius:8,height:44}},summary:{color:e.lightTextColor,fontSize:t?l.Z.fontSize.UIRegular.mobile:l.Z.fontSize.UIRegular.desktop,fontWeight:l.Z.fontWeight.regular,whiteSpace:"nowrap"}})),[t])}({isPhone:u}),f=(0,n.VK)((()=>o.collectionViewBlockStore()),[o]),x=(0,n.VK)((()=>m.default.state.currentSpaceStore),[]);if(!f)return(0,Re.jsx)(Re.Fragment,{});const v=f.getSpaceId()===(null==x?void 0:x.id);return(0,Re.jsxs)(Re.Fragment,{children:[!y&&t&&!u&&(0,Re.jsx)("div",{style:S.summary,children:(0,Re.jsx)(a.FormattedMessage,{id:"completeAutomationSprintAutomation.inlineSummary.completedPercentSummary",defaultMessage:"{completedTaskCount} / {totalTaskCount} tasks",values:{completedTaskCount:t.completedTaskCount,totalTaskCount:t.totalTaskCount}})}),(0,Re.jsx)(pt.Z,{ref:h,onClick:c,iconStyle:S.icon,icon:mt({isLoading:d,taskSummary:t}),style:S.button,disabled:d,disabledFeedback:d,children:(0,Re.jsx)(a.FormattedMessage,{defaultMessage:"Complete sprint",id:"completeSprintAutomationButton.label"})}),v&&(0,Re.jsx)(g.Yy,{origin:h})]})}function mt(e){const{isLoading:t,taskSummary:o}=e;if(t)return e=>(0,Re.jsx)("div",{style:e,children:(0,Re.jsx)(dt.Z,{})});const r=o?o.completedTaskPercent:0;return e=>(0,Re.jsx)("div",{style:e,children:(0,Re.jsx)(ct,{percentage:r})})}},41389:(e,t,o)=>{o.r(t),o.d(t,{default:()=>ie});o(21703);var r=o(67294),i=o(83355),n=o(99036),s=o(8848),a=o(84682),l=o(18955),c=o(91905),d=o(42875),p=o(72126),u=o(82990),h=o(5366),m=o(50906),g=o(62134),y=o(66890),S=o(75079),f=o(87279),x=o(18514),v=o(77907),C=o(34859),b=o(80444),w=o(49085);class M extends w.default{getInitialState(){return{value:"",html:"",query:""}}}const j=M;var I=o(29798),P=o(48019),_=o(78140),k=o(40721),T=o(53336),F=o(72495),Z=o(13991),A=o(76725),R=o(85893);class V extends i.Z{renderDescription(){const{entry:e}=this.props;if(e){const{descriptionMessage:t,fallbackDescription:o}=e;if(t)return(0,R.jsx)(h.FormattedMessage,{...t});if(o)return o}return null}renderComponent(){const{entry:e}=this.props;if(e){const{name:t,examples:o}=e,r=(0,l.EP)(this.props.Prism,(o||[]).join("\n")),i=this.renderSyntax();return(0,R.jsxs)("div",{children:[(0,R.jsx)("h1",{style:V.headerStyle,children:t}),(0,R.jsx)("p",{style:V.textStyle,children:this.renderDescription()}),(0,R.jsx)("p",{style:V.textStyle,children:(0,R.jsx)("b",{children:(0,R.jsx)(h.FormattedMessage,{id:"database.formula.syntaxSection.title",defaultMessage:"Syntax"})})}),(0,R.jsx)("pre",{style:this.getCodeStyle(),children:(0,A.Z)(i,(e=>(0,R.jsx)("br",{},`sep:${e}`)))}),o&&o.length>0&&(0,R.jsx)("p",{style:V.textStyle,children:(0,R.jsx)("b",{children:(0,R.jsx)(h.FormattedMessage,{id:"database.formula.examplesSection.title",defaultMessage:"Examples"})})}),(0,R.jsx)("pre",{style:this.getCodeStyle(),dangerouslySetInnerHTML:{__html:r}})]})}return(0,R.jsx)("div",{})}renderSyntax(){const{entry:e}=this.props;if(!e)return[];const{name:t,category:o}=e;return o===c.WD.property?[(0,R.jsxs)("span",{children:["prop(",JSON.stringify(t),")"]},0)]:o===c.WD.constant?[(0,R.jsx)("span",{children:t},0)]:o===c.WD.function?this.getFunctionSyntax(e):o===c.WD.operator?this.getOperatorSyntax(e):[]}getFunctionSyntax(e){const{name:t}=e;return V.getSignatureNames(e).map(((e,o)=>{let{variadic:r,arity:i}=e;return r?(0,R.jsxs)("span",{children:[t,"(",(0,R.jsx)("i",{children:r}),"...)"]},o):(0,R.jsxs)("span",{children:[t,"(",(0,A.Z)(i.map(((e,t)=>(0,R.jsx)("i",{children:e},t))),(e=>(0,R.jsxs)("span",{children:[","," "]},`sep:${e}`))),")"]},o)}))}getOperatorSyntax(e){const{operator:t}=e;return p.oA(V.getSignatureNames(e).map(((e,o)=>{let{arity:r}=e;if(1===r.length){const[e]=r;return(0,R.jsxs)("span",{children:[t," ",(0,R.jsx)("i",{children:e})]},-o-1)}if(2===r.length){const[e,i]=r;return(0,R.jsxs)("span",{children:[(0,R.jsx)("i",{children:e})," ",t," ",(0,R.jsx)("i",{children:i})]},-o-1)}if(3===r.length){const[e,t,i]=r;return(0,R.jsxs)("span",{children:[(0,R.jsx)("i",{children:e})," ","? ",(0,R.jsx)("i",{children:t})," ",": ",(0,R.jsx)("i",{children:i})]},-o-1)}})).concat(this.getFunctionSyntax(e)))}static getSignatureNames(e){const{name:t,signatures:o}=e;return"if"===t?[{arity:["boolean","value","value"]}]:"format"===t||"unaryPlus"===t?[{arity:["value"]}]:"equal"===t||"unequal"===t?[{arity:["value","value"]}]:o.map((e=>{let{arity:t,variadic:o}=e;return{variadic:o?V.typeNameMap[o]:void 0,arity:t?p.oA(t.map((e=>V.typeNameMap[e]))):[]}}))}getCodeStyle(){return{paddingTop:6,paddingBottom:8,paddingLeft:10,paddingRight:10,overflowX:"scroll",background:this.theme.sidebarBackground,borderRadius:3,fontSize:13,margin:0,fontFamily:u.Z.getCompositeFontFamily(Z.SP).mono,lineHeight:1.4}}}V.displayName="FormulaDocumentation",V.typeNameMap={checkbox:"boolean",number:"number",text:"text",date:"date"},V.headerStyle={fontSize:20,margin:0,lineHeight:1,marginTop:4,marginBottom:12},V.textStyle={whiteSpace:"normal",marginTop:8,marginBottom:8,fontSize:13,lineHeight:1.4};const B=(0,v.withDependency)(v.deps.prismjs,((e,t)=>(0,R.jsx)(V,{...t,Prism:e})));var O=o(39068),D=o(56505),N=o(64921),L=o(52275),K=o(31945),W=o(28992);class q extends i.Z{renderComponent(){const{entry:{name:e}}=this.props;return(0,R.jsx)(L.Z,{focused:this.props.focused,onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,icon:(0,R.jsx)("div",{style:{...O.f,...this.environment.device.isMobile&&{marginLeft:14}},children:this.renderPropertyIcon()}),title:e,right:this.renderDocumentationButtonPopup(),style:{...!this.environment.device.isMobile&&{paddingLeft:8,paddingRight:8}},desktopIconStyle:{marginLeft:0}})}renderDocumentationButtonPopup(){const{device:e}=this.environment;if(this.environment.device.isMobile)return(0,R.jsx)(K.ZP,{popupType:e.isMobile?K.Z4.SlideUp:K.Z4.Popup,renderOrigin:e=>(0,R.jsx)(N.Z,{mobileFeedback:!0,style:{width:16,height:16},...e,children:(0,D.S)({fill:this.theme.mediumIconColor})}),render:t=>{let o;return o=e.isMobile?{menuType:f.og.Modal,title:(0,R.jsx)(h.FormattedMessage,{defaultMessage:"Documentation",id:"database.formulaPropertyEntryMenuItem.title"}),right:(0,R.jsx)(k.DoneMenuText,{}),onClickRight:t.close}:{menuType:f.og.Popup},(0,R.jsx)(_.Z,{...o,children:(0,R.jsx)(F.Z,{children:(0,R.jsx)(W.Z,{title:(0,R.jsx)(B,{entry:this.props.entry}),style:{paddingTop:10,paddingBottom:16}})})})}})}renderPropertyIcon(){const{entry:e}=this.props,{theme:t}=this;if(e.category===c.WD.property||e.category===c.WD.constant){const{resultType:o}=e;return(0,R.jsx)(O.ZP,{type:o,icon:void 0,size:16,theme:t})}if(e.category===c.WD.function||e.category===c.WD.operator){const{signatures:[{resultType:o}]}=e;return(0,R.jsx)(O.ZP,{type:o,icon:void 0,size:16,theme:t})}}}q.displayName="FormulaEntryMenuItem",q.contextTypes={...f.mw,...i.w};const E=q;var G=o(63143),z=o(52821),U=o(45023),H=o(33929),$=o(89224),Y=o(42922),Q=o(3386),X=o(26388);const J=(0,h.defineMessages)({placeholder:{id:"database.formula.placeholder",defaultMessage:"Type a formula"}});class ee extends i.Z{constructor(){super(...arguments),this.updateTimer=void 0,this.latestSelectionRange=void 0,this.storeTypes={store:j},this.handleSelectionChange=()=>{const e=$.get();e&&this.input.contains(e.commonAncestorContainer)&&(this.latestSelectionRange=e)},this.handleInputMount=e=>this.input=e,this.handleInput=e=>{const{target:{textContent:t}}=e;this.updateValue(t),G.z4(this.updateTimer)&&(this.updateTimer=window.setTimeout((()=>this.executeUpdate()),ee.delay))},this.handlePaste=e=>{e.preventDefault();const t=e.clipboardData.getData("text/plain");document.execCommand("insertText",!1,t)},this.handleKeyUp=e=>{this.updateSelection()},this.handleClick=e=>{this.updateSelection()},this.handleKeyDown=e=>{(0,U.Z)(this.environment,e,"command+enter")&&(this.handleAccept(),e.stopPropagation())},this.getStyle=()=>({flexGrow:1,position:"relative",minWidth:0,...this.props.inputContainerStyle})}insertEntry(e){var t,o;const{value:r}=this.stores.store.state,{name:i}=e,n=ee.getCompletion(e),s=(null===(t=this.latestSelectionRange)||void 0===t?void 0:t.startOffset)??0;let a=s,c=(null===(o=this.latestSelectionRange)||void 0===o?void 0:o.endOffset)??0;const d=l.wo(r,s);if(d){const[e,t]=d,o=r.slice(e,t).toLowerCase();o!==n.toLowerCase().slice(0,t-e)&&o!==i.toLowerCase().slice(0,t-e)||(a=e,c=t)}this.input.focus();const p=this.input.firstChild||this.input,u=document.createRange();u.setStart(p,a),u.setEnd(p,c),$.set(u,this.environment.device),a<c&&document.execCommand("delete",!1),document.execCommand("insertText",!1,n);const h=(c+n.length)/(this.input&&this.input.textContent&&this.input.textContent.length||0)*this.container.scrollWidth;h>this.container.scrollLeft+this.container.offsetWidth&&(this.container.scrollLeft=h-this.container.offsetWidth)}handleAccept(){this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=void 0);const{value:e}=this.stores.store.state;if(""===e.trim())this.props.onSubmit();else{const{formula:t,error:o}=this.updateFormula(e);o||this.props.onSubmit(t)}}willMount(e){super.willMount(e);const{formula:t,schema:o}=e,r=this.props.formulaStringHelpers.formulaToString(t,o);this.updateValue(r)}didMount(){const{device:e}=this.environment,{value:t}=this.stores.store.state;if(this.input&&(this.input.textContent=t,e.isMobile||this.input.focus(),t)){const e=document.getSelection();this.input.firstChild&&e.collapse(this.input.firstChild,t.length),this.container.scrollLeft=this.container.scrollWidth-this.container.offsetWidth}document.addEventListener("selectionchange",this.handleSelectionChange)}willUnmount(){document.removeEventListener("selectionchange",this.handleSelectionChange)}renderComponent(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=g.fg(this.environment),{html:r}=this.stores.store.state;return(0,R.jsxs)("div",{style:this.getWrapStyle(),children:[(0,R.jsxs)("div",{ref:e=>{e&&(this.container=e)},style:this.getStyle(),children:[(0,R.jsx)(Q.Z,{capture:!t,onLeft:p.yR,onRight:p.yR,onSelectAll:p.yR,onRedo:p.yR,onUndo:p.yR,onToggleBold:p.yR,onToggleItalics:p.yR,onToggleCode:p.yR,onCut:p.yR,onCopy:p.yR,onPaste:p.yR,onKeypress:p.yR,onDelete:p.yR,onBackspace:p.yR,children:(0,R.jsx)("div",{ref:this.handleInputMount,contentEditable:!t,spellCheck:!1,autoCorrect:"off",autoCapitalize:"off",onClick:this.handleClick,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onInput:this.handleInput,onPaste:this.handlePaste,style:this.getInputStyle()})}),(0,R.jsx)("div",{style:this.getOverlayStyle(),dangerouslySetInnerHTML:{__html:r}})]}),!e.isMobile&&!t&&(0,R.jsx)(X.Z,{renderTooltip:()=>(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{children:(0,R.jsx)(h.FormattedMessage,{defaultMessage:"Accept",id:"database.formula.acceptFormulaInput.tooltip"})})," ",(0,R.jsxs)("span",{style:{color:this.theme.mediumInvertedTextColor},children:[o,"+Enter"]})]}),render:t=>(0,R.jsx)(Y.Z,{disabled:Boolean(this.stores.store.state.error),onClick:()=>this.handleAccept(),style:{height:24,padding:"0 8px",alignSelf:"flex-end",marginRight:6,marginBottom:4,...e.isMobile&&{marginRight:12}},...t,children:(0,R.jsx)(h.FormattedMessage,{id:"database.formula.doneButton.label",defaultMessage:"Done"})})})]})}updateValue(e){const t=""===e.trim()?this.props.disabled?"":H.default.formatMessage(J.placeholder):l.EP(this.props.Prism,e);this.stores.store.setState({...this.stores.store.state,html:t,value:e})}updateSelection(){const e=document.getSelection().anchorOffset,{value:t}=this.stores.store.state,o=l.wo(t,e),r=o?t.slice(o[0],o[1]):"";r!==this.stores.store.state.query&&this.stores.store.setState({...this.stores.store.state,query:r})}updateFormula(e){const{schema:t,property:o}=this.props;if(""===e.trim())return{error:void 0,formula:void 0,type:void 0};{const r=this.props.formulaStringHelpers.stringToFormula({str:e,property:o,schema:t,intl:H.default.getIntl(),propertyTypeDisplayName:z.SO});if(r&&"error"===r.type){const{message:e}=r;return{formula:void 0,error:e,type:void 0}}return{formula:r,error:void 0,type:void 0}}}executeUpdate(){const{value:e}=this.stores.store.state,{error:t,formula:o}=this.updateFormula(e);!t&&o&&this.props.onChange(o),this.updateTimer=void 0,this.stores.store.setState({...this.stores.store.state,error:t})}static getCompletion(e){const{category:t,name:o}=e;return t===c.WD.property?`prop(${JSON.stringify(o)})`:t===c.WD.constant?o:`${o}(`}getWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flex:"none",background:this.theme.inputBackground,minHeight:33,borderTopLeftRadius:3,borderTopRightRadius:3,...this.props.disabled&&{background:this.theme.contentBackground,borderRadius:3},...e.isMobile&&{borderBottom:`1px solid ${this.theme.regularDividerColor}`,background:this.theme.popoverBackground,minHeight:44,paddingLeft:t.state.paddingLeftCSS,paddingRight:t.state.paddingRightCSS},...this.props.wrapStyle}}getOverlayStyle(){const{device:e}=this.environment,{value:t}=this.stores.store.state;return{...e.isMobile?ee.mobileInputStyle:ee.desktopInputStyle,zIndex:0,...""===t.trim()&&{color:this.theme.mediumTextColor},position:void 0}}getInputStyle(){const{device:e}=this.environment,t=e.isSafari||e.isChrome?"WebkitTextFillColor":"color";return{...e.isMobile?ee.mobileInputStyle:ee.desktopInputStyle,border:"none",background:"none",[t]:""===this.stores.store.state.value?this.theme.regularTextColor:s.ZP.transparent,caretColor:this.theme.regularTextColor,zIndex:1,width:"100%"}}}ee.displayName="FormulaInput",ee.delay=0,ee.desktopInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:32,margin:0,padding:0,paddingLeft:10,paddingRight:8,paddingTop:8,fontSize:13,fontFamily:u.Z.getCompositeFontFamily(Z.SP).mono,wordWrap:"break-word"},ee.mobileInputStyle={alignItems:"center",position:"absolute",minWidth:"100%",minHeight:44,margin:0,paddingLeft:16,paddingRight:0,paddingTop:12,paddingBottom:12,fontSize:14,fontFamily:u.Z.getCompositeFontFamily(Z.SP).githubMono};const te=ee;var oe=o(74523);class re extends i.Z{constructor(){super(...arguments),this.storeTypes={formulaInputStore:j,menuListStore:I.Z},this.state={filteredSections:[]},this.handleFilteredSectionsChange=e=>{p.Xy(e.map((e=>e.key)),this.state.filteredSections.map((e=>e.key)))||this.setState({filteredSections:e})}}renderComponent(){const{device:e}=this.environment,{schema:t,property:o,disabled:i}=this.props,{error:n}=this.stores.formulaInputStore.state,{formula:s}=t[o],a=(0,R.jsxs)(r.Fragment,{children:[(0,R.jsx)(v.DependencyConsumer,{dependency:v.deps.prismjs,children:e=>(0,R.jsx)(v.DependencyConsumer,{dependency:v.deps.formulaStringHelpers,children:r=>(0,R.jsx)(te,{ref:e=>{e&&(this.formulaInput=e)},Prism:e,formulaStringHelpers:r,store:this.stores.formulaInputStore,formula:s,schema:t,property:o,disabled:i,onChange:e=>this.handleInputChange(e),onSubmit:e=>this.handleInputSubmit(e),wrapStyle:{overflow:"hidden"},inputContainerStyle:{maxHeight:"45vh",overflow:"scroll"}})})}),e.isMobile&&this.renderStatus()]});let l;return l=e.isMobile?{menuType:f.og.Modal,title:(0,R.jsx)(h.FormattedMessage,{id:"database.mobileFormulaModal.title",defaultMessage:"Formula"}),left:(0,R.jsx)(k.CancelMenuText,{}),right:n?void 0:(0,R.jsx)(h.FormattedMessage,{id:"database.mobileFormulaModal.saveButton.label",defaultMessage:"Save"}),onClickLeft:this.props.onClickCancel,onClickRight:()=>this.formulaInput.handleAccept(),header:a}:{menuType:f.og.Popup,width:580,height:i?"none":void 0,minHeight:358,disableScroller:!0,header:a,footer:this.renderStatus(),scrollerStyle:{display:"flex"}},(0,R.jsx)(_.Z,{...l,children:!i&&this.renderContent()})}renderContent(){const{device:e}=this.environment,t=this.getLibrary(),o=this.getFocusedEntry(t);return e.isMobile?(0,R.jsx)(P.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,onFilteredSectionsChange:this.handleFilteredSectionsChange}):(0,R.jsxs)("div",{style:{display:"flex",flexGrow:1,boxShadow:`\n\t\t\t\t\t\t\tinset 0 1px 0 ${this.theme.regularDividerColor},\n\t\t\t\t\t\t\tinset 0 -1px 0 ${this.theme.regularDividerColor}\n\t\t\t\t\t\t`,maxHeight:295},children:[(0,R.jsx)(T.Z,{type:C.Z.Y,style:{width:180,flexGrow:0,flexShrink:0},children:(0,R.jsx)(P.Z,{initialFocus:0,context:{blocks:[],environment:this.environment,publicEditMode:void 0},filter:this.stores.formulaInputStore.state.query,sections:this.renderSections(t),menuListStore:this.stores.menuListStore,onFilteredSectionsChange:this.handleFilteredSectionsChange})}),(0,R.jsx)(T.Z,{type:C.Z.Y,style:{padding:12,boxShadow:`inset 1px 0 0 ${this.theme.regularDividerColor}`,flexGrow:1},children:(0,R.jsx)(B,{entry:o})})]})}renderStatus(){const{device:e}=this.environment,{disabled:t}=this.props,{command:o}=g.fg(this.environment),{error:r}=this.stores.formulaInputStore.state;return r?(0,R.jsxs)("div",{style:e.isMobile?this.getMobileStatusWrapStyle():this.getDesktopStatusWrapStyle(),children:[(0,R.jsx)("span",{style:{...e.isMobile&&re.mobileStatusStyle,...re.errorStatusStyle},children:r}),!e.isMobile&&this.renderLearnMoreLink()]}):e.isMobile?(0,R.jsx)("div",{style:this.getMobileStatusWrapStyle(),children:(0,R.jsx)("span",{style:re.mobileStatusStyle,children:(0,R.jsx)(h.FormattedMessage,{defaultMessage:"No errors.",id:"database.formula.mobileNoErrors.message"})})}):t?void 0:(0,R.jsxs)("div",{style:this.getDesktopStatusWrapStyle(),children:[(0,R.jsx)("span",{children:(0,R.jsx)(h.FormattedMessage,{id:"database.formula.keyboardShortcutHint",defaultMessage:"{commandEnter} to accept",values:{commandEnter:(0,R.jsxs)("span",{style:{fontWeight:u.Z.fontWeight.medium},children:[o,"+Enter"]})}})}),this.renderLearnMoreLink()]})}renderLearnMoreLink(){return(0,R.jsx)("div",{style:{marginLeft:"auto"},children:(0,R.jsx)(oe.Z,{title:(0,R.jsx)("span",{style:{fontSize:u.Z.fontSize.UISmall.desktop},children:(0,R.jsx)(h.FormattedMessage,{defaultMessage:"Learn more about formulas",id:"formulaPropertyMenu.learnMore.button.label"})}),href:(0,x.UY)("guides.formulas"),analyticsFrom:"formula_property_menu"})})}renderSections(e){return e.map((e=>({key:e.key,title:this.props.intl.formatMessage(e.titleMessage),render:e=>(0,R.jsx)(F.Z,{...e,desktopTitleStyle:{paddingLeft:8,paddingRight:8}}),actions:e.entries.map(((e,t)=>({key:this.getEntryKey(e,t),displayName:e.name,analyticsName:e.name,searchName:e.name,render:t=>(0,R.jsx)(E,{...t,entry:e}),action:()=>{this.formulaInput.insertEntry(e)},closeParentMenu:!1})))})))}handleUpdate(e,t){const{onChange:o,schema:r,property:i,analyticsFrom:n}=this.props;if(e&&"error"===e.type);else{const s=r[i];o({propertySchema:{...s,formula:e},close:t}),s&&m.$qu(this.environment,{...(0,S.Pn)(this.context.collectionContextStore),property_type:s.type,action:"formula_edit",from:n})}}getLibrary(){const{schema:e,property:t,exampleBlock:o,intl:r}=this.props,i=Object.keys(e).filter((o=>{const r=e[o];return!(o===t||r&&n.rX.includes(r.type))})).map((t=>{const i=e[t];if(!i)throw new Error("Property not found.");const{name:n}=i,s=o?a.Qs({property:t,schema:e,block:o,getRecordModel:b.default.getCurrentBlockModelFn(),collectionRequestContext:{userId:void 0,userTimeZone:(0,d.r)(),intl:r,depth:0,resultCache:{},visitedProperties:new Set}}):void 0;return{name:n,category:c.WD.property,fallbackDescription:r.formatMessage({id:"database.formula.property.description",defaultMessage:"Returns the {propertyName} property for each entry."},{propertyName:n}),resultType:l.z6(i),examples:s?[`prop(${JSON.stringify(n)}) == ${JSON.stringify(s)}`]:[]}}));return[c.jQ(c.WD.property,i),...c.ZY]}getFocusedEntry(e){var t;const{focus:{section:o,indexLocal:r}}=this.stores.menuListStore.state,i="number"==typeof o&&"number"==typeof r?null===(t=this.state.filteredSections[o])||void 0===t||null===(t=t.actions[r])||void 0===t?void 0:t.key:void 0;if(void 0!==i)for(const n of e)for(const[e,t]of n.entries.entries())if(this.getEntryKey(t,e)===i)return t}getEntryKey(e,t){return`${e.name} ${t}`}getDesktopStatusWrapStyle(){return{display:"flex",flex:"none",alignItems:"center",fontSize:12,paddingLeft:8,paddingRight:8,height:30,color:this.theme.mediumTextColor}}getMobileStatusWrapStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",flex:"none",alignItems:"center",fontSize:14,height:28,color:this.theme.mediumTextColor,background:this.theme.popoverBackground,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,paddingLeft:e.state.paddingLeftCSS,paddingRight:e.state.paddingRightCSS}}handleInputChange(e){this.handleUpdate(e,!1)}handleInputSubmit(e){this.handleUpdate(e,!0)}}re.displayName="FormulaPropertyMenu",re.contextTypes={...i.w,...y.xm},re.mobileStatusStyle={paddingLeft:16,paddingRight:16},re.errorStatusStyle={color:s.ZP.redWithAlpha(.8),...u.Z.textOverflowStyle};const ie=(0,h.injectIntl)(re)},86765:(e,t,o)=>{o.d(t,{Z:()=>p});o(67294);var r=o(480),i=o(86628),n=o(24405),s=o(5366),a=o(1018),l=o(31278),c=o(76798),d=o(85893);const p=(0,s.injectIntl)((function(e){window.__c={n:"RelationCreateItemText"};const{title:t,targetCollectionStore:o}=e,p=(0,r.Fy)(),u=(0,i.VK)((()=>o.getIcon()),[o]),h=(0,n.yK)((e=>({medium:{color:e.mediumTextColor},dbName:{display:"flex",alignItems:"center",marginLeft:4},title:{marginLeft:a.Qi*(p.isRetina?.5:1)}})),[p.isRetina]),m=t?(0,d.jsxs)("span",{children:[" ",t," "]}):(0,d.jsx)("span",{children:" "}),g=(0,d.jsxs)("div",{style:h.dbName,children:[(0,d.jsx)(l.Z,{disabled:!0,icon:u,isEmptyPage:!1,size:p.isMobile?24:20}),(0,d.jsx)(c.Z,{store:o,style:h.title})]});return(0,d.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,d.jsx)(s.FormattedMessage,{id:"database.searchRelation.createNewPageFooter",defaultMessage:"<medium>New</medium> {pageName} <medium> in</medium> {databaseNameWithIcon}",values:{medium:e=>(0,d.jsx)("span",{style:h.medium,children:e}),pageName:m,databaseNameWithIcon:g}})})}))},30905:(e,t,o)=>{o.d(t,{Xh:()=>g,Y7:()=>S,ZP:()=>y,qQ:()=>m});o(67294);var r=o(86628),i=o(24405),n=o(20669),s=o(32056),a=o(3791),l=o(5366),c=o(44866),d=o(14976),p=o(78291),u=o(91839),h=o(85893);function m(e){let{collectionStore:t,propertySchema:o}=e;window.__c={n:"AiAutofillFillAllPagesTooltip"};const i=(0,r.VK)((()=>(0,d.Xh)(t.getName(),t)),[t]),n=(0,r.VK)((()=>{var e;const t=(null===(e=p.default.state.data)||void 0===e?void 0:e.addOns)??[];return(0,a.de)(t)}),[]);return(0,h.jsxs)("div",{children:[(0,h.jsx)("div",{style:{color:"white",fontWeight:500,wordWrap:"break-word",whiteSpace:"pre-wrap"},children:(0,h.jsx)(l.FormattedMessage,{...c.fillAllPagesMessages.fillAllPagesTooltip,values:{hasNames:Boolean(i)&&Boolean(o.name),collectionName:i,propertyName:o.name}})}),!n&&(0,h.jsx)("div",{style:{color:"#ACABA9",fontWeight:500},children:(0,h.jsx)(l.FormattedMessage,{...c.fillAllPagesMessages.fillAllPagesAddOnMessage})})]})}function g(e){let{updateAiInferencesTaskStatus:t,iconStyle:o,progressIconStyle:r}=e;window.__c={n:"AiAutofillFillAllPagesButtonIcon"};const s=(0,i.Fg)();return t.isRunning?(0,h.jsx)("div",{style:r,children:(0,h.jsx)(u.Z,{})}):(0,n.y)({width:14,color:s.accentColors.purple[400],...o})}function y(e){let{updateAiInferencesTaskStatus:t,style:o}=e;window.__c={n:"AiAutofillFillAllPagesButtonInner"};const r=(0,l.useIntl)();return(0,h.jsx)("div",{style:o,children:t.isRunning?(0,h.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:void 0===t.numPagesFilled||void 0===t.numPagesRequested?(0,h.jsx)(l.FormattedMessage,{defaultMessage:"Updating all pages",id:"aiAutofill.fillallPages.updatingAllPages"}):(0,h.jsx)(l.FormattedMessage,{defaultMessage:"{numPagesRequested, plural, one {Updating {numPagesFilled} of {numPagesRequested} page} other {Updating {numPagesFilled} of {numPagesRequested} pages}}",id:"aiAutofill.fillallPages.updatingAllPagesWithProgress",values:{numPagesFilled:(0,s.uf)(t.numPagesFilled,"compact",r),numPagesRequested:(0,s.uf)(t.numPagesRequested,"compact",r)}})}):(0,h.jsx)(l.FormattedMessage,{defaultMessage:"Update all pages",id:"aiAutofill.fillAllPages.buttonTitle"})})}function S(e){let{updateAiInferencesTaskStatus:t}=e;window.__c={n:"AiAutofillFillAllPagesButtonCaption"};const{numPagesFilled:o,numPagesRequested:r}={numPagesFilled:void 0,numPagesRequested:void 0,...t},n=(0,i.yK)((e=>({inner:{background:e.accentColors.purple[400],height:"100%",transition:"width .5s"},outer:{background:e.accentColors.gray[100],height:3,borderRadius:2,minWidth:120,overflow:"hidden",marginTop:8}})),[]);return void 0===o||void 0===r?null:(0,h.jsx)("div",{style:n.outer,role:"progressbar",children:(0,h.jsx)("div",{style:{...n.inner,width:100*Math.min(o/r,1)+"%"}})})}},43350:(e,t,o)=>{o.d(t,{Z:()=>n});o(67294);var r=o(65742);o(57658);var i=o(85893);function n(e){const{startPoint:t,endPoint:o,style:n,showArrowHead:l,useRightAngles:c,cornerRadiusOverride:d,handleMouseMove:p,handleMouseLeave:u}=e;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(a,{startPoint:t,startCurvePoint:c?void 0:{x:t.x+r.i2,y:t.y},endPoint:l?{x:o.x-1.5,y:o.y}:o,endCurvePoint:c?void 0:{x:o.x-r.i2,y:o.y},cornerRadiusOverride:d,style:n,handleMouseMove:p,handleMouseLeave:u,children:e.children}),l&&(0,i.jsx)(s,{endPoint:o,style:n})]})}function s(e){const{endPoint:t,style:o}=e;return(0,i.jsx)("polyline",{points:`${t.x-5},${t.y-6} ${t.x},${t.y} ${t.x-5},${t.y+6}`,style:o,fill:"transparent"})}function a(e){const{startPoint:t,startCurvePoint:o,endPoint:r,endCurvePoint:n,style:s,cornerRadiusOverride:a,handleMouseMove:l,handleMouseLeave:c}=e;let d="";d=o&&n?`M ${t.x} ${t.y} L ${o.x} ${o.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`:`M ${t.x} ${t.y} L ${t.x} ${r.y} L ${r.x} ${r.y}`;const p=function(e,t){function o(e,t,o){const i=t.x-e.x,n=t.y-e.y,s=Math.sqrt(i*i+n*n);return r(e,t,Math.min(1,o/s))}function r(e,t,o){return{x:e.x+(t.x-e.x)*o,y:e.y+(t.y-e.y)*o}}function i(e,t){e.length>2&&(e[e.length-2]=t.x.toString(),e[e.length-1]=t.y.toString())}function n(e){return{x:parseFloat(e[e.length-2]),y:parseFloat(e[e.length-1])}}const s=e.split(/[,\s]/).reduce(((e,t)=>{const o=t.match("([a-zA-Z])(.+)");return o?(e.push(o[1]),e.push(o[2])):e.push(t),e}),[]).reduce((function(e,t){return!isNaN(parseFloat(t))&&e.length?e[e.length-1].push(t):e.push([t]),e}),[]);let a=[];if(s.length>1){const e=n(s[0]);let l=null;"Z"===s[s.length-1][0]&&s[0].length>2&&(l=["L",e.x.toString(),e.y.toString()],s[s.length-1]=l),a.push(s[0]);for(let c=1;c<s.length;c++){const e=a[a.length-1],d=s[c],p=d===l?s[1]:s[c+1];if(p&&e&&e.length>2&&"L"===d[0]&&p.length>2&&"L"===p[0]){const s=n(e),l=n(d),c=n(p),u=o(l,s,t),h=o(l,c,t);i(d,u),a.push(d);const m=r(u,l,.5),g=r(l,h,.5),y=["C",m.x.toString(),m.y.toString(),g.x.toString(),g.y.toString(),h.x.toString(),h.y.toString()];a.push(y)}else a.push(d)}if(l){const e=n(a[a.length-1]);a.push(["Z"]),i(a[0],e)}}else a=s;return a.reduce((function(e,t){return`${e}${t.join(" ")} `}),"")}(d,a||16);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("path",{d:p,style:s,fill:"transparent"}),(l||c)&&(0,i.jsxs)("g",{onMouseMove:l,onMouseLeave:c,children:[(0,i.jsx)("path",{d:p,style:{strokeOpacity:0,strokeWidth:16,pointerEvents:"stroke",cursor:"default"},fill:"transparent"}),e.children]})]})}},65089:(e,t,o)=>{o.d(t,{FF:()=>s,Yy:()=>l,bZ:()=>a});o(67294);var r=o(5366),i=o(88492),n=o(85893);function s(e){let{origin:t}=e;return(0,n.jsx)(i.r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"current-sprint-view-tooltip",header:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.header",defaultMessage:"Manage the current sprint"}),content:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardView.content",defaultMessage:"Add tasks and update task status as your team makes progress during the sprint."})})}function a(e){let{origin:t}=e;return(0,n.jsx)(i.r,{origin:t,placementToOrigin:"bottom",tutorialId:"sprints-onboarding",tutorialStepId:"sprint-task-tooltip",header:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.header",defaultMessage:"Change tasks status"}),content:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.SprintBoardItem.content",defaultMessage:'Drag this task to "In progress".'})})}function l(e){let{origin:t}=e;return(0,n.jsx)(i.r,{origin:t,placementToOrigin:"bottom",style:{minWidth:240},tutorialId:"sprints-onboarding",tutorialStepId:"complete-sprint-button-tooltip",header:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.header",defaultMessage:"Complete this sprint"}),content:(0,n.jsx)(r.FormattedMessage,{id:"SprintsBoardOnboardingTooltip.CompleteSprintButton.content",defaultMessage:"Click the button when you're done with this sprint."})})}},13162:(e,t,o)=>{o.d(t,{Z:()=>k});var r=o(67294),i=o(12183),n=o(480),s=o(86628),a=o(24405),l=o(56373),c=o(8848),d=o(59054),p=o(47453),u=o(5366),h=o(6287),m=o(82990),g=o(8406),y=o(54642),S=o(16956),f=o(47307),x=o(39699),v=o(33929),C=o(42922),b=o(68894),w=o(68785),M=o(76798),j=o(32662),I=o(64369),P=o(85893);const _=(0,u.defineMessages)({autoIncrementIdPrefixPlaceholder:{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPlaceholder"},duplicatePrefixNameError:{defaultMessage:"{prefixName} isn't available for use.",id:"database.viewSettings.propertyTab.duplicatePrefixNameError"}});function k(e){window.__c={n:"CollectionSettingsAutoIncrementIdProperty"};const{uniqueIdProperty:t,prefixValue:o,collectionContextStore:c}=e,w=(0,n.O7)(),k=(0,s.VK)((()=>c.collectionStore()),[c]),[F,Z]=(0,r.useState)(o??""),[A,R]=(0,r.useState)(!0),[V,B]=(0,r.useState)(),O=(0,r.useCallback)((()=>{R(!0),B(void 0)}),[R,B]),D=(0,r.useCallback)((e=>{R(!0),B(v.default.formatMessage(_.duplicatePrefixNameError,{prefixName:`"${e}"`}))}),[]),N=(0,r.useCallback)(((e,t,o)=>{const r=o.collectionStore();r&&(R(!1),y.setRecordKey(w,{spaceId:r.getSpaceId(),table:r.table,key:e,id:r.id}).then((r=>{R(!0),200!==r.status?D(e):g.$q({environment:w,collectionContextStore:o,property:t,from:"view_settings",action:"unique_id_change_collection_key"})})).catch((()=>D(e))))}),[w,D]),L=(0,r.useCallback)((async e=>{if(!k)return!1;const t=await y.isRecordKeyAvailable(w,{spaceId:k.getSpaceId(),table:k.table,key:e.trim()});return"success"===t.type&&t.data.isAvailable}),[k,w]),K=(0,i.v)((e=>{L(e).then((t=>{t||D(e),R(!0)})).catch((()=>D(e)))}),500),[W]=(0,d.r5)((async()=>{if(k)return y.suggestRecordKey(w,{spaceId:k.getSpaceId(),table:h.v,id:k.id,shouldSetSuccessfullySuggestedRecord:!1})}),[k,w]);(0,r.useEffect)((()=>{var e;if(!o&&"resolved"===W.status)return"success"===(null===(e=W.value)||void 0===e?void 0:e.type)&&W.value.data?(B(void 0),void Z(W.value.data.key)):void 0}),[o,W]),(0,r.useEffect)((()=>()=>{K.cancel()}),[K]);const q=(0,r.useCallback)((e=>{const t=e.target.value.toUpperCase();Z(t),O(),t&&t!==o&&((0,l.k5)(t)||B(v.default.formatMessage(l.sY.prefixInvalidError)),R(!1),K(t))}),[O,o,K]),E=(0,r.useCallback)((()=>{K.flush()}),[K]),G=(0,r.useCallback)((e=>{const r=null==k?void 0:k.getRecordKeyStore();e!==o&&!V&&r&&k&&null!=t&&t.propertySchema?N(e,null==t?void 0:t.propertyId,c):R(!0)}),[k,o,V,t,N,c]),z=(0,r.useCallback)((()=>{const e=c.collectionStore();e&&x.createAndCommit({userAction:"CollectionSettingsAutoIncrementIdPropertyCreateNewIdProperty",environment:w,perform:t=>{const o=S.G3({environment:w,collectionStore:e,collectionViewArgs:void 0,propertyType:"auto_increment_id",transaction:t});N(F,o,c)}})}),[c,w,F,N]),U=(0,r.useCallback)((e=>{if(!k)return;const t=[{label:(0,P.jsx)(u.FormattedMessage,{id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit",defaultMessage:"Update ID Prefix"}),color:"red",onAccept:()=>G(e)}];f.showDialog({message:(0,P.jsx)("span",{children:(0,P.jsx)(u.FormattedMessage,{id:"database.viewSettings.propertyTab.changePrefixConfirmationMessage",defaultMessage:"Updating the prefix will stop 3rd party automations that rely on this ID (e.g., GitHub PR status automation).",values:{databaseName:(0,P.jsx)(M.Z,{style:{display:"inline",fontWeight:m.Z.fontWeight.medium},shouldWrap:!0,store:k})}})}),showCancel:!0,keepFocus:!0,items:t})}),[k,G]),H=(0,r.useCallback)((e=>{o?U(e):G(e)}),[o,G,U]),$=(0,r.useCallback)((()=>t?t&&!o?(0,P.jsxs)(P.Fragment,{children:[(0,p.R)({width:14,height:14}),(0,P.jsx)(j.Z,{size:4}),(0,P.jsx)(u.FormattedMessage,{defaultMessage:"Add ID prefix",id:"database.viewSettings.propertyTab.autoIncrementIdCreatePrefix"})]}):(0,P.jsx)(u.FormattedMessage,{defaultMessage:"Update ID Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixSubmit"}):(0,P.jsxs)(P.Fragment,{children:[(0,p.R)({width:14,height:14}),(0,P.jsx)(j.Z,{size:4}),(0,P.jsx)(u.FormattedMessage,{defaultMessage:"Add ID property",id:"database.viewSettings.propertyTab.autoIncrementIdCreateProperty"})]})),[o,t]),Y=(0,a.yK)((e=>({prefixInputOuterStyle:{color:void 0===o?e.lightTextColor:e.regularTextColor}})),[o]);return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(b.ZP,{left:(0,P.jsx)(I.Z,{style:{marginLeft:4,marginRight:7},children:(0,P.jsx)(u.FormattedMessage,{defaultMessage:"Prefix",id:"database.viewSettings.propertyTab.autoIncrementIdPrefix"})}),value:F,inputOuterStyle:Y.prefixInputOuterStyle,onChange:q,onBlur:E,placeholder:_.autoIncrementIdPrefixPlaceholder.defaultMessage,onSubmit:()=>H(F.trim()),focusInitial:!1,selectAll:!1,disabled:!1}),V||!A?(0,P.jsx)(T,{prefixName:F,hasRequestCompleted:A,errorMessage:V}):(0,P.jsx)(P.Fragment,{children:(0,P.jsx)(I.Z,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:16,marginLeft:16},children:(0,P.jsx)(u.FormattedMessage,{defaultMessage:"{prefixWithHyphen}1, {prefixWithHyphen}2, {prefixWithHyphen}3, ...",id:"database.viewSettings.propertyTab.autoIncrementIdPrefixPreview",values:{prefixWithHyphen:F?`${F}-`:""}})})}),(0,P.jsx)(C.Z,{isLarge:!0,style:{margin:"8px 16px",width:"90%"},onClick:()=>{t?H(F.trim()):z()},disabled:F===o||Boolean(V)||!A,children:$()})]})}function T(e){const{errorMessage:t,hasRequestCompleted:o}=e;return(0,P.jsx)(I.Z,{isMultiline:!0,style:{paddingTop:12,marginLeft:16,marginRight:16,...o?{color:c.ZP.red}:{},...e.styles},isSecondaryColor:!o,children:o&&t?t:(0,P.jsx)("div",{style:{paddingTop:3,paddingBottom:3},children:(0,P.jsx)(w.Z,{style:{width:14,height:14}})})})}},59187:(e,t,o)=>{o.d(t,{Z:()=>ge});var r=o(67294),i=o(480),n=o(86628),s=o(24405),a=o(77657),l=o(29109),c=o(5366),d=o(97880),p=o(47307),u=o(42631),h=o(88990),m=o(75081),g=o(12205),y=o(30874),S=o(89728),f=o(72495),x=o(32662),v=o(13162),C=(o(57658),o(99036)),b=o(39068),w=o(84619),M=o(74487);const j={pull_request_review_edited:!0,pull_request_review_submitted:!0,pull_request_review_requested:!0,pull_request_review_request_removed:!0,pull_request_closed:!0,pull_request_opened:!0,pull_request_reopened:!0,installation_deleted:!0,installation_suspend:!0,installation_unsuspend:!0,pull_request_converted_to_draft:!0,pull_request_edited:!0,pull_request_assigned:!0},I={pull_request_opened:!0,pull_request_review_requested:!0,pull_request_review_submitted:!0,pull_request_closed:!0};(0,d.AO)((e=>{const t=(0,d.Yd)(j);return(0,d.DE)(t,e)?{true:e}:{false:e}}));M.literals(...(0,d.Yd)({pull_request:!0,pull_request_review:!0,installation:!0})),M.literals(...(0,d.Yd)(j));var P=o(33907),_=o(47453),k=o(37612),T=o(8406),F=o(16956),Z=o(45264),A=o(39699),R=o(66890),V=o(33929),B=o(87279),O=o(29376),D=o(42917),N=o(42922),L=o(52275),K=o(31945),W=o(96525),q=o(61519),E=o(78140),G=o(32163),z=o(40721),U=o(22084),H=o(85893);const $=(0,c.defineMessages)({autoUpdate:{defaultMessage:"Auto-update",id:"collectionSettingsGithubAutomationConfig.statusPicker.autoUpdate"},when:{defaultMessage:"when PR is",id:"collectionSettingsGithubAutomationConfig.statusPicker.when"},addStatusDescription:{defaultMessage:"Add a status property to set up automations.",id:"collectionSettingsGithubAutomationConfig.addStatusDescription"},addStatusButton:{defaultMessage:"Add status property",id:"collectionSettingsGithubAutomationConfig.statusPicker.addStatusButton"},newStatusPropertyButton:{defaultMessage:"New status",id:"collectionSettingsGithubAutomationConfig.statusPicker.newStatusPropertyButton"},pull_request_opened:{defaultMessage:"Opened",id:"collectionSettingsGithubAutomationConfig.pullRequestOpened"},pull_request_review_requested:{defaultMessage:"Review requested",id:"collectionSettingsGithubAutomationConfig.pullRequestReviewRequested"},pull_request_review_submitted:{defaultMessage:"Approved",id:"collectionSettingsGithubAutomationConfig.pullRequestApproved"},pull_request_closed:{defaultMessage:"Merged",id:"collectionSettingsGithubAutomationConfig.pullRequestMerged"},noAutomations:{defaultMessage:"None",id:"collectionSettingsGithubAutomationConfig.noAutomation"},removeStatusOption:{defaultMessage:"Clear",id:"collectionSettingsGithubAutomationConfig.removeStatusOption"}}),Y={pull_request_opened:V.default.formatMessage($.pull_request_opened),pull_request_review_requested:V.default.formatMessage($.pull_request_review_requested),pull_request_review_submitted:V.default.formatMessage($.pull_request_review_submitted),pull_request_closed:V.default.formatMessage($.pull_request_closed)},Q=V.default.formatMessage($.noAutomations),X={pull_request_opened:null,pull_request_review_requested:null,pull_request_review_submitted:null,pull_request_closed:null};function J(e){window.__c={n:"CollectionSettingsGithubAutomationConfig"};const{gitHubProperty:t,selectedStatusProperty:o,setSelectedStatusProperty:s,intl:a}=e,l=(0,i.O7)(),c=(0,R.Y$)(),p=(0,i.Fy)(),u=re(),h=(0,n.VK)((()=>{const e=(0,O.KV)(c,t);if(e&&(0,C.NK)(e))return e}),[c,t]),m=(0,n.VK)((()=>{const e=c.normalizedSchemaStore.state;return(0,d.qP)(e).flatMap((e=>{let[t,o]=e;return o&&(0,C.gB)(o)?[{id:t,schema:o}]:[]}))}),[c.normalizedSchemaStore]);(0,r.useEffect)((()=>{if(!o&&m.length>0){if(null!=h&&h.connectedRelation.automation)for(const t of m)if(h.connectedRelation.automation[t.id])return void s(t);const e=m[0];s(e)}}),[m,h,o,s]);const[g,y]=(0,r.useState)(X);(0,r.useEffect)((()=>{var e,t;o&&h&&(0,C.NK)(h)&&null!==(e=h.connectedRelation.automation)&&void 0!==e&&e[o.id]?y(null===(t=h.connectedRelation.automation)||void 0===t?void 0:t[o.id]):y(X)}),[h,o]);const S=(0,r.useCallback)((e=>{const r=c.collectionStore();if(!(r&&o&&h&&(0,C.p_)(h)))return;const i=h.connectedRelation;if(!i||!o.id)return;i.automation={...i.automation,...e};const n={...h,connectedRelation:{...i}};T.$q({environment:l,collectionContextStore:c,property:o.id,from:"github_pull_requests_property",action:"configure_github_pr_automation",githubAutomationConfigured:e}),A.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomation",environment:l,perform:e=>{Z.xO({environment:l,collectionStore:r,update:{[t]:n},transaction:e})}})}),[c,o,h,l,t]),v=(0,n.VK)((()=>o&&o.schema.options?o.schema.options:[]),[o]),b=(0,n.VK)((()=>{const e={};return v.forEach((t=>{e[t.id]=t})),e}),[v]),M=(0,n.VK)((()=>{var e,t;const r=null==o||null===(e=o.schema)||void 0===e?void 0:e.groups,i=null==o||null===(t=o.schema)||void 0===t?void 0:t.options;return r&&i?r.map((e=>{const t=i.filter((t=>{var o;return null===(o=e.optionIds)||void 0===o?void 0:o.includes(t.id)}));if(0!==t.length)return{group:e,groupOptions:t}})).filter(d.$K):[]}),[o]);function j(e,t){const r=M.map((t=>{let{group:r,groupOptions:i}=t;const n=i.map((t=>({key:t.id,render:e=>(0,H.jsx)(L.Z,{...e,focused:e.focused,isTokenTitle:!0,title:(0,H.jsx)(U.F,{format:w.l.Small,value:t.value,color:t.color,showRemoveButton:!1,groupColor:r.color,isSingle:!0})}),action:()=>{const r={...g,[e]:t.id};o&&(S({[o.id]:r}),y(r))}}))).filter(d.$K);return{key:r.name,render:e=>(0,H.jsx)(f.Z,{...e,title:r.name,topBorder:e.index>0}),items:n}}));if(g[e]){function i(){const r={...g,[e]:null};o&&(S({[o.id]:r}),y(r)),t.close()}const n={key:"removeOptionSection",render:e=>(0,H.jsx)(f.Z,{...e,topBorder:!0}),items:[{key:"removeOptionButton",render:e=>(0,H.jsx)(L.Z,{...e,focused:!1,title:a.formatMessage($.removeStatusOption),left:(0,k.y)({width:12}),onClick:i}),action:e=>{i()}}]};r.push(n)}return r}return o?(0,H.jsx)(f.Z,{topBorder:!1,disableDesktopPadding:!0,disableMobilePadding:!0,title:(0,H.jsx)(te,{selectedStatusProperty:o,setSelectedStatusProperty:s,existingStatusProperties:m,intl:a}),children:(0,d.Yd)(I).map((e=>(0,H.jsx)(W.Z,{focused:!1,placementToOrigin:K.pO.Top,alignmentToOrigin:K.vR.End,popupType:p.isMobile?K.Z4.SlideUp:K.Z4.Popup,render:t=>{const o=p.isMobile?{menuType:B.og.Modal,right:(0,H.jsx)(z.DoneMenuText,{}),onClickRight:t.close}:{menuType:B.og.Popup,width:150};return(0,H.jsx)(E.Z,{...o,children:(0,H.jsx)(G.Z,{type:G.i.Vertical,sections:j(e,t),initialFocus:void 0,onAccept:t.close})})},renderOrigin:t=>{const r=g[e];let i=(0,H.jsx)("div",{style:u.noneText,children:Q});if(r){const e=b[r];if(e){var n;const t=null==o||null===(n=o.schema)||void 0===n||null===(n=n.groups)||void 0===n||null===(n=n.find((e=>{var t;return null===(t=e.optionIds)||void 0===t?void 0:t.includes(r)})))||void 0===n?void 0:n.color;i=(0,H.jsx)(U.F,{format:w.l.Small,showRemoveButton:!1,isSingle:!0,value:e.value,color:e.color,groupColor:t})}}return(0,H.jsx)(D.Z,{...t,focused:!1,icon:()=>(0,H.jsxs)("div",{style:{display:"inline-flex",alignItems:"center",justifyContent:"flex-start",whiteSpace:"nowrap"},children:[Y[e],(0,H.jsx)(x.Z,{size:8}),(0,P.n)(u.automationMenuItemArrow)]}),title:(0,H.jsx)("div",{style:{width:"100%",display:"inline-flex",justifyContent:"flex-end"},children:i}),showChevron:!0,chevronStyle:{margin:0}})}},e)))}):(0,H.jsx)(ee,{setSelectedStatusProperty:s,intl:a})}function ee(e){window.__c={n:"AddStatusProperty"};const{setSelectedStatusProperty:t,intl:o}=e,r=(0,i.O7)(),n=(0,R.Y$)(),s=re();return(0,H.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,H.jsx)(q.Z,{size:"100%",innerStyle:s.addStatusDivider}),(0,H.jsx)("div",{style:s.addStatusDescription,children:o.formatMessage($.addStatusDescription)}),(0,H.jsxs)(N.Z,{style:s.addStatusButton,onClick:e=>{e.stopPropagation(),oe(r,n,t)},children:[(0,_.R)({width:14}),(0,H.jsx)(x.Z,{size:4}),o.formatMessage($.addStatusButton)]}),(0,H.jsx)(x.Z,{size:4})]})}function te(e){window.__c={n:"GithubStatusPropertyPicker"};const{selectedStatusProperty:t,setSelectedStatusProperty:o,existingStatusProperties:r,intl:n}=e,a=(0,i.O7)(),l=(0,R.Y$)(),c=(0,i.Fy)(),p=re(),u=(0,s.Fg)(),h=r.map((e=>{const{id:t,schema:r}=e;return{key:t,action:()=>{o(e)},render:t=>(0,H.jsx)(L.Z,{...t,icon:(0,H.jsx)(b.ZP,{size:14,theme:u,icon:e&&e.schema.icon,type:"status"}),title:r.name})}})).filter(d.$K),m={key:"newStatusProperty",action:()=>{oe(a,l,o)},render:e=>(0,H.jsx)(L.Z,{...e,icon:(0,_.R)(p.statusPickerIcon),title:n.formatMessage($.newStatusPropertyButton)})};return(0,H.jsxs)("div",{style:p.statusPickerWrapper,children:[(0,H.jsxs)("div",{style:{display:"inline-flex",alignItems:"center"},children:[n.formatMessage($.autoUpdate),c.isMobile&&(0,H.jsx)(x.Z,{size:4}),(0,H.jsx)(K.ZP,{placementToOrigin:K.pO.Bottom,alignmentToOrigin:K.vR.Start,popupType:c.isMobile?K.Z4.SlideUp:K.Z4.Popup,renderOrigin:e=>(0,H.jsx)(L.Z,{...e,title:t.schema.name,focused:!1,style:p.statusPickerButtonCore,textWrapperStyle:p.statusPickerButtonTextWrapper,left:(0,H.jsx)(b.ZP,{size:14,theme:u,icon:t.schema.icon,type:"status"}),leftStyle:{marginLeft:2},showExtensionArrow:!0,extensionArrowStyle:p.statusPickerExtensionArrow}),render:e=>{const t=c.isMobile?{menuType:B.og.ActionSheet}:{menuType:B.og.Popup,width:150};return(0,H.jsx)(E.Z,{...t,children:(0,H.jsx)(G.Z,{type:G.i.Vertical,sections:[{key:0,render:e=>(0,H.jsx)(f.Z,{...e}),items:[...h,m]}],initialFocus:0,onAccept:e.close})})}})]}),c.isMobile&&(0,H.jsx)(x.Z,{size:4}),n.formatMessage($.when)]})}function oe(e,t,o){const r=t.collectionStore();r&&A.createAndCommit({userAction:"CollectionSettingsConfigureGithubAutomationCreateNewStatusProperty",environment:e,perform:i=>{const n=F.G3({environment:e,collectionStore:r,collectionViewArgs:void 0,propertyType:"status",transaction:i}),s=(0,O.KV)(t,n);s&&(0,C.gB)(s)&&o({id:n,schema:s})}})}function re(){const e=(0,i.Fy)().isMobile;return(0,s.yK)((t=>({addStatusDivider:{borderColor:t.tableDividerColor},addStatusDescription:{width:"calc(100% - 24px)",padding:e?"16px 8px":"14px 0px",fontSize:e?16:12,color:t.lightTextColor},addStatusButton:{width:"calc(100% - 24px)",display:"inline-flex",alignItems:"center",justifyContent:"center"},noneText:{color:t.lightTextColor},automationMenuItemArrow:{width:12,fill:t.lightIconColor,stroke:t.lightIconColor,strokeOpacity:.5,strokeWidth:2},statusPickerWrapper:{display:"inline-flex",alignItems:"center",flexWrap:"wrap",rowGap:2,marginBottom:e?10:void 0},statusPickerButtonTextWrapper:{margin:"0px 4px",fontSize:12},statusPickerButtonCore:{minHeight:e?28:20,borderRadius:5,maxWidth:e?150:100},statusPickerIcon:{width:14,height:14},statusPickerExtensionArrow:{transform:"rotate(180deg)",marginRight:2}})),[e])}var ie=o(49122);const ne=(0,c.defineMessages)({tabTitle:{defaultMessage:"GitHub Pull Requests",id:"database.viewSettings.githubConfigTab.tabTitle"},connect:{defaultMessage:"Connect to GitHub (Workspace)",id:"database.viewSettings.githubConfigTab.connect"},connectDescriptionAdmin:{defaultMessage:"Ask your workspace admin to configure the GitHub (Workspace) connection.",id:"database.viewSettings.githubConfigTab.connectDescriptionAdmin"},authError:{defaultMessage:"Auth failed. Please try again or contact Notion support.",id:"database.viewSettings.githubConfigTab.authError"},tabDescriptionNoIdPrefix:{defaultMessage:"This feature requires a prefixed ID property to link GitHub PRs to Notion {pluralItemName}.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoIdPrefix"},tabDescriptionNoStatus:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title.",id:"database.viewSettings.githubConfigTab.tabDescriptionNoStatus"},tabDescription:{defaultMessage:"Link PRs by adding the {singleItemName} ID to the PR title. Set up automated status updates in Notion based on PR status changes.",id:"database.viewSettings.githubConfigTab.tabDescription"}});function se(e){let{collectionContextStore:t,intl:o}=e;window.__c={n:"UnauthedFallback"};const r=me(),{hoveredBackground:s,pressedBackground:a}=he(),l=(0,g.J)(),c=(0,i.O7)(),d=ue(),m=function(e){return(0,n.VK)((()=>{var t;return null===(t=e.collectionStore())||void 0===t?void 0:t.getSpaceId()}),[e])}(t);return(0,H.jsxs)(f.Z,{disableMobileBorders:!0,mobileStyle:r.previewContentContainer,style:r.previewContentContainer,children:[(0,H.jsx)("img",{src:"/images/external_integrations/github-icon.png",style:{width:36,height:36}}),(0,H.jsx)("p",{style:r.connectDescription,children:l?(0,h.GT)().description:o.formatMessage(ne.connectDescriptionAdmin)}),(0,H.jsx)(S.Z,{style:r.connectButton,hoveredStyle:{background:s},pressedStyle:{background:a},disabled:!l,disabledFeedback:!l,onClick:async e=>{if(e.preventDefault(),m&&d)try{await u.hM({environment:c,spaceId:m,integration:d,from:"connected_relation_property_menu"})}catch(t){const e=o.formatMessage(ne.authError);p.showErrorMessage(e)}},children:o.formatMessage(ne.connect)}),(0,H.jsx)(x.Z,{size:4})]})}function ae(e){let{collectionContextStore:t}=e;window.__c={n:"UserEducationSection"};const o=me(),{isMobile:r}=(0,i.Fy)(),n=pe(t);return(0,H.jsxs)(f.Z,{disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,mobileStyle:o.previewContentContainer,style:o.previewContentContainer,children:[(0,H.jsx)(x.Z,{size:r?16:8}),(0,H.jsx)(ie.Z,{width:"calc(100% - 24px)",uniqueIdPrefix:null==n?void 0:n.prefix})]})}function le(e){let{collectionContextStore:t,intl:o,selectedStatusProperty:r}=e;window.__c={n:"DescriptionSection"};const i=(0,n.VK)((()=>t.databaseType),[t]),s=pe(t),a=me(),l=(0,m.sN)(i),c=(0,m.Q_)(i);let d;return d=s&&s.prefix?r?o.formatMessage(ne.tabDescription,{singleItemName:l}):o.formatMessage(ne.tabDescriptionNoStatus,{singleItemName:l}):o.formatMessage(ne.tabDescriptionNoIdPrefix,{pluralItemName:c}),(0,H.jsx)(f.Z,{disableMobileBorders:!0,disableMobilePadding:!0,mobileStyle:a.tabDescription,style:a.tabDescription,children:d})}function ce(e){let{collectionContextStore:t}=e;window.__c={n:"UniqueIdSection"};const o=pe(t);return o&&o.prefix?null:(0,H.jsx)(v.Z,{collectionContextStore:t,uniqueIdProperty:o&&{propertyId:o.id,propertySchema:o.schema},prefixValue:null==o?void 0:o.prefix})}function de(e){let{collectionContextStore:t,selectedStatusProperty:o,setSelectedStatusProperty:r,property:i,intl:n}=e;window.__c={n:"AutomationConfigSection"};const s=pe(t);return s&&s.prefix?(0,H.jsx)(J,{selectedStatusProperty:o,setSelectedStatusProperty:r,gitHubProperty:i,intl:n}):null}function pe(e){return(0,n.VK)((()=>{var t,o;const r=null===(t=e.collectionStore())||void 0===t||null===(t=t.getRecordKeyStore())||void 0===t?void 0:t.getRecordKey(),i=null===(o=e.collectionStore())||void 0===o?void 0:o.getSchema(),n=i&&(0,d.qP)(i).find((e=>{let[,t]=e;return t&&"auto_increment_id"===t.type}));if(n){const[e,t]=n;if(t&&"auto_increment_id"===t.type)return{id:e,schema:t,prefix:r}}}),[e])}function ue(){return(0,n.VK)((()=>y.Z.integrations.state.find((e=>e.id===a.U9))),[])}function he(){const e=ue(),t=(0,s.Fg)();return(0,n.VK)((()=>(0,l.d)(e,t.mode)),[e,t.mode])}function me(){const{isMobile:e}=(0,i.Fy)(),{background:t}=he();return(0,s.yK)((o=>({previewContentContainer:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},connectButton:{fontSize:14,maxWidth:"calc(100% - 24px)",height:void 0,color:o.regularInvertedTextColor,background:t,whiteSpace:"normal",padding:8,textAlign:"center"},connectDescription:{maxWidth:"calc(100% - 24px)",color:o.lightTextColor,fontSize:14,textAlign:"center"},tabDescription:{padding:e?18:14,fontSize:e?16:12,color:o.lightTextColor}})),[e,t])}const ge=(0,c.injectIntl)((function(e){window.__c={n:"CollectionSettingsGithubConfig"};const{collectionContextStore:t,property:o,intl:i}=e,[s,l]=(0,r.useState)(void 0);return(0,n.VK)((()=>{const e=y.Z.bots.state.find((e=>e.integration_id===a.U9));return Boolean(e)}),[])?(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(ae,{collectionContextStore:t}),(0,H.jsx)(le,{collectionContextStore:t,intl:i,selectedStatusProperty:s}),(0,H.jsx)(ce,{collectionContextStore:t}),(0,H.jsx)(de,{collectionContextStore:t,selectedStatusProperty:s,setSelectedStatusProperty:l,property:o,intl:i})]}):(0,H.jsx)(se,{collectionContextStore:t,intl:i})}))},49122:(e,t,o)=>{o.d(t,{Z:()=>d});o(67294);var r=o(480),i=o(24405),n=o(41892),s=o(82990),a=o(5366),l=o(32662),c=o(85893);function d(e){window.__c={n:"CollectionSettingsGithubPrTaskPreview"};const t=(0,a.useIntl)(),o=function(e){const{isMobile:t}=(0,r.Fy)(),o=t?18:14,n=1,a=6,l=20;return(0,i.yK)((t=>({githubContainer:{display:"flex",alignSelf:"center",flexDirection:"column",width:e||"90%",padding:l,border:`${n}px solid ${t.tableDividerColor}`,borderRadius:a,borderBottomRightRadius:4,cursor:"default"},githubPrTitleRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"flex-start",width:`calc(100% + ${l}px)`,overflow:"hidden"},githubPrTitle:{display:"inline-flex",fontSize:o,fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",background:t.whiteButtonBackground,padding:"2px 4px",borderTopLeftRadius:5,borderBottomLeftRadius:5,borderLeft:`2px solid ${t.blueColor}`,borderTop:`2px solid ${t.blueColor}`,borderBottom:`2px solid ${t.blueColor}`,width:"100%"},githubTask:{background:"light"===t.mode?t.accentColors.blue[50]:t.accentColors.blue[400]},githubPrInfoRow:{display:"inline-flex"},githubPrInfoPill:{display:"flex",flexDirection:"row",alignItems:"center",width:"fit-content",padding:"4px 10px",borderRadius:"2em",background:"#238636",flexShrink:0,...s.Z.textOverflowStyle},githubPrInfoOpenText:{color:"white",fontSize:o-2,fontWeight:500},githubPrInfoMergeInto:{display:"inline-flex",alignItems:"center",fontSize:o-2,color:t.lightTextColor,...s.Z.textOverflowStyle},githubPrInfoMain:{padding:"0px 4px",fontFamily:s.Z.baseFontFamily.githubMono,background:t.cardPressedBackground,borderRadius:a,color:t.regularTextColor,verticalAlign:"text-bottom",...s.Z.textOverflowStyle}})),[o,e])}(e.width),d=(0,c.jsx)("div",{id:"github-preview-github-pr-title-row",style:o.githubPrTitleRow,children:(0,c.jsxs)("div",{id:"github-preview-github-pr-title-wrapper",style:o.githubPrTitle,children:[(0,c.jsx)(l.Z,{size:2}),"[",(0,c.jsxs)("div",{id:"github-preview-github-pr-task",style:o.githubTask,children:[e.uniqueIdPrefix||t.formatMessage(p.idPrefix),e.uniqueIdValue?`-${e.uniqueIdValue}`:"-1"]}),"]",(0,c.jsx)(l.Z,{size:2}),t.formatMessage(p.prTitle)]})}),u=(0,c.jsxs)("div",{id:"github-preview-github-pr-info-row",style:o.githubPrInfoRow,children:[(0,c.jsxs)("div",{id:"github-preview-github-open-pr-pill",style:o.githubPrInfoPill,children:[(0,c.jsx)("img",{src:n.Z.images.externalIntegrations.githubPullOpenIconWhitePng,style:{width:16,height:16}}),(0,c.jsx)(l.Z,{size:2}),(0,c.jsx)("div",{style:o.githubPrInfoOpenText,children:t.formatMessage(p.open)})]}),(0,c.jsx)(l.Z,{size:8}),(0,c.jsx)("div",{id:"github-preview-github-merge-into-main",style:o.githubPrInfoMergeInto,children:(0,c.jsxs)("span",{style:o.githubPrInfoMergeInto,children:[t.formatMessage(p.mergeInto),(0,c.jsx)(l.Z,{size:4}),(0,c.jsx)("span",{style:o.githubPrInfoMain,children:t.formatMessage(p.main)})]})})]});return(0,c.jsxs)("div",{id:"github-preview-github-container",style:o.githubContainer,children:[d,(0,c.jsx)(l.Z,{size:12}),u]})}const p=(0,a.defineMessages)({dismissButtonAriaLabel:{defaultMessage:"A button to dismiss the user education preview.",id:"database.viewSettings.githubConfigTab.preview.dismissButtonAriaLabel"},idPrefix:{defaultMessage:"TASK",id:"database.viewSettings.githubConfigTab.preview.idPrefix"},prTitle:{defaultMessage:"GitHub PR Title",id:"database.viewSettings.githubConfigTab.preview.prTitle"},open:{defaultMessage:"Open",id:"database.viewSettings.githubConfigTab.preview.open"},mergeInto:{defaultMessage:"Merge into",id:"database.viewSettings.githubConfigTab.preview.mergeInto"},main:{defaultMessage:"main",id:"database.viewSettings.githubConfigTab.preview.main"}})},57145:(e,t,o)=>{o.d(t,{_:()=>n});var r=o(67294);const i=new Map;function n(e){const t=!i.get(e),o=(0,r.useRef)(t);return o.current&&i.set(e,!0),(0,r.useEffect)((()=>()=>{o.current&&i.set(e,!1)}),[e]),o.current}},67695:(e,t,o)=>{o.d(t,{Z:()=>n});var r=o(35431);class i extends r.Z{findTableHeaderCell(e,t){return this.find((o=>o.props.collectionContextStore===e&&o.props.property===t))}}const n=new i},29109:(e,t,o)=>{o.d(t,{d:()=>i});var r=o(84939);function i(e,t){const{r:o,g:i,b:n}=(null==e?void 0:e.info.accent_color)||{r:0,g:0,b:0},s=`rgba(${o},${i},${n},${"dark"===t?.6:1})`;return{background:s,hoveredBackground:(0,r._j)(s,.4),pressedBackground:(0,r._j)(s,.9)}}},8298:(e,t,o)=>{o.d(t,{N:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("arrowDownThick",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.99316 1.52246C7.40527 1.52246 7.00195 1.93262 7.00195 2.54785V10.1357L7.07031 11.6191L5.69629 10.0332L4.1582 8.50195C3.98047 8.31738 3.74805 8.19434 3.44727 8.19434C2.91406 8.19434 2.51074 8.59082 2.51074 9.15137C2.51074 9.41113 2.61328 9.65039 2.81836 9.8623L7.26172 14.3125C7.44629 14.5039 7.72656 14.6133 7.99316 14.6133C8.2666 14.6133 8.54004 14.5039 8.72461 14.3125L13.1748 9.8623C13.3799 9.65039 13.4824 9.41113 13.4824 9.15137C13.4824 8.59082 13.0791 8.19434 12.5459 8.19434C12.252 8.19434 12.0195 8.31738 11.835 8.50195L10.2969 10.0332L8.92285 11.6191L8.98438 10.1357V2.54785C8.98438 1.93262 8.58789 1.52246 7.99316 1.52246Z"})})},29651:(e,t,o)=>{o.d(t,{w:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("arrowUpThick",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M7.99316 14.6133C8.58789 14.6133 8.98438 14.2031 8.98438 13.5879V6L8.92285 4.5166L10.2969 6.10254L11.835 7.63379C12.0195 7.81836 12.252 7.94141 12.5459 7.94141C13.0791 7.94141 13.4824 7.54492 13.4824 6.98438C13.4824 6.72461 13.3799 6.48535 13.1748 6.27344L8.72461 1.82324C8.54004 1.63184 8.2666 1.52246 7.99316 1.52246C7.72656 1.52246 7.44629 1.63184 7.26172 1.82324L2.81836 6.27344C2.61328 6.48535 2.51074 6.72461 2.51074 6.98438C2.51074 7.54492 2.91406 7.94141 3.44727 7.94141C3.74805 7.94141 3.98047 7.81836 4.1582 7.63379L5.69629 6.10254L7.07031 4.5166L7.00195 6V13.5879C7.00195 14.2031 7.40527 14.6133 7.99316 14.6133Z"})})},65422:(e,t,o)=>{o.d(t,{K:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("boltFilled",{svg:(0,i.jsx)("path",{d:"M0 12.117c0 .38.293.664.703.664h5.518l-2.91 7.91c-.381 1.006.664 1.543 1.318.723l8.877-11.094c.166-.205.254-.4.254-.625 0-.371-.293-.664-.703-.664H7.539l2.91-7.91C10.83.115 9.785-.422 9.131.408L.254 11.492c-.166.215-.254.41-.254.625z"}),viewBox:"0 0 14 22"})},39192:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionGroupAccordion",{svg:(0,i.jsx)("path",{d:"M6.741 0a1 1 0 01.875 1.485l-2.742 4.94a1 1 0 01-1.748 0L.384 1.485A1 1 0 011.26 0h5.48z"}),viewBox:"0 0 8 7"})},45453:(e,t,o)=>{o.d(t,{p:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionHide",{viewBox:"0 0 16 16",svg:(0,i.jsx)("path",{d:"M12.6172 12.9492C12.8047 13.1309 13.0918 13.1426 13.2793 12.9492C13.4727 12.75 13.4609 12.4688 13.2793 12.2871L3.35352 2.37305C3.17773 2.19141 2.87305 2.18555 2.69141 2.37305C2.51562 2.54883 2.51562 2.85352 2.69141 3.0293L12.6172 12.9492ZM8 2.70703C6.98047 2.70703 6.05469 2.88281 5.19336 3.16406L6.13086 4.10156C6.72266 3.93164 7.33789 3.83203 8 3.83203C11.7441 3.83203 14.7207 7.08984 14.7207 7.77539C14.7207 8.23828 13.7715 9.43359 12.2656 10.377L13.1328 11.25C14.9727 10.043 16.0449 8.4668 16.0449 7.77539C16.0449 6.57422 12.8047 2.70703 8 2.70703ZM8 12.8496C9.08398 12.8496 10.0742 12.6621 10.9707 12.3516L10.0391 11.4199C9.40039 11.6074 8.72656 11.7246 8 11.7246C4.25586 11.7246 1.2793 8.5957 1.2793 7.77539C1.2793 7.38281 2.27539 6.11133 3.88086 5.12695L2.99609 4.24219C1.08008 5.46094 -0.0507812 7.07227 -0.0507812 7.77539C-0.0507812 8.97656 3.25977 12.8496 8 12.8496ZM10.9238 8.90625C11.0762 8.56055 11.1641 8.17383 11.1641 7.77539C11.1641 6.01172 9.75781 4.62305 8 4.62305C7.5957 4.62305 7.21484 4.69922 6.86328 4.8457L10.9238 8.90625ZM8 10.9336C8.45703 10.9336 8.88477 10.8281 9.26562 10.6465L5.12305 6.49805C4.93555 6.88477 4.83008 7.3125 4.83008 7.78125C4.83594 9.49805 6.23633 10.9336 8 10.9336Z"})})},40113:(e,t,o)=>{o.d(t,{h:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionRelationArrow",{viewBox:"-1 -1 136 22",svg:(0,i.jsx)("path",{d:"M129.646 21.854a.501.501 0 00.708 0l3.182-3.182a.5.5 0 00-.708-.707L130 20.793l-2.828-2.828a.501.501 0 00-.708.707l3.182 3.182zM1 21.5V6H0v15.5h1zm4.5-20H125v-1H5.5v1zm124 4.5v15.5h1V6h-1zM125 1.5a4.5 4.5 0 014.5 4.5h1A5.5 5.5 0 00125 .5v1zM1 6a4.5 4.5 0 014.5-4.5v-1A5.5 5.5 0 000 6h1z"})})},95474:(e,t,o)=>{o.d(t,{p:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionRelationSmallArrowRight",{viewBox:"0 0 33 8",svg:(0,i.jsx)("path",{d:"M32.3536 4.35355C32.5488 4.15829 32.5488 3.84171 32.3536 3.64645L29.1716 0.464466C28.9763 0.269204 28.6597 0.269204 28.4645 0.464466C28.2692 0.659728 28.2692 0.976311 28.4645 1.17157L31.2929 4L28.4645 6.82843C28.2692 7.02369 28.2692 7.34027 28.4645 7.53553C28.6597 7.7308 28.9763 7.7308 29.1716 7.53553L32.3536 4.35355ZM0 4.5H32V3.5H0V4.5Z"})})},19871:(e,t,o)=>{o.d(t,{G:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionSelfRelationArrow",{viewBox:"-1 -1 139 22",svg:(0,i.jsx)("path",{d:"M4.146 21.854a.5.5 0 00.708 0l3.182-3.182a.5.5 0 10-.708-.707L4.5 20.793l-2.828-2.828a.5.5 0 10-.708.707l3.182 3.182zm129.5 0a.501.501 0 00.708 0l3.182-3.182a.5.5 0 00-.708-.707L134 20.793l-2.828-2.828a.501.501 0 00-.708.707l3.182 3.182zM5 21.5V6H4v15.5h1zm4.5-20H129v-1H9.5v1zm124 4.5v15.5h1V6h-1zM129 1.5a4.5 4.5 0 014.5 4.5h1A5.5 5.5 0 00129 .5v1zM5 6a4.5 4.5 0 014.5-4.5v-1A5.5 5.5 0 004 6h1z"})})},9056:(e,t,o)=>{o.d(t,{g:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionShow",{viewBox:"0 0 30 30",svg:(0,i.jsx)("path",{d:"M15,4 C8.641,4 0,10.469 0,15 C0,19.531 8.641,26 15,26 C21.359,26 30,19.531 30,15 C30,10.469 21.359,4 15,4 Z M15,24 C9.149,24 2,17.975 2,15 C2,12.025 9.149,6 15,6 C20.851,6 28,12.025 28,15 C28,17.975 20.851,24 15,24 Z M15,8 C11.134,8 8,11.134 8,15 C8,18.866 11.134,22 15,22 C18.866,22 22,18.866 22,15 C22,11.134 18.866,8 15,8 Z M15,20 C12.238,20 10,17.761 10,15 C10,12.239 12.238,10 15,10 C17.762,10 20,12.239 20,15 C20,17.761 17.762,20 15,20 Z"})})},31505:(e,t,o)=>{o.d(t,{Y:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowLeft",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M0 3.5021C0 3.70786 0.0939831 3.93041 0.237195 4.06479L3.11934 6.76065C3.28493 6.91602 3.48633 7 3.67877 7C4.17106 7 4.48881 6.68506 4.48881 6.27774C4.48881 6.03839 4.37245 5.86203 4.22029 5.72345L3.19095 4.77025L2.56887 4.22855L3.47737 4.27055L8.13625 4.27055C8.6554 4.27055 9 3.96401 9 3.5021C9 3.04019 8.6554 2.73365 8.13625 2.73365L3.47737 2.73365L2.56887 2.77564L3.19095 2.23395L4.22029 1.27654C4.37245 1.13377 4.48881 0.961608 4.48881 0.722255C4.48881 0.314937 4.17106 0 3.67877 0C3.48633 0 3.28493 0.0839832 3.11487 0.239352L0.237195 2.93941C0.0939831 3.07378 0 3.29634 0 3.5021Z"})})},39301:(e,t,o)=>{o.d(t,{n:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("collectionTimelineArrowRight",{viewBox:"0 0 9 7",svg:(0,i.jsx)("path",{d:"M9 3.4979C9 3.29214 8.90602 3.06959 8.7628 2.93521L5.88066 0.239352C5.71507 0.0839835 5.51368 3.13148e-07 5.32123 2.96324e-07C4.82894 2.53287e-07 4.51119 0.314937 4.51119 0.722256C4.51119 0.961608 4.62755 1.13797 4.77971 1.27654L5.80905 2.22975L6.43113 2.77145L5.52263 2.72945L0.863749 2.72945C0.344604 2.72945 -6.62078e-07 3.03599 -7.02459e-07 3.4979C-7.4284e-07 3.95981 0.344604 4.26635 0.863749 4.26635L5.52263 4.26635L6.43113 4.22436L5.80905 4.76605L4.77971 5.72346C4.62755 5.86623 4.51119 6.03839 4.51119 6.27774C4.51119 6.68506 4.82894 7 5.32123 7C5.51367 7 5.71507 6.91602 5.88513 6.76065L8.7628 4.06059C8.90602 3.92622 9 3.70366 9 3.4979Z"})})},45363:(e,t,o)=>{o.d(t,{u:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("folderUnknownLarge",{viewBox:"0 0 48 48",svg:(0,i.jsx)("path",{d:"M39.1702 25.1855C43.1252 25.1855 46.4504 21.8896 46.4504 17.9053C46.4504 13.9062 43.1692 10.625 39.1702 10.625C35.1858 10.625 31.8899 13.9209 31.8899 17.9053C31.8899 21.9189 35.1858 25.1855 39.1702 25.1855ZM11.6604 37.5195H36.1379C38.7014 37.5195 40.1663 36.0547 40.1663 33.2422V26.8408C39.6829 26.9141 38.9504 26.9141 38.3498 26.8408V33.1543C38.3498 34.8389 37.427 35.7178 35.801 35.7178H11.6897C10.0491 35.7178 9.15551 34.8389 9.15551 33.1543V21.1133H30.7327C30.5276 20.5713 30.3811 20 30.3079 19.3994H9.15551V15.3125C9.15551 13.7598 9.94652 12.9834 11.4553 12.9834H14.8391C15.9084 12.9834 16.4797 13.2031 17.2707 13.9062L18.1057 14.6387C19.0286 15.4443 19.761 15.708 21.2405 15.708H30.4543C30.6008 15.0635 30.7766 14.5215 31.0842 13.8916H21.6799C20.5666 13.8916 19.9807 13.6865 19.219 13.0127L18.3694 12.2803C17.4172 11.4307 16.7434 11.1963 15.2786 11.1963H11.1038C8.67211 11.1963 7.3391 12.5293 7.3391 15.21V33.2422C7.3391 36.084 8.80395 37.5195 11.6604 37.5195ZM39.053 19.6924C38.5989 19.6924 38.3352 19.4287 38.3352 18.9746V18.916C38.3352 18.0811 38.76 17.6416 39.4485 17.1582C40.2248 16.6162 40.7375 16.2793 40.7375 15.5615C40.7375 14.9023 40.1955 14.4775 39.3606 14.4775C38.6575 14.4775 38.1741 14.8145 37.8664 15.166C37.6174 15.4297 37.4416 15.6934 37.0608 15.6934C36.6653 15.6934 36.4016 15.4297 36.4016 15.0195C36.4016 14.0088 37.8079 13.1299 39.3606 13.1299C41.133 13.1299 42.2463 14.1699 42.2463 15.4883C42.2463 16.5869 41.6164 17.0557 40.7815 17.6709C40.1077 18.1689 39.844 18.4473 39.7854 19.0479C39.7414 19.4434 39.5071 19.6924 39.053 19.6924ZM39.053 22.5195C38.4817 22.5195 38.0129 22.0508 38.0129 21.4795C38.0129 20.9229 38.4817 20.4541 39.053 20.4541C39.6243 20.4541 40.093 20.9229 40.093 21.4795C40.0784 22.0508 39.6243 22.5195 39.053 22.5195Z"})})},23903:(e,t,o)=>{o.d(t,{P:()=>n});o(67294);var r=o(45238),i=o(85893);const n=(0,r.I)("pin",{viewBox:"0 0 13 19",svg:(0,i.jsx)("path",{d:"M1.25 12.875h4.227v3.648c0 1.196.5 2.188.695 2.188.187 0 .687-.992.687-2.188v-3.648h4.227c.703 0 1.148-.438 1.148-1.102 0-1.648-1.32-3.304-3.359-4.109L8.617 4c.992-.648 1.93-1.383 2.328-1.914.211-.266.305-.531.305-.758 0-.476-.367-.828-.914-.828H2.008c-.555 0-.914.352-.914.828 0 .227.093.492.297.758.398.531 1.343 1.266 2.328 1.914L3.46 7.664C1.42 8.47.1 10.125.1 11.774c0 .664.446 1.101 1.149 1.101zm4.922-5.719c-.5 0-.984.047-1.438.14l.235-3.874c.008-.11-.008-.149-.086-.188-1.172-.601-2.078-1.312-2.14-1.468-.063-.102 0-.164.085-.164h6.68c.086 0 .148.062.086.164-.063.156-.969.867-2.14 1.468-.071.04-.095.079-.079.188l.234 3.875a7.177 7.177 0 00-1.437-.14zm-4.61 4.54c-.18 0-.257-.102-.226-.313.172-1.406 1.969-3.086 4.836-3.086 2.86 0 4.656 1.68 4.828 3.086.031.21-.047.312-.227.312h-9.21z"})})},40591:e=>{e.exports=function(e,t,o){var r=(o=o||{}).marker||":",i=r.charCodeAt(0),n=r.length,s=o.validate||function(e){return e.trim().split(" ",2)[0]===t},a=o.render||function(e,o,r,i,n){return 1===e[o].nesting&&e[o].attrJoin("class",t),n.renderToken(e,o,r,i,n)};e.block.ruler.before("fence","container_"+t,(function(e,o,a,l){var c,d,p,u,h,m,g,y,S=!1,f=e.bMarks[o]+e.tShift[o],x=e.eMarks[o];if(i!==e.src.charCodeAt(f))return!1;for(c=f+1;c<=x&&r[(c-f)%n]===e.src[c];c++);if((p=Math.floor((c-f)/n))<3)return!1;if(c-=(c-f)%n,u=e.src.slice(f,c),h=e.src.slice(c,x),!s(h,u))return!1;if(l)return!0;for(d=o;!(++d>=a)&&!((f=e.bMarks[d]+e.tShift[d])<(x=e.eMarks[d])&&e.sCount[d]<e.blkIndent);)if(i===e.src.charCodeAt(f)&&!(e.sCount[d]-e.blkIndent>=4)){for(c=f+1;c<=x&&r[(c-f)%n]===e.src[c];c++);if(!(Math.floor((c-f)/n)<p||(c-=(c-f)%n,(c=e.skipSpaces(c))<x))){S=!0;break}}return g=e.parentType,y=e.lineMax,e.parentType="container",e.lineMax=d,(m=e.push("container_"+t+"_open","div",1)).markup=u,m.block=!0,m.info=h,m.map=[o,d],e.md.block.tokenize(e,o+1,d),(m=e.push("container_"+t+"_close","div",-1)).markup=e.src.slice(f,c),m.block=!0,e.parentType=g,e.lineMax=y,e.line=d+(S?1:0),!0}),{alt:["paragraph","reference","blockquote","list"]}),e.renderer.rules["container_"+t+"_open"]=a,e.renderer.rules["container_"+t+"_close"]=a}}}]);