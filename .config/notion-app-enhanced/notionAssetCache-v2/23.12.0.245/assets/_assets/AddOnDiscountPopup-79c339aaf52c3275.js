"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9729],{80671:(e,t,o)=>{o.d(t,{Cl:()=>d,Kj:()=>u,k2:()=>r,v5:()=>i});var n=o(4615),a=o(896),s=o(63423);function r(){s.Z.setState({open:!0,stage:"limit_reached",addOnUpgradeId:(0,n.ZP)(),tax:0})}function i(){s.Z.setState({open:!1})}function d(e){const t=s.Z.state;t.open&&s.Z.setState({...t,stage:"confirm_purchase",coupon:e&&!(0,a.$v)(e)?e:void 0})}function u(){s.Z.setState({open:!0,stage:"cancel_plan",addOnUpgradeId:(0,n.ZP)(),tax:0})}},71487:(e,t,o)=>{o.d(t,{A:()=>u,y:()=>d});var n=o(5366),a=o(54642),s=o(47307),r=o(33929);const i=(0,n.defineMessages)({invalidCoupon:{id:"applyCoupon.error.invalidCoupon",defaultMessage:"Unable to apply the coupon to your account."}});async function d(e,t){const{customerId:o,offerType:n}=t,r=await a.getCustomerOffer(e,{customerId:o,newPlan:"downgrade_flow"===n?t.newPlan:void 0,offerType:n});if("failed"===r.type)s.showError(r);else{const e=r.data;if(e.offerType===n)return e.coupon}}async function u(e,t){const{customerId:o,coupon:n,offerType:d}=t;if(!n)return void s.showErrorMessage(r.default.formatMessage(i.invalidCoupon));const u=await a.applyCustomerOffer(e,{customerId:o,newPlan:"downgrade_flow"===d?t.newPlan:void 0,offerType:d,coupon:n});"failed"===u.type&&s.showError(u)}},74011:(e,t,o)=>{o.r(t),o.d(t,{AddOnDiscountPopup:()=>O});var n=o(67294),a=o(480),s=o(86628),r=o(24405),i=o(92595),d=o(11751),u=o(5366),c=o(3791),p=o(896),f=o(50906),l=o(39699),m=o(37181),g=o(38755),_=o(77907),y=o(80444),v=o(78291),S=o(80671),w=o(71487),P=o(70060),h=o(43163),C=o(88893),A=o(35057),b=o(85893);function O(){window.__c={n:"AddOnDiscountPopup"};const e=(0,a.O7)(),[t,o]=n.useState(void 0);(0,n.useEffect)((()=>{(0,i.exposeDebugValue)("resetAddOnDiscountPopup",(()=>{const{currentUserSettingsStore:t}=y.default.state;t&&l.createAndCommit({userAction:"AddOnDiscountPopup.resetAddOnPromoPopup",environment:e,perform:e=>{m.d2({userSettingsStore:t,transaction:e,data:{seen_ai_discount_popup:!1}})}})}))}),[e]);const{currentUserSettingsStore:O,currentSpaceStore:M}=(0,s.VK)((()=>y.default.state),[]),I=(0,s.VK)((()=>v.default.state.data),[]);(0,n.useEffect)((()=>{!async function(){var t;if(!M)return;if(!I)return;if(!(0,C.GJ)(I))return;if("unsubscribed_admin"!==I.type&&"subscribed_admin"!==I.type)return;if("stripe"!==(null===(t=I.customerData)||void 0===t?void 0:t.activeSubscriptionPlatform)||!I.customerData.stripe.isSubscribed)return;const n=C.XX(I);if((0,c.de)(null==n?void 0:n.addOns))return;const a=null!=n&&n.customerId?await w.y(e,{offerType:"add_on_upgrade_flow",customerId:n.customerId}):void 0;(0,p.pp)(a)&&o(a)}()}),[e,M,I]);const x=(0,n.useCallback)((()=>{O&&(l.createAndCommit({userAction:"AddOnDiscountPopup.markSeen",environment:e,perform:e=>{m.d2({userSettingsStore:O,transaction:e,data:{seen_ai_discount_popup:!0}})}}),f.Sh9(e))}),[O,e]),D=(0,n.useCallback)((()=>{t&&(S.k2(),S.Cl(t))}),[t]),k=(0,s.VK)((()=>!(!(0,p.pp)(t)||!(0,P.px)(e,(0,A.zt)())||(0,g.CV)(M))),[t,e,M]),E=(0,r.yK)((e=>({icon:{width:20,height:20,fill:e.accentColors.purple[400]}})),[]);return k?(0,b.jsx)(_.LazyFeatureIntroPopup,{calloutId:"add_on_discount_popup",initialPromo:{icon:d.t,iconStyle:E.icon,header:(0,b.jsx)(u.FormattedMessage,{id:"AddOnDiscountPopup.header",defaultMessage:"Add unlimited AI for {percentage} off?",values:{percentage:(0,p.pp)(t)?(0,h.o)(t):void 0}}),description:(0,b.jsx)(u.FormattedMessage,{id:"AddOnDiscountPopup.description",defaultMessage:"Project management is better with Notion AI. Add it on top of your paid plan with half off."})},steps:[],seenFeatureUserSetting:"seen_ai_discount_popup",userSettingsStore:O,allowExternalMouseEvents:!0,onDismiss:x,onTryFeatureClick:D,isUserEligible:k,onPopupSeen:()=>f.Cdl(e),onLearnMore:()=>{t&&D(),x()},ctaMessage:(0,b.jsx)(u.FormattedMessage,{id:"AddOnDiscountPopup.purchase.button",defaultMessage:"Claim your deal"})}):null}},43163:(e,t,o)=>{o.d(t,{o:()=>r});o(67294);var n=o(5366),a=o(97880),s=o(85893);function r(e){switch(e){case"ai_fifty_percent":return(0,s.jsx)(n.FormattedMessage,{id:"addOnUpgrade.confirmation.costSection.specialDiscounts.fiftyPercent",defaultMessage:"50%"});default:(0,a.t1)(e)}}},63423:(e,t,o)=>{o.d(t,{Z:()=>s});var n=o(49085);class a extends n.default{getInitialState(){return{open:!1}}}const s=new a}}]);