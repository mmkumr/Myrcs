"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8611],{68611:(e,t,i)=>{i.r(t),i.d(t,{default:()=>B});var s=i(67294),n=i(40782),r=i(83355),o=i(8848),a=i(37652),l=i(35840),d=i(72126),c=i(89101),h=i(82990),p=i(77671),u=i(54642),m=i(75018),f=(i(95477),i(59266)),g=i(28020),y=i(45023),v=i(91203),x=i(33846),S=i(72087),j=i(31150),w=i(86867),R=i(74194),C=i(84076),b=i(63296),I=i(77137),k=i(36360),Z=(i(27369),i(85893));class V extends r.Z{constructor(){super(...arguments),this.searchRef=s.createRef(),this.firstApiRef=s.createRef(),this.apiSectionRefs={find:s.createRef(),findAdminLogs:s.createRef(),pricing:s.createRef(),recovery:s.createRef(),security:s.createRef(),saml:s.createRef(),contentModeration:s.createRef(),rateLimits:s.createRef(),experiments:s.createRef(),utilities:s.createRef(),integrations:s.createRef(),marketing:s.createRef(),domainClaim:s.createRef(),spaceConsolidation:s.createRef(),ai:s.createRef()},this.storeTypes={searchStore:x.Z,ownershipRequestStore:S.Z},this.performGetOwnershipRequest=async()=>{const e=await u.adminGetOwnership(this.environment,{});if("failed"!==e.type)return e.data},this.scrollToSection=e=>{const t=this.apiSectionRefs[e];t.current&&t.current.scrollIntoView()},this.handleKeyDown=e=>{(0,y.Z)(this.environment,e,"command+/")&&(e.preventDefault(),this.stores.searchStore.reset(),this.searchRef.current&&this.searchRef.current.focusInput())},this.handleLogOut=()=>{p.B(this.environment)},this.filterStore=this.createComputedStore((()=>{const e=this.stores.searchStore.state.inputValue.toLowerCase();if(!(e.length<=1))try{return new RegExp(e,"i")}catch(t){return void console.error(`Can't filter with invalid regex "${e}"`,t)}}))}didMount(){window.addEventListener("keydown",this.handleKeyDown)}willUnmount(){window.removeEventListener("keydown",this.handleKeyDown)}renderComponent(){const e=(0,g.B7)(this.environment),{searchStore:t,ownershipRequestStore:i}=this.stores,s=(0,f.v2)(),r=s?f.Fr:f.AA,d=this.filterStore.state,p=void 0!==d?r.filter((e=>(0,f.H2)(e,d))):r,u=new Set(v.Z.getState()||[]),y=p.filter((e=>u.has(e.apiName))).map((e=>{const t=i.state.result?i.state.result[e.apiName]:void 0;return(0,Z.jsx)(j.Z,{style:V.itemStyle,api:e,owner:t},e.apiName)})),x=this.renderSection({key:"favorites",title:"⭐ Favorites",children:y});let S=!0;const B=f.KC.map((e=>{const t=p.filter((t=>t.sectionName===e)).map((e=>{const t=S?this.firstApiRef:void 0,s=i.state.result?i.state.result[e.apiName]:void 0;return S=!1,(0,Z.jsx)(j.Z,{style:V.itemStyle,ref:t,api:e,owner:s},e.apiName)}));return this.renderSection({key:e,title:f._c[e].title,children:t})})),L={request:{},performRequest:this.performGetOwnershipRequest,render:()=>null};return(0,Z.jsxs)(k.Z,{title:"Notion Admin Mode",children:[(0,Z.jsxs)("div",{style:V.wrapStyle,children:[(0,Z.jsxs)("div",{style:V.style,children:[(0,Z.jsxs)("div",{style:V.itemStyle,children:[(0,Z.jsxs)("div",{style:V.headerStyle,children:["Notion ",!s&&"Restricted"," Admin Mode"," ",void 0]}),(0,Z.jsxs)("div",{style:{marginBottom:12},children:[(0,Z.jsx)(C.Z,{href:"https://dev.notion.so/notion/Use-Admin-Mode-05f1e0ad9aa749a4b3dc07410b499465",external:!0,inline:!0,underline:!0,children:"Click here"})," ","to learn more about how to use Admin Mode."]}),(0,Z.jsxs)("div",{style:{display:"flex"},children:[(null==e?void 0:e.isDefined())&&(0,Z.jsxs)("div",{style:{flex:1},children:["Currently Logged in as: ",e.getEmail()]}),!(null!=e&&e.isDefined())&&(0,Z.jsx)("div",{style:V.warningTextStyle,children:(0,Z.jsx)(C.Z,{innerStyle:{textDecoration:"underline"},href:c._j.login,children:"Please log in."})}),(null==e?void 0:e.isDefined())&&(0,Z.jsx)(b.Z,{onClick:this.handleLogOut,style:{height:"auto"},children:"Log Out"})]}),s&&(0,Z.jsx)(w.Z,{}),!s&&(0,Z.jsxs)(b.Z,{onClick:()=>{m.navigate({environment:this.environment,url:"/"})},style:{marginTop:12,display:"flex",alignItems:"center"},children:[(0,a.V)({width:12,height:12,marginRight:12}),"Navigate to user workspace"]})]}),(0,Z.jsxs)("div",{style:V.itemStyle,children:[(0,Z.jsx)("div",{style:{fontWeight:h.Z.fontWeight.bold,fontSize:18,marginBottom:6},children:"Go to (cmd-/)"}),(0,Z.jsx)("div",{style:{marginBottom:14,display:"flex"},children:(0,Z.jsx)(R.Z,{showClearButton:!0,placeholder:"Filter, then press enter to jump",ref:this.searchRef,focusInitial:!0,value:this.stores.searchStore.state.inputValue,onChange:e=>{t.setState({...t.state,inputValue:e.target.value})},left:(0,l.R)({width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:o.Vx().mediumIconColor}),onSubmit:()=>{this.firstApiRef.current&&this.firstApiRef.current.focus()}})}),f.KC.map((e=>(0,Z.jsx)("div",{style:{marginTop:6},children:(0,Z.jsx)(C.Z,{onClick:()=>this.scrollToSection(e),underline:!0,children:f._c[e].title})},e)))]}),x,B,p.length<r.length&&(0,Z.jsxs)("div",{style:{opacity:.7,width:"100%",color:o.Vx().lightIconColor,margin:8,fontStyle:"italic"},children:[r.length-p.length,' hidden. To show all, press Cmd-/ or click "Clear" above.',(0,Z.jsx)("br",{}),this.randomQuip()]})]}),(0,Z.jsx)(n.Ix,{hideProgressBar:!0,autoClose:1500,transition:n.Mi})]}),(0,Z.jsx)(I.Z,{...L,requestStore:i})]})}renderSection(e){const{title:t,children:i,key:s}=e;if(i&&(!Array.isArray(i)||i.length))return(0,Z.jsxs)("div",{ref:this.apiSectionRefs[s],id:s,style:{...V.style,marginTop:12,marginBottom:12,width:"100%"},children:[(0,Z.jsx)("div",{style:{...V.headerStyle,width:"100%",marginLeft:V.itemStyle.margin},children:t}),i]},s)}randomQuip(){return d.UP(["Hi, spam duplicate","Your hair is looking so nice today!",'"The faster we are at getting botter, the faster we get botter" - Doug EngelBot',"You're doing a great job, keep it up!!","Computing for everyone","Remember to take a stretch break every once in a while"])}}V.displayName="Admin",V.wrapStyle={height:"100vh",overflow:"auto",background:o.Vx().sidebarBackground,padding:8},V.style={display:"flex",flexWrap:"wrap"},V.headerStyle={fontWeight:h.Z.fontWeight.bold,fontSize:36},V.itemStyle={width:500,padding:18,margin:8,border:`1px solid ${o.Vx().outlineButtonBorder}`,background:"white",position:"relative"},V.warningTextStyle={fontWeight:h.Z.fontWeight.bold,color:"red"};const B=V},31150:(e,t,i)=>{i.d(t,{Z:()=>F});i(21703),i(57658);var s=i(67294),n=i(83355),r=i(480),o=i(49085),a=i(8848),l=i(72126),d=i(4615),c=i(89101),h=i(97880),p=i(82990),u=i(5366),m=i(54642),f=i(92625),g=i(53471),y=i(59266),v=i(24608),x=i(77907);class S extends o.default{getInitialState(){return{inputValues:{}}}}const j=S;var w=i(91203),R=i(3104),C=i(52275),b=i(60458),I=i(41358),k=i(74194),Z=i(84076),V=i(68785),B=i(50506),L=i(63296),M=i(45959),A=i(64369),N=i(62069),E=i(85893);const T={...["userId","spaceId","blockId","pageId","integrationId","spaceId","fileId","teamId","collectionId","botId"].reduce(((e,t)=>({[t]:y.b9,[`${t}s`]:y.uy,...e})),{}),...["userEmail","fromEmail","toEmail"].reduce(((e,t)=>({[t]:y.cL,[`${t}s`]:y.VX,...e})),{}),domain:y.Ic,domains:y.EJ,supportTicketLink:y.ZT};function O(e){window.__c={n:"ImageUploadInput"};const{fieldName:t,acceptMultiple:i,store:n}=e,[o,l]=(0,s.useState)((()=>({isUploading:!1,errorMessage:void 0,uploadedFileUrls:[]}))),d=(0,r.O7)();return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(L.Z,{isLarge:!0,style:{width:"fit-content",backgroundColor:"white"},onClick:()=>{g.cR({multiple:!!i,environment:d,onStart:()=>{l({...o,isUploading:!0,errorMessage:void 0,uploadedFileUrls:[]})},bucket:"public",onError:e=>{l({isUploading:!1,errorMessage:e.message,uploadedFileUrls:[]})},onComplete:e=>{l({isUploading:!1,errorMessage:void 0,uploadedFileUrls:e}),n.setState({response:void 0,inputValues:{...n.state.inputValues,[t]:i?e:e[0]}})},accept:"image/*"})},children:[i?"Upload images":"Upload image",o.isUploading&&(0,E.jsx)(V.Z,{style:{marginLeft:4}})]}),o.uploadedFileUrls&&(0,E.jsx)("div",{children:o.uploadedFileUrls.join(",")}),o.errorMessage&&(0,E.jsx)("div",{style:{color:a.ZP.red,display:"inline-flex",marginLeft:8},children:o.errorMessage})]})}const U=(0,u.defineMessages)({loading:{id:"adminAPIRequest.loadingMessage",defaultMessage:"Loading…"}});class D extends n.Z{constructor(){super(...arguments),this.firstInputRef=s.createRef(),this.fileInputRef=s.createRef(),this.storeTypes={store:j,fileNameStore:o.default.createClass("")},this.buildPlaceholder=(e,t)=>void 0!==t.placeholder?t.placeholder:e in T?T[e]:void 0,this.renderKey=(e,t,i)=>{const{store:s}=this.stores,n=s.state.inputValues[t],r=0===i?this.firstInputRef:void 0;let o;if(e.type===y.It.String)o=(0,E.jsx)(k.Z,{ref:r,value:"string"==typeof n?n:"",placeholder:this.buildPlaceholder(t,e),showClearButton:!0,onChange:e=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:e.target.value}})},onSubmit:this.handleSubmit,onClearButtonClick:()=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:void 0}})}});else if(e.type===y.It.Number)o=(0,E.jsx)(k.Z,{ref:r,type:"number",value:"number"==typeof n?n.toString():"",onChange:e=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:parseInt(e.target.value)}})},onSubmit:this.handleSubmit});else if(e.type===y.It.Options){const i=[D.undefinedKey,...e.options],r={menuTitle:t,items:i,selectedItem:n,onSelect:e=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:e===D.undefinedKey?void 0:e}})},getKey:e=>e,renderItem:e=>(0,E.jsx)(C.Z,{...e,title:e.value===D.undefinedKey?"Empty":e.value}),renderOrigin:e=>(0,E.jsx)(L.Z,{isLarge:!0,style:{marginBottom:8},...e,children:n||"Empty"}),width:300};o=(0,E.jsx)(M.Z,{...r})}else if(e.type===y.It.Boolean)o=(0,E.jsx)(b.Z,{checked:Boolean(n),size:20,onClick:e=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:!Boolean(n)}})}});else if(e.type===y.It.Csv)o=(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(L.Z,{isLarge:!0,onClick:()=>{var e;null===(e=this.fileInputRef)||void 0===e||null===(e=e.current)||void 0===e||e.click()},style:{marginRight:10},children:"Upload"}),this.stores.fileNameStore.state,(0,E.jsx)("input",{ref:this.fileInputRef,style:{display:"none"},type:"file",name:e.name||"csv file",onChange:e=>this.handleOnChangeCsvFile(t,e)})]});else if(e.type===y.It.Image||e.type===y.It.Images){const i=e.type===y.It.Images;o=(0,E.jsx)(O,{fieldName:t,acceptMultiple:i,store:s})}else e.type===y.It.Timezone?o=(0,E.jsx)(N.Z,{renderOrigin:e=>(0,E.jsx)(L.Z,{...e,children:n}),onSelect:e=>{s.setState({response:void 0,inputValues:{...s.state.inputValues,[t]:e}})}}):(0,h.t1)(e);return(0,E.jsxs)("div",{children:[(0,E.jsx)("div",{style:{marginTop:12,marginBottom:4},children:l.fl(t)}),e.comment&&(0,E.jsx)(A.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4,marginBottom:8},children:e.comment}),o]},t)},this.handleOnChangeCsvFile=async(e,t)=>{const{store:i,fileNameStore:s}=this.stores,n=t.target.files;if(null==n||!n.length)return;const r=n[0],o=await r.text();s.setState(r.name),i.setState({response:void 0,inputValues:{...i.state.inputValues,[e]:o}})},this.handleSubmit=()=>{this.props.api.confirmationApiName?this.handleConfirm():this.handleConfirmedSubmit()},this.handleConfirm=()=>{const{store:e}=this.stores,{confirmationApiName:t,schema:i}=this.props.api,{inputValues:s}=e.state;if(!t)throw new Error("Should not have gotten here without a confirmationApiName");const n=this.normalizeInputValues(s,i),r=m[t];if(!r)throw new Error(`Missing api handler for ${t} - likely either a typo in client/helpers/adminHelpers.tsx or missing declaration in client/actions/api.ts`);f.j({message:U.loading}),r(this.environment,n).then((t=>{f.x(),this.downloadAsCsv(t),e.setState({...e.state,confirmationResponse:t})}))},this.handleConfirmedSubmit=()=>{const{store:e}=this.stores,{apiName:t,schema:i}=this.props.api,{inputValues:s}=e.state,n=this.normalizeInputValues(s,i);f.j({message:U.loading});const r=m[t];if(!r)throw new Error(`Missing api handler for ${t} - likely either a typo in client/helpers/adminHelpers.tsx or missing declaration in client/actions/api.ts`);r(this.environment,n).then((t=>{f.x(),this.downloadAsCsv(t)||e.setState({...e.state,confirmationResponse:void 0,response:t})}))},this.handleCancel=()=>{const{store:e}=this.stores;e.setState({inputValues:e.state.inputValues})},this.handleModalDismiss=()=>{const{store:e}=this.stores;if(!e.state.response)return;"failed"===e.state.response.type||this.props.api.isReadOnly?e.setState({inputValues:e.state.inputValues}):this.resetStoreState(this.props)},this.handlePin=()=>{const{api:e}=this.props,t=w.Z.getState()||[],i=t.indexOf(e.apiName);-1===i?t.push(e.apiName):t.splice(i,1),w.Z.setState(t)}}willMount(e){this.resetStoreState(e)}didMount(){this.shouldShowInline()&&this.handleSubmit()}renderComponent(){const{api:e,owner:t,defaultParams:i,style:s}=this.props,{apiName:n,displayName:r,schema:o,description:a,emoji:d,isDestructive:c}=e,h=(0,y.G0)(n),p=-1!==(w.Z.getState()||[]).indexOf(n)?"⭐":"☆",{confirmationResponse:u,response:m}=this.stores.store.state;return(0,E.jsxs)("div",{style:s,children:[(0,E.jsxs)("div",{style:D.headerStyle,children:[(0,E.jsx)(I.Z,{size:24,emoji:d}),(0,E.jsx)("span",{style:{marginLeft:4},children:r||l.fl(n.replace(/^(admin)/,""))}),(0,E.jsx)("span",{style:{flexGrow:1}}),(0,E.jsx)("a",{onClick:this.handlePin,style:{cursor:"pointer"},children:(0,E.jsx)(I.Z,{size:18,emoji:p})})]}),a&&(0,E.jsx)(A.Z,{isSmall:!0,isMultiline:!0,children:a}),!this.shouldShowInline()&&(0,E.jsxs)(E.Fragment,{children:[Object.entries(o).map(((e,t)=>{let[s,n]=e;return i&&i[s]?void 0:this.renderKey(n,s,t)})),(0,E.jsx)(L.Z,{style:{marginTop:8,marginBottom:8},isLarge:!0,onClick:this.handleSubmit,isRed:c,children:"Submit"})]}),this.shouldShowInline()&&!m&&(0,E.jsxs)("div",{children:[(0,E.jsx)(V.Z,{style:{width:18,height:18}}),"Loading ..."]}),this.renderError(u),this.renderConfirmation(u),this.renderError(m),this.renderResponse(m),(h||t)&&(0,E.jsxs)("div",{style:D.footerStyle,children:[t&&(0,E.jsxs)("span",{children:["Owned by"," ",(0,E.jsx)("a",{href:`https://notion.slack.com/app_redirect?channel=${t.slackChannel}`,children:t.teamName})]}),h&&t&&(0,E.jsx)("span",{children:" | "}),h&&(0,E.jsx)("span",{children:"Full Admin Tool"})]})]})}renderConfirmation(e){if(e&&"success"===e.type)return(0,E.jsx)(B.Z,{open:!0,innerStyle:D.modalStyle,onDismiss:this.handleCancel,disableAnimation:!0,render:()=>(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(A.Z,{isSmall:!0,isMultiline:!0,style:{marginBottom:8},children:"Does this information about the action you're about to take look good to you? Hit Confirm if it does. Cancel if not."}),(0,E.jsx)(x.LazyAdminReactJson,{data:e.data}),(0,E.jsx)(L.Z,{style:{marginTop:8,marginBottom:8},isLarge:!0,onClick:this.handleConfirmedSubmit,children:"Confirm"}),(0,E.jsx)(L.Z,{style:{marginTop:8,marginBottom:8,marginLeft:8},isLarge:!0,onClick:this.handleCancel,children:"Cancel"})]})})}renderError(e){if(!e)return;if("success"===e.type)return;const t=(0,v.pO)(e);return 401===e.status?(0,E.jsxs)("div",{style:D.responseErrorStyle,children:[t," Likely fixed by"," ",(0,E.jsx)(Z.Z,{innerStyle:{textDecoration:"underline"},href:c._j.login,children:"signing in."})]}):(0,E.jsx)("div",{style:D.responseErrorStyle,children:t})}renderResponse(e){if(!e||"success"!==e.type)return;const t=this.props.api.customResponseRenderer?(0,E.jsx)(this.props.api.customResponseRenderer,{data:e.data,environment:this.environment,singleRecordMode:this.props.singleRecordMode}):(0,E.jsx)(R.Z,{data:e.data});return this.shouldShowInline()?t:(0,E.jsx)(B.Z,{open:Boolean(e&&"success"===e.type),innerStyle:D.modalStyle,onDismiss:this.handleModalDismiss,disableAnimation:!0,render:()=>t})}focus(){this.firstInputRef.current&&this.firstInputRef.current.focusInput()}downloadAsCsv(e){if(s=e,Boolean("success"===s.type&&Array.isArray(null===(n=s.data)||void 0===n?void 0:n.rows)&&(null===(r=s.data)||void 0===r?void 0:r.rows.length)>0&&"string"==typeof(null===(o=s.data)||void 0===o?void 0:o.filename))){const{filename:s,rows:n}=e.data,r=Array.from(n.reduce(((e,t)=>(Object.keys(t).forEach((t=>e.add(t))),e)),new Set)),o=[r];for(const e of n){const t=new Array(r.length);for(let i=0;i<t.length;i++){const s=r[i];t[i]=e[s]}o.push(t)}const a=o.map((e=>e.join(","))).join("\n");var t=new Blob([a],{type:"data:text/csv"}),i=window.URL.createObjectURL(t);const l=document.createElement("a");return l.download=s,l.href=i,l.click(),!0}var s,n,r,o;return!1}shouldShowInline(){const{showByDefault:e,singleRecordMode:t}=this.props;return e&&t}resetStoreState(e){const{defaultParams:t}=e,{store:i}=this.stores,s={};for(const n of Object.keys(e.api.schema)){const i=e.api.schema[n];t&&t[n]?s[n]=t[n]:i&&void 0!==i.defaultValue?s[n]=i.defaultValue:s[n]=void 0}i.setState({inputValues:s})}normalizeInputValues(e,t){const i={};for(const s of Object.keys(e)){const n=e[s];t[s]&&(l.HD(n)&&d.qn(n.trim())?i[s]=d.wr(n.trim()):i[s]=n)}return i}}D.undefinedKey="__undefined",D.headerStyle={fontWeight:p.Z.fontWeight.bold,fontSize:20,display:"flex",alignItems:"center",marginBottom:6},D.footerStyle={fontSize:10,position:"absolute",bottom:7,right:20},D.responseErrorStyle={color:a.ZP.red,display:"inline-block",marginLeft:8},D.modalStyle={width:"calc(100% - 120px)",height:"calc(100% - 120px)",padding:24,fontSize:"1.2em",overflow:"scroll"};const F=D},91203:(e,t,i)=>{i.d(t,{Z:()=>r});var s=i(53809),n=i(30548);const r=new s.D({key:"adminFavoriteToolsSetting",namespace:n.$p,important:!1,trackingType:"preference"})},37652:(e,t,i)=>{i.d(t,{V:()=>r});i(67294);var s=i(45238),n=i(85893);const r=(0,s.I)("arrowLeft",{viewBox:"0 0 30 30",svg:(0,n.jsx)("polygon",{points:"29 14 4.813 14 13.406 5.406 12 4 1 15 12 26 13.406 24.594 4.813 16 29 16"})})},27369:()=>{}}]);