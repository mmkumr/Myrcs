"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[9938],{31192:(e,t,i)=>{i.d(t,{Z:()=>Tt});i(57658),i(30541);var s=i(94184),o=i.n(s),n=i(67294),r=i(1302),a=i(13991),l=i(6740),d=i(49085),h=i(99747),c=i(41432),p=i(99036),g=i(80951),u=i(6695),m=i(42875),S=i(65955),C=i(64788),v=i(68074),k=i(9999),y=i(27961),P=i(98519),x=i(83303),f=i(72126),b=i(6287),w=i(23867),M=i(90965),T=i(70203),B=i(82990),D=i(51454),j=i(5366),V=i(50906),E=i(35253),I=i(54564),F=i(51365),L=i(96802),_=i(32603),A=i(72711),R=i(61916),H=i(24677),Z=i(98104),O=i(29373),W=i(39699),z=i(89626),U=i(57819),N=i(19977),G=i(34047),$=i(92650),K=i(82994),X=(i(95477),i(66890)),q=i(28020),Q=i(80365),Y=i(43250),J=i(75079),ee=i(78316),te=i(19124),ie=i(11599),se=i(12534),oe=i(83055),ne=i(70177),re=i(33929),ae=i(87279),le=i(39500),de=i(45162),he=i(98165),ce=i(66430),pe=i(94134),ge=i(65598),ue=i(18514),me=i(45010),Se=i(77546),Ce=i(89086),ve=i(77907),ke=i(18245),ye=i(49427),Pe=i(24646),xe=i(5162),fe=i(80444),be=i(61766),we=i(886),Me=i(16772),Te=i(80796),Be=i(77080),De=i(73329),je=i(29755),Ve=i(77144),Ee=i(22294),Ie=i(29798),Fe=i(31792),Le=i(19671),_e=i(63971),Ae=i(94896),Re=i(82136),He=i(91551),Ze=i(13023),Oe=i(88923),We=i(69784),ze=i(27724),Ue=i(17963),Ne=i(4350),Ge=i(85854),$e=i(78030),Ke=i(53223),Xe=i(15201),qe=i(68709),Qe=i(23063),Ye=i(91754),Je=i(31945),et=i(25821),tt=i(68785),it=i(78140),st=i(40721),ot=i(89728),nt=i(26388),rt=i(58792),at=i(98272),lt=i(67064),dt=i(99731),ht=i(79354),ct=i(16720),pt=i(6779),gt=i(2524),ut=i(56507),mt=i(5618),St=i(22735),Ct=i(35943),vt=i(21953),kt=i(55217),yt=i(74169),Pt=i(16738),xt=i(3553),ft=i(37451),bt=i(85893);function wt(e){return!!e.isIOS&&"on"===Be.default.getGroup("multi-select-new-page-view-block-layout")}class Mt extends Ge.Z{constructor(){super(...arguments),this.contentEl=null,this.clickedAddIconState=!1,this.openResolvedDiscussionPopup=()=>{this.stores.resolvedDiscussionButtonPopupStore.setState({open:!0}),this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0})},this.getContentWrapEl=()=>this.contentEl,this.collectionContextStore=new we.Z(this.environment),this.discussionInputStore=new K.Z(this.environment,(0,w.C)(this.props.store.pointer.spaceId)),this.documentViewHorizontalOffset=this.createComputedStore((()=>{const{store:e}=this.props;return this.marginCommentsVisible.state&&!this.props.store.isFullWidth()?(0,$.gC)(this.environment,(0,ee.en)(e),(0,ee.Ks)(e)):0})),this.isCompletionsUiVisible=this.createComputedStore((()=>Boolean((0,U.RR)(Me.default.state)))),this.storeTypes={headerFocusStore:d.default.createClass(!1),headerMouseStore:Fe.Z,detailsFocusStore:d.default.createClass(!1),detailsMouseStore:Fe.Z,pageViewBlockStore:Re.Z,resolvedDiscussionButtonPopupStore:be.Z,backlinksButtonPopupStore:be.Z,templatePickerMenuListStore:Ie.Z,pageDescriptionStore:_e.Z,loadingPageCoverStore:d.default.createClass(!1)},this.getHorizontalTransformStyles=()=>{const e=this.documentViewHorizontalOffset.state;return{layout:{translateX:-1*e},layoutFull:{translateX:e}}},this.headerAndBottomControlsStore=this.createComputedStore((()=>{if(this.isMiniPeekContext())return{bottomControls:[]};let e=[],t=[];const i=this.pageExpandedBacklinksRenderState(),s=this.pageDiscussionsRenderState({disableDiscussionInput:!1});e=this.getTopControls(),t=this.getBottomControls(i,s);const o=this.getCommentControlPlacement({isTopControlsEmpty:0===e.length,isBottomControlsEmpty:0===t.length,discussionsRenderState:s});"top"===o?e.push(this.renderAddDiscussion({isBottomControl:!1})):"bottom"===o&&t.push(this.renderAddDiscussion({isBottomControl:!0}));return{headerControls:(0,bt.jsx)("div",{style:this.getHeaderControlsStyle(),className:"notion-page-controls",children:e}),bottomControls:t}})),this.hasCoverStore=this.createComputedStore((()=>this.props.store.hasCover())),this.hasIconStore=this.createComputedStore((()=>this.props.store.hasIcon())),this.renderBacklinksIcon=e=>(0,k.J)({...e,transform:"rotate(180deg)"}),this.titleStore=this.createComputedStore((()=>this.props.store.getTitleStore())),this.handleAddIconClick=()=>{this.clickedAddIconState=!1},this.handleAddRandomIconClick=()=>{const{store:e}=this.props;W.createAndCommit({userAction:"PageViewBlock.handleAddRandomIconClick",environment:this.environment,perform:t=>{L.is({store:e,transaction:t})}}),this.clickedAddIconState=!0},this.handleAddRandomCoverClick=async()=>{const{store:e}=this.props,{environment:t}=this,i=e.getCoverStore();if(!i)return;if(i.getValue())return;this.stores.loadingPageCoverStore.setState(!0);const s=(await ve.deps.pageCovers.loader()).default;W.createAndCommit({userAction:"PageViewBlock.handleAddRandomCoverClick",environment:t,perform:t=>{A.tk({transaction:t,store:e,coverStore:i,pageCovers:s})}}),this.stores.loadingPageCoverStore.setState(!1)},this.handleAddDiscussion=async()=>{this.stores.pageViewBlockStore.setState({...this.stores.pageViewBlockStore.state,forceDiscussionOpen:!0}),V.ZW8(this.environment,{from:"page_comments"}),await r.default.afterNextFlush(),Z.NX({store:this.discussionInputStore.state.textStore})},this.handleShowBacklinks=()=>{this.setBacklinksToggleState(!0)},this.handleShowDiscussion=()=>{this.setDiscussionToggleState(!0)},this.handleAddDescriptionClick=()=>{const{device:e}=this.environment,{pageDescriptionStore:t}=this.stores,{currentUserSettingsStore:i}=fe.default.state,s=this.getDescriptionStore();R.YT({environment:this.environment,pageId:this.props.store.id,store:t,userSettingsStore:i,isExpanded:!0,descriptionStore:s}),r.default.afterNextFlush((()=>{const t=this.getDescriptionStore();t&&(e.isMobileBrowser||Z.NX({store:t}))}))},this.handleHeaderFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,l.E)(t)&&this.stores.headerFocusStore.setState(!0)},this.handleHeaderBlur=()=>{this.stores.headerFocusStore.setState(!1)},this.handleDetailsFocus=e=>{const t=e.target;void 0!==t&&t instanceof HTMLElement&&(0,l.E)(t)&&this.stores.detailsFocusStore.setState(!0)},this.handleDetailsBlur=()=>{this.stores.detailsFocusStore.setState(!1)},this.handleHeaderMouseEnter=()=>{Te.Z.state.isDragging||We.Z.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!0})},this.handleHeaderMouseLeave=()=>{Te.Z.state.isDragging||We.Z.state.isActive||this.stores.headerMouseStore.setState({...this.stores.headerMouseStore.state,mouseEntered:!1})},this.handleDetailsMouseEnter=()=>{Te.Z.state.isDragging||We.Z.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!0})},this.handleDetailsMouseLeave=()=>{Te.Z.state.isDragging||We.Z.state.isActive||this.stores.detailsMouseStore.setState({...this.stores.detailsMouseStore.state,mouseEntered:!1})},this.handleHideDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=fe.default.state,i=this.props.store.id,s=this.getDescriptionStore();R.YT({environment:this.environment,pageId:i,isExpanded:!1,store:e,userSettingsStore:t,descriptionStore:s})},this.handleShowDescription=()=>{const{pageDescriptionStore:e}=this.stores,{currentUserSettingsStore:t}=fe.default.state,i=this.props.store.id,s=this.getDescriptionStore();R.YT({environment:this.environment,pageId:i,isExpanded:!0,store:e,userSettingsStore:t,descriptionStore:s})},this.handleHeaderMouseEnterThrottled=f.P2(this.handleHeaderMouseEnter,100),this.handleHeaderMouseLeaveDebounced=f.Ds(this.handleHeaderMouseLeave,100),this.handleDetailsMouseEnterThrottled=f.P2(this.handleDetailsMouseEnter,100),this.handleDetailsMouseLeaveDebounced=f.Ds(this.handleDetailsMouseLeave,100),this.handleTitleEditText=e=>{const t=this.titleStore.state;t&&(H.eP({environment:this.environment,store:this.props.store}),e.isAtStartOfLine?Z.N_({store:t}):Z.NX({store:t}))},this.handleTitleEsc=e=>{const{onTitleEsc:t}=this.props;Z.ZH(this.environment),H.ZH(this.environment),t&&t(e)},this.handleTitleTab=e=>{const{store:t,preventDefaultTitleTabBehavior:i}=this.props;if(i)return!0;if(e.preventDefault(),this.shouldShowProperties()){const e=this.getFormat();if(e&&e.collection_page_properties){const i=e.collection_page_properties.find(((e,t)=>this.canOpenProperty(e.property)));i&&r.default.afterNextFlush((()=>{F.bA({environment:this.environment,blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),collectionContextStore:this.collectionContextStore,store:t,property:i.property,format:$e.C.Page})}))}}},this.handleTitleUntab=e=>{if(this.props.preventDefaultTitleUntabBehavior)return!0;this.handleTitleEsc(e)},this.handlePlaceholderClick=()=>{const{store:e}=this.props;!e.canEdit()||this.props.store.isLocked()||this.shouldShowSpinner()||(0,le.X9)()||W.createAndCommit({userAction:"PageViewBlock.handlePlaceholderClick",environment:this.environment,perform:t=>{O.ls({environment:this.environment,store:e,transaction:t})}})},this.handlePlaceholderWrapClick=e=>{(0,se.ZP)({event:e,context:se.Af.EditorClick,callback:this.handlePlaceholderClick})},this.handleTitleChange=()=>{this.stores.templatePickerMenuListStore.reset()},this.handleAddTitleClick=()=>{const e=this.titleStore.state;e&&(H.ZH(this.environment),Z.NX({store:e}))},this.numberOfBacklinks=this.createComputedStore((()=>(0,Q.L)(this.props.store,this.environment).backlinks.length)),this.discussionToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"discussion",id:e})})),this.backlinksToggleStore=this.createComputedStore((()=>{const e=this.props.store.id;return"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.getToggleState({environment:this.environment,type:"backlinks",id:e})})),this.inlinePropertyIDsStore=this.createComputedStore((()=>{const e=this.getFormat();if(!e)return;const{store:t}=this.props,i=e.collection_page_sections||[],s=this.getSchema();return i.filter((e=>{const i=s[e.section];if(!i||"relation"!==i.type)return;const o=t.getPropertyValue(e.section),n=g.j$({relationValue:g.rq(o),propertySchema:i,getRecordModel:t.getRecordModel}).length;return"inline"===e.visibility&&s[e.section]&&0!==n})).map((e=>e.section))})),this.minimalPropertyIDsStore=this.createComputedStore((()=>{const e=this.getFormat();if(!e)return;const{store:t}=this.props,i=e.collection_page_sections||[],s=this.getSchema();return i.filter((e=>{const i=s[e.section];if(!i||"relation"!==i.type)return;const o=t.getPropertyValue(e.section),n=g.j$({relationValue:g.rq(o),propertySchema:i,getRecordModel:t.getRecordModel}).length;return"minimal"===e.visibility&&s[e.section]||"inline"===e.visibility&&s[e.section]&&0===n})).map((e=>e.section))})),this.showTemplatePickerStore=this.createComputedStore((()=>{const{store:e,loadingContainerStore:t}=this.props,i=this.environment.currentUser.isLoggedIn(),s=this.pageContext&&this.pageContext.publicEditModeStore.state;return Boolean(e&&t&&e.isDefined()&&!e.isLocked()&&e.canEdit()&&!e.hasContent()&&i&&(!(null!=s&&s.hasPublicPermission)||"edit"===(null==s?void 0:s.permission))&&!this.shouldShowSpinner()&&t.state.ready&&!this.isExternallySyncedPage()&&(!(0,te.GD)(s)||"completionPopup"!==Me.default.state.type))})),this.emptyTitlePlaceholderStore=this.createComputedStore((()=>{const{store:e,titlePlaceholder:t}=this.props,i=e.getModel();return t??(null==i?void 0:i.getEmptyTitlePlaceholder({getRecordModel:e.getRecordModel,userTimeZone:(0,m.r)(),intl:re.default.getIntl()}))})),this.shouldShowCollectionViewBlockTitle=this.createComputedStore((()=>{const{store:e}=this.props;if(e.getCollectionViewSourceCollectionStore())return!0;const t=this.titleStore.state;if(!t)return!1;if(T.QaF(t.getValue()))return!0;return!!(0,Ce.J5)(t)})),this.titleStyleStore=this.createComputedStore((()=>{const{device:e}=this.environment,{store:t,paddingLeft:i,paddingRight:s}=this.props,o=t.getFormat(),n=!!o.page_small_text,r=t.isCollectionView(),l=n||e.isMobile||r||this.isInSidePeek()?32:40,d=(0,Pe.$3)(this.environment)+(0,Pe.vJ)(this.environment)-i-s;return{color:this.theme.regularTextColor,fontWeight:B.Z.fontWeight.bold,lineHeight:1.2,fontSize:l,fontFamily:B.Z.getHeaderFontFamily({pageFont:o.page_font,locale:a.SP}),cursor:"text",display:"flex",alignItems:"center",textRendering:e.isSafari?"optimizeSpeed":void 0,width:t.isCollectionView()&&!this.props.store.getAppContainerBlockStore()?d:void 0,...this.props.titleStyle}})),this.collectionViewProps=this.createComputedStore((()=>{const{store:e,context:t,disabled:i}=this.props;if(e.isCollectionView())return{store:e,context:t,disabled:i,collectionViewId:this.getCurrentCollectionViewId()}})),this.pageIconProps=this.createComputedStore((()=>({store:this.props.store,isEditable:this.isEditable(),hasCover:this.hasCoverStore.state,isInSidePeek:this.isInSidePeek(),openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:()=>{this.clickedAddIconState=!1}}))),this.pageTitleProps=this.createComputedStore((()=>({store:this.props.store,disabled:!this.canEdit(),isInSidePeek:this.isInSidePeek(),isInMiniPeek:this.isMiniPeekContext(),paddingLeft:this.props.paddingLeft,paddingRight:this.props.paddingRight,extraStyles:this.titleStyleStore.state,titlePlaceholder:this.emptyTitlePlaceholderStore.state,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab}))),this.descriptionProps=this.createComputedStore((()=>{const e=this.pageDescriptionRenderState();if("visible"===e.type)return{type:"description",disabled:!this.isEditable(),canEdit:this.canEdit(),locked:this.props.store.isLocked(),pageId:this.props.store.id,toggleStore:this.stores.pageDescriptionStore,descriptionStore:e.descriptionStore,collectionStore:e.collectionStore,userSettingsStore:e.currentUserSettingsStore}}))}get registries(){return super.registries.concat(ye.Z)}getContentInnerWidth(){const e=this.getContentWrapEl();if(e){const t=e.getBoundingClientRect().width,i=this.getContentPadding()??{paddingLeft:0,paddingRight:0};return t-i.paddingLeft-i.paddingRight}}getContentPadding(){const e=this.getContentWrapEl();if(e){if(wt(this.environment.device))return{paddingLeft:0,paddingRight:0};const t=getComputedStyle(e),i=parseFloat(t.getPropertyValue("padding-left")),s=parseFloat(t.getPropertyValue("padding-left"));return{paddingLeft:f.i2(i)?0:i,paddingRight:f.i2(s)?0:s}}}willMount(e){super.willMount(e);const{store:t}=this.props,{currentUserSettingsStore:i}=fe.default.state,s=t.id;this.stores.pageDescriptionStore=new _e.Z,R.nI({pageId:s,store:this.stores.pageDescriptionStore,userSettingsStore:i,descriptionHasText:this.descriptionHasText()})}willMountOrUpdate(e){super.willMountOrUpdate(e);const{store:t,context:i}=e;var s;"page"===this.environment.RouterStore.state.route.name&&(null===(s=this.environment.mobileNative)||void 0===s||s.markTransitionReady({type:"page",id:this.props.store.id}));const o=this.getPageCollectionStore();if(this.collectionContextStore.collectionStore()!==o&&o){const e=o.getParentBlockStore();this.collectionContextStore.setContext({type:"collectionPage",collectionViewBlockStore:e,collectionStore:o})}if(i===Re.S.Frame){const e=this.pageContext&&this.pageContext.publicEditModeStore.state;null!=e&&e.hasPublicPermission&&"edit"===e.permission&&!t.isTemplate()?E.Bw({bannerStore:this.getBannerStore(),id:"EditingPageBanner",contentKey:"editing_page",styleKey:Ye.v.White}):E.qL({bannerStore:this.getBannerStore(),id:"EditingPageBanner"})}if(this.isFrameOrPeekContext()){const e=he.oZ(t),i=he.wf(t),s=he.D0(t);if((0,M.nV)(e))E.Bw({bannerStore:this.getBannerStore(),id:"SpaceContentDuplicationPage",contentKey:"space_content_duplication",styleKey:Ye.v.Red,blockStore:t});else if(i)E.Bw({bannerStore:this.getBannerStore(),id:"DeletedPage",contentKey:"deleted_or_moved_page",blockStore:t,styleKey:Ye.v.Red});else if(s)E.Bw({bannerStore:this.getBannerStore(),id:"ArchivedTeamPage",contentKey:"page_in_archived_team",styleKey:Ye.v.Red});else for(const t of["SpaceContentDuplicationPage","DeletedPage","ArchivedTeamPage"])E.qL({bannerStore:this.getBannerStore(),id:t})}if(this.isFrameOrPeekContext()&&(t.isTemplate()?E.Bw({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage",contentKey:"template_in_page",styleKey:Ye.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):t.isInsideFactoryOrDuplicateBlocksAction()?E.Bw({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage",contentKey:"template_in_button",styleKey:Ye.v.Beige,blockStore:t,context:this.props.context,disabled:this.props.disabled}):E.qL({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage"})),i===Re.S.Frame){je.Z.state.pageMap[t.id]?E.Bw({bannerStore:this.getBannerStore(),id:"ImportingEvernotePage",contentKey:"importing_evernote",styleKey:Ye.v.Blue,blockStore:t}):E.qL({bannerStore:this.getBannerStore(),id:"ImportingEvernotePage"})}t.useCrdt()?E.Bw({bannerStore:this.getBannerStore(),id:"CrdtPage",contentKey:"crdt_page",styleKey:Ye.v.Beige}):E.qL({bannerStore:this.getBannerStore(),id:"CrdtPage"})}didMount(){const{device:e}=this.environment,{store:t,context:i}=this.props,s=this.titleStore.state,o=this.environment.RouterStore.state;let n;var r,a;"page"===o.route.name&&(n=o.route.mobileData,_.updateMetricData({is_push:null===(r=n)||void 0===r?void 0:r.isPush}));if((0,ne.L)(),e.isPhone){const{PageScroller:e}=me.Z;if(e){if(e.scrollerEl()&&this.canEdit()&&!this.hasCoverStore.state){const t=this.getTitlePaddingHeightWithPaddingTop();e.scrollTo(t)}}}s&&this.shouldSelectTitleOnMount()&&(H.eP({environment:this.environment,store:t}),Z.NX({store:s}),e.isAndroid&&(0,xe.Y)("supportsUntitledPageAutoSelectOnStart")&&(null===(a=this.environment.mobileNative)||void 0===a||a.forceShowSoftKeyboard()));if(i===Re.S.Frame&&!this.props.store.isCollectionView()){const e=this.environment.RouterStore.state.initialRoute.name,{initialRenderCompleted:t,initialRenderAfterLoginCompleted:i,initialLoadCachedPageChunkCalledAt:s}=Ve.Z.state;if(t)if(i||"login"!==e){var l;ke.default.measure("navigation_page_render",{environment:this.environment,data:{is_push:(null===(l=n)||void 0===l?void 0:l.isPush)??!1}})}else ke.default.measure("initial_page_render_after_login",{environment:this.environment}),Ve.Z.update((e=>({...e,initialRenderAfterLoginCompleted:!0})));else{_.setInitialRenderCompleted();const t=performance.mark("initial_page_render").startTime;_.measureSubMetric({name:"await_page_chunk_end_to_browser_repaint_start",startTime:e=>{var t;return null===(t=e.await_page_chunk_start_to_await_page_chunk_end)||void 0===t?void 0:t.endTime},endTime:t}),ke.default.measureFromAppStart({metricName:"initial_page_render",endTime:t},{environment:this.environment,data:{...oe.I(),initial_route:e,did_prefetch_for_root_route:ce.l4,is_editable:this.isEditable(),profiling_tool:pe.getProfilingToolForSession()},shouldSendIfStatsigNotInitialized:!0}),void 0!==s&&ke.default.measureFromAppStart({metricName:"load_cached_page_chunk_wait_time",endTime:s},{environment:this.environment,data:{initial_route:e},shouldSendIfStatsigNotInitialized:!0})}this.markTransitionReadyIfNewPageRender()}if(this.collectionContextStore){const e=(0,J.vS)(this.collectionContextStore);ke.default.measure("collections.open_item_page_lag",{environment:this.environment,data:{...e,peek_mode:Oe.default.getPeekMode()}})}this.maybeSelectFirstBlockForAiOnboarding()}willUnmount(){super.willUnmount(),this.isFrameOrPeekContext()&&(E.qL({bannerStore:this.getBannerStore(),id:"DeletedPage"}),E.qL({bannerStore:this.getBannerStore(),id:"CollectionTemplatePage"}))}renderCollectionPageViewBlock(){const{store:e,context:t,style:i,paddingLeft:s,paddingRight:o}=this.props,{WindowSizeStore:n}=this.environment;if(!e.isCollectionView())return;if(t===Re.S.CollectionPageView){let e=this.renderCollectionPageViewContent();return(0,de.Aw)(this.environment)&&(e=(0,bt.jsx)(Xe.O,{displayName:"PageContent",style:{...Mt.wrapStyle,...i},disabled:!this.canEdit()||this.props.store.isLocked(),children:e})),e}const r=this.pageDiscussionsRenderState({disableDiscussionInput:!0});return(0,bt.jsxs)(bt.Fragment,{children:[this.renderCollectionHeader(),"visible"===r.type&&(0,bt.jsx)("div",{style:{paddingLeft:n.getSafePaddingLeftCSS(s),paddingRight:n.getSafePaddingRightCSS(o)},children:(0,bt.jsx)(pt.z,{store:this.props.store,showDiscussionInput:r.showDiscussionInput,unresolvedDiscussionStores:r.unresolvedDiscussionStores})}),this.renderCollectionView()]})}renderCollectionPageViewContent(){const{store:e}=this.props;if(e.isCollectionView())return(0,bt.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5},children:[(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth()},render:()=>(0,bt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderDocumentView()})}),!this.environment.device.isMobile&&(0,bt.jsx)(N.Z,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl})]})}layoutV2_getPageContent(){const{bottomControls:e}=this.headerAndBottomControlsStore.state,t=this.pageDiscussionsRenderState({disableDiscussionInput:!1}),i=this.pagePropertiesRenderState(),s=(0,lt.E)({collectionStore:this.getPageCollectionStore(),format:this.getFormat(),sectionPropertyIds:this.inlinePropertyIDsStore.state}),n=this.pageExpandedBacklinksRenderState(),r=this.marginCommentsRenderState(),a=this.getHorizontalTransformStyles(),l=this.getLayoutContentStyles(!0),d=this.layoutV2_getLayoutType(r.visible);return(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:a.layout,render:()=>(0,bt.jsxs)(et.Ar,{type:d,withBottomPadding:!0,children:[(0,bt.jsx)(et.hy,{children:(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:a.layoutFull,render:()=>this.renderPageCover()})}),(0,bt.jsx)(et.bU,{children:this.layoutV2_getPeekPageHeaderControls()}),(0,bt.jsx)(et.bU,{children:this.layoutV2_getPeekPageTitleWithIcon()}),(0,bt.jsxs)(qe.p,{allowSelectionWithin:!0,className:o()(et.zx,"layout-header-detailSections"),children:["visible"===i.type&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(St.$,{...i})}),"visible"===s.type&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(lt._,{topBorder:!1,state:s,store:this.props.store,disabled:this.props.disabled,onMouseEnter:this.handleDetailsMouseEnter,onMouseLeave:this.handleDetailsMouseLeave,blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),isInPeekRenderer:this.isPeekOrMiniPeekContext()})}),n&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(dt.f,{store:this.props.store})}),"visible"===t.type&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(pt.z,{...t,store:this.props.store})})]}),e.length>0&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)("div",{style:this.getDetailControlsSectionStyle(),className:"notion-page-details-controls",onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced,children:e})}),(0,bt.jsx)(et.bU,{className:"layout-editor",style:{minHeight:"170px"},children:(0,bt.jsx)(gt.e,{store:this.props.store,disabled:this.props.disabled,templatePickerMenuListStore:this.stores.templatePickerMenuListStore,onClick:this.isEmptyContentBlock()?this.handlePlaceholderWrapClick:void 0,legacyStyles:l.nonIOSLayoutBody,ref:e=>{e&&(this.contentEl=e)}})}),r.visible&&(0,bt.jsx)(et.$K,{children:(0,bt.jsx)(N.Z,{pageBlockStore:this.props.store,isVisible:r.visible,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl,isCollapsedAnchor:!0})})]})})}layoutV2_getLayoutType(e){return this.environment.device.isPhone?"phone":this.environment.device.isTablet?this.isFullWidth()?"wide":"tablet":this.isPeekContext()?this.isInSidePeek()?"side-peek":"center-peek":this.isInAppTemplatePreviewContext()?"template-preview":this.isFullWidth()?e?"wide-right-margin-expanded":"wide":"default"}layoutV2_getPeekPageHeaderControls(){const{headerControls:e}=this.headerAndBottomControlsStore.state;if(this.isInSidePeek())return(0,bt.jsx)(ut.U,{onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,headerControls:e})}layoutV2_getPeekPageTitleWithIcon(){const{headerControls:e}=this.headerAndBottomControlsStore.state;return this.isInSidePeek()?(0,bt.jsx)(rt.B,{...this.pageIconProps.state,...this.pageTitleProps.state}):(0,bt.jsx)("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,bt.jsx)(vt.J,{...this.pageIconProps.state,...this.pageTitleProps.state,headerControls:e,headerFocusStore:this.stores.headerFocusStore,paddingLeft:0,paddingRight:0})})}layoutV2_renderCollectionPageViewBlock(){const e=this.descriptionProps.state,t=this.pageDiscussionsRenderState({disableDiscussionInput:!1}),i=this.collectionViewProps.state;return this.props.context===Re.S.CollectionPageView?this.layoutV2_renderWikiPageView():(0,bt.jsxs)(et.Ar,{type:"wide",children:[(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(ut.U,{onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,headerControls:this.renderCollectionHeaderControls()})}),(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(rt.B,{...this.pageIconProps.state,...this.pageTitleProps.state})}),e&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(ct.Z,{...e})}),"visible"===t.type&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(pt.z,{...t,store:this.props.store})}),i&&(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(ht.o,{...i})})]})}layoutV2_renderWikiPageView(){const e=this.marginCommentsRenderState(),t=e.visible?"wiki-right-margin-expanded":"wiki";return(0,bt.jsxs)(et.Ar,{type:t,withBottomPadding:!0,children:[(0,bt.jsx)(et.bU,{children:(0,bt.jsx)(gt.e,{store:this.props.store,disabled:this.props.disabled,templatePickerMenuListStore:this.stores.templatePickerMenuListStore,onClick:this.isEmptyContentBlock()?this.handlePlaceholderWrapClick:void 0,ref:e=>{e&&(this.contentEl=e)}})}),e.visible&&(0,bt.jsx)(et.$K,{children:(0,bt.jsx)(N.Z,{pageBlockStore:this.props.store,isVisible:e.visible,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl,isCollapsedAnchor:!0})})]})}renderPersisted(){if(this.props.store.getType()===c.Ti.copyIndicator&&(this.props.store.getParentTable()!==b.v||this.props.store.getParentTable()===b.v&&0===Object.keys(this.props.store.getProperties()).length))return(0,bt.jsx)(at.X,{});if(this.props.store.isCollectionView())return(0,bt.jsx)(X.L1,{value:this.collectionContextStore,children:Be.default.checkGate("layout_collection_view_page")?this.layoutV2_renderCollectionPageViewBlock():this.renderCollectionPageViewBlock()});let e=this.shouldRenderLayoutV2()?this.layoutV2_getPageContent():this.getPageContent();return this.collectionContextStore&&this.collectionContextStore.contextType&&(e=(0,bt.jsx)(X.L1,{value:this.collectionContextStore,children:e})),(0,de.Aw)(this.environment)?(0,bt.jsx)(Xe.O,{displayName:"PageContent",style:{...Mt.wrapStyle,...this.props.style},disabled:!this.canEdit()||this.props.store.isLocked(),shouldSelectOnEnter:this.shouldSelectOnEnter,children:e}):e}shouldRenderLayoutV2(){return this.isPeekContext()?Be.default.checkGate("layout_side_peek_page"):!(!this.isFrameContext()&&!this.isInAppTemplatePreviewContext())&&Be.default.checkGate("layout_main_frame_page")}getPageContent(){const e=this.isMiniPeekContext(),t=!this.isExternallySyncedPage(),i=-1*this.documentViewHorizontalOffset.state;return(0,bt.jsxs)(bt.Fragment,{children:[e?null:this.renderPageCover(),(0,bt.jsx)("div",{style:{width:"100%",display:"flex",justifyContent:"center",zIndex:D.db,flexShrink:0},children:(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),translateX:i},render:()=>(0,bt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderPageHeader()})})}),t&&(0,bt.jsxs)("div",{style:{display:"flex",width:"100%",justifyContent:"center",paddingTop:5},children:[(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth(),translateX:i},render:()=>(0,bt.jsx)("div",{style:{maxWidth:"100%",minWidth:0},children:this.renderDocumentView()})}),this.props.context===Re.S.Frame&&(0,bt.jsx)(N.Z,{pageBlockStore:this.props.store,isVisible:this.marginCommentsVisible.state,context:this.props.context,pageViewBlockAccessor:this.getContentWrapEl})]})]})}renderDetailsDivider(e){return(0,bt.jsx)("div",{style:{width:"100%",height:1,background:this.theme.regularDividerColor,marginBottom:8}},`divider-${e}`)}renderPageHeader(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:i,paddingRight:s}=this.props,{headerControls:o,bottomControls:r}=this.headerAndBottomControlsStore.state,a=[],l=this.pagePropertiesRenderState();"visible"===l.type&&a.push((0,bt.jsx)(St.$,{...l},"page-properties"));const d=(0,lt.E)({collectionStore:this.getPageCollectionStore(),format:this.getFormat(),sectionPropertyIds:this.inlinePropertyIDsStore.state});"visible"===d.type&&a.push((0,bt.jsx)(lt._,{topBorder:!0,state:d,store:t,disabled:this.props.disabled,onMouseEnter:this.handleDetailsMouseEnter,onMouseLeave:this.handleDetailsMouseLeave,blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),isInPeekRenderer:this.isPeekOrMiniPeekContext()},"inline-page-sections"));this.pageExpandedBacklinksRenderState()&&(a.length>0&&a.push(this.renderDetailsDivider(3)),a.push((0,bt.jsx)(dt.f,{store:this.props.store},"page-expanded-backlinks")));const h=this.pageDiscussionsRenderState({disableDiscussionInput:!1});return"visible"===h.type&&(a.length>0&&a.push(this.renderDetailsDivider(2)),a.push((0,bt.jsx)(pt.z,{store:this.props.store,withLegacyInputPadding:!0,showDiscussionInput:h.showDiscussionInput,unresolvedDiscussionStores:h.unresolvedDiscussionStores},"page-discussions"))),a.length>0&&a.push(this.renderDetailsDivider(1)),(0,bt.jsxs)(n.Fragment,{children:[(0,bt.jsx)("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,bt.jsx)(vt.J,{store:t,pageViewBlockStore:this.stores.pageViewBlockStore,discussionInputStore:this.discussionInputStore,isEditable:this.isEditable(),headerControls:o,hasCover:this.hasCoverStore.state,isInSidePeek:this.isInSidePeek(),isInMiniPeek:this.isMiniPeekContext(),headerFocusStore:this.stores.headerFocusStore,paddingLeft:i,paddingRight:s,openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:this.handleAddIconClick,disabled:!this.canEdit(),extraStyles:this.titleStyleStore.state,titlePlaceholder:this.emptyTitlePlaceholderStore.state,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab})}),this.isMiniPeekContext()?null:(0,bt.jsx)("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleDetailsMouseEnterThrottled,onMouseMove:this.handleDetailsMouseEnterThrottled,onMouseLeave:this.handleDetailsMouseLeaveDebounced,children:(0,bt.jsxs)(qe.p,{onFocus:this.handleDetailsFocus,onBlur:this.handleDetailsBlur,allowSelectionWithin:!0,style:{paddingLeft:e.getSafePaddingLeftCSS(i),paddingRight:e.getSafePaddingRightCSS(s),maxWidth:"100%",width:"100%"},children:[a,r.length>0&&(0,bt.jsx)("div",{style:this.getDetailControlsSectionStyle(),className:"notion-page-details-controls",children:r}),(0,bt.jsx)(Ne.Z,{store:t},t.id)]})})]})}getTopControls(){const e=[],t=this.renderAddIcon();t&&e.push((0,bt.jsx)(n.Fragment,{children:t},"add-icon"));const i=this.renderAddCover();return i&&e.push((0,bt.jsx)(n.Fragment,{children:i},"add-cover")),e}getBottomControls(e,t){const i=[],s=!e&&this.renderShowBacklinks();s&&i.push((0,bt.jsx)(n.Fragment,{children:s},"backlinks"));const o="hidden"===t.type,r=o&&this.renderShowDiscussion();r&&i.push((0,bt.jsx)(n.Fragment,{children:r},"discussions"));const a=this.renderResolveDiscussionButtonPopupMenu();a&&!o&&i.unshift((0,bt.jsx)(n.Fragment,{children:a},"resoled-discussions"));const l=this.renderMinimalPageSections();return l&&i.push((0,bt.jsx)(n.Fragment,{children:l},"minimal-page-sections")),i}getCommentControlPlacement(e){const{isTopControlsEmpty:t,isBottomControlsEmpty:i,discussionsRenderState:s}=e,{device:o}=this.environment;return this.shouldRenderAddDiscussion()?"hidden"!==s.type||i?o.isMobile&&t?"bottom":"top":"bottom":"hidden"}renderCollectionHeaderControls(){return(0,bt.jsxs)("div",{onFocus:this.handleHeaderFocus,onBlur:this.handleHeaderBlur,style:{...this.getHeaderControlsStyle()},className:"notion-page-controls",children:[this.renderAddIcon(),this.renderAddCover(),this.renderLinkedCollectionViewBlockAddTitle(),this.renderSprintBoardDescriptionToggle(),this.renderDescriptionToggle()]})}renderCollectionHeader(){const{paddingLeft:e,paddingRight:t,store:i}=this.props,{WindowSizeStore:s}=this.environment;if((0,q.qG)(i.id))return;const o=this.shouldShowCollectionViewBlockTitle.state,n=(0,bt.jsxs)("div",{style:{display:"flex",alignItems:"flex-start"},children:[(0,bt.jsx)(mt.Z,{store:this.props.store,isEditable:this.isEditable(),hasCover:this.hasCoverStore.state,isInSidePeek:this.isInSidePeek(),isInMiniPeek:this.isMiniPeekContext(),openMenuOnMount:this.clickedAddIconState,openMenuOnMountCallback:this.handleAddIconClick}),o&&(0,bt.jsx)(Ct.Z,{store:this.props.store,disabled:!this.canEdit(),isInSidePeek:this.isInSidePeek(),isInMiniPeek:this.isMiniPeekContext(),paddingLeft:e,paddingRight:t,extraStyles:this.titleStyleStore.state,titlePlaceholder:this.emptyTitlePlaceholderStore.state,collectionContextStore:this.collectionContextStore,shouldShowTemplatePicker:this.showTemplatePickerStore.state,onTitleChange:this.handleTitleChange,onTitleEditText:this.handleTitleEditText,onTitleEsc:this.handleTitleEsc,onTitleUntab:this.handleTitleUntab,onTitleTab:this.handleTitleTab})]}),r=this.pagePropertiesRenderState(),a=this.pageDescriptionRenderState();return(0,bt.jsxs)("div",{style:this.getHeaderStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:[this.renderPageCover(),(0,bt.jsx)(Qe.Z,{isVisible:!0,animationStyle:{width:this.getAdjustedPageWidth()},render:()=>(0,bt.jsxs)("div",{style:{maxWidth:"100%",paddingLeft:s.getSafePaddingLeftCSS(e)},children:[this.renderCollectionHeaderControls(),(0,bt.jsxs)("div",{style:{paddingRight:s.getSafePaddingRightCSS(t),marginBottom:8},children:[n,this.renderSprintBoardDescription(),"visible"===a.type&&(0,bt.jsx)(ct.Z,{disabled:!this.isEditable(),canEdit:this.canEdit(),locked:this.props.store.isLocked(),pageId:this.props.store.id,toggleStore:this.stores.pageDescriptionStore,descriptionStore:a.descriptionStore,collectionStore:a.collectionStore,userSettingsStore:a.currentUserSettingsStore}),"visible"===r.type&&(0,bt.jsx)(St.$,{...r})]})]})})]})}renderPageCover(){const{WindowSizeStore:e}=this.environment,{store:t,paddingLeft:i,paddingRight:s,pageCoverHeight:o}=this.props,n=t.isCollectionView()?"20vh":o;return(0,bt.jsx)(qe.p,{allowSelectionWithin:!1,style:this.getPageCoverStyle(),onMouseEnter:this.handleHeaderMouseEnterThrottled,onMouseMove:this.handleHeaderMouseEnterThrottled,onMouseLeave:this.handleHeaderMouseLeaveDebounced,children:(0,bt.jsx)(yt.Z,{height:n,store:t,disabled:!this.isEditable(),paddingLeft:e.getSafePaddingLeftCSS(i),paddingRight:e.getSafePaddingRightCSS(s),proxyWidth:e.state.width})})}isExternallySyncedPage(){const{store:e}=this.props;if(e.isCollectionView()){const t=e.getCollectionViewSourceCollectionStore();return!!t&&t.isSyncedCollection()}return e.isType(c.Ti.externalObjectInstancePage)}renderAddIcon(){const{device:e}=this.environment;if(this.isEditable()&&!this.hasIconStore.state)return(0,bt.jsx)(ot.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomIconClick,icon:S.o,children:e.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageIconMobile",defaultMessage:"Icon"}):(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageIcon",defaultMessage:"Add icon"})},"add-icon")}renderAddCover(){const{device:e}=this.environment;if(this.isEditable()&&!(0,q.qG)(this.props.store.id)&&!this.hasCoverStore.state)return!0===this.stores.loadingPageCoverStore.state?(0,bt.jsx)(ot.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,disabled:!0,icon:C.P,children:e.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobileLoading",defaultMessage:"Loading"}):(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageCoverLoading",defaultMessage:"Loading cover"})},"add-cover-loading"):(0,bt.jsx)(ot.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddRandomCoverClick,icon:C.P,children:e.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageCoverMobile",defaultMessage:"Cover"}):(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageCover",defaultMessage:"Add cover"})},"add-cover")}renderLinkedCollectionViewBlockAddTitle(){var e;const{store:t}=this.props,{device:i}=this.environment;if(!this.isEditable()||!t.isCollectionView()||t.getCollectionViewSourceCollectionStore())return;return T.QaF(null===(e=this.titleStore.state)||void 0===e?void 0:e.getValue())?void 0:(0,bt.jsx)(ot.Z,{style:this.getControlHoverStyle({}),isLightGray:!0,onClick:this.handleAddTitleClick,icon:x.c,children:i.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageTitleMobile",defaultMessage:"Title"}):(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageTitle",defaultMessage:"Add title"})},"add-title")}renderSprintBoardDescriptionToggle(){const{store:e}=this.props,{device:t}=this.environment;if(!e.isCollectionView()||!this.isSprintBoard()||!this.isEditable())return;return Boolean(e.getFormat().hide_collection_view_page_description)?(0,bt.jsx)(ot.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:()=>R.kQ({environment:this.environment,store:e,value:!1}),icon:y.z,children:t.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.showDescription.mobileButton"}):(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Show description",id:"pageViewBlock.showDescription.button"})}):(0,bt.jsx)(ot.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:()=>{R.kQ({environment:this.environment,store:e,value:!0})},icon:y.z,children:(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Hide description",id:"pageViewBlock.hideDescription.button"})})}renderDescriptionToggle(){const{store:e}=this.props,{device:t}=this.environment;if(e.isCollectionView()&&e.getCollectionViewSourceCollectionStore())return this.shouldShowDescription()?(0,bt.jsx)(ot.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleHideDescription,icon:y.z,children:(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Hide description",id:"pageViewBlock.hideDescription.button"})}):this.isEditable()&&!this.descriptionHasText()?(0,bt.jsx)(ot.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleAddDescriptionClick,icon:y.z,children:t.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.addDescription.mobileButton"}):(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Add description",id:"pageViewBlock.addDescription.button"})}):this.descriptionHasText()?(0,bt.jsx)(ot.Z,{isLightGray:!0,style:this.getControlHoverStyle({}),onClick:this.handleShowDescription,icon:y.z,children:t.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Description",id:"pageViewBlock.showDescription.mobileButton"}):(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Show description",id:"pageViewBlock.showDescription.button"})}):void 0}shouldRenderAddDiscussion(){const{store:e}=this.props;return!ie.A$("comments","section_hide")&&(!e.isCollectionView()&&(!e.isInsideCollection()&&(!this.hasDiscussionToShow()&&(!!e.canComment()&&(!!this.environment.currentUser.isLoggedIn()&&!this.stores.pageViewBlockStore.state.forceDiscussionOpen)))))}renderAddDiscussion(e){const{device:t}=this.environment;return(0,bt.jsx)(ot.Z,{style:this.getControlHoverStyle({isBottomControl:e.isBottomControl}),isLightGray:!0,onClick:this.handleAddDiscussion,icon:v.v,children:t.isSmallPhone?(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageCommentMobile",defaultMessage:"Comment"}):(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.add.pageComment",defaultMessage:"Add comment"})},"add-comment")}renderShowDiscussion(){if(!ie.A$("comments","section_hide")&&this.hasDiscussionToShow()){const e=this.getNumberOfComments();return(0,bt.jsx)(ot.Z,{isGray:!0,onClick:this.handleShowDiscussion,icon:v.v,style:this.getDetailControlButtonStyle(),children:(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.show.pageComments",defaultMessage:"{numberOfComments, plural, one {{numberOfComments} comment} other {{numberOfComments} comments}}",values:{numberOfComments:e}})},"show-comments")}}renderShowBacklinks(){const e=this.numberOfBacklinks.state;if(0===e)return;if(ie.A$("backlinks","section_hide"))return;const t=t=>{let{onClick:i=f.ZT,tooltipEvents:s={},buttonPopupEvents:o={}}=t;return(0,bt.jsx)(ot.Z,{isGray:!0,icon:this.renderBacklinksIcon,style:this.getDetailControlButtonStyle(),onClick:i,...o,...s,children:(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.show.backlinks",defaultMessage:"{numberOfBacklinks, plural, one {{numberOfBacklinks} backlink} other {{numberOfBacklinks} backlinks}}",values:{numberOfBacklinks:e}})})},i=(0,bt.jsx)(nt.Z,{renderTooltip:()=>(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Show pages linked to this page",id:"pageViewBlock.show.backlinks.tooltip"}),placement:nt.Z.Placement.Bottom,delayThreshold:400,render:e=>t({tooltipEvents:e,onClick:this.handleShowBacklinks})},"show-backlinks"),s=(0,bt.jsx)(Je.ZP,{buttonPopupStore:this.stores.backlinksButtonPopupStore,popupType:Je.Z4.Popup,renderOrigin:e=>t({buttonPopupEvents:e}),render:()=>{const e={menuType:ae.og.Popup,width:500};return(0,bt.jsx)(it.Z,{...e,children:this.numberOfBacklinks.state>0?(0,bt.jsx)(dt.f,{store:this.props.store}):null})}},"backlinks-popup");return ie.A$("backlinks","section_collapsed")?s:i}isSprintBoard(){const{store:e}=this.props;return"sprint_board"===e.getFormat().special_page_for_pm_launch}renderSprintBoardDescription(){const{store:e}=this.props;if(this.isSprintBoard()&&!Boolean(e.getFormat().hide_collection_view_page_description))return(0,bt.jsx)(ct.k,{})}pageDescriptionRenderState(){if(!this.shouldShowDescription())return{type:"hidden"};const e=this.getDescriptionStore();if(!e)return{type:"hidden"};const{pageDescriptionStore:t}=this.stores;if(!t.isExpanded())return{type:"hidden"};const{store:i}=this.props,{currentUserSettingsStore:s}=fe.default.state;return{type:"visible",descriptionStore:e,currentUserSettingsStore:s,collectionStore:i.getCollectionViewSourceCollectionStore()}}pagePropertiesRenderState(){const{store:e}=this.props;if(e.isCollectionViewPageWithContent())return{type:"hidden"};const t=this.getPageCollectionStore();if(!t)return{type:"hidden"};const i=this.getFormat();return i?{type:"visible",store:e,format:i,collectionStore:t,disabled:!this.canEdit(),blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),isInPeekRenderer:this.isPeekOrMiniPeekContext()}:{type:"hidden"}}renderMinimalPageSections(){const{store:e,disabled:t}=this.props,i=this.getPageCollectionStore();if(!i)return;const s=this.getSchema(),o=this.getFormat(),n=e.isLocked();if(!o)return;const r=this.minimalPropertyIDsStore.state;return r&&r.length?(0,bt.jsx)(Pt.Z,{propertyIds:r,store:e,collectionStore:i,disabled:t,locked:n,schema:s,handleMouseMove:this.handleDetailsMouseEnter,handleMouseLeave:this.handleDetailsMouseLeave,handleContextMenu:()=>{},blockPropertyValueOverlayStore:this.getBlockPropertyOverlayStore(),format:o,type:"minimal",isInPeekRenderer:this.isPeekOrMiniPeekContext()}):void 0}pageDiscussionsRenderState(e){if(ie.A$("comments","section_hide"))return{type:"hidden"};const t=this.environment.currentUser.isLoggedIn(),i=this.shouldShowDiscussion(),{store:s}=this.props,o=ge.vV(s,{recursivelyLoadAllDiscussions:!1}),n=!e.disableDiscussionInput&&t&&s.canComment()&&0===o.length&&!this.isExternallySyncedPage();return!i||!n&&0===o.length?{type:"hidden"}:{type:"visible",showDiscussionInput:n,unresolvedDiscussionStores:o}}marginCommentsRenderState(){return{visible:(0,$.fg)(this.environment,this.props.store)}}renderResolveDiscussionButtonPopupMenu(){const{device:e}=this.environment,t=ge.mY(this.props.store,{recursivelyLoadAllDiscussions:!1});if(0===t.length)return;const i=(0,bt.jsx)(j.FormattedMessage,{id:"pageViewBlock.showResolvedComments.button",defaultMessage:"{numberOfResolvedComments, plural, one {{numberOfResolvedComments} resolved comment} other {{numberOfResolvedComments} resolved comments}}",values:{numberOfResolvedComments:t.length}});return(0,Pe.Sx)(this.environment)?(0,bt.jsx)(ot.Z,{icon:P.k,isGray:!0,style:this.getDetailControlButtonStyle(),onClick:()=>{I.Ib({environment:this.environment,blockStore:this.props.store,analyticsFrom:"page_comments",shouldFocusDiscussion:!0,recursivelyLoadAllDiscussions:!1,discussionIds:t.map((e=>e.id))})},children:i}):(0,bt.jsx)(Je.ZP,{buttonPopupStore:this.stores.resolvedDiscussionButtonPopupStore,popupType:e.isMobile?Je.Z4.SlideUp:Je.Z4.Popup,renderOrigin:e=>(0,bt.jsx)(ot.Z,{icon:P.k,isGray:!0,style:this.getDetailControlButtonStyle(),...e,children:i}),render:i=>{let s;return s=e.isMobile?{menuType:ae.og.Modal,title:(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Resolved comments",id:"pageViewBlock.resolvedComments.menuTabTitle"}),right:(0,bt.jsx)(st.DoneMenuText,{}),onClickRight:i.close,whiteBackground:!0}:{menuType:ae.og.Popup,width:500},(0,bt.jsx)(it.Z,{...s,children:t.map(((e,t,s)=>(0,bt.jsx)(xt.Z,{store:e,droppable:!0,render:()=>(0,bt.jsx)(ve.LazyDiscussion,{store:e,format:G.O2.Menu,isFirst:0===t,isOnly:1===s.length,discussionLocation:"page_discussion",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.store,onDismiss:i.close},e.id)},e.id)))})}},"resolve-discussions")}renderCollectionView(){const{store:e,paddingLeft:t,paddingRight:i,context:s}=this.props;if(!e.isCollectionView())return;const o=this.getCurrentCollectionViewId();return(0,bt.jsx)(Ke.D,{overridePaddingLeft:t,overridePaddingRight:i,store:e,isFullScreen:!0,viewId:o,disabled:this.props.disabled,hideHeaderActions:s===Re.S.InAppTemplatePreview})}renderDocumentView(){const e=this.getLayoutContentStyles(),t=this.isEmptyContentBlock()?this.handlePlaceholderWrapClick:void 0;return wt(this.environment.device)?(0,bt.jsxs)("div",{style:e.wrapper,children:[e.leftPadding&&(0,bt.jsx)(qe.p,{allowSelectionWithin:!1,style:e.leftPadding,onClick:t}),this.renderDocumentViewContent(e.body,t),e.rightPadding&&(0,bt.jsx)(qe.p,{allowSelectionWithin:!1,style:e.rightPadding,onClick:t})]}):this.renderDocumentViewContent(e.nonIOSLayoutBody,t)}renderDocumentViewContent(e,t){const{store:i}=this.props,s=this.shouldShowSpinner(),o=this.showTemplatePickerStore.state;return(0,bt.jsxs)("div",{style:e,ref:e=>{e&&(this.contentEl=e)},className:Y.QS0,onClick:t,children:[!this.isExternallySyncedPage()&&(0,bt.jsx)(kt.Z,{store:i.getContentStore(),emptyDroppableStyle:{width:"100%"},disabled:this.props.store.isLocked()||this.props.disabled,disableHoverMenu:this.isMiniPeekContext()}),s&&(0,bt.jsx)(tt.Z,{}),this.isFrameOrPeekContext()&&o&&!this.isMiniPeekContext()&&(0,bt.jsx)(ft.Z,{store:i,menuListStore:this.stores.templatePickerMenuListStore}),this.isMiniPeekContext()&&this.isEmptyContentBlock()&&(0,bt.jsx)("div",{style:{paddingLeft:2,color:this.theme.pageTitlePlaceholderTextColor},children:(0,bt.jsx)(j.FormattedMessage,{defaultMessage:"Add description",id:"text.miniPeek.placeholder"})})]})}pageExpandedBacklinksRenderState(){return!!this.shouldShowBacklinks()&&0!==this.numberOfBacklinks.state}setDiscussionToggleState(e){const t=this.props.store.id;"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.setToggleState({environment:this.environment,type:"discussion",id:t},e)}setBacklinksToggleState(e){const t=this.props.store.id;"PageDetailsStore"in this.environment&&this.environment.PageDetailsStore.setToggleState({environment:this.environment,type:"backlinks",id:t},e)}isCurrentBlock(){return this.props.store===fe.default.state.mainEditorCurrentBlockStore}getBlockPropertyOverlayStore(){return this.isPeekOrMiniPeekContext()?Ze.Z:Le.Z}isEmptyContentBlock(){const{store:e}=this.props;return!e.hasContent()&&(!e.isCollectionView()||e.isType("collection_view_page")&&e.isCollectionViewPageWithContent())}isFullWidth(){const{store:e,context:t}=this.props;if(t===Re.S.CollectionPageView)return!0;const{device:i}=this.environment,{isPhone:s}=i,o=e.isFullWidth(),n=e.isCollectionView(),r=this.isPeekOrMiniPeekContext();return o&&!s||n||r||s}getAdjustedPageWidth(){return this.isFullWidth()?"100%":q.CC}getNumberOfComments(){const{store:e}=this.props;return ge.Xp(e,{recursivelyLoadAllDiscussions:!1})}hasDiscussionToShow(){return this.getNumberOfComments()>0}shouldShowDiscussion(){if(this.stores.pageViewBlockStore.state.forceDiscussionOpen)return!0;const e=ie.dy(this.environment,"comments"),t=ie.A$("comments","section_collapsed");if(this.props.store.isInsideCollection()&&!this.hasDiscussionToShow()&&(e||t))return!0;if(!this.hasDiscussionToShow())return!1;const i=this.discussionToggleStore.state;return void 0===i?e:i}shouldShowBacklinks(){const e=ie.dy(this.environment,"backlinks"),t=this.backlinksToggleStore.state;return void 0===t?e:t}descriptionHasText(){const e=this.getDescriptionStore();return R.vn(e)}shouldSelectOnEnter(){return 0===ze.default.state.stores.length}shouldShowDescription(){if("sprint_board"===this.props.store.getFormat().special_page_for_pm_launch)return!0;const e=this.stores.pageDescriptionStore.isExpanded();return(this.descriptionHasText()||this.isEditable())&&e}getDescriptionStore(){const{store:e}=this.props;return e.getCollectionViewSourceDescriptionStore()}shouldShowProperties(){return Boolean(this.getPageCollectionStore())}getPageCollectionStore(){return this.props.store.getAssociatedCollectionStore()}getBannerStore(){return this.isPeekOrMiniPeekContext()?He.Z:De.Z}getSchema(){return this.props.store.getSchema()}getFormat(){const e=this.getPageCollectionStore();if(!e)return;const t=this.getSchema(),i=e.getFormat();return u.iB(i,t,void 0,u.j5.Collection)}canOpenProperty(e){if(!this.getPageCollectionStore())return!1;const t=this.getSchema()[e];return Boolean(t&&!p.uk.includes(t.type))}shouldShowSpinner(){const{store:e}=this.props;return Boolean(Ue.Z.state.pageMap[e.id])||Ae.Z.state.pages.has(e.id)}isEditable(){return this.canEditCollection()&&!this.props.store.isLocked()&&!this.isExternallySyncedPage()}getCurrentCollectionViewId(){if(this.isCurrentBlock()){const{RouterStore:e}=this.environment;return e.state.route.collectionViewId}}shouldSelectTitleOnMount(){const{device:e}=this.environment,{store:t}=this.props,i=this.titleStore.state,{forceSelectTitleOnMount:s}=this.props;return!!i&&(!!s||!t.isCollectionView()&&(!(e.isMobile&&!(0,ue.NW)(this.environment)&&!(0,xe.Y)("supportsUntitledPageAutoSelectOnStart"))&&(!T.QaF(i.getValue())||this.isEmptyContentBlock()&&!e.isMobile)))}markTransitionReadyIfNewPageRender(){const{device:e,RouterStore:t}=this.environment,{route:i}=t.state,s=this.props.store;var o;e.isMobileNative&&"page"===i.name&&i.showMoveTo&&s.isEmptyTitle()&&s.isEmptyPage()&&(null===(o=this.environment.mobileNative)||void 0===o||o.markTransitionReady({type:"new_page",id:s.id}))}maybeSelectFirstBlockForAiOnboarding(){if("space_for_ai"!==(0,z.sy)())return;const e=this.props.store.getContentStores()[0],t=z.__.state;e&&e.id===t&&(H.eP({environment:this.environment,store:e}),Z.NX({store:e.getBlockTitleStore()}))}isMiniPeekContext(){return this.props.context===Re.S.MiniPeekView}isPeekContext(){return this.props.context===Re.S.PeekView}isPeekOrMiniPeekContext(){return this.props.context===Re.S.PeekView||this.props.context===Re.S.MiniPeekView}isFrameContext(){return this.props.context===Re.S.Frame}isInAppTemplatePreviewContext(){return this.props.context===Re.S.InAppTemplatePreview}isFrameOrPeekContext(){return this.isFrameContext()||this.isPeekOrMiniPeekContext()}isInSidePeek(){return ee.en(this.props.store)&&(Oe.default.isSidePeekOpen()||Oe.default.isSidePeekClosing.state)}getPageCoverStyle(){const e=this.getHeaderStyle();return e.zIndex=D.ag,e}getHeaderStyle(){const{store:e}=this.props,t={width:"100%",display:"flex",flexDirection:"column",alignItems:"center",flexShrink:0,flexGrow:0};return e.isCollectionView()&&(e.isLocked()&&(t.cursor="default"),Se.eA(this.environment)&&(t.position="sticky",t.left=0)),t}static defaultPageCoverHeight(e){return e.device.isMobile?200:`${Mt.defaultDesktopPageCoverViewportPercentage}vh`}static paddingBottom(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{device:i}=e;return i.isTablet?380:i.isIOS?Math.max(350,t):i.isMobile?400:"30vh"}getTitlePaddingMarginTop(){return this.environment.device.isMobile?16:this.isPeekOrMiniPeekContext()?32:80}getTitlePaddingMarginBottom(){return this.environment.device.isMobile?32:4}getTitlePaddingHeightWithPaddingTop(){return Mt.titlePaddingHeight+this.getTitlePaddingMarginTop()}getHeaderControlsStyle(){const{store:e}=this.props,{device:t}=this.environment,{isMobile:i}=t,s=this.getTitlePaddingMarginTop();let o,n,r;return i?this.hasCoverStore.state?(this.hasIconStore.state,r="block",o=s,n=4):(r="flex",o=s,n=this.getTitlePaddingMarginBottom()):e.isCollectionView()||this.isInSidePeek()?(r="flex",this.hasCoverStore.state?(o=16,n=4):(o=4,n=4)):(r="flex",this.hasIconStore.state?(o=8,n=4):this.hasCoverStore.state?(o=16,n=4):(o=s,n=this.getTitlePaddingMarginBottom())),{display:r,justifyContent:"flex-start",flexWrap:"wrap",marginTop:o,marginBottom:n,marginLeft:-1,color:this.theme.lightTextColor,fontFamily:B.Z.getCompositeFontFamily(a.SP).sans,height:this.environment.device.isMobile?"auto":24,pointerEvents:"auto"}}getDetailControlsSectionStyle(){return{display:"flex",alignItems:"baseline",justifyContent:"flex-start",flexWrap:"wrap",color:this.theme.lightTextColor,fontFamily:B.Z.getCompositeFontFamily(a.SP).sans}}getControlHoverIsVisible(e){const{device:t}=this.environment,i=this.stores.headerMouseStore.state.mouseEntered,s=this.stores.detailsMouseStore.state.mouseEntered,o=this.stores.headerFocusStore.state,n=this.stores.detailsFocusStore.state;return!!t.isMobile||(e?s&&!Ee.Z.state.isKeyboardMode||n:i&&!Ee.Z.state.isKeyboardMode||o)}getControlHoverStyle(e){let{isBottomControl:t}=e;const{device:i}=this.environment,s=this.getControlHoverIsVisible(t);return{opacity:s?1:0,pointerEvents:s?"auto":"none",transition:"opacity 100ms ease",marginBottom:i.isMobile?0:-16}}getDetailControlButtonStyle(){return{fontWeight:B.Z.fontWeight.medium,color:this.theme.mediumTextColor}}getLayoutContentStyles(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{device:t}=this.environment,{context:i,paddingLeft:s,paddingRight:o,paddingBottom:n}=this.props,{store:r}=this.props,a=r.getFormat(),l=a.page_font||Mt.defaultFontFamily,d=Mt.fontFamily[l],c=this.isPeekOrMiniPeekContext(),p=this.isEmptyContentBlock()&&c&&!this.showTemplatePickerStore.state&&!this.shouldShowSpinner(),g=i===Re.S.InAppTemplatePreview;let u,m,S;if(t.isMobile)S=t.isAndroid?Mt.defaultAndroidFontSize:Mt.defaultMobileFontSize;else{S=a.page_small_text?Mt.fontSmallSize[l]||Mt.defaultFontSmallSize:Mt.fontSize[l]||Mt.defaultFontSize}let C={},v={},k={};if(!p){const{WindowSizeStore:t}=this.environment,i=t.getSafePaddingLeftCSS(s),r=t.getSafePaddingRightCSS(o);C={gridTemplateColumns:`${i} calc(100% - ${i} - ${r}) ${r}`},u={},m={},v=this.isCompletionsUiVisible.state?{paddingBottom:"600px"}:this.isMiniPeekContext()?{paddingBottom:0}:this.isEmptyContentBlock()?{paddingBottom:"15vh"}:{paddingBottom:n},k={...v,paddingLeft:e?0:i,paddingRight:e?0:r}}const y=Mt.fontLetterSpacing[l],P=Mt.fontLineHeight[l]||1.5;let x={};c&&(x=this.isMiniPeekContext()?{minHeight:Mt.miniPeekViewContentMinHeight,zIndex:1,paddingLeft:0,paddingRight:0}:{minHeight:Mt.peekViewContentMinHeight,zIndex:1});let f={};g&&(f={margin:"0 auto"});let b={};if(t.isPhone&&!r.isCollectionView()&&this.canEdit()&&!this.hasCoverStore.state){const e=132,t=this.getTitlePaddingHeightWithPaddingTop();b={minHeight:`calc(100vh - ${h.g+e-t}px)`}}return{wrapper:{flexShrink:0,flexGrow:1,display:"grid",gridTemplateColumns:"100%",maxWidth:"100%",width:"100%",...C},leftPadding:u,body:{display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:d,fontSize:S,letterSpacing:y?`${y}em`:void 0,lineHeight:P,zIndex:D.ke,...v,...x,...f,...b},rightPadding:m,nonIOSLayoutBody:{flexShrink:0,flexGrow:1,maxWidth:"100%",display:"flex",alignItems:"flex-start",flexDirection:"column",fontFamily:d,fontSize:S,letterSpacing:y?`${y}em`:void 0,lineHeight:P,width:"100%",zIndex:D.ke,...k,...x,...f,...b}}}}Mt.wrapStyle={width:"100%",display:"flex",flexDirection:"column",position:"relative",alignItems:"center",flexGrow:1},Mt.defaultDesktopPageCoverViewportPercentage=30,Mt.defaultFontFamily=B.Z.getCompositeFontFamily(a.SP).sans,Mt.defaultFontSize=16,Mt.defaultMobileFontSize=16,Mt.defaultAndroidFontSize=17,Mt.defaultFontSmallSize=14,Mt.titlePaddingHeight=28,Mt.peekViewContentMinHeight=240,Mt.miniPeekViewContentMinHeight=80,Mt.fontFamily={serif:B.Z.getCompositeFontFamily(a.SP).serif,mono:B.Z.getCompositeFontFamily(a.SP).mono},Mt.fontSize={serif:17,mono:15},Mt.fontSmallSize={serif:15,mono:14},Mt.fontLetterSpacing={serif:0,mono:.055},Mt.fontLineHeight={serif:1.6,mono:1.6};const Tt=Mt}}]);