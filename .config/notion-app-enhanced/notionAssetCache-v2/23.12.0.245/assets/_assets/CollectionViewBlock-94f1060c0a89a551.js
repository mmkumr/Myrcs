"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[3190],{54281:(e,t,o)=>{o.d(t,{$o:()=>U,Fv:()=>z,IL:()=>$,J4:()=>X,KA:()=>G,Nf:()=>F,_p:()=>N,cQ:()=>Z,f$:()=>q,fX:()=>E,j2:()=>D,k2:()=>W,mg:()=>J,mz:()=>A,oP:()=>O,tF:()=>Q,td:()=>Y,x:()=>H});o(57658);var r=o(30120),n=o(1302),a=o(15145),i=o(45433),l=o(40652),s=o(53877),c=o(42875),d=o(15157),u=o(72126),m=o(97880),g=o(75079),p=o(65742),f=o(78316),S=o(88632),y=o(77080),b=o(35661),C=o(27724),v=o(34583),k=o(50906),h=o(8406),w=o(49865),_=o(75134),P=o(5149),M=o(45264),x=o(96802),T=o(9953),L=o(79978),R=o(75018),I=o(24677),V=o(98104),B=o(39699);function D(e){const{collectionViewStore:t,collectionContextStore:o,timelineState:r,environment:n}=e,a=n.currentUser.id,i=(0,p.B8)(t.id),l=(0,p.pQ)(t,n),s=o.permissionScopes.state,c=u.Ds((()=>{if(r.destroyed)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,p.al)(r)};d.Z.set({userId:a,key:i,value:e})}),1e3),m=u.Ds((()=>{if(r.destroyed||!S.Z.state.online||!n.currentUser.isLoggedIn()||!s.canConfigureBlock)return;const e={zoomLevel:r.zoomLevel.state,centerTimestamp:(0,p.al)(r)},o=t.getFormat().timeline_preference;u.Xy(o,e)||B.createAndCommit({userAction:"collectionTimelineViewActions.setRemotePreference",environment:n,perform:o=>{x.FH({stores:[t],update:{timeline_preference:e},transaction:o})}})}),5e3);r.savePreference=()=>{c(),m()},F({timelineState:r,environment:n,...l})}function F(e){const{timelineState:t,zoomLevel:o,centerTimestamp:r,environment:a}=e,{savePreference:i}=t,l=a.WindowSizeStore.state.width+2*p.Ge,s=(0,p.x2)(o,l),c=r-s/2,d=r+s/2;t.zoomLevel.setState(o),t.currentRange.setState({startTimestamp:c,endTimestamp:d}),n.default.afterNextFlush((()=>{G({timelineState:t,centerTimestamp:r}),i&&i()}))}function G(e){const{timelineState:t,centerTimestamp:o}=e,{horizontalScroller:r,outerSizeObserver:n}=t;if(!r)return;const a=t.zoomLevel.state,{startTimestamp:i,endTimestamp:l}=t.currentRange.state,s=n.rect.state.width;if(s===(0,p.e$)(a,l-i))return;const c=(0,p.e$)(a,o-i)-s/2;r.scrollLeft=c,t.scrollLeft.setState(c)}function O(e){const{environment:t,store:o,query:r,date:n,schema:a,transaction:i}=e,{timeline_by:l}=r;if(!l)return;const s=(0,p.TW)({store:o,dateValue:n,query:r,schema:a}),c=o.getPropertyValue(l),d=r.timeline_by_end?o.getPropertyValue(r.timeline_by_end):void 0;return T.sW({store:o.getPropertiesStore(),data:s,transaction:i}),_.H({environment:t,store:o,dateProperty:{id:l,newValue:(null==s?void 0:s[l])??[],oldValue:c},otherDateProperty:r.timeline_by_end?{id:r.timeline_by_end,newValue:(null==s?void 0:s[r.timeline_by_end])??[],oldValue:d}:void 0}),o}function z(e){var t;const{environment:o,timelineState:n,collectionStore:a,collectionContextStore:i,store:l,query:d,groupFormat:u,transaction:m}=e,g=n.zoomLevel.state,f=(0,p.al)(n),{snapUnit:S,getDateRangePlaceholderDuration:y}=p.BJ[g],{timeline_by:b}=d;if(!b)return;const C=null===(t=i.groupsStore.getGroupState(u))||void 0===t?void 0:t.resultsStore.state;if(!C)return;const v=r.ou.fromMillis(f),k=(0,p.DS)(v,S),h=(0,p.DS)(y(v),S),_=(0,p.AZ)({startValue:(0,s.Lg)((0,c.r)()),snapUnit:S,desiredStart:k,desiredEnd:h});return O({environment:o,store:l,query:d,schema:a.getSchema(),date:_,transaction:m}),w.$T({environment:o,collectionStore:a,before:!0,store:C[0],insertStores:[l],collectionContextStore:i,groupsPointer:u?[u]:[],transaction:m}),l}function q(e){const{type:t,timelineState:o,store:r,startX:n,query:a,schema:i,intl:l,environment:s}=e,{horizontalScroller:c}=o,{startTimestamp:d}=o.currentRange.state;if(!c)return;I.Ys({environment:s,store:r});const m=c.scrollLeft,{stores:g}=C.default.state,f=u.oA(g.map((e=>{const t=(0,p.bk)({store:e,query:a,schema:i,userId:s.currentUser.id,intl:l});if(t)return{startValue:t,store:e}})));o.dragState.setState({type:t,startStore:r,stores:f.map((e=>{let{store:t}=e;return t})),startValues:f.map((e=>{let{startValue:t}=e;return t})),temporaryValues:f.map((e=>{let{startValue:t}=e;return t})),startX:n,startStartTimestamp:d,startScrollLeft:m})}function X(e){const{timelineState:t,store:o,startX:r,startY:n,schema:a,collectionContextStore:i,verticalScroller:l}=e,{horizontalScroller:s}=t,{startTimestamp:c}=t.currentRange.state;if(!s||!l)return;const d=s.scrollLeft,u=l.scrollTop,m=(0,p.YE)(i,o,a);t.drawState.setState({startStore:o,startDependencyRelationPointers:m,temporaryDependencyRelationPointers:[...m],startX:r,startY:n,startScrollLeft:d,startScrollTop:u,startStartTimestamp:c,xOffsetPx:0,yOffsetPx:0,tryToCompleteDrawnArrow:!1})}function Y(e){const{timelineState:t,currentX:o}=e,{horizontalScroller:r}=t,n=t.zoomLevel.state,a=t.dragState.state,{startTimestamp:i}=t.currentRange.state;if(!a||!r)return;const{type:l,startStartTimestamp:c,startValues:d,startScrollLeft:g,startX:f,startStore:S,stores:y}=a,b=p.BJ[n],{snapUnit:C}=b,v=r.scrollLeft-g+(o-f)+(0,p.e$)(n,i-c),k=(0,p.x2)(n,v),h=d[y.indexOf(S)];let w;if(l===p.px.LeftResizer){const{start:e}=(0,p.XO)(h,C),t=e.plus(k);w=d.map((e=>{const o=(0,p.AZ)({startValue:e,snapUnit:C,desiredStart:t});return(0,s.gW)(o)}))}else if(l===p.px.RightResizer){const{end:e}=(0,p.XO)(h,C),t=e.plus(k);w=d.map((e=>{const o=(0,p.AZ)({startValue:e,snapUnit:C,desiredEnd:t});return(0,s.Qq)(o)}))}else l===p.px.ItemDrag?w=d.map((e=>{const{start:t,end:o}=(0,p.XO)(e,C),r=t.plus(k),n=r.plus(o.valueOf()-t.valueOf());return(0,p.AZ)({startValue:e,snapUnit:C,desiredStart:r,desiredEnd:n})})):(0,m.t1)(l);u.Xy(a.temporaryValues,w)||t.dragState.setState({...a,temporaryValues:w})}function A(e){const{timelineState:t,currentX:o,currentY:r,verticalScroller:n}=e,a=t.drawState.state,i=t.zoomLevel.state,{startTimestamp:l}=t.currentRange.state,{horizontalScroller:s}=t;if(!a||!s||!n)return;const{startDependencyRelationPointers:c,startStore:d,startX:m,startY:g,startScrollLeft:f,startScrollTop:S,startStartTimestamp:y}=a,b=s.scrollLeft,C=n.scrollTop,v=b-f+(o-m)+(0,p.e$)(i,l-y),k=C-S+(r-g),h=t.hoveredItem.state;if(h&&h!==d&&!c.some((e=>e.id===h.id))){const e=[...c,{table:"block",id:h.id,spaceId:h.getSpaceId()}];u.Xy(a.temporaryDependencyRelationPointers,e)||t.drawState.setState({...a,temporaryDependencyRelationPointers:e,xOffsetPx:void 0,yOffsetPx:void 0})}else t.drawState.setState({...a,temporaryDependencyRelationPointers:[...c],xOffsetPx:v,yOffsetPx:k})}function E(e){const{environment:t,timelineState:o,query:r,schema:n,transaction:a}=e,i=o.dragState.state,{timeline_by:l}=r;if(!i||!l)return;const{temporaryValues:s,stores:c}=i;s.forEach(((e,o)=>{const i=c[o];O({environment:t,store:i,query:r,schema:n,transaction:a,date:e})})),o.dragState.setState(void 0)}function U(e){var t;const{timelineState:o,environment:r,transaction:n,collectionContextStore:a,isFullScreen:i,isRootChild:l}=e,s=o.drawState.state,c=o.dateRangePlaceholder.state;if(!s)return;const{startStore:d,startDependencyRelationPointers:u,temporaryDependencyRelationPointers:m}=s;if(!d)return void o.drawState.setState(void 0);let f;if(c.active){const{date:e,store:t,parentStore:i,groupFormat:l,newTimelineItemProps:s,existingTimelineItemProps:u}=c;if(t&&u){const{query:o,schema:a}=u;O({environment:r,store:t,query:o,schema:a,date:e,transaction:n}),f={table:"block",id:t.id,spaceId:d.getSpaceId()}}else if(s){const{query:o,schema:c,isFullScreen:u,canEditTimelineItems:m,subitemPath:g}=s,p=J({environment:r,date:e,store:t,parentStore:i,query:o,schema:c,isFullScreen:u,groupFormat:l,canEditTimelineItems:m,collectionContextStore:a,subitemPath:g,transaction:n,from:"timeline_complete_draw"});p&&(f={table:"block",id:p.id,spaceId:d.getSpaceId()})}o.dateRangePlaceholder.setState({active:!1})}else f=m.find((e=>!u.includes(e)));const S=(0,p._e)(a);if(S){const{property:e}=S;f&&(L.hE({environment:r,propertyWithInverse:S,sourceStore:d,destStore:b.G.createChildStore(d,f),position:{type:"after"},transaction:n}),h.rv({environment:r,collectionContextStore:a,block_id:d.id,property:e,property_type:"relation",from:"timeline",isFromBulkActionsToolbar:!1,isUnthrottled:!0})),o.drawState.setState(void 0)}else P.wl({item:{type:y.default.checkGate("dependency_date_shifting_by_space")?"dependencies":"arrowsBy"},collectionSettingsStore:a.settingsStore}),o.drawState.setState({...s,tryToCompleteDrawnArrow:!0});const C=null===(t=f)||void 0===t?void 0:t.id;C&&k.LEn(r,{...(0,g.Pn)(a),...(0,p.Ii)({environment:r,collectionContextStore:a,timelineState:o,isFullScreen:i,isRootChild:l}),dependenciesPropertyID:null==S?void 0:S.property,blockedByStoreID:d.id,blockingStoreID:C})}function Z(e){const{timelineState:t,environment:o}=e;t.dragState.state&&(t.dragState.setState(void 0),I.ZH(o))}function H(e){const{timelineState:t,environment:o}=e;t.drawState.state&&(t.drawState.setState(void 0),I.ZH(o))}function W(e){const{stores:t,collectionViewStore:o,schema:r,transaction:n}=e,a=o.getType(),i=o.getQuery(r),l=[];i&&("calendar"===a?i.calendar_by&&l.push(i.calendar_by):"timeline"===a&&(i.timeline_by&&l.push(i.timeline_by),i.timeline_by_end&&l.push(i.timeline_by_end)));for(const s of t)for(const e of l)T.sO({store:s.getPropertyStore(e),value:void 0,transaction:n})}function $(e){const{dependency:t,collectionContextStore:o,environment:r,timelineState:n,isFullScreen:a,isRootChild:i}=e,l=(0,p._e)(o),s=o.collectionStore();if(!l||!s)return;const{property:c}=l,{store:d,relationPointer:u}=t,m=d.getSchema()[c];m&&"relation"===m.type&&(B.createAndCommit({userAction:"CollectionTimelineDependenciesOverlay.handleRemoveRelation",environment:r,perform:e=>{L.Bl({environment:r,propertyWithInverse:l,sourceStore:d,destStore:b.G.createChildStore(d,u),transaction:e}),h.rv({environment:r,block_id:u.id,property:c,property_type:m.type,from:"timeline",collectionContextStore:o,isFromBulkActionsToolbar:!1,isUnthrottled:!0})}}),k.lfq(r,{...(0,g.Pn)(o),...(0,p.Ii)({environment:r,collectionContextStore:o,timelineState:n,isFullScreen:a,isRootChild:i}),dependenciesPropertyID:c,blockedByStoreID:d.id,blockingStoreID:u.id}))}function Q(e){const{collectionViewStore:t,newProperty:o,transaction:r}=e;x.FH({stores:[t],update:{timeline_arrows_by:{property:o}},transaction:r})}function N(e){var t;const{collectionContextStore:o,relationPropertyId:r,transaction:n}=e,a=o.collectionStore();if(!a)return;const s=r?a.getSchema()[r]:void 0,c="relation"===(null==s?void 0:s.type)&&s.property&&"relation"===(null===(t=a.getSchema()[s.property])||void 0===t?void 0:t.type)?s.property:void 0;x.FH({stores:[a],update:{collection_default_arrows_by:r,...a.getFormat().app_config_uri===l.iS?{app_uri_map:{...a.getFormat().app_uri_map?a.getFormat().app_uri_map:{},[i.Es.BlockingRelation]:r,[i.Es.BlockedRelation]:c}}:{}},transaction:n})}function J(e){const{environment:t,transaction:o,date:r,parentStore:n,query:i,schema:l,isFullScreen:s,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,from:m}=e;if(!v.M_(t))return;const g=c?[c]:[],p=u.groupsStore.getGroupState(g);if(!p)return;if(n)return function(e){const{environment:t,transaction:o,date:r,store:n,parentStore:i,query:l,schema:s,groupFormat:c,canEditTimelineItems:d,collectionContextStore:u,subitemPath:m}=e;if(!n||!i)return;const g=c?[c]:[],p=w.yk({environment:t,collectionContextStore:u,groupsPointer:g,store:n,before:!1,collectionStore:i,transaction:o,subitemPath:m,subitemInsertDirection:"into"});if(p){if(O({environment:t,store:p,query:l,schema:s,date:r,transaction:o}),t.device.isMobile)R.navigateToBlock({environment:t,store:p,pageVisitSource:a.tY.Create});else if(p&&d){const e=p.getBlockTitleStore();V.N_({store:e})}return p}}(e);u.searchQuery.state&&M.Ug({searchQuery:"",collectionContextStore:u,isFullScreen:s});const S=w.IW({environment:t,collectionContextStore:u,groupsPointer:g,coerce:!0,initializeDefaultTemplate:!0,transaction:o,from:m});if(!S)return;const y=S.coercionSucceeded,b=S.newStore;if(O({environment:t,store:b,query:i,schema:l,date:r,transaction:o}),t.device.isMobile)R.navigateToBlock({environment:t,store:b,pageVisitSource:a.tY.Create});else if(y&&d){const e=b.getBlockTitleStore();V.NX({store:e})}else R.peekBlock({environment:t,store:b,peekMode:(0,f.kr)(u.collectionViewStore()),resultsStore:null==p?void 0:p.resultsStore,collectionContextStore:u,pageVisitSource:a.tY.Create});return b}},80025:(e,t,o)=>{o.d(t,{Vn:()=>i,mF:()=>l,qf:()=>c});var r=o(5366),n=o(33929);const a=(0,r.defineMessages)({default:{defaultMessage:"Light gray",id:"colors.select.lightGray"},gray:{defaultMessage:"Gray",id:"colors.select.gray"},translucentGray:{defaultMessage:"Gray",id:"colors.select.gray"},brown:{defaultMessage:"Brown",id:"colors.select.brown"},orange:{defaultMessage:"Orange",id:"colors.select.orange"},yellow:{defaultMessage:"Yellow",id:"colors.select.yellow"},green:{defaultMessage:"Green",id:"colors.select.green"},blue:{defaultMessage:"Blue",id:"colors.select.blue"},purple:{defaultMessage:"Purple",id:"colors.select.purple"},pink:{defaultMessage:"Pink",id:"colors.select.pink"},red:{defaultMessage:"Red",id:"colors.select.red"}});function i(e){const t=a[e]||a.gray;return n.default.formatMessage(t)}const l=(0,r.defineMessages)({foregroundColorDefault:{id:"action.foregroundColor.default.name",defaultMessage:"Default"},foregroundColorGray:{id:"action.foregroundColor.gray.name",defaultMessage:"Gray"},foregroundColorBrown:{id:"action.foregroundColor.brown.name",defaultMessage:"Brown"},foregroundColorOrange:{id:"action.foregroundColor.orange.name",defaultMessage:"Orange"},foregroundColorYellow:{id:"action.foregroundColor.yellow.name",defaultMessage:"Yellow"},foregroundColorGreen:{id:"action.foregroundColor.green.name",defaultMessage:"Green"},foregroundColorBlue:{id:"action.foregroundColor.blue.name",defaultMessage:"Blue"},foregroundColorPurple:{id:"action.foregroundColor.purple.name",defaultMessage:"Purple"},foregroundColorPink:{id:"action.foregroundColor.pink.name",defaultMessage:"Pink"},foregroundColorRed:{id:"action.foregroundColor.red.name",defaultMessage:"Red"},backgroundColorGray:{id:"action.backgroundColor.gray.name",defaultMessage:"Gray background"},backgroundColorBrown:{id:"action.backgroundColor.brown.name",defaultMessage:"Brown background"},backgroundColorOrange:{id:"action.backgroundColor.orange.name",defaultMessage:"Orange background"},backgroundColorYellow:{id:"action.backgroundColor.yellow.name",defaultMessage:"Yellow background"},backgroundColorGreen:{id:"action.backgroundColor.green.name",defaultMessage:"Green background"},backgroundColorBlue:{id:"action.backgroundColor.blue.name",defaultMessage:"Blue background"},backgroundColorPurple:{id:"action.backgroundColor.purple.name",defaultMessage:"Purple background"},backgroundColorPink:{id:"action.backgroundColor.pink.name",defaultMessage:"Pink background"},backgroundColorRed:{id:"action.backgroundColor.red.name",defaultMessage:"Red background"},backgroundColorDefault:{id:"action.backgroundColor.default.name",defaultMessage:"Default background"}}),s={default:{...l.foregroundColorDefault},gray:{...l.foregroundColorGray},brown:{...l.foregroundColorBrown},orange:{...l.foregroundColorOrange},yellow:{...l.foregroundColorYellow},teal:{...l.foregroundColorGreen},blue:{...l.foregroundColorBlue},purple:{...l.foregroundColorPurple},pink:{...l.foregroundColorPink},red:{...l.foregroundColorRed},gray_background:{...l.backgroundColorGray},brown_background:{...l.backgroundColorBrown},orange_background:{...l.backgroundColorOrange},yellow_background:{...l.backgroundColorYellow},teal_background:{...l.backgroundColorGreen},blue_background:{...l.backgroundColorBlue},purple_background:{...l.backgroundColorPurple},pink_background:{...l.backgroundColorPink},red_background:{...l.backgroundColorRed}};function c(e){return s[e]}},56638:(e,t,o)=>{o.d(t,{Z:()=>a});var r=o(49085);class n extends r.default{getInitialState(){return{open:!1}}}const a=new n},53470:(e,t,o)=>{o.d(t,{H:()=>a});o(67294);var r=o(45238),n=o(85893);const a=(0,r.I)("rename",{viewBox:"0 0 16 16",svg:(0,n.jsx)("path",{d:"M14.7881 2.5752L15.3008 2.04199C15.5605 1.76855 15.5742 1.39941 15.3213 1.13965L15.1436 0.955078C14.9111 0.722656 14.5283 0.763672 14.2754 1.00977L13.749 1.5293L14.7881 2.5752ZM6.68066 9.87598L8.0752 9.28809L14.2891 3.06738L13.25 2.03516L7.03613 8.25586L6.4209 9.60254C6.35254 9.75977 6.52344 9.9375 6.68066 9.87598ZM4.09668 14.4355H12.0674C13.373 14.4355 14.1387 13.6768 14.1387 12.2207V4.99512L12.7988 6.33496V12.1045C12.7988 12.7676 12.4434 13.1025 11.9854 13.1025H4.17871C3.54297 13.1025 3.19434 12.7676 3.19434 12.1045V4.49609C3.19434 3.83301 3.54297 3.49805 4.17871 3.49805H10.0234L11.3633 2.1582H4.09668C2.62695 2.1582 1.85449 2.91699 1.85449 4.37988V12.2207C1.85449 13.6836 2.62695 14.4355 4.09668 14.4355Z"})})}}]);