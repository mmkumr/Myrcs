"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[105],{88625:(e,t,r)=>{r.r(t),r.d(t,{SpaceSubscriptionUpdatePaymentMethodModal:()=>S});r(21703);var a=r(86664),n=r(67294),o=r(480),s=r(86628),i=r(24405),d=r(8848),c=r(59730),l=r(97880),u=r(82990),p=r(5366),m=r(47307),g=r(16100),f=r(80444),h=r(45407),y=r(34583),b=r(88893),x=r(42922),v=r(63296),C=r(64369),M=r(85893);function S(e){return(0,M.jsx)(a.Elements,{stripe:(0,g.getStripe)(),children:(0,M.jsx)(_,{...e})})}function _(e){window.__c={n:"SpaceSubscriptionUpdatePaymentMethodModalStripeConsumer"};const[t,r,d]=(0,s.AF)(void 0,h.Z),u=(0,a.useStripe)(),g=(0,a.useElements)(),[f,y]=n.useState(!1),[S,_]=n.useState(void 0),P=(0,o.O7)(),k=(0,p.useIntl)(),B=n.useCallback(((e,a)=>{t.paymentRequest||(r({...t,paymentRequest:e,supportsApplePay:Boolean(a&&a.applePay)}),d.addPaymentOption("native_payment_platform"))}),[r,d,t]);n.useEffect((()=>{if(u){const t=u.paymentRequest({country:"US",currency:"usd",total:{label:k.formatMessage({id:"spaceSubscriptionUpdatePaymentMethod.applePay.total.label",defaultMessage:"Notion - You will be charged on a recurring basis"}),amount:0}});t.canMakePayment().then((e=>{e&&B(t,e)})),t.on("token",(t=>{w({environment:P,spaceStore:e.spaceStore,stripeToken:t.token.id,customerData:e.customerData,onComplete:r=>{t.complete(r?"success":"fail"),e.onComplete()}})}))}}),[u,e,k,P,B]);const A=b.zt(t.availablePaymentMethods),E=(0,i.yK)(j,[]);return f?(0,M.jsxs)("div",{style:E.container,children:[(0,M.jsx)("div",{style:E.header,children:(0,M.jsx)(p.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.update.header",defaultMessage:"Update credit card"})}),(0,M.jsx)("div",{style:E.cardContainer,children:(0,M.jsx)(a.CardElement,{options:{hidePostalCode:!0}})}),S&&(0,M.jsx)(C.Z,{isMultiline:!1,style:E.error,children:S}),(0,M.jsx)("div",{style:E.upgradeButtonContainer,children:(0,M.jsx)(x.Z,{style:E.upgradeButton,onClick:()=>async function(e){const{stripe:t,elements:r,environment:n,spaceStore:o,customerData:s,onComplete:i,setError:d}=e;if(!t||!r)return;const c=r.getElement(a.CardElement);if(!c)return;const l=await t.createToken(c);!l.error&&l.token?await w({environment:n,spaceStore:o,stripeToken:l.token.id,customerData:s,onComplete:i}):l.error&&d(l.error.message)}({stripe:u,elements:g,environment:P,spaceStore:e.spaceStore,customerData:e.customerData,onComplete:e.onComplete,setError:_}),children:(0,M.jsx)(p.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.creditCard.updateButton",defaultMessage:"Update"})})})]}):(0,M.jsxs)("div",{style:E.container,children:[(0,M.jsx)("div",{style:E.header,children:(0,M.jsx)(p.FormattedMessage,{id:"spaceSubscriptionUpdatePaymentMethod.update.header",defaultMessage:"Update payment method"})}),(0,M.jsx)("div",{style:E.optionGroup,children:A.map(((r,a)=>{let{type:n,title:o}=r;return(0,M.jsx)("div",{onClick:()=>async function(e){const{customerData:t,newPaymentMethod:r,setCreditCardSelected:a,paymentRequest:n}=e;if("credit_card"===r){if(t.isSubscribed&&"send_invoice"===t.billing){if(!(await m.confirmUserAction({message:(0,M.jsx)("span",{children:(0,M.jsx)(p.FormattedMessage,{defaultMessage:"Update to automatic billing?",id:"spaceSubscriptionUpdatePaymentMethod.invoiceToCreditCard.confirmMessage"})}),description:(0,M.jsx)("span",{children:(0,M.jsx)(p.FormattedMessage,{defaultMessage:"Your credit card will be charged automatically for future billing events. Invoices will no longer be sent to your billing email, but can be found in the Billing section of your Notion dashboard.",id:"spaceSubscriptionUpdatePaymentMethod.invoiceToCreditCard.confirmDescription"})})})))return}a(!0)}else{if("invoice"===r)throw new c.XV("You cannot select this payment collection method in the app. Please reach out to support.",{type:"collection_method_not_allowed"});"native_payment_platform"===r?n&&n.show():(0,l.t1)(r)}}({customerData:e.customerData,newPaymentMethod:n,paymentRequest:t.paymentRequest,setCreditCardSelected:y}),children:(0,M.jsx)(v.Z,{style:{...E.option,...a!==A.length-1?E.optionBorder:void 0},children:o})},n)}))})]})}async function w(e){const{environment:t,spaceStore:r,stripeToken:a,customerData:n,onComplete:o}=e,{currentUserStore:s}=f.default.state,i=null!=s&&s.isDefined()?s.getEmail():void 0,d=n.billingEmail||i;if(!d)throw new Error("No billing email found.");try{await y.Mg({environment:t,spaceStore:r,paymentData:{type:"stripeToken",value:a},billingEmail:d,from:"space_settings-billing_tab-update_credit_card"}),o(!0)}catch{o(!1)}}function j(e){return{container:{width:500,background:e.popoverBackground,padding:30,borderRadius:3},optionGroup:{borderRadius:"2px",background:e.groupedFormBackground,border:"1px solid",borderColor:e.groupedFormBorder},option:{display:"flex",justifyContent:"flex-start",border:"none",height:void 0,paddingTop:"15px",paddingBottom:"15px"},optionBorder:{borderBottom:"1px solid",borderBottomColor:e.groupedFormBorder},header:{fontSize:18,marginBottom:16,fontWeight:u.Z.fontWeight.medium},cardContainer:{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBackground,padding:"10px",marginTop:"10px",marginBottom:"10px"},upgradeButtonContainer:{width:"100%",justifyContent:"flex-end",display:"flex"},upgradeButton:{marginTop:"20px"},error:{marginTop:8,color:d.ZP.red}}}},16100:(e,t,r)=>{r.r(t),r.d(t,{getStripe:()=>b,injectStripe:()=>y,paymentIntentRequiresPaymentMethod:()=>M,translateStripeError:()=>C,useElementsOptions:()=>v});var a=r(86664),n=r(97894),o=r(67294),s=r(86628),i=r(24405),d=r(24211),c=r(97880),l=r(82990),u=r(50906),p=r(95477),m=r(80444),g=r(70060),f=r(85893);let h=null;function y(e){return t=>{const[r]=o.useState(b);return(0,f.jsx)(a.Elements,{stripe:r,children:(0,f.jsx)(a.ElementsConsumer,{children:r=>{let{stripe:a,elements:n}=r;const o={...t,stripe:a,elements:n};return(0,f.jsx)(e,{...o})}})})}}async function b(){return h||(n.loadStripe.setLoadParameters({advancedFraudSignals:!1}),h=(0,n.loadStripe)(p.default.stripe.key)),h}function x(e){switch(e){case"en-US":return"en";case"ko-KR":return"ko";case"ja-JP":return"ja";case"fr-FR":return"fr-FR";case"de-DE":return"de";case"es-ES":return"es-ES";case"es-LA":return"es-419";case"pt-BR":return"pt-BR";case"zh-CN":return"zh";case"zh-TW":return"zh-TW";case"da-DK":return"da";case"nl-NL":return"nl";case"fi-FI":return"fi";case"nb-NO":return"nb";case"sv-SE":return"sv";default:return"auto"}}function v(e){const t=(0,i.Fg)(),{type:r}=e,a="setup"===r||"subscription"===r?e.currency:void 0,n="subscription"===r?e.amount:void 0,[u,p]=(0,s.VK)((()=>{var e;const t=(null===(e=m.default.state)||void 0===e||null===(e=e.currentUserSettingsStore)||void 0===e||null===(e=e.getSettings())||void 0===e?void 0:e.preferred_locale)||d.al;return[g.rR(),t]}),[]);return(0,o.useMemo)((()=>{const e="dark"===t.mode,o={appearance:{labels:"floating",variables:{spacingGridRow:"8px",colorPrimary:t.blueColor,colorText:t.regularTextColor,colorTextPlaceholder:e?"#5A5A5A":"#ACABA9",fontFamily:l.Z.baseFontFamily.sans,borderRadius:"4px"},rules:{".Input":{display:"flex",alignItems:"center",width:"100%",fontSize:"14px",lineHeight:"20px",letterSpacing:"-0.154px",padding:"3px 6px",height:"40px",boxShadow:"none",backgroundColor:e?"#262626":"#F9F9F8",borderWidth:"1px",borderStyle:"solid",borderColor:e?"#1C1C1C":"rgba(227,226,224,0.5)",cursor:"text",color:e?"#E1E1E1":"#1D1B16"},".Label":{fontSize:"14px",color:e?"#5A5A5A":"#ACABA9"},".Label--resting":{fontSize:"14px",lineHeight:"140%",letterSpacing:"-0.154px",color:e?"#5A5A5A":"#ACABA9"},".Label--floating":{fontSize:"10px",fontWeight:"600",lineHeight:"13px",letterSpacing:"0.12px",marginTop:"4px",transition:"all 200ms ease"}}},locale:x(p)};switch(r){case"address":return o;case"setup":return u?{...o,currency:null==a?void 0:a.toLowerCase(),mode:"setup",paymentMethodCreation:"manual"}:{};case"subscription":return u?{...o,amount:n,currency:null==a?void 0:a.toLowerCase(),mode:"subscription",paymentMethodCreation:"manual",setupFutureUsage:"off_session"}:{};default:(0,c.t1)(r)}}),[t,r,n,a,p,u])}function C(e,t,r){if(!r.code)return r.message||"";switch(u._qN(e,{error:r.code,stripe_decline_code:r.decline_code}),r.code){case"invalid_expiry_year_past":return t.formatMessage({id:"stripeHelpers.invalidExpiryYear.error.message",defaultMessage:"Your card's expiration year is in the past."});case"invalid_cvc":return t.formatMessage({id:"stripeHelpers.invalidCVC.error.message",defaultMessage:"Your card's security code is invalid."});case"invalid_number":return t.formatMessage({id:"stripeHelpers.invalidNumber.error.message",defaultMessage:"Your card number is not a valid credit card number."});case"card_declined":return function(e,t){switch(t){case"expired_card":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.expiredCard",defaultMessage:"Your card was declined because it is an expired card."});case"incorrect_number":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.incorrectNumber",defaultMessage:"Your card was declined because you input an incorrect number."});case"insufficient_funds":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.declinedFunds",defaultMessage:"Your card was declined because of insufficient funds."});case"invalid_cvc":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidCvc",defaultMessage:"Your card was declined because you input an invalid CVC number"});case"invalid_amount":return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message.invalidAmount",defaultMessage:"Your card was declined because payment amount exceeds the amount that's allowed."});default:return e.formatMessage({id:"stripeHelpers.cardDeclined.error.message",defaultMessage:"Your card was declined."})}}(t,r.decline_code);default:return r.message||""}}function M(e){let{status:t}=e;return["requires_payment_method","requires_source"].includes(t)}},45407:(e,t,r)=>{r.d(t,{Z:()=>s});var a=r(49085),n=r(72126);class o extends a.default{getInitialState(){return{availablePaymentMethods:["credit_card"],paymentRequest:void 0,supportsApplePay:!1}}isPaymentOptionAvailable(e){return this.state.availablePaymentMethods.includes(e)}addPaymentOption(e){const t=n.jj([...this.state.availablePaymentMethods,e]);this.setState({...this.state,availablePaymentMethods:t})}}const s=o}}]);