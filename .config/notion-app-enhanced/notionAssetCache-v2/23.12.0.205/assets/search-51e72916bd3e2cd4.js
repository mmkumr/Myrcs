"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[6464],{10912:(e,t,r)=>{r.d(t,{Z:()=>M});var i=r(23174),s=r.n(i),o=(r(57658),r(67294)),n=r(83355),l=r(27531),a=r(41432),d=r(80951),c=r(95538),u=r(21202),h=r(97880),p=r(78316),m=r(17311),g=r(35328),v=r(57559),f=r(16550),y=r(12981),S=r(81865);function b(e){return"number"==typeof e}class C extends n.Z{constructor(){super(...arguments),this.renderContentBlock=e=>{const{store:t}=this.props,r=v.G.createChildStore(t,{table:u.iU,id:e}),i=(0,f.h)(r);if(i)return s()(l.D,{value:this.restrictedContentStore},void 0,s()(i,{store:r,disabled:!0,disableCommentMenu:!0,disableHoverMenu:!0,hideContent:(0,g.BX)(r),style:{fontSize:12,opacity:.8,pointerEvents:"none"},isQuickFind:!0,numberedListCounterStore:this.createComputedStore((()=>({depth:0,numberedListBlockIdsWithFormat:this.createNumberedListCounterStore(e)})))},e))},this.coverStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,p.NU)(e);return t.image?t.image:t.blockIds})),this.restrictedContentStore=this.createComputedStore((()=>{const{store:e}=this.props,t=(0,p.wK)(e);return t.image?void 0:t.blockIds})),this.numberedLists=this.createComputedStore((()=>{const{store:e}=this.props,t=this.coverStore.state,r=[];if(Array.isArray(t)){let i=0;for(;i<t.length;){let s=t[i],o=v.G.createChildStore(e,{table:u.iU,id:s});if(o.getType()===a.Ti.numberedList){const n=[{blockId:s,idx:1}],l=[{id:s,format:void 0,depth:n.length-1,index:n[0].idx}];for(i+=1;i<t.length&&(s=t[i],o=v.G.createChildStore(e,{table:u.iU,id:s}),o.getType()===a.Ti.numberedList);){{const e=o.getParentId();if(o.getParentId()===n[n.length-1].blockId)n.push({blockId:s,idx:1});else{let t=n[n.length-1].idx;for(;n.length>0&&n[n.length-1].blockId!==e;)t=n[n.length-1].idx,n.pop();n.push({blockId:s,idx:t+1})}l.push({id:s,format:void 0,depth:n.length-1,index:n[n.length-1].idx})}i+=1}r.push(l)}else i+=1}}return r}))}didUpdate(e){this.props.coverFormat.type!==e.coverFormat.type&&this.props.onLoadProxiedImage()}renderComponent(){const{coverFormat:e}=this.props;return"page_cover"===e.type?this.renderPageCover():"page_content"===e.type?this.renderPageContent():"property"===e.type?this.renderProperty(e.property):void 0}renderPageCover(){var e;const{store:t}=this.props,r=null===(e=t.getCover())||void 0===e?void 0:e.cover;return r?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(S.Z,{url:r,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),render:(e,t)=>{if(t)return s()(y.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.showEmptyGalleryCover?this.renderEmptyGalleryCover():void 0}renderPageContent(){const e=this.coverStore.state,t=this.restrictedContentStore.state;if(e){if(!Array.isArray(e))return s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(S.Z,{url:e.url,onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),isAuthenticated:!0,permissionRecord:e.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(y.Z,{style:{...this.getImageStyle(),...this.getPageContentImageStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder());if(e.length>0)return o.createElement(o.Fragment,null,s()("div",{style:this.getContentWrapStyle()},void 0,t?e.filter((e=>t.indexOf(e)>=0)).map(this.renderContentBlock):e.map(this.renderContentBlock),this.props.coverContentFadedOverlay&&s()("div",{style:this.getContentFadedOverlayStyle()})));if(this.props.showEmptyGalleryCover)return this.renderEmptyGalleryCover()}else if(this.props.showEmptyGalleryCover)return this.renderEmptyGalleryCover()}renderProperty(e){const{store:t}=this.props,r=(0,d.g)(t.getPropertyValue(e)).find((e=>(0,c.SR)({url:e.url})));return r?s()("div",{style:this.getImageCoverWrapStyle()},void 0,s()(S.Z,{onFinishedLoadingProxyUrl:e=>this.props.onLoadProxiedImage(e),url:r.url,isAuthenticated:!0,permissionRecord:this.props.store.pointer,width:this.getCoverWidth(),render:(e,t)=>{if(t)return s()(y.Z,{style:{...this.getImageStyle(),...this.getCoverStyle(),...this.getCoverAspectStyle(),objectPosition:`center ${100*(1-this.imagePosition)}%`},src:t})}}),this.renderImageBorder()):this.props.showEmptyGalleryCover?this.renderEmptyGalleryCover():void 0}renderEmptyGalleryCover(){return s()("div",{style:{height:this.getCoverHeight(),...this.props.emptyGalleryCoverStyle}})}renderImageBorder(){switch(this.props.variant){case"default":return null;case"gallery":return s()("div",{style:{position:"absolute",left:0,right:0,bottom:0,borderBottom:`1px solid ${this.theme.regularDividerColor}`}});default:(0,h.t1)(this.props.variant)}}get imagePosition(){const{coverPosition:e,store:t}=this.props;if(b(e))return e;if(t.getFormatStore().isDefined()){const{page_cover_position:e,card_cover_position:r}=t.getFormat();if(b(r))return r;if(b(e))return e}return.5}createNumberedListCounterStore(e){const t=this.numberedLists.state;for(const r of t)if(r.find((t=>t.id===e)))return r;return[]}getImageStyle(){return this.props.style||{}}getCoverHeight(){const{coverHeight:e,coverSizeFormat:t}=this.props;if(e)return e;switch(t){case"large":return m.Z.card.desktop.large.height;case"small":return m.Z.card.desktop.small.height;case"medium":default:return m.Z.card.desktop.medium.height}}getCoverWidth(){const{coverWidth:e,coverSizeFormat:t}=this.props;return e||(0,p.rD)(t)}getImageCoverWrapStyle(){return{height:this.getCoverHeight(),position:"relative",pointerEvents:"none",overflow:"hidden"}}getContentWrapVariantStyle(){const{ThemeStore:e}=this.environment,t="dark"===e.state.mode;switch(this.props.variant){case"default":return{};case"gallery":return{background:this.theme.collectionGalleryPreviewCardCover,padding:"8px 8px 0",boxShadow:t?"transparent":`inset 0 -1px 0 0 ${this.theme.regularDividerColor}`,...this.props.contentWrapStyle};default:(0,h.t1)(this.props.variant)}}getContentWrapStyle(){return{height:this.getCoverHeight(),pointerEvents:"none",overflow:"hidden",position:this.props.coverContentFadedOverlay?"relative":"static",...this.getContentWrapVariantStyle(),...this.props.contentWrapStyle}}getContentFadedOverlayStyle(){return{width:"100%",height:40,position:"absolute",bottom:0,left:0,background:`linear-gradient(to bottom, transparent, ${this.theme.accentColors.gray[30]} 100%)`,...this.props.coverContentFadedOverlayStyle}}getCoverVariantStyle(){switch(this.props.variant){case"default":return{border:`1px solid ${this.theme.stroke.regular}`,borderRadius:4};case"gallery":return{borderRadius:0,borderTopLeftRadius:1,borderTopRightRadius:1};default:(0,h.t1)(this.props.variant)}}getCoverStyle(){return{width:"100%",height:this.getCoverHeight(),...this.getCoverVariantStyle(),objectPosition:"center"}}getCoverAspectStyle(){const{coverAspectFormat:e}=this.props;return{objectFit:void 0===e?"cover":e}}getPageContentImageStyle(){return{...this.getCoverStyle(),objectPosition:"center center"}}}C.displayName="CollectionItemCover";const M=C},92660:(e,t,r)=>{r.d(t,{Z:()=>a});var i=r(23174),s=r.n(i),o=(r(67294),r(83355)),n=r(50506),l=r(53437);class a extends o.Z{renderComponent(){const{render:e}=this.props,{device:t}=this.environment,r=this.props.modalStore.state;return t.isMobile?s()(l.ZP,{ariaLabel:this.props.ariaLabel,open:r.open,popupType:l.ZP.PopupType.SlideUp,origin:this.props.origin,onDismiss:this.props.onDismiss,render:e,style:this.props.style}):s()(n.Z,{ariaLabel:this.props.ariaLabel,open:r.open,preventHideChildrenWhileOpening:!0,render:e,onDismiss:this.props.onDismiss,style:this.props.style,innerStyle:this.props.innerStyle})}}a.displayName="DefaultPopupOrModal"},36507:(e,t,r)=>{r.d(t,{Z:()=>m});var i=r(23174),s=r.n(i),o=r(10434),n=r.n(o),l=r(67294),a=r(83355),d=r(82990),c=r(87279),u=r(75024),h=r(28992);class p extends a.Z{constructor(){super(...arguments),this.styles={menuItem:{minHeight:void 0,...this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:d.Z.fontWeight.medium,fontSize:u.yv(this.environment,"UIRegular"),lineHeight:u.Dp(this.environment,"UIRegular")},caption:{fontSize:u.yv(this.environment,"UIRegular")}}}renderComponent(){const{style:e,captionStyle:t,...r}=this.props,i={...this.styles.menuItem,...e},s={...this.styles.caption,...t};return l.createElement(h.Z,n()({},r,{title:this.renderTitle(),caption:this.renderCaption(s),textWrapperStyle:this.styles.text,style:i,captionStyle:s}))}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,r=this.getThemeColors(),i={...t.title,...r.title};return s()("h4",{role:"alert",style:i},void 0,e)}renderCaption(e){const{caption:t}=this.props;if(!t)return;const r={...e,...this.getThemeColors().caption};return s()("div",{style:r},void 0,t)}getThemeColors(){return{title:{color:this.theme.mediumTextColor},caption:{color:this.theme.lightTextColor}}}}p.displayName="ErrorMenuItem",p.contextTypes={...c.mw,...a.w};const m=p},30676:(e,t,r)=>{r.d(t,{F:()=>u});var i=r(10434),s=r.n(i),o=r(23174),n=r.n(o),l=r(67294),a=r(86628),d=r(52275),c=r(93686);function u(e){window.__c={n:"TeamMenuItem"};const{teamStore:t}=e,{name:r}=(0,a.VK)((()=>({name:t.getName()})),[t]);return l.createElement(d.Z,s()({},e,{icon:n()(c.p,{size:14,store:t,disabled:!0}),title:r}))}},97680:(e,t,r)=>{r.d(t,{Z:()=>S});var i=r(10434),s=r.n(i),o=r(23174),n=r.n(o),l=r(67294),a=r(83355),d=r(66897),c=r(97880),u=r(33929),h=r(87279),p=r(98742),m=r(52275),g=r(26388),v=r(70301),f=r(45653);class y extends a.Z{renderComponent(){const{actor:e,userTitle:t,useEmailAsTooltip:r,tooltip:i,tooltipPlacement:o}=this.props,a=u.default.getIntl(),h=e.asActor&&e.isUser()?e.email:void 0,y=r&&h?h:i,S=this.environment.device.isMobile?24:20;let b;return(0,d.YU)(e)?b=n()(v.Z,{botValue:null==e?void 0:e.asActor,size:S}):(0,d.$S)(e)?b=n()(f.Z,{userValue:null==e?void 0:e.asActor,size:S}):(0,d.Iq)(e)?b=n()(f.Z,{userValue:void 0,size:S}):(0,c.t1)(e),n()(g.Z,{placement:o??g.Z.Placement.Bottom,alignment:g.Z.Alignment.Start,textWrap:!0,render:r=>l.createElement(m.Z,s()({},(0,p.Z)(r,this.props),{icon:b,title:t??(0,d.$4)(a,e),className:"notranslate"})),disableTooltip:!y,renderTooltip:()=>y})}}y.displayName="UserMenuItem",y.contextTypes={...h.mw,...a.w};const S=y},22715:(e,t,r)=>{r.d(t,{Z:()=>n});r(23174);var i=r(67294),s=r(480),o=r(24405);r(58047);function n(){window.__c={n:"WebComponentNotSupportedInMobileNativeWarning"};(0,s.O7)(),(0,o.yK)((e=>({container:{margin:"8px 16px",background:e.accentColors.yellow[100],borderRadius:8,height:"fit-content"}})),[]);return i.createElement(i.Fragment,null)}},83890:(e,t,r)=>{r.d(t,{Z:()=>M});var i=r(10434),s=r.n(i),o=r(23174),n=r.n(o),l=r(67294),a=r(83355),d=r(66897),c=r(22686),u=r(19889),h=r(7928),p=r(5366),m=r(31299),g=r(57559),v=r(92864),f=r(93044),y=r(255),S=r(97680),b=r(8319);class C extends a.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:r,onRemove:i,onClick:s}=t;const o=this.styles,l=this.getUserValue(e),a=n()(y.Z,{disabled:r,onClick:i});return n()(S.Z,{disabled:r,focused:!1,actor:(0,d.m3)(l),right:a,style:o.menuItem,desktopTitleStyle:o.menuItemTitle,onClick:s},e)},this.renderItemForSummary=e=>(0,h.Nz)(this.props.intl,this.getUserValue(e)),this.renderToken=(e,t)=>{const{userIds:r}=this.props,i=1===r.length,s=this.getUserValue(e);if(s)return n()(v.ZP,{format:this.environment.device.isMobile?f.lP.Large:f.lP.Small,showRemoveButton:!0,isSingle:i,onClickRemove:t.onRemove,actor:(0,d.m3)(s),shouldShrink:!0,style:{background:"transparent"}},e)},this.renderResultMenuItem=(e,t)=>{const r=this.getUserValue(e);return l.createElement(S.Z,s()({},t,{key:e,actor:(0,d.m3)(r)}))},this.performRequest=async e=>{let{query:t,current:r}=e;const i=new Set(r);return(await m.Yu({environment:this.environment,query:t,membersOnly:!1})).filter((e=>!i.has(e.id))).slice(0,20).map((e=>e.id))},this.getUserValue=e=>this.createUserStore(e).getValue(),this.createUserStore=e=>{const{parentStore:t}=this.props;return g.U6.createChildStore(t,{table:u.KJ,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:2,fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,userIds:r,onChange:i,disabled:s,focused:o,onMenuDismiss:l,intl:a}=this.props;return n()(b.Z,{mode:e,title:t,icon:c.f,iconStyles:this.styles.recordIcon,items:r,onChange:i,disabled:s,focused:o,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:n()(p.FormattedMessage,{defaultMessage:"Add a person",id:"search.filterMenu.addAPersonButton.label"}),labelText:{title:t,tokenInputPlaceholder:a.formatMessage({defaultMessage:"Search people",id:"search.filterMenu.searchPeople.placeholder"}),componentDebugName:"SearchPersonFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:l,hasItemsSelected:(null==r?void 0:r.length)>0})}}C.displayName="SearchPersonFilter";const M=(0,p.injectIntl)(C)},92921:(e,t,r)=>{r.r(t),r.d(t,{SearchStaticContext:()=>ns,SearchStoresContext:()=>ls,default:()=>ds});var i=r(23174),s=r.n(i),o=(r(57658),r(67294)),n=r(83355),l=r(18466),a=r(49085),d=r(15145),c=r(12174),u=r(72126),h=r(4615),p=r(97880);var m=r(70203),g=r(63143),v=r(50906),f=r(75018),y=r(87531),S=r(74647),b=r(95477),C=r(73744),M=r(69988),x=r(98165),I=r(65598),P=r(65496),T=r(41168),w=r(95697),k=r(80444),F=r(24042),R=r(77080),Z=r(32470),B=r(55320),E=r(2342),L=r(30857),O=r(87956),A=r(29026),D=r(9019),N=r(10434),q=r.n(N),V=r(480),_=r(86628),W=r(24405),z=r(29477),H=r(43250),U=r(87279),K=r(59054),j=r(21202),$=r(92338),G=r(68120),Q=r(18245),J=r(88632),X=r(57559);function Y(e){let{dependencies:t,debugColumnStore:r,localDebounce:i=25,serverDebounce:s=275,searchResultStore:n,localSearchCache:l,permanentFilterOverride:a,enabled:d}=e;const c=(0,V.O7)(),h=(0,_.VK)((()=>function(e){const{isOnline:t,debugColumnStore:r}=e,i=r.state.searchExperimentOverrides;function s(e){return(null==i?void 0:i[e])??R.default.getGroup(e,{disableExposureLogging:!0})}return{shouldSearchLocal:"on"!==s("search-no-local-blending")&&t,forcedClusterPattern:r.state.forcedClusterPattern,searchExperimentOverrides:r.state.searchExperimentOverrides,forcedBlockIds:r.state.forcedBlockIds}}({isOnline:t.isOnline,debugColumnStore:r})),[t.isOnline,r]),p=(0,o.useMemo)((()=>u.Ds(ee,s)),[s]);(0,K.r5)((()=>d?async function(e){const{query:t,openAsPage:r,store:i,fetchServerResultsFn:s}=e;if(r&&u.Xy(t,i.state.selectedQueryResultQuery))return;const o="quick_find_scroll"!==A.ZP.state.source;i.update((e=>({...e,localResults:o?void 0:e.localResults})));const n=function(e){const{shouldSearchLocal:t,parentStore:r,environment:i,query:s,debug:o,limit:n,hasPublicAccessPermission:l,isOnline:a,localSearchCache:d,store:c,permanentFilterOverride:h}=e;let p;const m={...s,filters:{...s.filters,...h}};if(t){var g;return p=P.b9(function(e){const{parentStore:t,requestInput:r,isOnline:i,environment:s,hasPublicAccessPermission:o,localSearchCache:n}=e,{query:l}=r;if(!n)return;if(!l.text.trim())return;if(o)return;const a=Q.default.mark("rum.local_quick_search_query"),d=void 0,c=P.Y_({query:r,localCachedPages:n,parentStore:t,environment:s,isOnline:i,shouldLimitLocalResultsWhenOnline:!0,applyScoreThresholdWhenOnline:!0,maxLocalResultsOverride:d});return Q.default.measure(a,{environment:s}),c}({parentStore:r,environment:i,requestInput:{query:m,debug:o,limit:n},hasPublicAccessPermission:l,isOnline:a,localSearchCache:d})),L.default.update((e=>({...e,numLocalRequests:e.numLocalRequests+1}))),u.xb(null===(g=p)||void 0===g?void 0:g.results)&&(0,E.Xx)(c.state)&&c.state.serverResultsLoading?c.update((e=>({...e,clearLocalResultsOnServerResponse:!0}))):c.update((e=>({...e,clearLocalResultsOnServerResponse:!1,localResults:p}))),p}}(e),l=[];l.push(...(null==n?void 0:n.results.map((e=>e.id)))??[]),await s({...e,excludedBlockIds:l})}({...t,...h,store:n,fetchServerResultsFn:p,environment:c,localSearchCache:l,permanentFilterOverride:a}):Promise.resolve()),[t,h,n,p,c,l,a,d],{debounce:i})}async function ee(e){let{parentStore:t,environment:r,query:i,debug:s,isOnline:o,publicAccessPermissionAncestorBlockId:n,currentSpaceStore:l,searchSessionId:a,searchExperimentOverrides:d,forcedClusterPattern:c,recentPagesForBoosting:h,store:m,forcedBlockIds:f,limit:y,permanentFilterOverride:S,excludedBlockIds:b}=e;const C={query:{...i,filters:{...i.filters,...S}},debug:s,limit:y};m.update((e=>({...e,serverResultsLoading:!0}))),L.default.update((e=>({...e,numServerRequests:e.numServerRequests+1})));const M=m.state.serverResults,x=A.ZP.state.source,I=await async function(e){const{parentStore:t,requestInput:r,isOnline:i,environment:s,publicAccessPermissionAncestorBlockId:o,searchSessionId:n,searchSessionFlowNumber:l,source:a,spaceId:d,searchExperimentOverrides:c,forcedClusterPattern:u,recentPagesForBoosting:h,forcedBlockIds:m,excludedBlockIds:v}=e,{query:f}=r;if(!f.text.trim()&&!P.FN(f.filters))return;if(!i)return{error:$.Ix.Offline};const y=Q.default.mark("rum.server_quick_search_query"),S=await P.MS({environment:s,input:r,spaceId:d,publicAccessPermissionAncestorBlockId:o,searchSessionId:n,searchSessionFlowNumber:l,source:a,searchExperimentOverrides:c,forcedClusterPattern:u,recentPagesForBoosting:"on"===(null==c?void 0:c["search-debug-only-no-recent-boosting"])?[]:h,forcedBlockIds:m,excludedBlockIds:v});if(!S)return;if("failed"===S.type)return S.offline?{error:$.Ix.Offline}:{error:$.Ix.RequestFailed};const b=S.data.trackEventProperties,C=(0,G.Qr)(b)?{}:(0,g.m8)((0,p.Yd)(b).map((e=>[`server-${e}`,b[e]]))),M=S.data.results.map(((e,r)=>({...e,serverEventProperties:C,originalPosition:r,store:X.G.createChildStore(t,{table:j.iU,id:e.id})})));return Q.default.measure(y,{environment:s}),{value:{results:M,total:S.data.total,debugInfo:S.data.debug,serverEventProperties:C,clusterInfo:S.data.clusterInfo}}}({parentStore:t,environment:r,requestInput:C,spaceId:null==l?void 0:l.id,searchSessionId:a,searchSessionFlowNumber:L.default.state.numServerRequests,publicAccessPermissionAncestorBlockId:n,isOnline:o,source:x,searchExperimentOverrides:d,forcedClusterPattern:c,recentPagesForBoosting:h,forcedBlockIds:f,excludedBlockIds:b}),T={query:{...A.ZP.state.query,filters:{...A.ZP.state.query.filters,...S}},limit:A.ZP.state.limit,debug:Z.ZP.getDebugLevel()};if(!u.Xy(C,T))return;const w=P.b9(I),k="quick_find_scroll"===x?P.Nu({existingResults:M,newPageResults:w}):w;if(I&&!I.error){var F,R,E;const e=I.value.results;m.update((t=>({...t,serverError:null==I?void 0:I.error,serverResultsLoading:!1,serverResults:k,serverResultsAllLoaded:e.length<y,serverEventProperties:I.value.serverEventProperties,localResults:t.clearLocalResultsOnServerResponse?void 0:t.localResults,clearLocalResultsOnServerResponse:!1})));const t=(null==k?void 0:k.results.map((e=>{var t;return{id:e.id,badges:(null===(t=e.badges)||void 0===t?void 0:t.map((e=>e.type)))??[]}})))??[],i=new Map;for(const{badges:r}of t)for(const e of r){const t=i.get(e)??0;i.set(e,t+1)}const{sections:s}=P.IV({intentBasedGrouping:B.default.state.intentBasedSearch.enablesGrouping,localResults:null===(F=m.state.localResults)||void 0===F?void 0:F.results,serverResults:null==k?void 0:k.results}),o={};for(const[r,n]of Object.entries(s))o[r]=n.map((e=>e.id));v.ZfC(r,{numLocalResults:(null===(R=m.state.localResults)||void 0===R?void 0:R.results.length)||0,numServerResults:(null==k?void 0:k.results.length)||0,localResultsIds:(null===(E=m.state.localResults)||void 0===E?void 0:E.results.map((e=>e.id)))||[],...I.value.serverEventProperties,badgeCounts:i,badgesByResultId:t,idsBySection:o})}else m.update((e=>({...e,serverError:null==I?void 0:I.error,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,localResults:e.clearLocalResultsOnServerResponse?void 0:e.localResults,clearLocalResultsOnServerResponse:!1})))}function te(){const e=(0,V.O7)(),t=(0,V.Fy)(),{searchResultStore:r,secondarySearchResultStore:i}=(0,o.useContext)(ns),{parentStore:s}=(0,o.useContext)(ls),n=function(e){const t=(0,V.O7)();return(0,_.VK)((()=>{const{hasPublicAccessPermission:r,publicAccessPermissionAncestorBlockId:i}=P.bC(t);return{isOnline:Boolean(J.Z.state.online),limit:A.ZP.state.limit,parentStore:e,hasPublicAccessPermission:r,publicAccessPermissionAncestorBlockId:i,currentSpaceStore:k.default.state.currentSpaceStore,debug:Z.ZP.getDebugLevel(),openAsPage:B.default.state.openAsPage,recentPagesForBoosting:A.ZP.state.recentPagesForBoosting,searchSessionId:B.default.state.sessionId,currentSpaceViewStore:k.default.state.currentSpaceViewStore,query:A.ZP.state.query}}),[t,e])}(s),l=(0,_.VK)((()=>Boolean((0,Z.gq)({device:t})&&Z.BJ.state.visible)),[t]),[{value:a}]=(0,K.r5)((()=>n.hasPublicAccessPermission?Promise.resolve(void 0):n.currentSpaceStore?P.hb({environment:e,currentSpaceStore:n.currentSpaceStore,currentSpaceViewStore:n.currentSpaceViewStore,excludeCurrentPage:"control"===R.default.getGroup("search-includes-current-page-in-local-search")}):Promise.resolve(void 0)),[e,n.currentSpaceStore,n.currentSpaceViewStore,n.hasPublicAccessPermission]);Y({dependencies:n,searchResultStore:r,localSearchCache:a,debugColumnStore:Z.v_,enabled:!0}),Y({dependencies:n,searchResultStore:i,localSearchCache:a,debugColumnStore:Z.BJ,enabled:l})}var re=r(5162),ie=r(69454),se=r(36488),oe=r(56940),ne=r(78140),le=r(40721),ae=r(83785),de=r(22715),ce=r(67220),ue=r(69651),he=r(64275),pe=r(6637),me=r(60291),ge=r(37612),ve=r(83303),fe=r(53772),ye=r(82990),Se=r(5366),be=r(61766),Ce=r(23063),Me=r(64921),xe=r(52275),Ie=r(31945),Pe=r(60458),Te=r(89728),we=r(72495),ke=r(93481),Fe=r(84619),Re=r(90028),Ze=r(31299),Be=r(33929),Ee=r(15447),Le=r(31278),Oe=r(11470),Ae=r(76798),De=r(255),Ne=r(85567),qe=r(8319);const Ve=(0,Se.defineMessages)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class _e extends n.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:r,onRemove:i,onClick:o}=t;const n=this.styles,l=this.createBlockStore(e),a=s()(De.Z,{disabled:r,onClick:i});return s()(Oe.Z,{disabled:r,focused:!1,store:l,right:a,style:n.menuItem,desktopTitleStyle:n.menuItemTitle,onClick:o})},this.renderItemForSummary=e=>s()(Ae.Z,{store:this.createBlockStore(e),shouldWrap:!0,maxLength:50}),this.renderToken=(e,t)=>{const{blockIds:r}=this.props,i=this.tokenStyles,o=1===r.length,n=this.createBlockStore(e),l=s()("div",{style:i.token},void 0,s()(Le.Z,{disabled:!0,icon:n.getIcon(),isEmptyPage:!1,size:20,style:i.icon}),s()(Ae.Z,{store:n}));return s()(Ne.Z,{format:this.environment.device.isMobile?Fe.l.Large:Fe.l.Small,value:l,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:o,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1},e)},this.renderResultMenuItem=(e,t)=>{const r=this.createBlockStore(e);return o.createElement(Oe.Z,q()({},t,{key:e,store:r}))},this.performRequest=async e=>{let{query:t,current:r}=e;const{currentSpaceStore:i}=k.default.state;if(!i)return[];const s=t?(await Ze.nJ({environment:this.environment,query:t,limit:20,spaceId:i.id,requireEditPermissions:!1,excludeTemplates:!1,source:"ancestor_filter_page_search",boostRecentlyViewedPages:!0})).results:Ee.X4.state.map((e=>e.pageId)),o=new Set(r);return s.filter((e=>!o.has(e)))},this.createBlockStore=e=>{const{parentStore:t}=this.props;return X.G.createChildStore(t,{table:j.iU,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{fill:"currentColor"}},this.tokenStyles={token:{display:"flex",alignItems:"center"},icon:{marginRight:4}}}renderComponent(){const{mode:e,title:t,blockIds:r,onChange:i,disabled:o,focused:n,onMenuDismiss:l}=this.props;return s()(qe.Z,{mode:e,hasItemsSelected:(null==r?void 0:r.length)>0,title:t,icon:Re.j,iconStyles:this.styles.recordIcon,items:r,onChange:i,focused:n,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s()(Se.FormattedMessage,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:Be.default.formatMessage(Ve.searchPages),componentDebugName:"SearchPageFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,disabled:o,onMenuDismiss:l})}}_e.displayName="SearchPageFilter";const We=_e;var ze=r(83890),He=r(88507),Ue=r(29369),Ke=r(30397),je=r(93044),$e=r(30676);class Ge extends n.Z{constructor(){super(...arguments),this.renderFilterListItem=(e,t)=>{let{disabled:r,onRemove:i,onClick:o}=t;const n=this.styles,l=this.createTeamStore(e),a=s()(De.Z,{disabled:r,onClick:i});return s()($e.F,{disabled:r,focused:!1,teamStore:l,right:a,style:n.menuItem,desktopTitleStyle:n.menuItemTitle,onClick:o},e)},this.renderItemForSummary=e=>this.createTeamStore(e).getName(),this.renderAvatarFactory=e=>{const t=e.getIcon();return e=>s()(Le.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:e})},this.renderToken=(e,t)=>{const{teamIds:r}=this.props,i=1===(null==r?void 0:r.length),o=this.createTeamStore(e);if(!o)return;const n=o.getName();return s()(je.ZP,{format:this.environment.device.isMobile?je.lP.Large:je.lP.Small,showRemoveButton:!0,isSingle:i,onClickRemove:t.onRemove,renderAvatar:this.renderAvatarFactory(o),title:n,style:{background:"transparent"}},e)},this.renderResultMenuItem=(e,t)=>{const r=this.createTeamStore(e);return o.createElement($e.F,q()({},t,{key:e,teamStore:r}))},this.performRequest=async e=>{var t;let{query:r,current:i}=e;const s=new Set(i),o=k.default.state.currentSpaceViewStore,n=k.default.state.currentSpaceStore,l=null===(t=k.default.state.currentUserStore)||void 0===t?void 0:t.id;if(!o||!n||!l)return[];if(!r){const e=new Set(o.getTeamsStores().map((e=>e.id)));if(Ke.Z.state.teams.map((e=>e.id)).forEach((t=>e.add(t))),e.size>0)return[...e]}const a=await(0,w.qX)({environment:this.environment,spaceStore:n,currentUserId:l});return(await Ze.zf({query:r,spaceViewStore:o,teamStores:a})).filter((e=>!s.has(e.id))).slice(0,20).map((e=>e.id))},this.createTeamStore=e=>{const{parentStore:t}=this.props;return X.zX.createChildStore(t,{table:Ue.e0,id:e})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:6,fill:"currentColor"}}}renderComponent(){const{mode:e,title:t,teamIds:r,onChange:i,disabled:o,focused:n,onMenuDismiss:l,intl:a}=this.props;return s()(qe.Z,{mode:e,title:t,icon:He.I,iconStyles:this.styles.recordIcon,items:r||[],onChange:i,disabled:o,focused:n,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:s()(Se.FormattedMessage,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label"}),labelText:{title:t,tokenInputPlaceholder:a.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder"}),componentDebugName:"SearchTeamFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:l,hasItemsSelected:Boolean(r&&(null==r?void 0:r.length)>0)})}}Ge.displayName="SearchTeamFilter";const Qe=(0,Se.injectIntl)(Ge);var Je=r(33338),Xe=r(86825),Ye=r(75689),et=r(91642);class tt extends n.Z{constructor(){super(...arguments),this.handleToggle=()=>{const{value:e,onChange:t}=this.props;t(!e)},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},sectionMenuItem:{display:"flex"}}}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){return s()(et.Z,{marginAfter:!1,style:this.styles.sectionMenuItem},void 0,this.renderSwitcherMenuItem(e))}renderMobile(e){const{title:t,value:r,disabled:i}=this.props;return e===qe.z.Button?this.renderSwitcherMenuItem(e):s()(Ye.Z,{disabled:i,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:r})}renderSwitcherMenuItem(e){const{title:t,icon:r,value:i,style:n,...l}=this.props,a=this.styles,d=this.getThemeColors(),c={...a.menuItem,...d.menuItem,...n};return e===qe.z.Pill?s()(Je.Z,{on:i,hideChevron:!0,title:s()("span",{},void 0,t),onClick:this.handleToggle,icon:r(a.pillIcon)}):o.createElement(Xe.Z,q()({title:t,icon:r(a.icon),on:i,onClick:this.handleToggle,style:c},l))}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}tt.displayName="SearchToggleFilter",tt.Mode=qe.z;const rt=tt;var it=r(8848),st=r(42853),ot=r(32163);function nt(e){window.__c={n:"SearchExperimentFilterPopupButton"};const t=(0,V.Fy)();return s()(Ie.ZP,{popupType:t.isMobile?Ie.Z4.SlideUp:Ie.Z4.Popup,renderOrigin:t=>o.createElement(at,q()({events:t},e)),render:t=>o.createElement(lt,q()({parent:t},e))})}function lt(e){let{parent:t,experiment:r,searchExperimentOverrides:i,onChange:n}=e;window.__c={n:"SearchExperimentFilterMenu"};const l=(0,V.Fy)(),a=(0,W.yK)((()=>({menuOptionStyle:{color:it.ZP.mediumTextColor}})),[]);let d;d=l.isMobile?{menuType:U.og.Modal,title:r.experimentId,right:s()(Se.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:t.close}:{menuType:U.og.Popup,width:250};const c=r.groups.map((e=>({key:e,action:i=>{n({experimentId:r.experimentId,group:e}),t.close()},render:(t,r)=>o.createElement(xe.Z,q()({},t,{title:e,style:a.menuOptionStyle}))})));return o.createElement(ne.Z,d,s()(ot.Z,{type:ot.i.Vertical,initialFocus:void 0,sections:[{key:r.experimentId,render:e=>o.createElement(we.Z,e),items:c}]}))}function at(e){let{experiment:t,events:r,searchExperimentOverrides:i}=e;window.__c={n:"SearchExperimentFilterMenuButton"};const n=(0,W.yK)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.lightIconColor},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginLeft:6,color:e.mediumTextColor},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginRight:4}})),[]);return o.createElement(Te.Z,q()({},r,{isSmall:!0,key:t.experimentId,style:n.experimentGroupButtonStyle}),s()("div",{style:n.rowContainer},void 0,s()("div",{style:n.groupCell},void 0,i[t.experimentId]||t.group),s()("div",{},void 0,(0,st.i)(n.experimentGroupButtonChevronStyle))))}const dt=e=>({fontSize:14,lineHeight:1.2,color:e.mediumTextColor,marginRight:4,display:"flex",alignItems:"center",whiteSpace:"nowrap"}),ct=function(e){window.__c={n:"SearchExperimentFilter"};const{experiment:t}=e,{leftOverrides:r,rightOverrides:i,experimentDiffers:n,experimentAgreesButNondefault:l}=(0,_.VK)((()=>{const e=Z.v_.state.searchExperimentOverrides,r=Z.BJ.state.searchExperimentOverrides,i=(e[t.experimentId]??t.group)!==(r[t.experimentId]??t.group);return{leftOverrides:e,rightOverrides:r,experimentDiffers:i,experimentAgreesButNondefault:!i&&void 0!==r[t.experimentId]&&e[t.experimentId]!==t.group}}),[t]),a=(0,W.yK)((e=>({rowContainer:{backgroundColor:n?e.equationErrorPlaceholderBackground:l?e.accentColors.yellow[100]:void 0},titleCell:{...dt(e),maxWidth:180,textOverflow:"ellipsis",overflow:"hidden"}})),[l,n]),d=(0,o.useCallback)((e=>{const{experimentId:t,group:r,store:i}=e;i.setState({...i.state,searchExperimentOverrides:{...i.state.searchExperimentOverrides,[t]:r}})}),[]);return o.createElement(o.Fragment,null,s()("div",{style:{...a.titleCell,...a.rowContainer}},void 0,t.experimentId.replace("search-","")),s()("div",{style:a.rowContainer},void 0,s()(nt,{experiment:t,searchExperimentOverrides:r,onChange:e=>{d({...e,store:Z.v_})}})),s()("div",{style:a.rowContainer},void 0,s()(nt,{experiment:t,searchExperimentOverrides:i,onChange:e=>{d({...e,store:Z.BJ})}})))};var ut=r(53877),ht=r(42875),pt=r(22686);let mt=function(e){return e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem",e}({});class gt extends n.Z{constructor(){super(...arguments),this.handleFilterClick=e=>{const{onMenuDismiss:t}=this.props;this.applyFilter(e),this.openSidebar(),t&&t()},this.applyFilter=e=>{A.ZP.updateFilters(e)},this.openSidebar=()=>{A.ZP.isDebugSidebarOpen()||A.ZP.setState({...A.ZP.state,isDebugSidebarOpen:!0})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:{...ye.Z.textOverflowStyle},icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}}}renderComponent(){const{mode:e}=this.props;return e===mt.Button?this.renderAsButton():e===mt.MenuItem?this.renderAsMenuItem():void(0,p.t1)(e)}renderAsButton(){const{icon:e,title:t,filter:r}=this.props,i=this.styles,o=this.getThemeColors();return s()(Me.Z,{style:{...i.buttonFilter,...o.buttonFilter},onClick:()=>this.handleFilterClick(r)},void 0,e&&e({...i.icon,...i.buttonIcon}),s()("span",{style:i.buttonText},void 0,t))}renderAsMenuItem(){const{icon:e,title:t,filter:r,focused:i}=this.props,o=this.styles,n=this.getThemeColors(),l={...o.menuItem,...n.menuItem};return s()(xe.Z,{icon:e&&e(o.icon),focused:i,title:t,onClick:()=>this.handleFilterClick(r),style:l})}getThemeColors(){const{device:e}=this.environment;return{menuItem:{color:e.isDesktop?this.theme.mediumTextColor:void 0,...this.props.isLastInSection&&{boxShadow:void 0}},buttonFilter:{color:this.theme.mediumTextColor}}}}gt.displayName="SearchFilterPreset",gt.Mode=mt;class vt extends n.Z{renderComponent(){const e=vt.getCurrentPageFilter();if(e)return o.createElement(gt,q()({icon:Re.j,title:s()(Se.FormattedMessage,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e},this.props))}static isActive(e){const t=vt.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const r=t.ancestors[0];return-1!==e.ancestors.indexOf(r)}}vt.displayName="InCurrentPagePreset",vt.getCurrentPageFilter=()=>{const{mainEditorCurrentBlockStore:e}=k.default.state;if(e&&e.id)return{ancestors:[e.id]}};class ft extends n.Z{renderComponent(){const e=ft.getCurrentUserFilter(this.environment);if(e)return o.createElement(gt,q()({icon:pt.f,title:s()(Se.FormattedMessage,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e},this.props))}static isActive(e,t){const r=ft.getCurrentUserFilter(e);if(!r)return!1;if(!r.createdBy)return!1;const i=r.createdBy[0];return-1!==t.createdBy.indexOf(i)}}ft.displayName="CreatedByMePreset",ft.getCurrentUserFilter=e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}};class yt extends n.Z{renderComponent(){const e=yt.getPastWeekFilter();if(e)return o.createElement(gt,q()({icon:ue.C,title:s()(Se.FormattedMessage,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e},this.props))}static isActive(e){const{lastEditedTime:t}=yt.getPastWeekFilter();return u.Xy(t,e.lastEditedTime)}}yt.displayName="EditedLastWeekPreset",yt.getPastWeekFilter=()=>({lastEditedTime:{starting:ut.Oo((0,ht.r)()),ending:ut.Lg((0,ht.r)())}});var St=r(1743),bt=r(74194);function Ct(e){window.__c={n:"SearchStringOverrideControls"};const{leftValue:t,rightValue:r,setLeftValue:i,setRightValue:n,placeholder:l,label:a}=e,{titleCell:d,rightTitleCell:c,leftTitleCell:u}=(0,W.yK)((e=>{const i=dt(e);return{titleCell:i,rightTitleCell:{...i,color:r?i.color:e.lightTextColor,width:"95%"},leftTitleCell:{...i,color:t?i.color:e.lightTextColor,width:"95%"}}}),[t,r]),[h,p]=(0,o.useState)(r),[m,g]=(0,o.useState)(t);(0,o.useEffect)((()=>{void 0===r&&p(void 0),void 0===t&&g(void 0)}),[r,t]);const v=(0,o.useCallback)((()=>{n(h)}),[n,h]),f=(0,o.useCallback)((()=>{i(m)}),[i,m]),y=(0,o.useCallback)((e=>{p(e.target.value)}),[]),S=(0,o.useCallback)((e=>{g(e.target.value)}),[]);return o.createElement(o.Fragment,null,s()("div",{style:d},void 0,a),s()(St.Z,{capture:!0,allowMenuList:!1},void 0,s()(bt.Z,{style:u,onBlur:f,value:m,onChange:S,placeholder:l}),s()(bt.Z,{style:c,onBlur:v,value:h,onChange:y,placeholder:l})))}let Mt=function(e){return e.Button="Button",e.Section="Section",e}({});class xt extends n.Z{constructor(){super(...arguments),this.storeTypes={buttonPopupStore:be.Z},this.renderAddFilterOrigin=e=>{const t=this.styles;return o.createElement(Te.Z,q()({},e,{style:t.addFilterButtonMobile,icon:pe.I,isBlue:!0}),s()(Se.FormattedMessage,{defaultMessage:"Add filter",id:"search.addFilter.button.label"}))},this.renderAddFilterMenu=()=>s()(ne.Z,{menuType:U.og.ActionSheet},void 0,this.renderSuggestedFilters(),s()(et.Z,{title:this.renderMoreFiltersTitle()},void 0,this.renderCreatedByFilter(qe.Z.Mode.Button),this.renderCreatedTimeFilter(qe.Z.Mode.Button),this.renderLastEditedTimeFilter(qe.Z.Mode.Button),this.renderAncestorFilter(qe.Z.Mode.Button),this.renderInTeamFilter(qe.Z.Mode.Button))),this.searchExperimentsToToggle=this.createComputedStore((()=>Object.entries(c.g6).map((e=>{let[t,r]=e;return{experimentId:t,experimentVersion:1,group:R.default.getGroup(t),groups:["control",...r]}})))),this.closeAddFilterMenu=()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})},this.callTitleFilterUpdateFns=e=>{A.ZP.updateFilters({navigableBlockContentOnly:e})},this.closeSidebar=()=>A.ZP.setState({...A.ZP.state,isDebugSidebarOpen:!1}),this.styles={sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 250px",minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?ye.Z.fontSize.UISmall.mobile:ye.Z.fontSize.UISmall.desktop,fontWeight:ye.Z.fontWeight.medium,marginRight:-8}}}renderComponent(){return this.props.isMobile?this.props.mode===Mt.Button?this.renderAddButtonMobile():this.props.mode===Mt.Section?this.renderActiveFiltersMobile():void(0,p.t1)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{state:e}=A.ZP,t=P.De(e.query.filters);return s()(we.Z,{disableMobilePadding:!0,disableMobileBorders:!0},void 0,this.renderTitlesOnlyFilter(qe.z.Section),this.renderDeletedOnlyFilter(qe.z.Section),this.renderActiveFilters(t,qe.Z.Mode.Section))}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return s()(Ie.ZP,{popupType:Ie.Z4.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderActiveFilters(e,t){return s()(o.Fragment,{},void 0,e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t),e.inTeams&&this.renderInTeamFilter(t))}renderSuggestedFilters(){const{filters:e}=A.ZP.state.query,t=ft.isActive(this.environment,e),r=yt.isActive(e),i=vt.isActive(e);if(!(t&&r&&i))return s()(et.Z,{title:s()(Se.FormattedMessage,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0},void 0,!t&&s()(ft,{mode:mt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!r&&s()(yt,{mode:mt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!i&&s()(vt,{mode:mt.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0}))}renderSidebar(){const e=this.styles,t=this.getThemeColors(),r={...e.sidebar,...t.sidebar,...!A.ZP.isDebugSidebarOpen()&&e.sidebarHidden};return s()("aside",{style:r},void 0,s()(Me.Z,{onClick:this.closeSidebar,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,right:10}},void 0,(0,he.D)({width:14,fill:this.theme.mediumTextColor})),this.renderDevToolsSection())}renderForcedClusterPatternInput(){return null}renderShowDebugInfoToggle(){return s()(rt,{mode:qe.z.Button,focused:!1,title:"Show debug info",icon:ce.S,value:Z.ZP.state.showDebugInfo,onChange:e=>{Z.ZP.setState({...Z.ZP.state,showDebugInfo:Boolean(e)})}})}renderShowDebugSearchToggle(){return s()(rt,{mode:qe.z.Button,focused:!1,title:"Profile query",icon:ce.S,value:"everything"===Z.ZP.state.debug,onChange:e=>{Z.ZP.setState({...Z.ZP.state,debug:e?"everything":void 0})}})}renderDevToolsSection(){if((0,fe.x)(b.default))return s()(et.Z,{title:"Dev Tools"},void 0,s()(Ce.Z,{isVisible:!0,animationStyle:{height:"100%"},render:()=>s()("div",{style:{overflow:"scroll"}},void 0,this.renderShowDebugInfoToggle(),this.renderShowDebugSearchToggle(),this.renderForcedClusterPatternInput(),s()(et.Z,{style:{marginTop:16},title:"Quick Switch"},void 0,s()(Pt,{title:"No local at all",searchExperimentOverrides:{"search-no-local-blending":"on","search-debug-only-no-recent-boosting":"on"}}),s()(Pt,{title:"No local results",searchExperimentOverrides:{"search-no-local-blending":"on"}}),s()(Pt,{title:"No local boosting",searchExperimentOverrides:{"search-debug-only-no-recent-boosting":"on"}}),s()(Pt,{title:"Vector only",searchExperimentOverrides:{"search-vectors":"log-norm"}})),s()(et.Z,{style:{marginTop:16},title:"Dev Experiments",right:s()(Te.Z,{onClick:()=>{Z.v_.reset(),Z.BJ.reset()},style:{paddingLeft:0,paddingRight:0,height:"unset"}},void 0,(0,me.b)({width:12}))},void 0,s()("div",{style:{display:"grid",gridTemplateColumns:"auto 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingLeft:14}},void 0,s()("div",{}),s()("div",{}),s()(It,{columnStore:Z.BJ}),this.searchExperimentsToToggle.state.map((e=>s()(ct,{experiment:e},e.experimentId))),s()(Ct,{leftValue:Z.v_.state.forcedClusterPattern,rightValue:Z.BJ.state.forcedClusterPattern,setLeftValue:Z.v_.updateForcedClusterPattern,setRightValue:Z.BJ.updateForcedClusterPattern,placeholder:"cluster-pattern",label:"forced cluster pattern"}),s()(Ct,{leftValue:Z.v_.state.forcedBlockIds,rightValue:Z.BJ.state.forcedBlockIds,setLeftValue:Z.v_.updateForcedBlockIds,setRightValue:Z.BJ.updateForcedBlockIds,placeholder:"block ids",label:"forced block ids"}))))}))}renderTitlesOnlyFilter(e){const{filters:t}=A.ZP.state.query;return s()(rt,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"}),icon:ve.c,value:t.navigableBlockContentOnly||!1,onChange:this.callTitleFilterUpdateFns})}renderDeletedOnlyFilter(e){const{filters:t}=A.ZP.state.query;return s()(rt,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only"}),icon:ge.y,value:t.isDeletedOnly||!1,onChange:this.createUpdateFunction("isDeletedOnly")})}renderMoreFiltersTitle(){return s()(Se.FormattedMessage,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}renderAncestorFilter(e){const{filters:t}=A.ZP.state.query;return s()(ls.Consumer,{},void 0,(r=>{let{parentStore:i}=r;return s()(We,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"}),parentStore:i,blockIds:t.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("ancestors")})}))}renderCreatedByFilter(e){const{filters:t}=A.ZP.state.query;return s()(ls.Consumer,{},void 0,(r=>{let{parentStore:i}=r;return s()(ze.Z,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:i,userIds:t.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdBy")})}))}renderCreatedTimeFilter(e){const{filters:t}=A.ZP.state.query;return s()(ke.Z,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:ue.C,value:t.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdTime")})}renderLastEditedTimeFilter(e){const{filters:t}=A.ZP.state.query;return s()(ke.Z,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:ue.C,value:t.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("lastEditedTime")})}renderInTeamFilter(e){if(!(0,w.bq)())return;const{filters:t}=A.ZP.state.query;return s()(ls.Consumer,{},void 0,(r=>{let{parentStore:i}=r;return s()(Qe,{mode:e,focused:!1,title:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"}),parentStore:i,teamIds:t.inTeams,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("inTeams")})}))}createUpdateFunction(e){return t=>A.ZP.updateFilters({[e]:t})}getThemeColors(){return{sidebar:{backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:`1px solid ${this.theme.regularDividerColor}`}}}}function It(e){let{columnStore:t}=e;window.__c={n:"ExperimentColumnShowHeader"};const r=(0,_.VK)((()=>t.state.visible),[t]);return s()(xe.Z,{icon:s()(Pe.Z,{checked:r,size:14,onClick:()=>t.update((e=>({...e,visible:!e.visible})))}),focused:!1,title:"Show",onClick:()=>t.update((e=>({...e,visible:!e.visible})))})}function Pt(e){let{title:t,searchExperimentOverrides:r}=e;return s()(xe.Z,{focused:!1,title:t,onClick:()=>{Z.BJ.update((e=>({...e,visible:!1}))),Z.v_.update((e=>({...e,searchExperimentOverrides:r})))}})}xt.displayName="SearchFilterMenu";const Tt=xt;var wt=r(28992),kt=r(98519),Ft=r(4023),Rt=r(7931);const Zt=function(e){window.__c={n:"SearchSortMenu"};const t=o.useRef(),r=(0,V.Fy)(),{isMobile:i}=r,{activeOption:n,items:l}=o.useMemo((()=>function(e){const{currentSortBy:t,setSortBy:r,sortOptions:i,selectButton:s}=e;let n=i[0];const l=i.map((e=>{const i=t.field,l=`${i}.${"relevance"===i?"":t.direction}`,a=e.key===l;return a&&(n=e),{key:e.key,action:()=>{r(e.sort),s&&s.current&&s.current.closeMenu()},render:t=>o.createElement(xe.Z,q()({},t,{title:e.formattedName,right:a&&(0,kt.k)({fill:it.ZP.regularIconColor,width:14,height:14})}))}}));return{activeOption:n,items:l}}({...e,selectButton:t})),[e,t]),a=(0,W.yK)((e=>({selectedTitle:{color:e.mediumTextColor},label:{marginRight:2,fontSize:i?ye.Z.fontSize.UISmall.mobile:ye.Z.fontSize.UISmall.desktop,transform:"translateY(0.5px)"},innerButton:{color:e.mediumTextColor,fontWeight:ye.Z.fontWeight.semibold,fontSize:i?ye.Z.fontSize.UISmall.mobile:ye.Z.fontSize.UISmall.desktop,height:20,padding:"2px 4px",marginRight:1,transform:"translateY(0.5px)"},menu:{minWidth:200}})),[i]),d=i?s()(Se.FormattedMessage,{id:"search.sort.sortMenuTitle",defaultMessage:"Sort By"}):void 0;return o.createElement(Rt.Z,{ref:e=>{e&&(t.current=e)},alignmentToOrigin:Ft.v.Start,selectedTitle:s()("div",{style:a.selectedTitle},void 0,n.formattedName),label:void 0,renderMenuSections:()=>[{key:"searchSortOrder",render:e=>o.createElement(et.Z,q()({},e,{title:d,desktopStyle:a.menu,disableDesktopPadding:!1})),items:l}],labelStyle:a.label,innerButtonStyle:a.innerButton})};class Bt extends n.Z{constructor(){super(...arguments),this.styles={menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?ye.Z.fontSize.UISmall.mobile:ye.Z.fontSize.UISmall.desktop,fontWeight:ye.Z.fontWeight.medium,borderRadius:3,height:20,lineHeight:"20px"}}}}renderComponent(){const{device:e}=this.environment,t=this.styles,r={...e.isMobile&&t.menuItemMobile},i=this.shouldAllowFilters()&&this.renderAddFilterButton();return s()(wt.Z,{title:this.renderSortMenu(),right:i,textWrapperStyle:t.titleWrapper,style:r})}renderSortMenu(){return s()(Zt,{currentSortBy:A.ZP.state.query.sort,setSortBy:e=>{A.ZP.setState({...A.ZP.state,query:{...A.ZP.state.query,sort:e}})},sortOptions:Et})}renderAddFilterButton(){const{device:e}=this.environment;if(e.isMobile)return s()(Tt,{isMobile:!0,mode:Mt.Button})}shouldAllowFilters(){const{isPublicPageSearch:e}=this.props;return!e}}Bt.displayName="SearchHeader";const Et=[{key:"relevance.",formattedName:s()(Se.FormattedMessage,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"}),sort:{field:"relevance"}},{key:"lastEdited.desc",formattedName:s()(Se.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"}),sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:s()(Se.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"}),sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:s()(Se.FormattedMessage,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"}),sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:s()(Se.FormattedMessage,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}),sort:{field:"created",direction:"asc"}}],Lt=Bt;var Ot=r(35840),At=r(38755);class Dt extends a.default{getInitialState(){return{open:!1}}}const Nt=new Dt;var qt=r(68785),Vt=r(33411);class _t extends n.Z{constructor(){super(...arguments),this.typingTimer=void 0,this.renderLeft=()=>{const{showSpinner:e,selectedResult:t}=this.props,{device:r}=this.environment,i=this.styles,o={...this.getThemeColors().searchIcon,...i.searchIcon},n=null==t?void 0:t.getIcon(),l=Boolean(A.ZP.state.query.text.trim())&&!r.isMobile;return s()(Vt.Z,{show:e,showDelay:500,showHold:200,render:e=>(e=>s()("div",{style:i.headerIcon},void 0,e?s()(qt.Z,{style:o}):l?s()(Le.Z,{disabled:!0,icon:n,isEmptyPage:Boolean(n),size:20}):(0,Ot.R)(o)))(e)})},this.handleQueryChange=e=>{this.handleTyping();const t=String(e.target.value);this.props.onQueryChange(t)},this.handleClearButtonClick=()=>{A.ZP.resetQuery({resetFilters:!0}),A.ZP.update((e=>({...e,source:"quick_find"})))},this.handleFocus=()=>{const{onFocusChange:e}=this.props;e(!0)},this.handleBlur=()=>{const{onFocusChange:e}=this.props;e(!1)},this.styles={inputDesktop:{fontSize:18,height:_t.DESKTOP_INPUT_HEIGHT,paddingLeft:12,paddingRight:16,alignItems:"center",flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:{width:16,height:16},headerIcon:{height:24,width:24,display:"flex",alignItems:"center",justifyContent:"center"},input:{minWidth:0,...ye.Z.textOverflowStyle},suggestedText:{whiteSpace:"pre",color:this.theme.mediumTextColor},clearButton:{marginLeft:8}}}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){const{device:e}=this.environment,{isOpen:t,selectedResult:r}=this.props,i=this.styles,o=this.getThemeColors(),n=m.Jcv(null==r?void 0:r.getTitleValue()),l=A.ZP.state.query.text,a=void 0!==r&&(null==n?void 0:n.slice(0,l.length).toLocaleLowerCase())===l.toLocaleLowerCase()&&l&&l.length<20&&!e.isMobile,d=!a&&void 0!==r&&l&&l.length<20&&!e.isMobile;let c="";a?c=`${null==n?void 0:n.substring(l.length)} — ${_t.messages.open.defaultMessage}`:d&&(c=n?` — ${_t.messages.open.defaultMessage} ${n}`:` — ${_t.messages.open.defaultMessage}`);const u=""!==c&&s()("div",{},void 0,s()("span",{},void 0,l),s()("span",{style:{background:this.theme.tint.regular}},void 0,c)),h=e.isMobile?bt.Z.Format.ExtraLarge:bt.Z.Format.Transparent,p=e.isMobile?{...i.inputMobile,...o.inputMobile}:{...i.inputDesktop,...o.inputDesktop};return s()(bt.Z,{format:h,placeholder:this.getPlaceholderText(),left:this.renderLeft(),value:l,suggestedText:u,suggestedTextStyle:i.suggestedText,focus:e.isMobile?void 0:t&&!Nt.state.open,focusInitial:!(0,re.Y)("supportsNativeHome")&&e.isMobile,focusAfterAnimation:!0,showClearButton:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:p,inputStyle:i.input})}updateIfIsFirstKeyStroke(){void 0===L.default.state.firstKeyStrokeTimeMs&&L.default.update((e=>({...e,firstKeyStrokeTimeMs:Date.now()})))}handleTyping(){this.updateIfIsFirstKeyStroke();const{onTypingChange:e}=this.props;this.typingTimer&&window.clearTimeout(this.typingTimer),e(!0),this.typingTimer=window.setTimeout((()=>e(!1)),_t.TYPING_DEBOUNCE_MS)}getPlaceholderText(){const{currentSpaceStore:e,mainEditorCurrentBlockStore:t}=k.default.state,r=e&&(0,At.rn)(this.environment,e);if(r)return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedSpace",defaultMessage:"Search {spaceName}…"},{spaceName:r});if(t){const e=m.Jcv(t.getTitleValue()).slice(0,_t.MAX_PLACEHOLDER_TITLE_LENGTH);return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:e})}return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}getThemeColors(){return{inputDesktop:{boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`},inputMobile:{background:this.theme.inputBackground},searchIcon:{fill:this.theme.mediumIconColor}}}}_t.displayName="SearchInputMenuItem",_t.messages=(0,Se.defineMessages)({open:{id:"search.inputMenu.suggestedText.open",defaultMessage:"Open"}}),_t.TYPING_DEBOUNCE_MS=300,_t.DESKTOP_INPUT_HEIGHT=48,_t.MAX_PLACEHOLDER_TITLE_LENGTH=100;const Wt=(0,Se.injectIntl)(_t);var zt=r(11751),Ht=r(69327),Ut=r(29798),Kt=r(88923),jt=r(27724),$t=r(43145),Gt=r(94184),Qt=r.n(Gt),Jt=r(75e3),Xt=r(64369);function Yt(e,t){window.__c={n:"SearchActionMenuItem"};const{inline:r,title:i,focused:s,isBeforeFocused:n,className:l}=e,{icon:a,...d}=e,c=(0,W.yK)((e=>({hoveredStyle:{background:e.buttonHoveredBackground}})),[]),u=(0,W.yK)((e=>({style:{minHeight:36,paddingTop:8,paddingBottom:8,...!r&&!n&&!s&&{boxShadow:`0 1px 0 ${e.lightDividerColor}`}},textWrapper:{marginLeft:4,alignItems:void 0,flex:void 0,width:"100%",display:"block",textOverflow:"ellipsis",...r&&{alignItems:"baseline"}},icon:{display:"block",flexShrink:0,height:18,width:18,color:e.mediumTextColor},enterIcon:{height:14,width:14,fill:e.mediumIconColor},iconContainer:{marginTop:1}})),[s,r,n]),h={title:i,icon:er(a,u.icon,u.iconContainer),style:u.style,textWrapperStyle:u.textWrapper,right:tr(s,u.enterIcon),className:Qt()("notranslate",l),buttonStyle:{paddingLeft:2},hoveredStyle:c.hoveredStyle};return o.createElement(xe.Z,q()({ref:t},d,h,{disableTransition:!0,ignoreLocalHoverState:!0}))}function er(e,t,r){return s()(Xt.Z,{style:r},void 0,e(t))}function tr(e,t){const r={...t,opacity:e?1:0};return s()("div",{style:{display:"flex"}},void 0,(0,Jt.U)(r))}const rr=o.forwardRef(Yt);var ir=r(75024),sr=r(63296);class or extends n.Z{constructor(){super(...arguments),this.openSidebar=()=>A.ZP.setState({...A.ZP.state,isDebugSidebarOpen:!0}),this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?ye.Z.fontSize.UIRegular.mobile:ye.Z.fontSize.UIRegular.desktop}},footerWrapper:{flexShrink:0},footerText:{color:this.theme.lightTextColor,fontSize:ir.yv(this.environment,"UISmall"),...ye.Z.textOverflowStyle},footerDebugButton:{...nr(this.theme),marginRight:6}}}renderComponent(){const e=this.styles;return s()("footer",{style:e.footerWrapper},void 0,s()(we.Z,{topBorder:!0,style:e.footer(),disableDesktopPadding:!0},void 0,o.createElement(wt.Z,q()({},this.props,{style:e.footerText})),(0,fe.x)(b.default)&&!A.ZP.state.isDebugSidebarOpen&&s()(sr.Z,{onClick:this.openSidebar,style:e.footerDebugButton},void 0,"Open Debug Sidebar")))}}or.displayName="SearchFooterContainer";const nr=e=>({fontSize:12,color:e.lightTextColor,marginLeft:6,paddingRight:4,paddingLeft:4,height:24}),lr=or;var ar=r(22109),dr=r(62134);function cr(){window.__c={n:"SearchFooterNavigationHints"};const e=(0,V.O7)(),t=(0,Se.useIntl)(),r=(0,W.yK)((t=>({upDownIcon:{marginRight:4,marginBottom:-2,display:"inline",width:12,height:12,fill:t.mediumIconColor},enterIcon:{marginRight:4,marginBottom:-2,display:"inline",width:11,height:11,fill:t.mediumIconColor},commandGlyph:{fontSize:.75*ir.yv(e,"UIRegular"),paddingRight:1,color:t.lightTextColor},footerText:{fontSize:ir.yv(e,"UISmall"),color:t.lightTextColor,...ye.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16}})),[e]),i={...ir.mK,...r.footerText},{command:o}=dr.fg(e);return s()("ul",{style:i},void 0,s()("li",{style:r.inlineHint},void 0,(0,ar.T)(r.upDownIcon),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})),s()("li",{style:r.inlineHint},void 0,(0,Jt.U)(r.enterIcon),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})),s()("li",{style:r.inlineHint},void 0,s()("span",{style:r.commandGlyph},void 0,o),(0,Jt.U)(r.enterIcon),e.device.isElectron?t.formatMessage({id:"searchFooter.helpText.openNewWindow",defaultMessage:"Open in a new window"}):t.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})))}r(75553),r(32240);var ur=r(94308),hr=r(45168),pr=r(14871),mr=r(97820),gr=r(28020),vr=r(84210),fr=r(98742),yr=r(8323),Sr=r(16402),br=r(77907),Cr=r(24039),Mr=r(90403),xr=r(64133),Ir=(r(73063),r(50506)),Pr=r(86176),Tr=r(26388),wr=r(73299),kr=r(40793),Fr=r(97239),Rr=r(96525);function Zr(e){window.__c={n:"SearchBreadcrumbFilterPopup"};const{parent:t,store:r,onClick:i}=e,n=(0,V.O7)(),{device:l}=n;let a;a=l.isMobile?{menuType:U.og.Modal,title:s()(Se.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:s()(le.DoneMenuText,{}),onClickRight:t.close}:{menuType:U.og.Popup,width:240};const d=(0,o.useCallback)((()=>{null==i||i({store:r,action:"include"})}),[i,r]),c=(0,o.useCallback)((()=>{null==i||i({store:r,action:"exclude"})}),[i,r]),u=r instanceof X.zX?"teamspace":"parent page",h={key:"results",render:e=>o.createElement(we.Z,e),items:[{key:"include-filter",render:e=>o.createElement(xe.Z,q()({},e,{title:`Add ${u} to filter`})),action:d},{key:"exclude-filter",render:e=>o.createElement(xe.Z,q()({},e,{title:`Exclude ${u} from results`})),action:c}]};return o.createElement(ne.Z,a,s()(ot.Z,{type:ot.i.Vertical,onAccept:t.close,initialFocus:void 0,sections:[h]}))}class Br extends n.Z{constructor(){super(...arguments),this.getFilterPopupRenderer=e=>t=>s()(Zr,{parent:t,store:e,onClick:this.props.onClick}),this.getBreadcrumbCommonProps=e=>({maxWidth:this.props.ancestorMaxWidth,popupRenderer:this.getFilterPopupRenderer(e),iconSize:this.props.iconSize,titleStyle:this.getTitleStyle(),iconStyle:Br.iconStyle,highlighter:this.props.highlighter})}renderComponent(){const{store:e}=this.props,t=e.getTitleStore();if(t&&t.isReady())return s()("div",{style:this.getStyle(),className:"notranslate"},void 0,this.renderAncestors())}renderAncestors(){const{store:e,maxAncestorCount:t}=this.props,r=x.uJ(e),i=e.isNavigableBlock()?r.slice(1):[...r];if(i.reverse(),r.reverse(),i.length>t){const[e,s,n]=[i[0],i.slice(1,i.length-t+1),i.slice(i.length-t+1)];if((0,w.bq)()){const t=n.length;return[this.renderButtonForStore({store:e,showDivider:!this.props.isMobile}),this.renderBlocksAsPopup(this.props.isMobile?r:s),...n.map(((e,r)=>{const i=!this.props.hideCurrentPage||r!==t-1;return e instanceof X.zX?o.createElement(Fr.Z,q()({store:e,showDivider:i},this.getBreadcrumbCommonProps(e))):o.createElement(kr.Z,q()({store:e,showDivider:i},this.getBreadcrumbCommonProps(e)))}))]}{const e=i.filter((e=>e instanceof X.G)),r=i.filter((e=>e instanceof X.G)),s=e.length;return[o.createElement(kr.Z,q()({key:e[0].id,store:e[0],showDivider:!this.props.isMobile},this.getBreadcrumbCommonProps(e[0]))),this.renderBlocksAsPopup(this.props.isMobile?r:e.slice(1,e.length-t+1)),...e.slice(e.length-t+1).map(((e,t)=>o.createElement(kr.Z,q()({key:e.id,store:e,showDivider:!this.props.hideCurrentPage||t!==s-1},this.getBreadcrumbCommonProps(e)))))]}}{const e=i.length;return i.map(((t,r)=>this.renderButtonForStore({store:t,showDivider:!this.props.hideCurrentPage||r!==e-1})))}}renderButtonForStore(e){const{store:t,showDivider:r}=e;return t instanceof X.zX?o.createElement(Fr.Z,q()({store:t,showDivider:r},this.getBreadcrumbCommonProps(t))):o.createElement(kr.Z,q()({store:t,showDivider:r},this.getBreadcrumbCommonProps(t)))}getMenuListSections(e){const t=this.props.isMobile?Ie.Z4.SlideUp:Ie.Z4.Popup;return[{key:"results",render:e=>o.createElement(we.Z,e),items:e.map(((e,r)=>({key:e.id,render:i=>o.createElement(Rr.Z,q()({},i,{stopClickPropagation:!0,popupType:t,renderOrigin:t=>o.createElement(Oe.Z,q()({},t,{isSubpage:0!==r,store:e,hidePath:!0,focused:!1})),render:t=>s()(Zr,{parent:t,store:e,onClick:this.props.onClick})})),action:()=>{}})))}]}renderBlocksAsPopup(e){return s()(Ie.ZP,{popupType:this.props.isMobile?Ie.Z4.SlideUp:Ie.Z4.Popup,renderOrigin:e=>{var t;return this.props.isMobile?o.createElement(Me.Z,q()({style:{...Br.dividerWrapStyle},mobileFeedback:!0},e),s()(wr.f,{}),s()("div",{style:Er},void 0,"..."),s()(wr.f,{})):s()("div",{style:Br.dividerWrapStyle},void 0,o.createElement(Te.Z,q()({isSmall:!0},e,{style:{paddingLeft:2,paddingRight:2,fontSize:null===(t=this.props.style)||void 0===t?void 0:t.fontSize}}),"..."),s()(wr.f,{}))},render:t=>{let r;return r=this.props.isMobile?{menuType:U.og.Modal,title:s()(Se.FormattedMessage,{defaultMessage:"Breadcrumb",id:"breadcrumb.mobileBreadcrumbMenu.title"}),right:s()(le.DoneMenuText,{}),onClickRight:t.close}:{menuType:U.og.Popup,width:240},o.createElement(ne.Z,r,s()(ot.Z,{type:ot.i.Vertical,initialFocus:void 0,sections:this.getMenuListSections(e)}))}},"pages-popup")}getStyle(){return{display:"flex",alignItems:"center",lineHeight:1.2,fontSize:this.props.isMobile?ye.Z.fontSize.UIRegular.mobile:ye.Z.fontSize.UIRegular.desktop,color:this.theme.text.tertiary,filter:"grayscale(70%)",...this.props.style}}getTitleStyle(){return{lineHeight:1.2,fontSize:this.props.isMobile?ye.Z.fontSize.UISmall.mobile:ye.Z.fontSize.UISmall.desktop,color:this.theme.text.tertiary}}}Br.displayName="SearchPathBreadcrumb",Br.iconStyle={marginRight:3},Br.dividerWrapStyle={display:"flex",alignItems:"center",flexShrink:0};const Er={marginLeft:3,marginRight:3};(0,Se.defineMessages)({openInSidePeekButtonLabel:{id:"search.result.openInSidePeek.button.label",defaultMessage:"Open search result in side peek"},copySearchResultLinkButtonLabel:{id:"search.result.copyLink.button.label",defaultMessage:"Copy link to search result"}});class Lr extends n.Z{constructor(){super(...arguments),this.storeTypes={explanationModalOpen:a.default.createClass(!1)},this.renderTooltip=()=>s()(Cr.Z,{store:this.props.store}),this.handleSearchPathBreadcrumbClick=e=>{let{store:t,action:r}=e;"block"===t.table?"include"===r?A.ZP.updateFilters({ancestors:u.jj(A.ZP.state.query.filters.ancestors.concat(t.id))}):A.ZP.updateFilters({dev_excludedPages:u.jj((A.ZP.state.query.filters.dev_excludedPages||[]).concat(t.id))}):"team"===t.table&&("include"===r?A.ZP.updateFilters({inTeams:u.jj((A.ZP.state.query.filters.inTeams||[]).concat(t.id))}):A.ZP.updateFilters({dev_excludedTeams:u.jj((A.ZP.state.query.filters.dev_excludedTeams||[]).concat(t.id))}))},this.renderVerifiedBadge=()=>s()(Mr.Z,{style:this.styles.badge,content:s()("div",{style:this.styles.badgeContent},void 0,(0,ur.f)(this.styles.verifiedBadgeIcon),s()("div",{style:this.styles.badgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.verified.badge.text",defaultMessage:"Verified"})))}),this.renderPopularThisWeekBadge=()=>s()(Mr.Z,{style:this.styles.badge,content:s()("div",{style:this.styles.badgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.popularThisWeek.badge.text",defaultMessage:"Popular this week"}))}),this.renderMostViewedBadge=()=>s()(Mr.Z,{style:this.styles.badge,content:s()("div",{style:this.styles.badgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.mostViewed.badge.text",defaultMessage:"Most viewed"}))}),this.renderIsTemplateBadge=()=>s()(Mr.Z,{content:s()("div",{style:this.styles.grayedOutBadgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.template.badge.text",defaultMessage:"Template"}))}),this.getPageVisitSource=()=>"recent_pages"===this.props.type?d.tY.SearchRecents:d.tY.SearchQuery,this.handleOpenInSidePeek=()=>{const{store:e,queryId:t,result:r}=this.props,i=this.getPageVisitSource();r?f.navigateToSearchResult({searchResult:r,openInSidePeek:!0,environment:this.environment,pageVisitSource:i,queryId:t,openInNew:void 0}):f.navigateToPage({store:e,queryId:t,environment:this.environment,pageVisitSource:i,openInSidePeek:!0,peekMode:"s"})},this.handleCopy=()=>{const{store:e,queryId:t}=this.props,r=(0,vr.ZP)({store:e,pageVisitSource:this.getPageVisitSource(),queryId:t});pr.RD({environment:this.environment,stringValue:r,copiedMessage:pr.tq.copiedLinkToClipboard})},this.styles={title:{fontWeight:ye.Z.fontWeight.medium,lineHeight:"20px"},titleContent:{display:"flex",...this.props.inline?{}:{width:0,flexGrow:1}},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},textWrapper:{marginLeft:4,alignItems:"center",width:"100%"},inlineTextWrapper:{alignItems:"center"},highlight:{fontWeight:ye.Z.fontWeight.medium},vectorHighlight:{fontWeight:ye.Z.fontWeight.medium,whiteSpace:"pre-wrap"},rightContentWrapper:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center"},rightIcon:{height:16,width:16},rightIconButtonIcon:{height:12,width:12},rightIconButtonWrapper:{height:18,width:18,marginRight:6},uniqueIDBadgeWrapper:{display:"flex",gap:8,marginRight:8,alignItems:"center"},caption:{marginTop:1},debugArea:{fontFamily:"monospace"},timestamp:{fontSize:ye.Z.fontSize.UISmall.desktop,fontWeight:ye.Z.fontWeight.regular},tooltip:{maxWidth:300},tooltipTitle:{fontWeight:ye.Z.fontWeight.medium,fontSize:ye.Z.fontSize.UISmall.desktop},tooltipText:{fontWeight:ye.Z.fontWeight.medium,fontSize:ye.Z.fontSize.UISmall.desktop,marginLeft:0,paddingRight:20},tooltipValue:{fontSize:ye.Z.fontSize.UISmall.desktop,fontWeight:ye.Z.fontWeight.regular},tooltipMenuItem:{minHeight:20},badge:{background:"light"===this.theme.mode?this.theme.accentColors.blue[30]:this.theme.accentColors.blue[200]},badgeContent:{display:"flex",alignItems:"center",width:"100%"},badgeCaption:{marginLeft:2,color:this.theme.blueColor},grayedOutBadgeCaption:{marginLeft:1},vectorBadge:{background:this.theme.invoiceGreen,color:this.theme.contentBackground},verifiedBadgeIcon:{width:10,height:10,fill:this.theme.blueColor},right:{display:"flex"},collectionTextMatchingProperty:{lineHeight:2}},this.debugHitCustomRenderer=e=>{let{data:t,keyPath:r}=e;if(2===r.length&&"_explanation"===r[0])return{element:o.createElement(o.Fragment,null,s()("button",{onClick:e=>{this.stores.explanationModalOpen.setState(!0),e.stopPropagation()}},void 0,"show simplified explanation")),expanded:!1};const i=t._ltrlog;if(i)return function(e){const t=Object.keys(e[0])[0],r=e[0][t].map(((e,t)=>{const r=t%2==0?Nr:Dr;return s()("tr",{},e.name,s()("td",{style:r},void 0,`${t}`),s()("td",{style:r},void 0,`${e.name}`),s()("td",{style:r},void 0,`${e.value}`))}));return{element:o.createElement(o.Fragment,null,s()("div",{},void 0,s()("b",{},void 0,`Featureset: ${t}`)),s()("div",{style:qr},void 0,s()("table",{style:Vr},void 0,r))),expanded:!1}}(i);if(!["_score","matched_queries"].every((e=>t[e])))return null;const{_score:n,matched_queries:l}=t;return{element:o.createElement(o.Fragment,null,`score ${n}, ${(l??[]).length} matched query clauses`),expanded:!1}}}renderComponent(){const{focused:e,isLastInSection:t,isBeforeFocused:r,inline:i,className:n}=this.props,l=this.styles,a=this.getThemeColors(),d={...l.menuItem,...!i&&!t&&!r&&!e&&a.menuItemBorder},c={...l.caption,...a.caption},u={...l.timestamp,...a.timestamp},h={...l.textWrapper,...this.props.inline&&l.inlineTextWrapper},p={title:this.renderTitle(),icon:this.renderIcon(),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderRight(),rightStyle:e?void 0:u,dontShrinkRight:!0,captionStyle:c,style:d,spacerStyle:this.hasPath()?void 0:_r,textWrapperStyle:h,className:Qt()("notranslate",n),buttonStyle:{paddingLeft:2},hoveredStyle:{background:this.theme.tint.regular}};return(0,yr.Mk)()&&!B.default.state.intentBasedSearch.enablesSidePeekPanel?s()(Tr.Z,{delayThreshold:50,placement:Tr.Z.Placement.Right,originGap:18,renderTooltip:this.renderTooltip,style:l.tooltip,render:e=>o.createElement(xe.Z,q()({},this.props,p,{disableTransition:!0},(0,fr.Z)(this.props,e)))}):o.createElement(xe.Z,q()({},this.props,p,{disableTransition:!0,ignoreLocalHoverState:!0}))}renderTitle(){var e;const{store:t,result:r,placeholder:i,index:o}=this.props,n=this.styles,l=this.getThemeColors(),a=void 0===r,d={...n.title,...!a&&!this.props.focused&&l.nonHighlightedTextColor},c=[];if(r&&r.highlight)if(c.push(...(0,M.fe)(r.highlight.pathText)),this.usesFullPageIndexingHighlight())c.push(...(0,M.fe)(r.highlight.title));else{X.G.createChildStore(this.props.store,{table:j.iU,id:r.id,spaceId:r.spaceId}).isNavigableBlock()&&c.push(...(0,M.fe)(r.highlight.text))}const u=this.props.focused?void 0:this.getWordHighlighter({words:c}),h=null===(e=(0,x.VP)(t))||void 0===e?void 0:e.isArchived(),p=(0,hr.e)(r),m=(0,gr.zj)(),g=m&&m===(null==r?void 0:r.id)&&"on"===R.default.getGroup("search-includes-current-page-in-local-search");const v=(0,yr.Mk)()&&!g&&!h?function(){function e(e){var t;return void 0!==(null==r||null===(t=r.badges)||void 0===t?void 0:t.find((t=>t.type===e)))}return e("is_template")?"is_template":e("verified")?"verified":e("popular_this_week")?"popular_this_week":e("most_viewed")?"most_viewed":void 0}():void 0,f={is_template:this.renderIsTemplateBadge,verified:this.renderVerifiedBadge,popular_this_week:this.renderPopularThisWeekBadge,most_viewed:this.renderMostViewedBadge};return s()("div",{style:{display:"flex",justifyContent:"space-between",...d}},void 0,s()("div",{style:n.titleContent},void 0,Z.ZP.state.showDebugInfo&&void 0!==o&&`${o+1}. `,p&&this.renderUniqueIdHighlight(r),s()(Ae.Z,{style:d,store:t,placeholder:i,highlighter:u}),!1,h&&s()(Mr.Z,{content:s()("div",{style:this.styles.grayedOutBadgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.archived.badge.text",defaultMessage:"Archived"}))}),g&&s()(Mr.Z,{content:s()("div",{style:this.styles.grayedOutBadgeCaption},void 0,s()(Se.FormattedMessage,{id:"search.result.currentPage.badge.text",defaultMessage:"Current page"}))}),v&&f[v]()),Z.ZP.state.showDebugInfo&&this.renderDebugIcons())}renderUniqueIdHighlight(e){var t;const{focused:r}=this.props,i=null==e||null===(t=e.highlight)||void 0===t?void 0:t.uniqueId;if(!i)return;const o="dark"===this.environment.ThemeStore.state.mode,n=this.styles,l=this.getWordHighlighter({words:[i]}),a=r?o?it.FN.dark.translucentGray[300]:it.se.light.darkgray.alpha(.09):o?it.FN.dark.translucentGray[200]:it.se.light.darkgray.alpha(.06);return s()("div",{style:n.uniqueIDBadgeWrapper},void 0,s()("div",{},void 0,s()(xr.Z,{text:i,highlighter:l})),s()("div",{style:{borderRight:`1.5px solid ${a}`,height:14,borderRadius:1}}))}renderRight(){return s()("div",{style:this.styles.right},void 0,this.rightContent())}rightContent(){const{lastViewed:e,focused:t}=this.props;if(this.environment.device.isMobile)return;if(e&&!t)return(0,Sr.IS)(e,{useCompactFormat:!0});const r=this.styles,i=this.getThemeColors(),s={...r.rightIcon,...i.enterIcon,opacity:t?1:0};r.rightIconButtonIcon;return(0,Jt.U)(s)}renderDebugIcons(){var e;const{result:t,index:r,originalPosition:i}=this.props,o=null===(e=(null==t?void 0:t.sources)??[])||void 0===e?void 0:e.flatMap((e=>e===$.vp.Local?["💻"]:e===$.vp.ElasticSearch?["🌐"]:e===$.vp.Postgres?["🐘"]:e===$.vp.VectorDBBlock||e===$.vp.VectorDBCollection?["🔭"]:e===$.vp.ElasticsearchRandom?["🎲"]:e===$.vp.ElasticsearchUniqueID?["🆔"]:e===$.vp.ElasticsearchForcedRecentRecall?["⏰"]:void(0,p.t1)(e))).reverse(),n=[...void 0===r||void 0===i?[" "]:r>i?["⬇️"]:r<i?["⬆️"]:[],...o].join("").trim();return n&&s()("span",{},void 0,n)}renderIcon(){const{store:e}=this.props;return s()(Le.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:20,largeIcon:!1})}renderCaption(){const{store:e,inline:t,result:r,debugLocal:i,debugHits:n}=this.props,{device:l}=this.environment,a=this.getWordHighlighter({words:(0,M.fe)(r&&r.highlight&&r.highlight.pathText),removeDuplicate:!0}),d=t||l.isMobile?0:2,c=(n??[]).find((e=>"elasticsearch"===e.type&&void 0!==e._explanation)),u="elasticsearch"===(null==c?void 0:c.type)?null==c?void 0:c._explanation:void 0;return o.createElement(o.Fragment,null,s()(Pr.Z,{store:e,extraLength:d,showFullPathInTooltip:!0,highlighter:a,enableHoverAncestor:!0,tooltipStyle:this.getThemeColors().captionTooltip,tooltipDividerStyle:this.getThemeColors().captionTooltipDivider}),o.createElement("div",{ref:this.props.debugAreaRef},i&&s()("div",{style:this.styles.debugArea},void 0,s()(br.LazyAdminReactJson,{data:{debugLocal:i},defaultCollapsed:!0,customCollapsedRenderers:[Ar],showCopyButton:!1,showModalButton:!1})),n&&s()("div",{style:this.styles.debugArea},void 0,s()(br.LazyAdminReactJson,{data:{debugHits:n},defaultCollapsed:!0,customCollapsedRenderers:[this.debugHitCustomRenderer],showCopyButton:"small",showModalButton:!0})),n&&(null==r?void 0:r.rankingSignals)&&s()("div",{style:this.styles.debugArea},void 0,s()(br.LazyAdminReactJson,{data:{rankingSignals:r.rankingSignals},defaultCollapsed:!0,showCopyButton:"small",showModalButton:!1})),u&&s()(Ir.Z,{open:this.stores.explanationModalOpen.state,innerStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},onDismiss:()=>{this.stores.explanationModalOpen.setState(!1)},render:()=>s()("pre",{},void 0,function(e){var t;let{explanation:r,simple:i=!1,filterZeros:s=!1}=e;return function e(t,r){if(!t)return[];const{value:o,description:n,details:l}=t;if(0===o&&s)return[];const a=(0===o?"0":o.toFixed(4)).padStart(8);function d(e){return`${"  ".repeat(r+(arguments.length>1&&void 0!==arguments[1]?arguments[1]:0))}${e}`}const c=`[${a}] ${n}`;if(n.startsWith("match on required clause"))return[d(`[${a}] match on required clause ${null==l?void 0:l[1].description}`)];if(["max of:","sum of:","min of:"].includes(n)&&1===(null==l?void 0:l.length))return e(l[0],r);if(n.startsWith("tf")||n.startsWith("idf")){var u;const e=n.split(",")[0],t=null===(u=n.split(" computed as ")[1])||void 0===u?void 0:u.replace(" from:","");return[d(`[${a}] ${e}: [${(l??[]).map((e=>`${e.description.split(",")[0]}=${e.value}`)).join(" ")}] --\x3e ${t}`)]}if(n.startsWith("ConstantScore(_id:"))return[d(`[${a}] ids query`)];const h=i&&0!==r&&(n.startsWith("weight")||n.startsWith("Function"));return[d(c.replace(", result of:","").replace(" from:","").replace(" [PerFieldSimilarity]","").replace(/:$/,"").trim()),...(h?[]:l??[]).flatMap((t=>e(t,r+1)))]}(null==r||null===(t=r.details)||void 0===t?void 0:t[0],0)}({explanation:u}).join("\n"))})))}renderPreview(){var e,t;const{result:r}=this.props;if(!r)return;if(!r.highlight)return;if(X.G.createChildStore(this.props.store,{table:j.iU,id:r.id,spaceId:r.spaceId}).isNavigableBlock()&&!this.usesFullPageIndexingHighlight())return;let i,n;if(r.highlight.text)i=r.highlight.text;else if(r.highlight.collectionText){var l;i=r.highlight.collectionText,n=null==r||null===(l=r.matchedCollectionProperties)||void 0===l?void 0:l.collectionText}if(!i)return;const a=(0,M.ZP)(i);if(this.usesFullPageIndexingHighlight()){const e=e=>e.filter(M.il).map((e=>e[0].toLowerCase())),t=t=>void 0===t?[]:e((0,M.ZP)(t)),i=[...new Set([...t(r.highlight.title),...t(r.highlight.pathText)])],s=e=>i.some((t=>t.includes(e)));if(e(a).every((e=>s(e))))return}const d=this.styles,c=null!==(e=r.sources)&&void 0!==e&&e.includes($.vp.VectorDBBlock)||null!==(t=r.sources)&&void 0!==t&&t.includes($.vp.VectorDBCollection)?d.vectorHighlight:d.highlight,u=this.getThemeColors();return o.createElement(o.Fragment,null,void 0!==n&&s()(mr.Z,{propertySchema:n,showIcon:!0,style:this.styles.collectionTextMatchingProperty}),s()(xr.Z,{text:i,highlighter:{tokenize:e=>(0,M.Vu)(a),style:{...c,...u.highlightedText}}}))}usesFullPageIndexingHighlight(){const{result:e}=this.props;return e&&!e.sources.includes($.vp.Local)}getWordHighlighter(e){const{words:t,removeDuplicate:r}=e;if(0===t.length)return;const i={...this.styles.highlight,...this.getThemeColors().highlightedText},s=r?new Set:void 0;return{tokenize:e=>(0,M.XT)({text:e,patterns:t,uniqueTokenHighlighterContext:s}),style:i}}hasPath(){const{hidePath:e,store:t}=this.props;return!e&&(0,Pr.L)(t)}getThemeColors(){return{nonHighlightedTextColor:{color:this.theme.text.secondary},menuItemBorder:{boxShadow:`0 1px 0 ${this.theme.lightDividerColor}`},highlightedText:{color:this.theme.text.primary},enterIcon:{fill:this.theme.icon.secondary},bookmarkedIcon:{fill:this.theme.topbarFavorite},caption:{color:this.theme.text.secondary},captionTooltip:{color:this.theme.text.contrast},captionTooltipDivider:{color:this.theme.text.contrast},timestamp:{color:this.theme.text.tertiary},tooltipTitle:{color:this.theme.text.secondary},tooltipText:{color:this.theme.text.primary},tooltipValue:{color:this.theme.text.tertiary}}}}Lr.displayName="SearchResultMenuItem",Lr.contextTypes={...U.mw,...n.w};const Or=Lr,Ar=e=>{let{data:t}=e;const r=t;if(!r)return null;const{localSource:i,score:s,frecencyScore:n,personalizationBoost:l}=r;let a=i;return a||(a=new Set("unknown")),{element:o.createElement(o.Fragment,null,`from ${[...a].join(",")} [s ${s} | f ${n} | b ${l}]`),expanded:!1}},Dr={paddingLeft:5,paddingRight:20,paddingTop:2,paddingBottom:2,border:"1px solid black",color:it.FN.dark.green[900]},Nr={...Dr,color:it.FN.dark.gray[30]},qr={maxHeight:200,overflowY:"scroll"},Vr={border:"1px solid black"};const _r={visibility:"hidden"};function Wr(e){switch(e){case"Today":return s()(Se.FormattedMessage,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today"});case"Yesterday":return s()(Se.FormattedMessage,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday"});case"Past Week":return s()(Se.FormattedMessage,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past Week"});case"Past 30 Days":return s()(Se.FormattedMessage,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 Days"});case"Older":return s()(Se.FormattedMessage,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older"})}(0,p.t1)(e)}const zr=function(e){window.__c={n:"SearchDefaultBody"};const{onSelect:t,spaceId:r}=e,[i,n]=o.useState(!1),[l,a]=o.useState(!1),d=(0,_.qz)(void 0,Ut.Z),{section:c,indexLocal:h}=(0,_.VK)((()=>d.state.focus),[d]),p=(0,V.O7)(),m=(0,V.Fy)(),g=(0,W.yK)((e=>({wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},sectionHeader:{fontWeight:ye.Z.fontWeight.semibold,marginBottom:7},section:{marginBottom:18},notionAiLabel:{lineHeight:"20px",fontSize:14,textOverflow:"ellipsis",overflow:"hidden",display:"block",fontWeight:ye.Z.fontWeight.medium},notionAiIcon:{fill:e.aiPurpleColor}})),[]),{defaultBodyFocusedResult:v}=(0,o.useContext)(ns),f=(0,_.VK)((()=>Ee.X4.state),[]),S=(0,_.VK)((()=>{const e=Kt.default.state,t=Kt.default.isMiniOrCenterPeekOpen()||jt.default.isInPeekRenderer();return e.open&&(t||e.isOpening)?e.target:k.default.state.mainEditorCurrentBlockStore}),[]),{isQnAEnabled:b,isQnACornerEnabled:C}=(0,_.VK)((()=>({isQnAEnabled:R.default.checkGate("qna_in_app_enabled_for_spaceid"),isQnACornerEnabled:R.default.checkGate("qna_in_corner")})),[]);(0,o.useEffect)((()=>()=>{v.setState(void 0)}));const M=f.filter((e=>e.pageId!==(null==S?void 0:S.id))),x=(0,_.VK)((()=>{const e={};return M.forEach((t=>{let{pageId:r,visitedAt:i}=t;return e[r]=i})),e}),[M]),I=(0,_.VK)((()=>{const e=new Map;return M.map(((r,i)=>{const s=Ee._5(r.visitedAt),n="Today"!==s&&"Yesterday"!==s,l={result:{key:`${r.store.id}:${i}`,action:e=>t({action:e,sectionName:"recents",selectedResult:{store:r.store,id:r.store.id,score:-1,spaceId:r.store.getSpaceId(),sources:[$.vp.Local],featureGroups:[],originalPosition:i,serverEventProperties:void 0}}),render:e=>o.createElement(Or,q()({},e,{inline:!m.isMobile,store:r.store,hidePath:!1,lastViewed:n?x[r.store.id]:void 0,buttonStyle:{paddingLeft:1},type:"recent_pages"}))},store:r.store};var a;e.has(s)?null===(a=e.get(s))||void 0===a||a.push(l):e.set(s,[l])})),e}),[m.isMobile,M,t,x]),P=(0,_.VK)((()=>{const e=[];b&&e.push({key:"actions",items:[{key:"actionMenuItem.assistant",action:()=>{C?y.em({environment:p}):y.yu({environment:p})},render:e=>o.createElement(rr,q()({},e,{title:s()("div",{className:"notranslate",style:g.notionAiLabel},void 0,"Ask Notion AI"),icon:e=>(0,zt.t)({...e,...g.notionAiIcon})}))}],render:e=>s()(we.Z,{title:"Actions",desktopTitleStyle:g.sectionHeader,disableDesktopPadding:!0,style:g.section},void 0,e.children)});for(const[t,r]of I.entries()){const i=Wr(t),o={key:t,items:r.map((e=>e.result)),render:e=>s()(we.Z,{title:i,desktopTitleStyle:g.sectionHeader,disableDesktopPadding:!0,style:g.section},void 0,e.children)};e.push(o)}return e}),[p,b,C,I,g.notionAiIcon,g.notionAiLabel,g.section,g.sectionHeader]),T=(0,o.useCallback)((e=>{const t=()=>{const e=Ht.Z.getWithoutSubscribing(r),t=e[e.length-1];return null==t?void 0:t.visitedAt},s=u.P2((async()=>{const e=t(),i=p.currentUser.id;if(!i||!e)return;n(!0);const s=await Ee.Od(e,{environment:p,userId:i,spaceId:r});n(!1),s||a(!0)}),300);t()&&e<=200&&!i&&!l&&s()}),[l,i,p,r]);(0,o.useEffect)((()=>{if(void 0!==c&&void 0!==h){var e;const r=null===(e=P[c])||void 0===e?void 0:e.key;if(r&&"string"==typeof r&&"action"!==r&&Ee._k.includes(r)){var t;const e=null===(t=I.get(r))||void 0===t||null===(t=t[h])||void 0===t?void 0:t.store;return void v.setState(e)}}v.setState(void 0)}),[v,c,h,I,P]);const w=!m.isMobile&&M.length>0;return o.createElement(o.Fragment,null,s()("div",{style:g.wrapper},void 0,s()(ot.Z,{store:d,type:ot.i.Vertical,initialFocus:0,disableKeyboardArrowWrap:!0,sections:P,unfocusOnScroll:!0}),s()($t.Z,{onChange:T})),w&&s()(lr,{title:s()(cr,{})}))};const Hr=(0,r(45238).I)("title",{viewBox:"0 0 14 10",svg:s()("path",{d:"M10.674 9.45c.293 0 .576-.052.85-.153.273-.098.515-.238.726-.422.215-.184.383-.4.504-.65h.03v.662a.569.569 0 00.163.416c.11.101.25.152.422.152a.579.579 0 00.428-.164c.11-.105.164-.256.164-.451V4.973c0-.43-.104-.805-.31-1.125-.208-.32-.5-.569-.88-.744-.378-.18-.828-.27-1.347-.27-.594 0-1.114.115-1.559.346-.445.226-.75.533-.914.92-.031.07-.056.14-.076.21a.684.684 0 00-.03.194c0 .148.05.27.147.363.102.09.23.135.387.135a.61.61 0 00.287-.064.555.555 0 00.217-.2c.172-.32.377-.554.615-.703.238-.148.533-.223.885-.223.426 0 .76.112 1.002.334.242.223.363.528.363.915v.486l-1.828.1c-.77.042-1.361.23-1.775.562-.41.328-.616.773-.616 1.336 0 .379.09.71.27.996.183.285.435.508.756.668.324.16.697.24 1.119.24zm.328-.938c-.367 0-.666-.092-.897-.276a.906.906 0 01-.345-.738.86.86 0 01.34-.709c.23-.184.558-.29.984-.322l1.664-.106v.598c0 .293-.078.557-.234.791a1.69 1.69 0 01-.627.557c-.266.136-.56.205-.885.205zM.689 9.414c.2 0 .354-.045.463-.135.114-.086.202-.234.264-.445l.65-1.816h3.346l.65 1.816c.063.21.149.36.258.445.114.09.268.135.463.135.207 0 .371-.057.492-.17a.593.593 0 00.188-.463c0-.129-.027-.27-.082-.422L4.79 1.357c-.09-.246-.22-.43-.393-.55C4.23.686 4.012.625 3.742.625c-.508 0-.847.244-1.02.732L.116 8.39a1.3 1.3 0 00-.076.404c0 .195.057.348.17.457.117.11.277.164.48.164zm1.717-3.486L3.73 2.119h.03l1.324 3.809H2.406z"})});var Ur=r(15157),Kr=r(34859),jr=r(79131),$r=r(53336),Gr=r(76725),Qr=r(19889),Jr=r(7928);function Xr(e){window.__c={n:"SearchFilterBarTitle"};const{filterUIName:t}=e,{parentStore:r}=(0,o.useContext)(ls),i=(0,_.VK)((()=>A.ZP.state.query.filters),[]),n=(0,W.yK)((e=>({title:{maxWidth:220,...ye.Z.textOverflowStyle}})),[]),l=(0,_.VK)((()=>{switch(t){case"personFilter":return function(e,t){const r=e.createdBy,i=Be.default.getIntl(),s=u.oA(r.map((e=>{const r=X.U6.createChildStore(t,{table:Qr.KJ,id:e});return(0,Jr.Nz)(i,r.getModel())})));return(0,Gr.Z)(s,ri)}(i,r);case"teamsFilter":case"dev_notInTeamFilter":return function(e,t){const r=e.inTeams;if(!r)return[];const i=u.oA(r.map((e=>X.zX.createChildStore(t,{table:Ue.e0,id:e}).getName())));return(0,Gr.Z)(i,ri)}(i,r);case"pageFilter":return ii(i,r);case"dateFilter":return function(e){const t=Be.default.getIntl(),r=ei(e);if("createdTime"===r)return P._Q(e.createdTime,t);if("lastEditedTime"===r)return P._Q(e.lastEditedTime,t);return""}(i);case"pageFilter":case"dev_notInPageFilter":return ii(i,r);case"titleToggle":return[];default:(0,p.t1)(t)}}),[r,t,i]);return s()("div",{style:n.title},void 0,s()(Se.FormattedMessage,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:Yr(t),filterOperator:0===l.length?void 0:ti(t,i),filterValues:l,colon:0===l.length?void 0:":"}}))}function Yr(e){switch(e){case"personFilter":return s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by"});case"teamsFilter":return s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace"});case"pageFilter":return s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In"});case"dateFilter":return s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.date",defaultMessage:"Date"});case"titleToggle":return s()(Se.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Title only"});case"dev_notInPageFilter":return s()(Se.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInPageFilter.label",defaultMessage:"[dev] Not in page"});case"dev_notInTeamFilter":return s()(Se.FormattedMessage,{id:"[DO NOT TRANSLATE].search.filterMenu.notInTeamFilter.label",defaultMessage:"[dev] Not in teamspace"})}(0,p.t1)(e)}function ei(e){const t=P.VD.createdTime(e.createdTime),r=P.VD.lastEditedTime(e.lastEditedTime);return t?"createdTime":r?"lastEditedTime":void 0}function ti(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dev_notInPageFilter":case"dev_notInTeamFilter":case"dateFilter":case"titleToggle":return}(0,p.t1)(e)}const ri=e=>", ";function ii(e,t){const r=e.ancestors,i=u.oA(r.map((e=>{const r=X.G.createChildStore(t,{table:j.iU,id:e});return r.isDefined()?r.getModel().getRenderTitle({getRecordModel:r.getRecordModel,userTimeZone:(0,ht.r)(),intl:Be.default.getIntl()}):""})));return(0,Gr.Z)(i,ri)}var si=r(41558),oi=r(3386),ni=r(53437),li=r(45959),ai=r(83264);const di={today:s()(Se.FormattedMessage,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label"}),pastWeek:s()(Se.FormattedMessage,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label"}),pastMonth:s()(Se.FormattedMessage,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label"})};function ci(e){let{date:t,onClick:r,onDismiss:i}=e;const o=(0,ht.r)(),n=ut.Lg(o),l=n;let a;const d=di[t];"today"===t?a=n:"pastWeek"===t?a=ut.Oo(o):"pastMonth"===t?a=ut.dj(o):(0,p.t1)(t);return s()(xe.Z,{focused:!1,icon:(0,ue.C)({height:18,width:18}),title:d,onClick:e=>{r({value:{starting:{type:"date",start_date:a.start_date},ending:{type:"date",start_date:l.start_date}}}),i(e)}})}class ui extends n.Z{constructor(){super(...arguments),this.storeTypes={store:si.Z},this.renderPillButtonOrigin=()=>{const{icon:e,title:t}=this.props,{store:r}=this.stores,i=this.styles,{dateFilterType:o}=r.state,n=A.ZP.state.query.filters[o].starting;return s()(Je.Z,{on:Boolean(n),icon:e(i.pillIcon),title:s()("span",{},void 0,t),onClick:this.handleOriginActivate})},this.renderPopupContents=()=>{const{title:e}=this.props,{store:t}=this.stores;return o.createElement(o.Fragment,null,s()("div",{style:this.styles.dateFilterHeader},void 0,this.renderOperatorSelect(),s()(Me.Z,{style:this.styles.clearButton,onClick:this.handleClear},void 0,s()(Se.FormattedMessage,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label"}))),s()("div",{style:this.styles.quickDatesWrapper},void 0,s()(ci,{date:"today",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),s()(ci,{date:"pastWeek",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),s()(ci,{date:"pastMonth",onClick:this.updateTemporary,onDismiss:this.handleMenuClose})),s()(ai.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose,hideDateInputMenuItems:!0}))},this.handleOriginActivate=()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState({...t.state,isOpen:!0,focus:"starting"})},this.handleMenuClose=e=>{const{onMenuDismiss:t}=this.props,{store:r}=this.stores,{temporaryDateRange:i,dateFilterType:s}=r.state;P.zD(e)||(this.updateFilter(s,i),r.setState({...r.state,isOpen:!1}),t&&t())},this.handleClear=()=>{const{store:e}=this.stores,{dateFilterType:t}=e.state;this.updateFilter(t,{starting:void 0,ending:void 0}),e.clearTemporaryDateRange()},this.handleMenuListKey=e=>{e.preventDefault&&e.preventDefault()},this.updateTemporary=e=>{const{store:t}=this.stores;if(e.error)return;t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}});const{dateFilterType:r,temporaryDateRange:i}=t.state,{starting:s,ending:o}=i;s&&o&&this.updateFilter(r,{starting:s,ending:o})},this.styles={menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},sectionMenuItem:{display:"flex"},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"},quickDatesWrapper:{marginTop:12,boxShadow:`0 1px 0 ${this.theme.regularDividerColor}`,paddingBottom:15,marginBottom:15},clearButton:{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13,paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:3,flexShrink:0},dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginLeft:12,marginRight:12}}}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{store:t}=this.stores,r=this.styles;return s()(et.Z,{style:r.sectionMenuItem},void 0,s()(oi.Z,{capture:t.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},void 0,s()(ni.ZP,{popupType:this.getPopupType(),open:t.state.isOpen,origin:this.renderPillButtonOrigin(),render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:ni.ZP.Placement.Bottom,alignmentToOrigin:ni.ZP.Alignment.Start,keepFocus:!0,style:r.popup})))}updateFilter(e,t){A.ZP.updateFilters({[e]:t})}getHumanReadableDateFilterType(e){return{lastEditedTime:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:s()(Se.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}updateFilterFromToggle(e){const{value:t}=this.props,{store:r}=this.stores,{dateFilterType:i}=r.state;this.updateFilter(e,t),e!==i&&(this.updateFilter(i,{starting:void 0,ending:void 0}),r.setState({...r.state,dateFilterType:e}))}renderOperatorSelect(){const{device:e}=this.environment,{store:t}=this.stores,{dateFilterType:r}=t.state,i={width:190,items:["createdTime","lastEditedTime"],selectedItem:r,getKey:e=>e,onSelect:e=>this.updateFilterFromToggle(e),renderItem:e=>o.createElement(xe.Z,q()({title:this.getHumanReadableDateFilterType(e.value)},e)),renderOrigin:t=>o.createElement(Me.Z,q()({},t,{style:{paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:3,flexShrink:0}}),s()("div",{style:{display:"flex",alignItems:"center",...!e.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13}}},void 0,s()("span",{style:{marginRight:4}},void 0,this.getHumanReadableDateFilterType(r)),this.renderOperatorChevron()))};return o.createElement(li.Z,q()({},i,{mobileActionSheet:!0}))}renderOperatorChevron(){const{device:e}=this.environment;return(0,st.i)({width:10,height:10,...e.isMobile&&{marginTop:2}})}renderMobile(e){const{store:t}=this.stores,r=e===qe.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return s()(ni.ZP,{popupType:ni.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:r,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:r}=this.props,i=this.styles;return s()(xe.Z,{disabled:r,focused:!1,icon:e(i.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:r,disabled:i,intl:o}=this.props,n=this.styles,l=s()("div",{style:n.summary},void 0,(0,ue.C)(n.iconActiveMobile),P._Q(t,o,r));return s()(Ye.Z,{disabled:i,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:l})}getCurrentValue(){const{store:e}=this.stores,{dateFilterType:t,temporaryDateRange:r}=e.state;return{...A.ZP.state.query.filters[t],...r}}getPopupType(){const{device:e}=this.environment;return e.isMobile?ni.ZP.PopupType.SlideUp:ni.ZP.PopupType.Popup}}ui.displayName="SearchGenericDateFilter";const hi=(0,Se.injectIntl)(ui);function pi(e){const t=A.ZP.state.query.sort,r=Et.find((e=>u.Xy(e.sort,t)))??Et[0],i="relevance"===r.sort.field?s()(Se.FormattedMessage,{id:"search.sort.sortOrder.bestMatches.title",defaultMessage:"Sort"}):r.formattedName;return s()(Je.Z,{disabled:!1,title:i,onClick:e.onClick,icon:(0,ar.T)({width:16,marginRight:6,fill:"currentColor"})})}function mi(){const e=A.ZP.state.query.sort,t=Et.findIndex((t=>u.Xy(t.sort,e))),r=[];for(const i of Et)r.push({key:i.key,render:e=>o.createElement(xe.Z,q()({},e,{title:i.formattedName})),action:()=>{A.ZP.setState({...A.ZP.state,query:{...A.ZP.state.query,sort:i.sort}})}});return s()(ne.Z,{menuType:U.og.Popup},void 0,s()(ot.Z,{type:ot.i.Vertical,initialFocus:t<0?0:t,sections:[{key:"sortOptions",items:r,render:e=>o.createElement(we.Z,q()({},e,{disableDesktopPadding:!0}))}]}))}const gi=function(){window.__c={n:"SearchSortButton"};const e=(0,W.yK)((()=>({popup:{paddingTop:12,paddingBottom:8}})),[]);return s()(Ie.ZP,{popupType:Ie.Z4.Popup,renderOrigin:pi,render:mi,disabled:!1,placementToOrigin:ni.ZP.Placement.Bottom,alignmentToOrigin:ni.ZP.Alignment.Start,style:e.popup})},vi="SearchFilterSettings";function fi(e){window.__c={n:"SearchFilterBar"};const t=(0,_.qz)(void 0,be.Z),{isMobile:r}=e,{parentStore:i}=(0,o.useContext)(ls),n=(0,V.O7)(),l=(0,_.VK)((()=>n.currentUser.id),[n]),a=(0,_.VK)((()=>A.ZP),[]),d=(0,_.Kw)(a),c=d.query.filters,u=(0,_.VK)((()=>B.default.state.isPublicPageSearch),[]),h=(0,_.VK)((()=>(0,w.bq)()&&R.default.checkGate("enable_search_team_filter")&&!u),[u]),p=(0,_.VK)((()=>!u),[u]),m=!1,g=(0,W.yK)((e=>({scroller:{display:"flex",alignItems:"center",paddingTop:10,paddingRight:12,paddingBottom:10,paddingLeft:12},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginLeft:6},divider:{height:16,width:1,borderRadius:1,backgroundColor:e.stroke.deemphasized}})),[]),v=(0,o.useCallback)((e=>t=>a.updateFilters({[e]:t})),[a]),f=(0,o.useCallback)((()=>{t.setState({...t.state,open:!1})}),[t]),y=(0,o.useCallback)((()=>{if(p)return s()(ze.Z,{mode:qe.z.Pill,focused:!1,title:s()(Xr,{filterUIName:"personFilter"}),parentStore:i,userIds:c.createdBy,onMenuDismiss:f,onChange:v("createdBy")})}),[p,i,c.createdBy,f,v]),S=(0,o.useCallback)((()=>h&&s()(Qe,{mode:qe.z.Pill,focused:!1,title:s()(Xr,{filterUIName:"teamsFilter"}),parentStore:i,teamIds:c.inTeams,onMenuDismiss:f,onChange:v("inTeams")})),[i,c.inTeams,f,v,h]),b=(0,o.useCallback)((()=>s()(We,{mode:qe.z.Pill,focused:!1,title:s()(Xr,{filterUIName:"pageFilter"}),parentStore:i,blockIds:c.ancestors,onMenuDismiss:f,onChange:v("ancestors")})),[i,c.ancestors,f,v]),C=(0,o.useCallback)((()=>null),[i,c.dev_excludedPages,f,v,m]),M=(0,o.useCallback)((()=>null),[i,c.dev_excludedTeams,f,v,m]),x=(0,o.useCallback)((()=>s()(hi,{mode:qe.z.Pill,focused:!1,title:s()(Xr,{filterUIName:"dateFilter"}),icon:ue.C,value:c.lastEditedTime,onMenuDismiss:f})),[c.lastEditedTime,f]),I=(0,o.useCallback)((()=>!r&&s()(rt,{mode:qe.z.Pill,focused:!1,title:s()(Xr,{filterUIName:"titleToggle"}),icon:Hr,value:c.navigableBlockContentOnly||!1,onChange:v("navigableBlockContentOnly")})),[c.navigableBlockContentOnly,v,r]);(0,o.useEffect)((()=>{const e=Ur.Z.get({userId:l,key:vi});e&&e.filterOrder&&a.updateFilterState(e)}),[l,a]);const P={titleToggle:I(),personFilter:y(),teamsFilter:S(),pageFilter:b(),dateFilter:x(),dev_notInPageFilter:C(),dev_notInTeamFilter:M()};const T=(0,o.useCallback)((()=>o.createElement(o.Fragment,null,s()(gi,{}),s()("div",{style:g.divider}))),[g.divider]);return s()("div",{style:g.barContainer},void 0,s()("div",{style:g.scrollerContainer},void 0,s()($r.Z,{type:Kr.Z.X,style:g.scroller,showLeftRightOverlay:!1},void 0,o.createElement(o.Fragment,null,T()),o.createElement(o.Fragment,null,s()(jr.ZP,{direction:"horizontal",keys:d.filterState.filterOrder,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>P[e],style:g.draggableList,onDrop:e=>function(e){const t={...d.filterState,filterOrder:e};Ur.Z.set({userId:l,key:vi,value:t}),a.updateFilterState(t)}(e)})))))}var yi=r(12921),Si=(r(1800),r(54642),r(47307),r(64964),r(31194),r(1310),r(16354)),bi=r(43765);r(92660);(0,Se.defineMessages)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"Any additional comments or context (e.g. ...)"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for"}});class Ci extends n.Z{constructor(){super(...arguments),this.storeTypes={requestModalOpen:a.default.createClass(!1),responseModalOpen:a.default.createClass(!1)},this.styles={footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?ye.Z.fontSize.UIRegular.mobile:ye.Z.fontSize.UIRegular.desktop}},footerText:{fontSize:ir.yv(this.environment,"UISmall"),...ye.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16},resultCountWrapper:{display:"flex",alignItems:"center",...ye.Z.textOverflowStyle},resultCount:{fontWeight:ye.Z.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*ir.yv(this.environment,"UISmall")},commandGlyph:{fontSize:.75*ir.yv(this.environment,"UIRegular")},footerDebugButton:nr(this.theme),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll",padding:10},navigationHints:{marginLeft:15}}}renderComponent(){const{localResults:e,serverResults:t}=this.props.searchResultStore.state,{shouldShow:r}=this.props;if(!r)return;const i=this.styles,n=this.getThemeColors(),l={...i.resultCount,...n.resultCount},{count:a,isLowerBound:d}=this.props.searchResultStore.getResultCount(),c=s()("span",{style:i.resultText},void 0,d?this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCountApproximate",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:a,resultwrapper:e=>s()("span",{style:l},void 0,e)}):this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCount",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:a,resultwrapper:e=>s()("span",{style:l},void 0,e)})),u=B.default.state.intentBasedSearch.enablesGrouping,h=u?s()(cr,{}):s()("div",{style:i.resultCountWrapper},void 0,u?void 0:s()("div",{},void 0,c,this.renderSpinner(this.props.showSpinner)),s()("div",{style:i.navigationHints},void 0,s()(cr,{})));return s()(lr,{title:h,right:o.createElement(o.Fragment,null,false,this.renderSearchDebugButtons())})}renderSpinner(e){const t=this.styles;return s()(Vt.Z,{show:e,showDelay:500,showHold:200,render:e=>e&&s()(qt.Z,{style:t.spinner})})}renderSearchDebugButtons(){var e;if(!Z.ZP.state.debug&&!Z.ZP.state.showDebugInfo)return;const{rawRequests:t,rawResponses:r}=(null===(e=this.props.searchResultStore.state.serverResults)||void 0===e||null===(e=e.debugInfo)||void 0===e?void 0:e.response)||{};return o.createElement(o.Fragment,null,t&&o.createElement(o.Fragment,null,s()(Ir.Z,{open:this.stores.requestModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.requestModalOpen.setState(!1)},render:()=>s()(br.LazyAdminReactJson,{showCopyButton:"large",defaultCollapsed:!1,data:t})}),s()(sr.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.requestModalOpen.setState(!0)},void 0,"Open Request")),r&&o.createElement(o.Fragment,null,s()(Ir.Z,{open:this.stores.responseModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.responseModalOpen.setState(!1)},render:()=>s()(br.LazyAdminReactJson,{showCopyButton:"large",data:{rawResponses:r},defaultCollapsed:!1})}),s()(sr.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.responseModalOpen.setState(!0)},void 0,"Open Response")))}getThemeColors(){return{footerText:{color:this.theme.lightTextColor},resultCount:{color:this.theme.mediumTextColor},keyboardShortcut:{color:this.theme.mediumTextColor}}}}Ci.displayName="SearchResultsFooter";const Mi=(0,Se.injectIntl)(Ci);var xi=r(73935),Ii=r(11689),Pi=r(43339),Ti=r(39634),wi=r(36507);class ki extends n.Z{constructor(){super(...arguments),this.handleSendMessageClick=()=>{Ti.j({environment:this.environment,from:"quick_find"})},this.styles={menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline"},searchDeletedButton:{display:"inline",lineHeight:"25px"}}}renderComponent(){return o.createElement(wi.Z,q()({},this.getErrorMessage(),{style:this.styles.menuItem,captionStyle:this.styles.caption,shouldWrapCaption:!0}))}renderNoResults(){return{title:ki.noResultsTitle,caption:this.renderNoResultsMessage()}}renderNoResultsMessage(){const e=A.ZP.state.query.filters,t=P.FN(e);if(!P.VD.isDeletedOnly(e.isDeletedOnly)){const e=this.styles,t=this.getThemeColors(),r={...e.searchDeletedButton,...t.searchDeletedButton};return s()(Se.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",values:{searchdeleted:e=>s()(Si.Z,{onClick:this.props.handleSearchDeletedOnly,style:r},void 0,e),br:s()("br",{})}})}return s()(Se.FormattedMessage,t?{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}:{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}renderOffline(){return{title:ki.noResultsTitle,caption:s()(Se.FormattedMessage,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"})}}renderRequestFailed(){const e=this.styles,t=this.getThemeColors(),r={...e.reportProblemButton,...t.reportProblemButton};return{title:s()(Se.FormattedMessage,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:s()(Se.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:e=>s()(Si.Z,{onClick:this.handleSendMessageClick,style:r},void 0,e)}})}}getErrorMessage(){const{error:e}=this.props;switch(e.type){case $.Ix.NoResults.type:return this.renderNoResults();case $.Ix.Offline.type:return this.renderOffline();case $.Ix.RequestFailed.type:return this.renderRequestFailed();default:(0,p.t1)(e)}}getThemeColors(){return{reportProblemButton:{color:this.theme.blueColor},searchDeletedButton:{color:this.theme.blueColor}}}}ki.displayName="SearchErrorMenuItem",ki.contextTypes={...U.mw,...n.w},ki.noResultsTitle=s()(Se.FormattedMessage,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"});const Fi=ki;function Ri(e,t){return s()(we.Z,{disableMobilePadding:!0,disableMobileBorders:!0,topBorder:!1,style:{marginTop:0,paddingTop:0}},void 0,s()(wt.Z,{body:e,bodyStyle:t}))}const Zi=(0,Se.injectIntl)((function(e){var t,r,i,n,l;window.__c={n:"SearchResultsMenuList"};const[a,d]=(0,o.useState)(!1),c=(0,V.Fy)().isMobile,h=(0,W.yK)((e=>({results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:{...c&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace",marginTop:0},actionMenuItemTitle:{fontWeight:ye.Z.fontWeight.medium,lineHeight:"20px",fontSize:15,color:e.mediumTextColor,textOverflow:"ellipsis",overflow:"hidden",display:"block"},menuListContainer:{display:"flex",flexDirection:"column",gap:12,marginTop:c?13:void 0,marginBottom:4}})),[c]),{searchResultStore:m,localResults:g,serverResults:v,resultListStore:f,searchExperimentOverrides:S,intl:b,showActions:C}=e,M=e.errorState,x=(0,_.VK)((()=>A.ZP.state.query.text),[]),I=C.length>0?{key:"actions",render:e=>o.createElement(we.Z,q()({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,title:s()(Se.FormattedMessage,{id:"search.searchActions.actions.text",defaultMessage:"Actions"})})),items:u.oA(C.map((e=>function(e){const{type:t,title:r,icon:i,action:s}=e;return{key:`actionMenuItem.${t}`,action:s,render:e=>o.createElement(rr,q()({},e,{title:r,icon:i}))}}({...e,title:e.renderTitle(x,b,h.actionMenuItemTitle)}))))}:void 0,T=(0,_.VK)((()=>B.default.state.intentBasedSearch.enablesGrouping),[]),w=(0,P.IV)({intentBasedGrouping:T,localResults:g,serverResults:v}),{allSearchResults:k}=w,F=(0,o.useCallback)((t=>{const{results:r,sectionTitle:i,compact:n,rendersTimeSinceLastViewedMs:l}=t,{id:a,title:d}=function(e){if(!e)return{id:"defaultSearchResults",title:void 0};switch(e.type){case"unique-id":return{id:"uniqueIdSearchResults",title:s()(Se.FormattedMessage,{id:"search.searchResultBuckets.uniqueID.text",defaultMessage:"ID matches"})};case"jump-back-in":return{id:"jumpBackInSearchResults",title:s()(Se.FormattedMessage,{id:"search.searchResultBuckets.topResults.text",defaultMessage:"Top results"})};case"server":return{id:"serverOnlySearchResults",title:s()(Se.FormattedMessage,{id:"search.searchResultBuckets.server.text",defaultMessage:"{count}{maybeLowerBoundSign} results",values:{count:e.values.count,maybeLowerBoundSign:e.values.isLowerBound?"+":""}})};case"non-unique-id":return{id:"nonUniqueIdSearchResults",title:s()(Se.FormattedMessage,{id:"search.searchResultBuckets.bestMatches.text",defaultMessage:"Best Matches"})}}(0,p.t1)(e)}(i);return r.length>0?{key:a,render:e=>o.createElement(we.Z,q()({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0,title:d})),items:u.oA(r.map(((t,r)=>{var i;return function(e){var t;const{selectedResult:r,index:i,sectionName:s,allSearchResults:n,props:l,compact:a,timeSinceLastViewedMs:d}=e,{store:c}=r,u=c.isNavigableBlock()?c:c.getNavigableBlockStore();if(!u)return;const h=o.createRef(),p=Boolean(Z.ZP.getDebugLevel()),m=p&&r.sources.includes($.vp.Local)?{score:r.score,frecencyScore:r.frecencyScore,localSource:r.localSource,personalizationBoost:r.personalizationBoost,id:r.id}:void 0,g=p&&(r.sources.includes($.vp.ElasticSearch)||r.sources.includes($.vp.VectorDBBlock)||r.sources.includes($.vp.VectorDBCollection))?null===(t=l.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.resultsDebugMap[c.id]:void 0,v=l.clusterInfo,f=Date.now();return{key:`${c.id}:${i}`,action:e=>{const{event:t}=e;function i(e){const r=xi.findDOMNode(e.current);return Boolean(r&&"target"in t&&t.target&&(r===t.target||r.contains(t.target)))}h.current&&i(h)||l.handleSelectResult({action:e,selectedResult:r,sectionName:s,allSearchResults:n})},render:e=>{var t;return o.createElement(Or,q()({},e,{index:i,originalPosition:r.originalPosition,isFirstInSection:0===i,store:u,hidePath:!1,result:r,className:H.ulv,debugLocal:m,debugHits:g,debugAreaRef:h,clusterInfo:v,inline:a&&!p,inlineCaptionMinWidthPercentage:20,lastViewed:d?f-d:void 0,queryId:null===(t=r.serverEventProperties)||void 0===t?void 0:t["server-queryId"],type:"query_results"}))}}}({selectedResult:t,index:r,sectionName:a,allSearchResults:k,props:e,compact:n,timeSinceLastViewedMs:l&&null!==(i=t.localSource)&&void 0!==i&&i.has("recentVisit")?t.timeSinceLastViewedMs:void 0})})))}:void 0}),[k,e]),R=(0,_.VK)((()=>F({results:"intent-based-grouping"===w.type?w.sections.jumpBackInSearchResults:[],sectionTitle:{type:"jump-back-in"},compact:!0,rendersTimeSinceLastViewedMs:!0})),[F,w.sections,w.type]),E=(0,_.VK)((()=>{const e="intent-based-grouping"===w.type?w.sections.serverOnlySearchResults:[],t=m.getResultCount();return F({results:e,sectionTitle:{type:"server",values:{count:e.length,isLowerBound:t.isLowerBound}},compact:!1})}),[F,w.sections,w.type,m]),L=(0,_.VK)((()=>F({results:"uniqueIdSearchResults"in w.sections?w.sections.uniqueIdSearchResults:[],sectionTitle:{type:"unique-id"},compact:!1})),[F,w.sections]),O=(0,_.VK)((()=>F({results:"unique-id"===w.type?w.sections.nonUniqueIdSearchResults:"default"===w.type?w.sections.defaultSearchResults:[],sectionTitle:"unique-id"===w.type?{type:"non-unique-id"}:void 0,compact:!1})),[F,w.sections,w.type]),D=[I,R,L,E,O].filter(p.$K),N=null===(t=e.debugInfo)||void 0===t||null===(t=t.response)||void 0===t?void 0:t.parsedQueries,z=null===(r=e.debugInfo)||void 0===r||null===(r=r.response)||void 0===r?void 0:r.detectedLanguages,U=null===(i=e.debugInfo)||void 0===i?void 0:i.traceLogs,K=null===(n=e.debugInfo)||void 0===n||null===(n=n.response)||void 0===n?void 0:n.debugUrls,j=(0,o.useCallback)(((t,r)=>{const{onMaybeLoadMoreResults:i}=e,s=t<=200;s&&!a&&i(),d(s),r.offsetFromTop&&A.ZP.update((e=>({...e,hasScrolled:!0})))}),[a,e]),G=O||E?(null==I||null===(l=I.items)||void 0===l?void 0:l.length)??0:0;return s()(ns.Consumer,{},void 0,(e=>{let{queryResultsSectionRef:t}=e;return o.createElement("section",{style:h.results,ref:t},!u.xb(S)&&Ri(o.createElement(o.Fragment,null,s()(br.LazyAdminReactJson,{data:{searchExperimentOverrides:S},showCopyButton:!1,showModalButton:!1,defaultCollapsed:!1})),h.debugMessageMenuItemTextStyle),N&&Ri(s()(br.LazyAdminReactJson,{data:{parsedQueries:N},customCollapsedRenderers:[Oi],showCopyButton:"small",showModalButton:!0,defaultCollapsed:!0}),h.debugMessageMenuItemTextStyle),z&&Ri(s()(br.LazyAdminReactJson,{data:{detectedLanguages:z},customCollapsedRenderers:[Li]}),h.debugMessageMenuItemTextStyle),U&&Ri(s()(br.LazyAdminReactJson,{data:{tracer:{traceLogs:U}},customCollapsedRenderers:[Ei],defaultCollapsed:!0}),h.debugMessageMenuItemTextStyle),K&&Ri(s()(br.LazyAdminReactJson,{data:{debugUrls:K},defaultCollapsed:!0,customCollapsedRenderers:[Di],showCopyButton:"small",showModalButton:!0,maxLinkValueLength:40}),h.debugMessageMenuItemTextStyle),D&&s()("div",{className:"search-results-list"},void 0,s()(ot.Z,{type:ot.i.Vertical,initialFocus:G,store:f,disableKeyboardArrowWrap:!0,sections:D,style:h.menuListContainer})),function(e,t){if(e.isLoading)return;if(e.showMajorError)return s()(Fi,{error:e.serverError,handleSearchDeletedOnly:()=>{const e=A.ZP.state.query.text;y.IB(),Ii.Z.setState({...Ii.Z.state,open:!0}),Pi.Z.setState({...Pi.Z.state,currentTab:"all_pages",filter:e,limit:Pi.Z.startLimit})}});if(e.serverError&&e.serverError!==$.Ix.NoResults)return function(e,t){return s()(we.Z,{disableMobilePadding:!0,disableMobileBorders:!0},void 0,s()(bi.Z,{title:e,style:t}))}(e.serverError.message,t)}(M,h.messageMenuItem)||s()($t.Z,{onChange:j}))}))}));function Bi(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return s()("span",{dangerouslySetInnerHTML:{__html:t}})}const Ei=e=>{let{data:t,keyPath:r}=e;if("traceLogs"===(null==r?void 0:r[0])&&u.PO(t)&&Array.isArray(t.log)&&t.log.length>0){const{log:e,startTimeMs:r}=t;return{element:o.createElement(o.Fragment,null,s()("div",{},void 0,s()("b",{},void 0,`Trace started at ${r}`)),e.map(((e,t)=>s()("div",{},t,s()("span",{style:Ai},void 0,`[${e.timestamp-r}ms][${e.callerFileName.split(".")[0]}]`),s()("span",{},void 0,`${e.msg}`))))),expanded:!1}}return null},Li=e=>{let{data:t,keyPath:r}=e;return"detectedLanguages"===r.join(".")&&u.PO(t)?{element:o.createElement(o.Fragment,null,Object.entries(t).filter((e=>{let[t,r]=e;return Boolean(r)})).map((e=>{let[t]=e;return t})).join(", ")||"None"),expanded:!1}:null},Oi=e=>{var t,r;let{data:i,keyPath:s}=e;const o=i,n=Object.values(o).find((e=>void 0!==e));if(!n)return null;if(!["type","description","time_in_nanos"].every((e=>n[e])))return null;if(1===s.length)return{element:Bi(n.description),expanded:!1};let l=n.description??"";return null!==(t=l)&&void 0!==t&&t.includes("permissions.teamIds")&&(l="PermissionsQuery"),null!==(r=l)&&void 0!==r&&r.includes("(_id:[")&&(l="BoostRecentPageIds"),{element:Bi(l),expanded:!1}},Ai={color:"blue"},Di=e=>{let{data:t}=e;const r=t;if(!r)return null;const i=Object.values(r).find((e=>{let{clusterName:t}=e;return void 0!==t}));if(i){const{clusterName:e}=i;return{element:o.createElement(o.Fragment,null,e),expanded:!1}}return{element:o.createElement(o.Fragment,null,"unknown"),expanded:!1}};const Ni=function(e){window.__c={n:"SearchResultsBody"};const{searchResultStore:t,sxsMode:r,searchDebugColumnStore:i}=e,n=(0,V.O7)(),l=(0,V.Fy)(),a=(0,W.yK)((e=>({container:{display:"flex",flexDirection:"column",width:r?"50%":"100%",flex:1,overflow:"hidden"},askAiLabel:{color:e.regularTextColor,fontWeight:ye.Z.fontWeight.medium,fontSize:14},askAiQuery:{fontWeight:ye.Z.fontWeight.regular},askAiIcon:{fill:e.aiPurpleColor}})),[r]),d=(0,_.qz)(void 0,Ut.Z),c=(0,_.VK)((()=>d.state.focus.indexGlobal),[d]),{handleSelectResult:u,globalFocusedIndex:h}=(0,o.useContext)(ns),{localResults:p,serverResults:m,clusterInfo:g,debugInfo:v,serverResultsLoading:f,searchExperimentOverrides:S,hasPublicAccessPermission:b,errorState:C,serverResultsAllLoaded:M}=(0,_.VK)((()=>{var e,r;const{hasPublicAccessPermission:s}=P.bC(n);return{localResults:t.state.localResults,serverResults:t.state.serverResults,serverResultsLoading:t.state.serverResultsLoading,clusterInfo:null===(e=t.state.serverResults)||void 0===e?void 0:e.clusterInfo,debugInfo:null===(r=t.state.serverResults)||void 0===r?void 0:r.debugInfo,searchExperimentOverrides:i.state.searchExperimentOverrides,hasPublicAccessPermission:s,errorState:t.state.errorState,serverResultsAllLoaded:t.state.serverResultsAllLoaded}}),[t,i,n]),x=!1===C.isLoading&&C.showMajorError,I=Boolean(p||m),T=(0,o.useCallback)((()=>{!f&&!M&&void 0!==m&&A.ZP.update((e=>({...e,limit:e.limit+A.Xv,isScrolled:!0,source:"quick_find_scroll"})))}),[f,M,m]),w=(0,_.VK)((()=>P.oO({localResults:null==p?void 0:p.results,serverResults:null==m?void 0:m.results})),[p,m]),k=(0,_.VK)((()=>[{type:"assistant",renderTitle:(e,t,r)=>function(e,t){return s()("div",{className:"notranslate",style:t},void 0,e)}(o.createElement(o.Fragment,null,s()("span",{},void 0,"Ask Notion AI "),s()("span",{style:a.askAiQuery},void 0,`“${e}”`)),{...r,...a.askAiLabel}),icon:e=>(0,zt.t)({...e,...a.askAiIcon}),action:()=>{(0,yi.hv)()&&(0,yi.lN)()?y.em({environment:n}):y.yu({environment:n})},shouldShow:()=>!!(0,yi.lN)()||!!(0,yi.jp)(n.device)&&(A.ZP.state.query.text.split(" ").length-1>=2&&A.ZP.state.query.text.length>6)}].filter((e=>e.shouldShow(n)))),[n,a],{useDeepEqual:!0});(0,_.VK)((()=>{const e=t.state.insertedActionResultsCount,r=k.length;e!==r&&t.update((e=>({...e,insertedActionResultsCount:r})))}),[k,t]);const F=(0,o.useCallback)((()=>d.update((e=>e.focus.isInitialized&&0===e.focus.section&&0===e.focus.indexLocal&&0===e.focus.indexGlobal?e:{...e,focus:k.length>0?{section:1,indexLocal:0,indexGlobal:k.length}:{section:0,indexLocal:0,indexGlobal:0}}))),[d,k]);return(0,o.useEffect)((()=>{F()}),[w,F]),(0,o.useEffect)((()=>{h.setState(c)}),[h,c]),s()("div",{style:a.container},void 0,s()(Zi,{errorState:C,handleSelectResult:u,onMaybeLoadMoreResults:T,resultListStore:d,searchResultStore:t,localResults:null==p?void 0:p.results,serverResults:null==m?void 0:m.results,debugInfo:v,clusterInfo:g,publicAccessPermission:b,searchExperimentOverrides:S,showActions:k}),s()(Mi,{searchResultStore:t,showSpinner:f,shouldShow:!x&&I&&!l.isMobile}))};function qi(){window.__c={n:"SearchNavigationalView"};const{searchFilterMenuRef:e,handleRecentPageSelect:t,searchResultStore:r,secondarySearchResultStore:i}=(0,o.useContext)(ns),n=(0,V.Fy)(),{errorState:l,shouldShowSxSView:a,hasQuery:d}=(0,_.VK)((()=>({shouldShowSxSView:Boolean((0,Z.gq)({device:n})&&Z.BJ.state.visible),errorState:r.state.errorState,hasQuery:Boolean(A.ZP.state.query.text.trim())||P.VA(A.ZP.state.query.filters)})),[r,n]),c=(0,W.yK)((()=>({container:{display:"flex",flexDirection:"column",width:a?"50%":"100%"},sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[a]),u=!1===l.isLoading&&l.showMajorError,h={searchResultStore:r,searchDebugColumnStore:Z.v_,sxsMode:a},p=(0,_.VK)((()=>{var e;return null===(e=k.default.state.currentSpaceStore)||void 0===e?void 0:e.id}),[]);return o.createElement(o.Fragment,null,!n.isMobile&&s()(fi,{isMobile:n.isMobile}),d?o.createElement(o.Fragment,null,!u&&n.isMobile&&o.createElement(Tt,{isMobile:!0,mode:Mt.Section,ref:e}),s()("div",{style:c.sxsContainer},void 0,o.createElement(Ni,h),a&&o.createElement(Ni,q()({},h,{searchResultStore:i,searchDebugColumnStore:Z.BJ})))):p?s()(zr,{onSelect:t,spaceId:p}):null)}var Vi=r(66897),_i=r(27714),Wi=r(26825),zi=r(74169),Hi=r(90683),Ui=r(37034),Ki=r(10912),ji=r(84076);function $i(e){window.__c={n:"SearchSidePeekPanelMetadataItem"};const{itemName:t,itemValue:r,isFirstInList:i}=e,o=(0,W.yK)((e=>({itemName:{fontSize:14,color:e.mediumTextColor},itemValue:{fontSize:14,maxWidth:"60%"},itemContainer:{height:36,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",borderTop:i?void 0:`1px solid ${e.regularDividerColor}`}})),[i]);return s()("div",{style:o.itemContainer},void 0,s()("div",{style:o.itemName},void 0,t),s()("div",{style:o.itemValue},void 0,r))}const Gi={createdBy:s()(Se.FormattedMessage,{id:"search.preview.metadata.createdBy",defaultMessage:"Created by"}),created:s()(Se.FormattedMessage,{id:"search.preview.metadata.created",defaultMessage:"Created"}),lastEditedBy:s()(Se.FormattedMessage,{id:"search.preview.metadata.lastEditedBy",defaultMessage:"Last edited by"}),lastEdited:s()(Se.FormattedMessage,{id:"search.preview.metadata.lastEdited",defaultMessage:"Last edited"})},Qi={type:"page_content"};function Ji(e){window.__c={n:"SearchSidePeekPanel"};const{selectedResult:t}=e,r=(0,W.yK)((e=>({sidePeekPanel:{flex:"0 0 300px",overflowY:"auto",overflowX:"hidden",minHeight:400,borderLeft:`1px solid ${e.regularDividerColor}`,display:"flex",flexDirection:"column",justifyContent:"space-between"},sidePeekPanelHidden:{display:"none"},emoji:{width:20},pageCover:{position:"absolute",width:"100%",height:49,zIndex:-1},emptyPageCover:{width:"100%",height:"100%",backgroundColor:e.fill.wash},sidePeekContentContainer:{margin:16,width:268},sidePeekActionContainer:{display:"flex",flexDirection:"column"},titleContainer:{marginTop:20,display:"flex",height:73,flexDirection:"column",justifyContent:"space-between"},title:{fontSize:22,fontWeight:ye.Z.fontWeight.bold,textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},previewContainer:{marginTop:15,marginBottom:16,display:"flex",flexDirection:"column",position:"relative"},hoveredOrPressedPreview:{background:"unset",boxShadow:"unset"},preview:{borderRadius:6,border:`1px solid ${e.regularDividerColor}`,padding:"8px 16px",background:"unset",boxShadow:"unset"},previewGradientOverlay:{background:`linear-gradient(to top, ${e.contentBackground} 0px, ${e.contentBackgroundTransparent} 20px)`},metadataContainer:{marginTop:15,display:"flex",flexDirection:"column"},action:{margin:16,border:`1px solid ${e.regularDividerColor}`,borderRadius:4,background:"unset"},metadataActorWrapper:{display:"flex",alignItems:"center"},metadataActorName:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},metadataActorAvatar:{marginRight:5}})),[]),i=(0,_.VK)((()=>({...r.sidePeekPanel,...!A.ZP.isSidePeekPanelOpen()&&r.sidePeekPanelHidden})),[r.sidePeekPanel,r.sidePeekPanelHidden]),n=(0,V.O7)(),l=(0,Se.useIntl)(),a=(0,_.VK)((()=>(0,Ui.V)(t,l,n)),[l,n,t]),c=(0,_.VK)((()=>k.default.state.currentSpaceStore?(0,At.jv)(k.default.state.currentSpaceStore):[]),[]),u=(0,o.useCallback)(((e,t,i)=>{if(void 0===e||void 0===t)return;const o=(0,Vi.Hl)({pointer:{id:e,spaceId:i.id,table:t},getRecordModel:i.getRecordModel}).asActor;return void 0!==o&&(0,Wi.GU)({spacePermissions:c,userId:o.id})?s()("span",{style:r.metadataActorWrapper},void 0,(0,Hi.a)({actor:o,size:18,style:r.metadataActorAvatar}),s()("div",{style:r.metadataActorName},void 0,(0,Vi.$4)(l,o))):void 0}),[l,c,r.metadataActorWrapper,r.metadataActorName,r.metadataActorAvatar]),h=(0,o.useCallback)((e=>(0,Sr.IS)(e,{useCompactFormat:!0,useLowercase:!0})),[]),{createdBy:p,created:m,lastEditedBy:g,lastEdited:v}=(0,_.VK)((()=>{const e=k.default.state.currentSpaceStore;return void 0===e?{createdBy:void 0,created:void 0,lastEditedBy:void 0,lastEdited:void 0}:{createdBy:u(t.getCreatedById(),t.getCreatedByTable(),e),created:h(t.getCreatedTime()),lastEditedBy:u(t.getLastEditedById(),t.getLastEditedByTable(),e),lastEdited:h(t.getLastEditedTime())}}),[h,u,t]),f=[{key:"createdBy",itemName:Gi.createdBy,itemValue:p},{key:"created",itemName:Gi.created,itemValue:m},{key:"lastEditedBy",itemName:Gi.lastEditedBy,itemValue:g},{key:"lastEdited",itemName:Gi.lastEdited,itemValue:v}],{previewIcon:y,isEmptyPage:S,hasCover:b}=(0,_.VK)((()=>({previewIcon:t.getIcon(),isEmptyPage:t.isEmptyPage(),hasCover:void 0!==t.getCover()})),[t]),C=(0,_.VK)((()=>(0,vr.ZP)({store:t,collectionViewId:t.id,fullyQualified:!0,pageVisitSource:d.tY.SearchQuery})),[t]),M=(0,o.useCallback)((()=>{pr.RD({environment:n,stringValue:C,copiedMessage:pr.tq.copiedLinkToClipboard})}),[n,C]);return s()("aside",{style:i},void 0,s()("div",{style:r.pageCover},void 0,b?s()(zi.Z,{store:t,disabled:!0,paddingLeft:0,paddingRight:0,height:49,proxyWidth:320}):s()("div",{style:r.emptyPageCover})),s()("div",{style:r.sidePeekContentContainer},void 0,s()("div",{style:r.titleContainer},void 0,s()(Le.Z,{disabled:!0,icon:y,isEmptyPage:S,size:36,largeIcon:!0}),s()("div",{style:r.title},void 0,a)),s()(ji.Z,{style:r.previewContainer,href:C,hoveredStyle:r.hoveredOrPressedPreview,pressedStyle:r.hoveredOrPressedPreview},void 0,s()(Ki.Z,{variant:"default",contentWrapStyle:r.preview,store:t,coverFormat:Qi,coverSizeFormat:"large",showEmptyGalleryCover:!1,coverContentFadedOverlay:!0,coverContentFadedOverlayStyle:r.previewGradientOverlay,onLoadProxiedImage:()=>{}})),s()("div",{style:r.metadataContainer},void 0,f.filter((e=>void 0!==e.itemValue)).map(((e,t)=>s()($i,{isFirstInList:0===t,itemName:e.itemName,itemValue:e.itemValue},e.key))))),s()("div",{style:r.sidePeekActionContainer},void 0,s()(sr.Z,{icon:_i.N,style:r.action,onClick:M},void 0,s()(Se.FormattedMessage,{defaultMessage:"Copy link",id:"search.preview.actions.copyLink"}))))}const Xi="80vh";function Yi(e){window.__c={n:"SearchContentPane"};const t=(0,V.Fy)();return te(),s()(oe.Z,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!t.isMobile,render:()=>s()(se.Z,{capture:!0,allowMenuList:!0,render:t=>o.createElement(es,q()({},e,{ignoreAreaEvents:t}))})})}function es(e){window.__c={n:"SearchContentPaneInner"};const{ignoreAreaEvents:t,renderAsPage:r,onClose:i}=e,{handleQueryChange:n,searchFilterMenuRef:l,modalBodyMenuRef:a,searchResultStore:d,globalFocusedIndex:c,defaultBodyFocusedResult:h}=(0,o.useContext)(ns),p=(0,W.yK)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},topbar:{height:void 0,marginTop:10,marginLeft:16,marginBottom:10,marginRight:16},topbarRightButtonWrapper:{flex:void 0,paddingLeft:16},topbarButton:{fontWeight:void 0,padding:0,color:e.mediumTextColor},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:r?"100vh":Xi},clearButton:{color:e.lightTextColor},sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[r]),[m,g]=(0,o.useState)(!1),[v,f]=(0,o.useState)(!1),y=(0,V.O7)(),S=(0,V.Fy)(),{isSearchMenuOpen:b,shouldShowSidePeekPanel:C,shouldShowDebugSidebar:M,hasPublicAccessPermission:x,hasQuery:I,shouldShowSpinner:T}=(0,_.VK)((()=>{const e=Boolean(J.Z.state.online),{hasPublicAccessPermission:t}=P.bC(y);return{isSearchMenuOpen:B.default.state.open,shouldShowSpinner:e&&Boolean(A.ZP.state.query.text)&&d.state.serverResultsLoading&&!m,shouldShowSidePeekPanel:ss(S),shouldShowDebugSidebar:os({device:S,isPublicAccessPermissionForPage:t}),hasPublicAccessPermission:t,hasQuery:Boolean(A.ZP.state.query.text.trim())||P.VA(A.ZP.state.query.filters)}}),[m,d,S,y]),w=(0,o.useMemo)((()=>u.Ds((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),500,{leading:!0})),[]),k=(0,o.useCallback)((()=>{v&&w()}),[w,v]),F=(0,o.useCallback)((e=>{f(e),e||S.isMobileNative&&ie.Z.updateKeyboardPhase(y,ie.i.willHide,0)}),[S.isMobileNative,y]),R=(0,_.VK)((()=>P.pG(d,c)),[d,c]),Z=(0,_.VK)((()=>h.state),[h]),E=(0,o.useMemo)((()=>s()(Wt,{isOpen:Boolean(r||b),onTypingChange:g,onFocusChange:F,showSpinner:T,onQueryChange:n,selectedResult:R})),[r,b,F,T,n,R]),L=(0,o.useMemo)((()=>{if(S.isMobile){return{menuType:U.og.Modal,left:E,shouldRenderLeftDirectly:!0,width:r?"100vw":void 0,...rs({isPhone:S.isPhone,renderAsPage:r,style:p.topbarRightButtonWrapper,onClick:i}),header:I&&s()(Lt,{isPublicPageSearch:x}),disableHeaderShadow:!0,topbarStyle:p.topbar,leftRightButtonStyle:p.topbarButton,onScroll:is(S)?k:void 0,bodyScrollerClassName:H.GZn,...t}}const e={menuType:U.og.Popup,maxHeight:r?"100vh":Xi,minHeight:50,disableScroller:!0,scrollerStyle:p.scroller,...t};return r&&S.isDesktop&&(e.maxWidth="100%"),e}),[S,p,t,E,r,i,I,x,k]),O=Z||R;return o.createElement(ne.Z,q()({},L,{className:H.Oau,ref:a}),s()(ts,{enableLazyLoading:r},void 0,s()("div",{style:p.body},void 0,s()(de.Z,{}),!S.isMobile&&E,s()(qi,{})),C&&void 0!==O&&s()(Ji,{selectedResult:O}),M&&o.createElement(Tt,{ref:l})))}function ts(e){window.__c={n:"SearchMenuContentsWrapper"};const{enableLazyLoading:t,children:r}=e,i=(0,V.O7)();return t?s()(ae.Z,{fetch:async()=>{var e;await z.Vs(0),await k.default.waitUntil((()=>void 0!==k.default.state.currentSpaceStore)),null===(e=i.mobileNative)||void 0===e||e.markTransitionReady({type:"search"})},loading:()=>s()(o.Fragment,{}),render:()=>r}):s()(o.Fragment,{},void 0,r)}function rs(e){let{isPhone:t,style:r,renderAsPage:i,onClick:o}=e;return t&&(0,re.Y)("supportsNativeHome")||i?{rightOuterStyle:{display:"none"}}:{right:s()(le.CancelMenuText,{}),onClickRight:o,rightOuterStyle:r}}function is(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function ss(e){if(!e.isMobile)return A.ZP.isSidePeekPanelOpen()}function os(e){let{device:t,isPublicAccessPermissionForPage:r}=e;if(!r&&!t.isMobile)return A.ZP.isDebugSidebarOpen()}const ns=o.createContext(null),ls=o.createContext(null);class as extends n.Z{constructor(){super(...arguments),this.inactiveTimer=void 0,this.spaceId=void 0,this.isOpen=!1,this.shouldClearServerResultsOnQueryChange=!1,this.queryResultsSectionRef=o.createRef(),this.searchFilterMenuRef=o.createRef(),this.modalBodyMenuRef=o.createRef(),this.searchResultStore=new E.ZP,this.secondarySearchResultStore=new E.ZP,this.globalFocusedIndex=a.default.createValue(0),this.defaultBodyFocusedResult=a.default.createValue(void 0),this.getStaticContext=u.HP((()=>({queryResultsSectionRef:this.queryResultsSectionRef,searchFilterMenuRef:this.searchFilterMenuRef,modalBodyMenuRef:this.modalBodyMenuRef,handleSelectResult:this.handleQueryResultSelect,handleRecentPageSelect:this.handleRecentPageSelect,handleQueryChange:this.handleQueryChange,searchResultStore:this.searchResultStore,secondarySearchResultStore:this.secondarySearchResultStore,globalFocusedIndex:this.globalFocusedIndex,defaultBodyFocusedResult:this.defaultBodyFocusedResult}))),this.getStoresContext=u.HP((e=>({parentStore:e}))),this.renderContent=()=>s()(ns.Provider,{value:this.getStaticContext()},void 0,s()(ls.Provider,{value:this.getStoresContext(this.props.parentStore)},void 0,s()(Yi,{renderAsPage:this.props.renderAsPage,onClose:this.handleComponentClose}))),this.handleRecentPageSelect=e=>{this.handleSelectResult({...e,context:"recent_pages"})},this.handleQueryResultSelect=e=>{this.handleSelectResult({...e,context:"query_results"})},this.handleComponentOpenClose=()=>{this.isOpen!==B.default.state.open&&(this.isOpen=B.default.state.open,B.default.state.open&&(clearTimeout(this.inactiveTimer),A.ZP.update((e=>({...e,hasScrolled:!1})))))},this.handleComponentClose=()=>{const{device:e}=this.environment,{selectedQueryResult:t,numKeystrokes:r,numServerRequests:i,numLocalRequests:s,hadMetaClick:o}=L.default.state,{serverEventProperties:n}=this.searchResultStore.state,{query:l,hasScrolled:a}=A.ZP.state;if(r>0&&(i>0||s>0)&&!t&&!o&&(B.default.state.openAsPage||B.default.state.open)){const t=Date.now(),s=B.default.state.openedTimeMs,o=B.default.state.sessionId,l=L.default.state.firstKeyStrokeTimeMs;v.EH8(this.environment,{...n,timeToAbandonMs:t-s,timeFromFirstKeyStrokeToAbandonMs:l?t-l:void 0,numKeystrokes:r,numResultsAboveFold:this.getNumResultsAboveFold(),searchSessionId:o,searchSessionFlowNumber:i,hasScrolled:a,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:(0,T.qX)(),isMobile:e.isMobile})}y.IB(),""===l.text.trim()&&A.ZP.reset();const d=R.default.getEligibleGroup({experimentId:"search-shorten-inactive-timer",defaultGroup:"control"});let u=120*g.C0;"control"!==d&&c.g6["search-shorten-inactive-timer"].includes(d)&&(u=parseInt(d,10)*g.C0),this.inactiveTimer&&clearTimeout(this.inactiveTimer),u>0?this.inactiveTimer=window.setTimeout(this.resetState,u):this.resetState(),!this.props.renderAsPage&&e.isMobile&&S.close(),L.default.reset()},this.handlePotentialWebSearchAbandon=e=>{this.props.renderAsPage&&this.handleComponentClose()},this.handleSelectResult=e=>{var t,r;let{action:i,sectionName:s,context:o,selectedResult:n,allSearchResults:l}=e;const{serverEventProperties:a,store:c}=n,{numKeystrokes:u,hadMetaClick:h}=L.default.state;if(!B.default.state.open&&!B.default.state.openAsPage)return;const{event:m}=i,g=C.DJ(m);"query_results"===o&&(L.default.update((e=>({...e,selectedQueryResult:!0}))),this.searchResultStore.update((e=>({...e,selectedQueryResultQuery:A.ZP.state.query}))));const y=Date.now(),{openedTimeMs:S,sessionId:b}=B.default.state,{firstKeyStrokeTimeMs:M}=L.default.state,{numServerRequests:x}=L.default.state,{query:I}=A.ZP.state,w=(0,T.qX)(),k=(null==l?void 0:l.filter((e=>{var t;return void 0!==(null===(t=e.matchedCollectionProperties)||void 0===t?void 0:t.collectionText)})).length)??0,F=(null==l?void 0:l.filter((e=>{var t;return void 0!==(null===(t=e.highlight)||void 0===t?void 0:t.collectionText)})).length)??0,R=void 0!==(null===(t=n.matchedCollectionProperties)||void 0===t?void 0:t.collectionText),Z=void 0!==(null===(r=n.highlight)||void 0===r?void 0:r.collectionText);v.nLf(this.environment,{...a,context:o,queryStringLength:I.text.trim().length,hasFilters:P.FN(I.filters),activeFilters:I.filters,selectedItemIndex:i.index,selectedItemLocalIndex:{sectionName:s,index:i.indexLocal.indexLocal},numKeystrokes:u,isMetaClick:Boolean(g),isSidebarOpen:A.ZP.isDebugSidebarOpen(),timeToSelectMs:y-S,timeFromFirstKeyStrokeToSelectMs:M?y-M:y-S,sources:null==n?void 0:n.sources,localSources:[...(null==n?void 0:n.localSource)??[]],indexInRecentPages:null==n?void 0:n.indexInRecentPages,timeSinceLastViewedMs:null==n?void 0:n.timeSinceLastViewedMs,hadMetaClick:h,numResultsAboveFold:this.getNumResultsAboveFold(),selectedSearchResultMetadata:this.getSearchResultMetadata(n),selectedSearchResultContent:void 0,allSearchResultMetadata:null==l?void 0:l.slice(0,as.MAX_RESULT_TO_TRACK).map((e=>this.getSearchResultMetadata(e))),totalSearchResultCount:null==l?void 0:l.length,searchSessionId:b,searchSessionFlowNumber:x,originalPosition:null==n?void 0:n.originalPosition,numLocalResults:this.getNumLocalResults(),numTotalLocalResults:this.getNumTotalLocalResults(),numVisibleMembers:w,isMobile:this.environment.device.isMobile,resultWithCollectionPropertyMatchCount:k,resultWithCollectionPropertyHighlightCount:F,isCollectionPropertyMatch:R,isCollectionPropertyHighlight:Z});const E=(null==a?void 0:a["server-queryId"])??function(e){let{searchSessionId:t,searchSessionFlowNumber:r}=e;if((0,p.$K)(t)&&(0,p.$K)(r))return`1:${t}:${r}`}({searchSessionId:b,searchSessionFlowNumber:x});let D;"recent_pages"===o?D=d.tY.SearchRecents:"query_results"===o?D=d.tY.SearchQuery:(0,p.t1)(o);f.navigateToSearchResult({searchResult:n,environment:this.environment,pageVisitSource:D,queryId:E,openInNew:g,openInSidePeek:!1}),O.Z.setState({queryId:E,pageId:c.id,timeEntered:new Date}),g?L.default.update((e=>({...e,hadMetaClick:!0}))):this.handleComponentClose()},this.handleQueryChange=e=>{this.shouldClearServerResultsOnQueryChange&&(this.searchResultStore.update((e=>({...e,serverResults:void 0}))),this.secondarySearchResultStore.update((e=>({...e,serverResults:void 0})))),""!==e?(L.default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),A.ZP.updateQueryText(e)):A.ZP.resetQuery({resetFilters:!1})},this.getNumResultsAboveFold=()=>P.MQ({environment:this.environment,searchResultsSection:this.queryResultsSectionRef.current,modalBodyMenu:this.modalBodyMenuRef.current,searchFilterMenu:this.searchFilterMenuRef.current}),this.getNumLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.results.length)??0},this.getNumTotalLocalResults=()=>{var e;return(null===(e=this.searchResultStore.state.localResults)||void 0===e?void 0:e.total)??0},this.getSearchResultMetadata=e=>{const{store:t,highlight:r,sources:i,localSource:s}=e;return l.Z.withListenerIgnored((()=>{var o,n,l,a,d;return{blockId:t.id,blockType:t.getType(),lowestNavigableAncestorId:null===(o=t.getNavigableBlockStore())||void 0===o?void 0:o.id,depth:x.qA(t).length,matchesText:Boolean(null==r?void 0:r.text),matchesPathText:Boolean((null==r?void 0:r.pathText)||(null==r?void 0:r.title)),matchesTitle:Boolean(null==r?void 0:r.title),isNavigable:t.isNavigableBlock(),lastEditedTime:t.getLastEditedTime(),isTeamArchived:null===(n=(0,x.VP)(t))||void 0===n?void 0:n.isArchived(),sources:i,localSource:[...s??[]],badges:(null===(l=e.badges)||void 0===l?void 0:l.map((e=>e.type)))??[],isCollectionPropertyMatch:void 0!==(null===(a=e.matchedCollectionProperties)||void 0===a?void 0:a.collectionText),isCollectionPropertyHighlight:void 0!==(null===(d=e.highlight)||void 0===d?void 0:d.collectionText),featureGroups:e.featureGroups}}))},this.getPathText=e=>{const t=[];return x.uJ(e).forEach((e=>{if(I.NZ(e)){var r;const i=(0,m.QaF)(null===(r=e.getNavigableBlockStore())||void 0===r?void 0:r.getTitleValue());i&&t.push(i)}else if((0,w.bq)()&&I.Y(e)){const r=e.getName();r&&t.push(r)}})),t},this.handleSpaceChange=()=>{const e=k.default.state.currentSpaceStore&&k.default.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetState())},this.resetState=()=>{A.ZP.reset(),B.default.reset(),this.searchResultStore.reset(),this.secondarySearchResultStore.reset(),L.default.reset()}}willMount(){var e;this.spaceId=null===(e=k.default.state.currentSpaceStore)||void 0===e?void 0:e.id,this.shouldClearServerResultsOnQueryChange="on"===R.default.getGroup("search-clear-results-on-query-change"),(0,Z.lO)()}willMountOrUpdate(e){if(e.renderAsPage&&!B.default.state.sessionId){const e=(0,h.ZP)();B.default.update((t=>({...t,open:!1,openAsPage:!0,openedTimeMs:Date.now(),sessionId:e}))),v.wFN(this.environment,{from:"nativeTab-search-direct-link",searchSessionId:e})}}didMount(){this.props.renderAsPage||B.default.addListener(this.handleComponentOpenClose),k.default.addListener(this.handleSpaceChange),f.potentialWebSearchAbandonEventEmitter.addListener(this.handlePotentialWebSearchAbandon)}willUnmount(){this.resetState(),this.props.renderAsPage||B.default.removeListener(this.handleComponentOpenClose),f.potentialWebSearchAbandonEventEmitter.removeListener(this.handlePotentialWebSearchAbandon),k.default.removeListener(this.handleSpaceChange),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){if(F.Z.state.isGlobalSearchHost)return null;if(this.props.renderAsPage)return this.renderContent();const{device:e,mobileNative:t}=this.environment,r=Boolean(B.default.state.open);return s()(D.Z,{open:r,onDismiss:this.handleComponentClose,modalStyle:this.getModalStyle(),disableAnimation:!e.isMobile||(null==t?void 0:t.supportsNativeHomeOnPhone())||!1,renderContent:this.renderContent})}getPublicAccessPermissionForPage(){return P.bC(this.environment)}getSearchResultContent(e,t){return l.Z.withListenerIgnored((()=>{var r;return{title:(0,m.QaF)(null===(r=e.getNavigableBlockStore())||void 0===r?void 0:r.getTitleValue()),pathText:this.getPathText(e),highlight:{text:(0,M.fe)(null==t?void 0:t.text),pathText:(0,M.fe)(null==t?void 0:t.pathText)}}}))}getModalStyle(){const{renderAsPage:e}=this.props,t=(0,Z.gq)({device:this.environment.device}),r=os({device:this.environment.device,isPublicAccessPermissionForPage:this.getPublicAccessPermissionForPage().hasPublicAccessPermission}),i=ss(this.environment.device);return{width:"75%",minHeight:50,maxHeight:e?"100vh":"80vh",transform:"translate3d(0,0,0)",background:this.theme.popoverBackground,maxWidth:function(){if(t)return"90vw";let e=660;return r&&(e+=250),i&&(e+=300),e}(),borderRadius:12}}}as.displayName="Search",as.MAX_RESULT_TO_TRACK=50;const ds=as},63334:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(49085);class s extends i.default{getInitialState(){return{}}}const o=s},2342:(e,t,r)=>{r.d(t,{Xx:()=>a,ZP:()=>c});var i=r(49085),s=r(92338),o=r(62965),n=r(29026);class l extends i.default{getInitialState(){return{insertedActionResultsCount:0,localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:d,selectedQueryResultQuery:void 0}}setState(e){const t={...this.instanceState};if(!(0,o.Z)(this.instanceState,t))return;const r=function(e){const{newState:t,priorState:r}=e,{localResults:i,serverError:o,serverResultsLoading:n,serverResults:l}=t,a=Boolean(i),d=n?void 0:o;if(!a&&n)return!r.errorState.isLoading&&r.errorState.showMajorError?r.errorState:{isLoading:n};if(a)return{hasLocalResults:a,serverError:d,isLoading:!1,showMajorError:!1};if(d)return{hasLocalResults:a,serverError:d,isLoading:!1,showMajorError:!0};if(0===(null==l?void 0:l.results.length))return{hasLocalResults:a,serverError:s.Ix.NoResults,isLoading:!1,showMajorError:!0};return{hasLocalResults:a,serverError:d,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:r})}getResultCount(){const{serverResults:e,localResults:t}=this.state,r=(null==e?void 0:e.total)??(null==t?void 0:t.total)??0,i=Boolean(e&&r>=100);return{count:r,isLowerBound:Boolean(e&&t&&r<n.Xv)||i}}}function a(e){const t=Boolean(e.localResults),r=Boolean(e.serverResults)&&!e.serverResultsLoading;return t||r||!1}const d={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const c=l},54983:(e,t,r)=>{r.d(t,{Z:()=>o});var i=r(49085);class s extends i.default{getInitialState(){return{}}}const o=s},22109:(e,t,r)=>{r.d(t,{T:()=>o});var i=r(23174),s=r.n(i);r(67294);const o=(0,r(45238).I)("arrowsUpDown",{viewBox:"0 0 16 16",svg:s()("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})},67220:(e,t,r)=>{r.d(t,{S:()=>o});var i=r(23174),s=r.n(i);r(67294);const o=(0,r(45238).I)("bot",{viewBox:"0 0 16 16",svg:s()("path",{d:"M7.996 16C12.381 16 16 12.38 16 8s-3.627-8-8.012-8C3.611 0 0 3.62 0 8s3.62 8 7.996 8zm0-1.594A6.375 6.375 0 011.61 8a6.366 6.366 0 016.38-6.398A6.393 6.393 0 0114.398 8a6.383 6.383 0 01-6.403 6.406zM4.648 8.518c0 .21.17.364.386.364h2.53l-1.346 3.605c-.202.527.355.813.703.395l4.168-5.176a.515.515 0 00.132-.325c0-.209-.17-.356-.379-.356H8.305l1.346-3.613c.201-.518-.356-.812-.704-.395l-4.16 5.184a.484.484 0 00-.14.317z"})})},6637:(e,t,r)=>{r.d(t,{I:()=>o});var i=r(23174),s=r.n(i);r(67294);const o=(0,r(45238).I)("filterCircled",{viewBox:"0 0 16 16",svg:s()("path",{d:"M8 15.126C11.8623 15.126 15.0615 11.9336 15.0615 8.06445C15.0615 4.20215 11.8623 1.00293 7.99316 1.00293C4.13086 1.00293 0.938477 4.20215 0.938477 8.06445C0.938477 11.9336 4.1377 15.126 8 15.126ZM8 13.7383C4.85547 13.7383 2.33301 11.209 2.33301 8.06445C2.33301 4.91992 4.84863 2.39746 7.99316 2.39746C11.1377 2.39746 13.667 4.91992 13.6738 8.06445C13.6738 11.209 11.1445 13.7383 8 13.7383ZM4.41797 6.75879H11.5889C11.9307 6.75879 12.1699 6.54688 12.1699 6.22559C12.1699 5.9043 11.9307 5.68555 11.5889 5.68555H4.41797C4.07617 5.68555 3.84375 5.9043 3.84375 6.22559C3.84375 6.54688 4.07617 6.75879 4.41797 6.75879ZM5.36816 9.02148H10.6455C10.9805 9.02148 11.2197 8.80273 11.2197 8.48145C11.2197 8.16016 10.9805 7.94141 10.6455 7.94141H5.36816C5.02637 7.94141 4.78711 8.16016 4.78711 8.48145C4.78711 8.80273 5.02637 9.02148 5.36816 9.02148ZM6.35254 11.2773H9.6543C9.99609 11.2773 10.2354 11.0654 10.2354 10.7441C10.2354 10.4229 9.99609 10.2041 9.6543 10.2041H6.35254C6.01074 10.2041 5.77148 10.4229 5.77148 10.7441C5.77148 11.0654 6.01074 11.2773 6.35254 11.2773Z"})})},88507:(e,t,r)=>{r.d(t,{I:()=>n});var i=r(23174),s=r.n(i),o=r(67294);const n=(0,r(45238).I)("openTeamSearch",{viewBox:"0 0 16 14",svg:o.createElement(o.Fragment,null,s()("path",{d:"M9.506 13.342h4.447c.348 0 .621-.11.82-.328.2-.22.3-.516.3-.891V4.852c0-.375-.1-.67-.3-.885-.199-.219-.472-.328-.82-.328H9.922v1.136h3.709c.101 0 .178.026.228.077.051.05.076.127.076.228v6.815c0 .101-.025.177-.076.228-.05.05-.127.076-.228.076H9.506v1.143zm2.28-6.358h.925c.129 0 .193-.064.193-.193v-.896c0-.133-.064-.2-.193-.2h-.926c-.125 0-.187.067-.187.2v.896c0 .129.062.193.187.193zm0 2.168h.925c.129 0 .193-.066.193-.199v-.896c0-.133-.064-.2-.193-.2h-.926c-.125 0-.187.067-.187.2v.896c0 .133.062.2.187.2zm0 2.163h.925c.129 0 .193-.067.193-.2v-.896c0-.13-.064-.194-.193-.194h-.926c-.125 0-.187.065-.187.194v.896c0 .133.062.2.187.2zm-10.864.808c0 .375.1.672.299.89.199.22.474.329.826.329H9.44c.348 0 .621-.11.82-.328.204-.22.305-.516.305-.891V1.928c0-.38-.101-.676-.304-.89-.2-.22-.473-.329-.82-.329H2.046c-.352 0-.627.11-.826.328-.2.215-.3.512-.3.89v10.196zm1.142-.228V2.162c0-.105.026-.183.077-.234.05-.051.127-.076.228-.076h6.75c.102 0 .178.025.229.076.05.05.076.129.076.234v9.733c0 .101-.026.177-.076.228-.051.05-.127.076-.229.076H2.37c-.101 0-.178-.025-.228-.076-.051-.05-.077-.127-.077-.228zm1.588.85h.891v-1.946c0-.117.06-.176.182-.176h2.039c.12 0 .181.059.181.176v1.945h.89V10.5c0-.25-.058-.435-.175-.557-.117-.125-.295-.187-.533-.187H4.36c-.238 0-.416.062-.533.187-.117.122-.176.307-.176.557v2.244zm.17-8.362h1.12c.156 0 .234-.078.234-.235v-1.09c0-.156-.078-.234-.235-.234H3.822c-.148 0-.222.078-.222.235v1.09c0 .156.074.234.222.234zm2.719 0h1.12c.152 0 .228-.078.228-.235v-1.09c0-.156-.077-.234-.229-.234H6.541c-.152 0-.229.078-.229.235v1.09c0 .156.077.234.229.234zM3.822 6.627h1.12c.156 0 .234-.078.234-.234V5.309c0-.157-.078-.235-.235-.235H3.822c-.148 0-.222.078-.222.235v1.084c0 .156.074.234.222.234zm2.719 0h1.12c.152 0 .228-.078.228-.234V5.309c0-.157-.077-.235-.229-.235H6.541c-.152 0-.229.078-.229.235v1.084c0 .156.077.234.229.234zm-2.719 2.25h1.12c.156 0 .234-.08.234-.24V7.553c0-.157-.078-.235-.235-.235H3.822c-.148 0-.222.078-.222.235v1.084c0 .16.074.24.222.24zm2.719 0h1.12c.152 0 .228-.08.228-.24V7.553c0-.157-.077-.235-.229-.235H6.541c-.152 0-.229.078-.229.235v1.084c0 .16.077.24.229.24z"}))})},90028:(e,t,r)=>{r.d(t,{j:()=>o});var i=r(23174),s=r.n(i);r(67294);const o=(0,r(45238).I)("searchInPage",{viewBox:"0 0 12 14",svg:s()("path",{d:"M2.877 13.365h6.24c.63 0 1.104-.164 1.424-.492.32-.324.48-.8.48-1.43V6.13c0-.274-.015-.504-.046-.691a1.531 1.531 0 00-.182-.522 2.185 2.185 0 00-.387-.498l-3.07-3.123a2.11 2.11 0 00-.48-.38 1.528 1.528 0 00-.51-.183A3.464 3.464 0 005.7.68H2.877c-.629 0-1.104.164-1.424.492-.32.324-.48.8-.48 1.43v8.841c0 .633.16 1.112.48 1.436.32.324.795.486 1.424.486zm.094-1.154c-.282 0-.492-.072-.633-.217-.14-.144-.211-.351-.211-.621V2.678c0-.27.07-.479.21-.627.142-.149.354-.223.64-.223h2.496V5.04c0 .418.101.73.304.938.207.207.52.31.938.31h3.158v5.086c0 .27-.07.477-.21.621-.142.145-.354.217-.64.217H2.971zm3.855-6.938c-.12 0-.209-.027-.263-.082-.051-.054-.077-.142-.077-.263V1.986l3.229 3.287H6.826z"})})},45168:(e,t,r)=>{r.d(t,{e:()=>s});var i=r(92338);function s(e){if(e)return e.sources.includes(i.vp.ElasticsearchUniqueID)}},68120:(e,t,r)=>{r.d(t,{Qr:()=>h});r(21703);var i=r(97880),s=r(63143),o=r(74487);const n=Symbol("JSON Schema"),l=Symbol("JSON Schema Components"),a=Symbol("No JSON Schema"),d={isNull:()=>({type:"null",[l]:{}}),boolean:()=>({type:"boolean",[l]:{}}),number:()=>({type:"number",[l]:{}}),integer:()=>({type:"integer",[l]:{}}),string:()=>({type:"string",[l]:{}}),dateString:()=>({type:"string",format:"date",[l]:{}}),literal:e=>({enum:[e],[l]:{}}),literals:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return{enum:t,[l]:{}}},uuid:()=>({type:"string",format:"uuid",[l]:{}}),uuidWithoutDashes:()=>({type:"string",format:"uuid",[l]:{}}),any:()=>u,array:e=>({type:"array",items:e[n],[l]:e[n][l]}),tuple:e=>({type:"tuple",items:!1,prefixItems:e.map((e=>e[n])).filter((e=>e!==a)),[l]:Object.assign({},...e.map((e=>e[n][l])))}),record:(e,t)=>({type:"object",additionalProperties:t[n],[l]:t[n][l]}),object:e=>{let{required:t,optional:r,exact:i}=e;return{type:"object",properties:(0,s.m8)(Object.entries({...t,...r}).filter((e=>{let[t,r]=e;return r[n]!==a})).map((e=>{let[t,r]=e;return[t,r[n]]}))),...i&&{additionalProperties:!1},...Object.keys(t).length>0&&{required:Object.keys(t)},[l]:Object.assign({},...Object.values({...t,...r}).map((e=>e[n][l])))}},union:e=>({anyOf:e.map((e=>e[n])).filter((e=>e!==a)),[l]:Object.assign({},...e.map((e=>e[n][l])))}),gte:(e,t)=>{const r=e[n];return r!==a?{...r,minimum:t}:r},lte:(e,t)=>{const r=e[n];return r!==a?{...r,maximum:t}:r},maxLength:(e,t)=>{const r=e[n];if(r===a)return r;if("type"in r){if("string"===r.type)return{...r,maxLength:t};if("array"===r.type)return{...r,maxItems:t}}throw new Error("Unknown type for max length.")},minLength:(e,t)=>{const r=e[n];if(r===a)return r;if("type"in r){if("string"===r.type)return{...r,minLength:t};if("array"===r.type)return{...r,minItems:t}}throw new Error("Unknown type for min length.")},nonEmpty:e=>{const t=e[n];if(t===a)return t;if("type"in t){if("string"===t.type)return{...t,minLength:1};if("object"===t.type)return{...t,minProperties:1};if("array"===t.type)return{...t,minItems:1}}throw new Error("Unknown non-emptyable type.")},nullable:e=>{const t=e[n];if(t===a)return t;if("type"in t)if(Array.isArray(t.type)){if("null"===t.type[1])return t;(0,i.t1)(t.type[1])}else{if("string"===t.type)return{...t,type:[t.type,"null"]};if("object"===t.type)return{...t,type:[t.type,"null"]};if("array"===t.type)return{...t,type:[t.type,"null"]};if("tuple"===t.type)return{...t,type:[t.type,"null"]};if("boolean"===t.type)return{...t,type:[t.type,"null"]};if("integer"===t.type)return{...t,type:[t.type,"null"]};if("number"===t.type)return{...t,type:[t.type,"null"]};if("null"===t.type)return t;(0,i.t1)(t.type)}else{if("const"in t)return{...t,enum:[t.const,null]};if("enum"in t)return{...t,enum:[...t.enum,null]};if("anyOf"in t)return{...t,anyOf:t.anyOf.map((e=>d.nullable({[n]:e})))};if("$ref"in t)return{anyOf:[t,{type:"null"}],[l]:t[l]};if(h(t))return t;(0,i.t1)(t)}}},c=(0,s.m8)(Object.entries(d).map((e=>{let[t,r]=e;return[t,function(){for(var e=arguments.length,s=new Array(e),a=0;a<e;a++)s[a]=arguments[a];return 1===s.length&&(0,i.Kn)(s[0])&&("id"in s[0]||"description"in s[0])?function(){const{description:e,examples:i,id:a}=s[0];let d={description:e,...i&&{examples:i},...r(...arguments)};return a&&(d={$ref:`#/components/schemas/${a}`,[l]:{...d[l],[a]:d}}),{[n]:d,...o[t](...arguments)}}:{[n]:r(...s),...o[t](...s)}}]}))),u=(Symbol("Exact empty object ({})"),c.object({id:"emptyObject"})({required:{},optional:{},exact:!0}),{});function h(e){return(0,i.Kn)(e)&&0===Object.keys(e).length}}}]);