"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[5590],{21269:(e,t,o)=>{o.d(t,{Z:()=>d});var n=o(23174),i=o.n(n),r=(o(67294),o(480)),a=o(84169),l=o(50906),c=o(42917),s=o(16354);const d=function(e){window.__c={n:"CollectionSettingsLearnMoreButton"};const{title:t,href:o,analyticsFrom:n}=e,d=(0,r.O7)();return i()(s.Z,{href:o,onClick:()=>l.Fsx(d,{from:n}),external:!0},void 0,i()(c.Z,{icon:a.m,title:t,isGray:!0}))}},71846:(e,t,o)=>{o.d(t,{S:()=>M,Z:()=>P});var n=o(10434),i=o.n(n),r=o(23174),a=o.n(r),l=(o(57658),o(67294)),c=o(83355),s=o(49085),d=o(56666),u=o(44495),p=o(6287),g=o(5366),m=o(8406),f=o(31299),v=o(33929),y=o(29798),S=o(57559),h=o(73657),_=o(52275),I=o(68894),x=o(32163),C=o(11470),b=o(77137),R=o(72495),k=o(26388),T=o(78948);let M=function(e){return e[e.Source=0]="Source",e[e.Relation=1]="Relation",e[e.Automation=2]="Automation",e}({});const V=(0,g.defineMessages)({linkedInputPlaceholder:{defaultMessage:"Link to a database…",id:"database.viewSettings.searchCollections.linkedInputPlaceholder"},linkedOrSourceInputPlaceholder:{defaultMessage:"Link or create a database…",id:"database.viewSettings.searchCollections.linkedOrSourceInputPlaceholder"},automationInputPlaceholder:{id:"automations.databasePicker.automationInputPlaceholder",defaultMessage:"Select a database…"}});class w extends c.Z{constructor(){super(...arguments),this.storeTypes={inputStore:s.default.createClass(""),limitStore:s.default.createClass(5),menuListStore:y.Z},this.performSearchCollections=async e=>{const{query:t,limit:o}=e,{collectionContextStore:n,parentStore:i,requireEditPermissions:r}=this.props,a=null==n?void 0:n.collectionViewBlockStore(),l=await f.RT({environment:this.environment,collectionViewBlockStore:a,parentStore:i,query:t,limit:o,requireEditPermissions:r});return{results:l.results,showMore:Math.max(0,l.total-l.results.length)}}}renderComponent(){const{collectionContextStore:e,selectedCollectionStore:t,context:o,parentStore:n}=this.props,{device:r}=this.environment,{limitStore:c,inputStore:s,menuListStore:u}=this.stores,m=s.state,y="linked"===(null==e?void 0:e.getCollectionViewBlockSourceState())||o===M.Relation?V.linkedInputPlaceholder:o===M.Source?V.linkedOrSourceInputPlaceholder:V.automationInputPlaceholder;return l.createElement(l.Fragment,null,a()(R.Z,{},void 0,a()(I.ZP,{focusInitial:!r.isMobile||void 0,value:m,onChange:e=>{s.setState(e.target.value),c.setState(e.target.value?20:5),u.setState({focus:{section:0,indexLocal:0,indexGlobal:0}})},placeholder:v.default.formatMessage(y),showClearButton:!0})),a()(b.Z,{request:{query:m,limit:c.state},performRequest:this.performSearchCollections,debounce:f.vp,render:(r,s,m)=>{if(!s)return a()(R.Z,{},void 0,a()(T.Z,{}));const{results:f,showMore:v}=s,y=f.map((r=>{const a=S.NW.createChildStore(n,{table:p.v,id:r});return{key:r,render:n=>{var c;return l.createElement(C.Z,i()({},n,{checkState:t&&t.id===r,store:a,right:o===M.Relation&&(null==e||null===(c=e.collectionStore())||void 0===c?void 0:c.id)===r&&this.renderSelfDatabaseIconTooltip()}))},action:e=>{const{index:t}=e;this.handleAcceptExistingCollection({collectionStore:a,totalResults:f.length,clickedIndex:t})}}}));if(v>0){const e={key:"showMore",render:e=>l.createElement(_.Z,i()({},e,{buttonStyle:{color:this.theme.mediumTextColor,fill:this.theme.mediumIconColor},icon:(0,d.o)({width:16,height:16}),title:a()(g.FormattedMessage,{defaultMessage:"Show {showMore} more",id:"database.viewSettings.searchCollections.showMore.title",values:{showMore:Math.min(v,20)}})})),action:()=>{c.setState(c.state+20)}};y.push(e)}return l.createElement(l.Fragment,null,f.length>0&&a()(x.Z,{type:x.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>l.createElement(R.Z,e),items:y}],store:u}),0===f.length&&a()(h.Z,{caption:a()(g.FormattedMessage,{defaultMessage:"No results",id:"database.viewSettings.searchCollections.noResultsTitle"})}))}}))}renderSelfDatabaseIconTooltip(){return a()(k.Z,{renderTooltip:()=>a()(g.FormattedMessage,{defaultMessage:"This database",id:"database.viewSettigs.searchCollections.thisDatabase.tooltip"}),render:e=>l.createElement("div",e,(0,u.D)({width:14,height:14}))})}handleAcceptExistingCollection(e){const{collectionStore:t,totalResults:o,clickedIndex:n}=e,{collectionContextStore:i,searchSessionId:r,context:a}=this.props,{inputStore:l}=this.stores;i&&m.wd({environment:this.environment,collectionContextStore:i,action:"select_existing_collection"});const{onAccept:c}=this.props;c(t),m.tW({environment:this.environment,eventName:"select_search_item",totalResults:o,clickedIndex:n,sessionId:r,source:a,queryLength:l.state.length})}}w.displayName="CollectionSettingsSearchCollections";const P=(0,g.injectIntl)(w)},40863:(e,t,o)=>{o.d(t,{BO:()=>y,Ft:()=>p,Lh:()=>I,YG:()=>g,du:()=>v,y$:()=>f});o(57658);var n=o(30120),i=o(30823),r=o(40506),a=o(53877),l=o(42875),c=o(72126),s=o(59753),d=o(5366),u=o(28020);function p(e){const{collectionContextStore:t}=e,o=t.collectionViewStore();if(!o)return;const n=t.normalizedSchemaStore.state,i=o.getQuery(n);if(!i||!i.calendar_by)return;const r=t.dateRangeStart.state,c=t.dateRangeEnd.state,s=(0,a.hT)(r,(0,l.r)()),d=(0,a.hT)(c,(0,l.r)());return m({calendarBy:i.calendar_by,dateRangeStartDate:s,dateRangeEndDate:d})}function g(e){const{collectionContextStore:t,startOfDay:o}=e,i=t.collectionViewStore();if(!i)return;const r=t.normalizedSchemaStore.state,c=i.getQuery(r);if(!c||!c.calendar_by)return;const s=n.ou.fromMillis(o).endOf("day").valueOf(),d=(0,a.hT)(o,(0,l.r)()),u=(0,a.hT)(s,(0,l.r)());return m({calendarBy:c.calendar_by,dateRangeStartDate:d,dateRangeEndDate:u})}function m(e){const{dateRangeStartDate:t,dateRangeEndDate:o,calendarBy:n}=e;return{type:"results",filter:{operator:"and",filters:[{property:n,filter:{operator:"date_is_on_or_after",use_end:!0,value:{type:"exact",value:t}}},{property:n,filter:{operator:"date_is_on_or_before",value:{type:"exact",value:o}}}]},limit:5e3}}function f(e){const{collectionContextStore:t,results:o,getRecordValue:n,intl:i}=e,s=t.collectionViewStore(),d=t.normalizedQueryStore.state,p=t.normalizedSchemaStore.state,g=d?d.calendar_by:void 0,m=t.dateRangeStart.state,f=t.dateRangeEnd.state,h=u.AK.state,_=(0,l.r)(),I=t.getCurrentUserId();if(!(s&&d&&g&&p))return;const x=c.oA(o.map((e=>y({blockStore:e,calendarBy:g,schema:p,getRecordValue:n,userId:I,intl:i})))),C={};o.forEach(((e,t)=>{C[e.id]=t}));0===(d.sort||[]).length&&x.sort(((e,t)=>{const o=e.start.valueOf(),n=t.start.valueOf();if(o===n){return C[e.id]-C[t.id]}return o-n}));const b=(0,a.em)(m,h,_),R=(0,a.gQ)(f,h,_);let k=b;const T=[];do{const e=(0,a.gQ)(k.valueOf(),h,_),t={},o=x.filter((t=>(0,r.b8)(k.valueOf(),e.valueOf(),t.start.valueOf(),t.end?t.end.valueOf():void 0))).map((o=>{const{id:n,start:i,end:r,includeTime:a,timeZone:l}=o,{startColumn:c,columnCount:s}=v({startUnixTimestampMS:i.valueOf(),endUnixTimestampMS:r?r.valueOf():void 0,startOfWeekUnixTimestampMS:k.valueOf(),endOfWeekUnixTimestampMS:e.valueOf()}),d=S(c,s,t);return{id:n,start:i.valueOf(),end:r?r.valueOf():void 0,row:d,includeTime:a,timeZone:l}}));T.push({start:k.valueOf(),end:e.valueOf(),items:o}),k=(0,a.em)(k.plus({week:1}).plus({hour:25}).valueOf(),h,_)}while(k<R);return T}function v(e){const t=n.ou.fromMillis(e.startUnixTimestampMS),o=e.endUnixTimestampMS?n.ou.fromMillis(e.endUnixTimestampMS):void 0,i=n.ou.fromMillis(e.startOfWeekUnixTimestampMS),r=n.ou.fromMillis(e.endOfWeekUnixTimestampMS),a=t.startOf("day"),l=n.ou.max(i,a),c=l.diff(i,"days").get("days");let s=1;if(o){const e=o.endOf("day"),t=n.ou.min(r,e);s=Math.ceil(t.diff(l,"days").get("days"))}return{start:t,end:o,startOfWeek:i,endOfWeek:r,startColumn:c,columnCount:s}}function y(e){const{blockStore:t,calendarBy:o,schema:n,getRecordValue:r,intl:c,userId:d}=e,u=t.getModel();if(!u)return;const p=(0,i.FT)({property:o,schema:n,block:u,getRecordModel:s.om.fromGetRecordValueFn(r),propertyMapping:void 0,collectionRequestContext:{userId:d,userTimeZone:(0,l.r)(),depth:0,intl:c,visitedProperties:new Set,resultCache:{}}}).next().value;if("date"!==p.type)return;const g=p.value,m=g&&(0,a.NK)(g,(0,l.r)());if(!g||!m)return;return{id:u.id,start:m.start,end:m.end,includeTime:"datetime"===g.type||"datetimerange"===g.type,timeZone:"datetime"===g.type||"datetimerange"===g.type?g.time_zone:void 0}}function S(e,t,o){let n=0;for(;;){let i=!1;for(let r=0;r<t;r++)h(o,e+r,n)&&(i=!0);if(!i)break;n++}for(let i=0;i<t;i++)_(o,e+i,n);return n}function h(e,t,o){return Boolean(e[o]&&e[o][t])}function _(e,t,o){e[o]||(e[o]={}),e[o][t]=!0}const I=(0,d.defineMessages)({week:{defaultMessage:"Week",id:"calendar.viewRanges.week"},month:{defaultMessage:"Month",id:"calendar.viewRanges.month"}})},11335:(e,t,o)=>{o.d(t,{EE:()=>E,EF:()=>Q,Li:()=>B,Ng:()=>G,P$:()=>J,QZ:()=>L,R4:()=>H,WM:()=>N,Xd:()=>O,cB:()=>z,i1:()=>D,j_:()=>ee,qM:()=>K,qk:()=>F,rU:()=>$,sA:()=>j,tk:()=>X,vM:()=>W,wB:()=>Z});o(21703),o(57658);var n=o(43261),i=o.n(n),r=o(67294),a=o(86628),l=o(3865),c=o(80700),s=o(23290),d=o(76205),u=o(1274),p=o(84116),g=o(78106),m=o(76218),f=o(72126),v=o(26825),y=o(4615),S=o(68626),h=o(98963),_=o(18844),I=o(77420),x=o(6287),C=o(13493),b=o(97880),R=o(77080),k=o(30874),T=o(57559),M=o(82343),V=o(52821),w=o(33929),P=o(8323);function O(e){return e.isTriggerType("event")||e.isTriggerType("notification_event")}function A(e){const{action:t,actionValue:o,automationValue:n}=e;var i,r,a,l,c,s,d;if("create_page"===t.action.type){if(!o||"create_page"===o.type)return function(e){const{actionId:t,automationId:o,collectionPointer:n,properties:i,values:r,spaceId:a,templatePageId:l}=e;return{...Y({actionId:t,actionType:"create_page",automationId:o,spaceId:a}),config:{collection:n,properties:i,values:r,template_page_id:l}}}({actionId:t.action.id,automationId:n.id,collectionPointer:(null===(i=t.action.config)||void 0===i?void 0:i.collection)??(null==o||null===(r=o.config)||void 0===r?void 0:r.collection),properties:(null===(a=t.action.config)||void 0===a?void 0:a.properties)??(null==o||null===(l=o.config)||void 0===l?void 0:l.properties),spaceId:n.space_id,values:(null===(c=t.action.config)||void 0===c?void 0:c.values)??(null==o||null===(s=o.config)||void 0===s?void 0:s.values),templatePageId:null===(d=t.action.config)||void 0===d?void 0:d.template_page_id})}else if("update_pages"===t.action.type){var u,p,g,m,f,v;if(!o||"update_pages"===o.type)return function(e){const{actionId:t,automationId:o,properties:n,spaceId:i,target:r,values:a}=e;return{...Y({actionId:t,actionType:"update_pages",automationId:o,spaceId:i}),config:{target:r,properties:n,values:a}}}({actionId:t.action.id,automationId:n.id,properties:(null===(u=t.action.config)||void 0===u?void 0:u.properties)??(null==o||null===(p=o.config)||void 0===p?void 0:p.properties),spaceId:n.space_id,target:(null===(g=t.action.config)||void 0===g?void 0:g.target)??(null==o||null===(m=o.config)||void 0===m?void 0:m.target),values:(null===(f=t.action.config)||void 0===f?void 0:f.values)??(null==o||null===(v=o.config)||void 0===v?void 0:v.values)})}else if("slack_notification"===t.action.type){var y,S,h,_;if(!o||"slack_notification"===o.type)return function(e){const{actionId:t,automationId:o,externalBotId:n,spaceId:i,target:r}=e;return{...Y({actionId:t,actionType:"slack_notification",automationId:o,spaceId:i}),config:{target:r,external_bot_id:n}}}({actionId:t.action.id,automationId:n.id,externalBotId:(null===(y=t.action.config)||void 0===y?void 0:y.external_bot_id)??(null==o||null===(S=o.config)||void 0===S?void 0:S.external_bot_id),spaceId:n.space_id,target:(null===(h=t.action.config)||void 0===h?void 0:h.target)??(null==o||null===(_=o.config)||void 0===_?void 0:_.target)})}else{if("duplicate_blocks"===t.action.type||"modal_confirmation"===t.action.type||"open_page"===t.action.type||"query_collection"===t.action.type)return;(0,b.t1)(t.action)}}function E(e){const{automationStore:t,currentUserId:o,inMemoryRecordCache:n}=e;return(0,a.VK)((()=>{const e=null==t?void 0:t.getRole(),i=null==t?void 0:t.getValue(),r=(null==t?void 0:t.getActionStores().map((e=>e.getValue())).filter(b.$K))??[],a=null==t?void 0:t.pointer;return s=>{if(o&&e&&i&&a){if(!(0,l.Vd)(i)&&!(0,l.nl)(i))return i;if("update_name"===s.type){const t=function(e){var t;const{action:o,automationValue:n}=e;return(null===(t=n.properties)||void 0===t?void 0:t.name)!==o.name?{...n,properties:{...n.properties,name:o.name}}:n}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_source"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.pointer,i=n.table===x.v?{pointer:n,type:x.v}:{pointer:n,type:C.n};return{...o,trigger:{...o.trigger,event:{...o.trigger.event,source:i}}}}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_trigger"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?o:{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!0}}};if("any_page_property_edited"===n.type)return"any"!==o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"any"}}}}:o;if("property_changed"===n.type){const e="some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[],t=f.cx(e,(e=>e.property===n.property)),i={filter:n.filter,property:n.property},r=-1===t?[...e,i]:e.map((e=>e.property===n.property?i:e));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{some:r,type:"some"}}}}}(0,b.t1)(n)}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else if("update_action"===s.type){var d;const t=r.find((e=>e.id===s.action.id)),l=A({action:s,actionValue:t,automationValue:i});if(!l)return;if(n.setRecord({pointer:{id:l.id,spaceId:i.space_id,table:_.Xj},userId:o},{role:"editor",value:l}),null===(d=i.action_ids)||void 0===d||!d.includes(l.id)){const t={...i,action_ids:[...i.action_ids??[],l.id]};n.setRecord({pointer:a,userId:o},{role:e,value:t})}n.emitAll()}else if("remove_action"===s.type){const r=s.action.id;n.deleteRecord({pointer:{id:r,spaceId:i.space_id,table:_.Xj},userId:o});const l={...i,action_ids:(i.action_ids??[]).filter((e=>e!==r))};n.setRecord({pointer:a,userId:o},{role:e,value:l}),function(e){const{automationStore:t,newAutomationValue:o,currentUserId:n,inMemoryRecordCache:i}=e,r=t.getParentStore();if((null==r?void 0:r.table)!==x.v)return;const a={automationStore:t,parentPointer:r.getSpaceShardedPointer(),type:"event",persisted:!0,intl:w.default.getIntl(),parentRecordStore:r},l=(0,M.pt)({context:a,automationValue:o});if(S.x.isFail(l))return;const s=(o.action_ids??[]).map((e=>({pointer:{id:e,spaceId:o.space_id,table:_.Xj},userId:n})));for(const u of s){const e=i.getRecordModel(u),t=i.getRecord(u);if(!e||!t||!t.value||"create_page"!==t.value.type&&"update_pages"!==t.value.type)continue;const o=new Set(l.value.actionInputValueTypes[e.id].map((e=>{if(e.kind===p.yp.ContextValue)return e.id;e.kind!==p.yp.ThisRow&&e.kind!==p.yp.Binding&&(0,b.t1)(e)})).filter(b.$K)),n=(0,c.z)(e.type).acceptFormulaVisitor({action:e,visitor:{visitVariableOutsideOfFormula:e=>o.has(e)?{type:"keep"}:{type:"replace",value:void 0},visitFormula:e=>e.value&&(0,m.UB)(e).some((e=>!o.has(e)))?{type:"replace",value:void 0}:{type:"keep"}}});let r=t.value;for(const i of n)if("update"===i.command)if(1===i.path.length&&"config"===i.path[0]&&Object.keys(i.args).includes("target")&&"update_pages"===r.type)r={...r,config:{target:void 0,properties:[],values:{}}};else if(2===i.path.length&&"config"===i.path[0]&&"values"===i.path[1]){var d;const e=Object.keys(i.args)[0];r={...r,config:{...r.config,values:{...null===(d=r.config)||void 0===d?void 0:d.values,[e]:void 0}}}}i.setRecord(u,{value:r,role:t.role})}}({automationStore:t,newAutomationValue:l,currentUserId:o,inMemoryRecordCache:n}),n.emitAll()}else if("remove_trigger"===s.type){const t=function(e){const{action:t,automationValue:o}=e,n=t.trigger;if("page_added"===n.type)return o.trigger.event.pagesAdded?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagesAdded:!1}}}:o;if("any_page_property_edited"===n.type)return"any"===o.trigger.event.pagePropertiesEdited.type?{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:{type:"none"}}}}:o;if("property_changed"===n.type){const e=("some"===o.trigger.event.pagePropertiesEdited.type?o.trigger.event.pagePropertiesEdited.some:[]).filter((e=>e.property!==n.property));return{...o,trigger:{...o.trigger,event:{...o.trigger.event,pagePropertiesEdited:e.length>0?{some:e,type:"some"}:{type:"none"}}}}}(0,b.t1)(n)}({action:s,automationValue:i});i!==t&&(n.setRecord({pointer:a,userId:o},{role:e,value:t}),n.emitAll())}else(0,b.t1)(s)}}}),[t,o,n])}function F(e){const{automationContextStore:t,automationStore:o,collectionStore:n}=e,i=n.getSchema(),r=o.getKeyStore("properties").getKeyStore("name").getValue();if(null==r||!r.trim())return!1;const a=o.getTrigger(),l="event"===(null==a?void 0:a.type),c="notification_event"===(null==a?void 0:a.type);if(!l&&!c)return!1;const{pagesAdded:s,pagePropertiesEdited:d}=a.event;if("some"===d.type&&d.some.some((e=>q({collectionSchema:i,property:e.property})||U({collectionSchema:i,property:e.property,type:"trigger"}))))return!1;if(!s&&("none"===d.type||"some"===d.type&&0===d.some.length))return!1;const u=o.getActionStores().filter((e=>e.isDefined()));return 0!==u.length&&u.every((e=>function(e){const{actionStore:t,automationContextStore:o,collectionStore:n}=e;if(t.isType("slack_notification"))return(0,b.$K)(t.getConfigStore().getKeyStore("external_bot_id").getValue())&&(0,b.$K)(t.getConfigStore().getKeyStore("target").getValue());if(t.isType("update_pages")){const e=t.getConfigStore().getKeyStore("target").getValue(),i=t.getConfigStore().getKeyStore("properties").getValue()??[];if(!(0,b.$K)(e)||0===i.length)return!1;if("collection"===e.type){const t=T.NW.createChildStore(n,e.collection).getSchema();if(i.some((e=>q({property:e,collectionSchema:t})||U({collectionSchema:t,property:e,type:"action"}))))return!1}else if("variable"===e.type){const t=(0,g.MY)(e.id);if("global"===t.source&&"button_page"===t.global){const e=n.getSchema();if(i.some((t=>q({property:t,collectionSchema:e})||U({collectionSchema:e,property:t,type:"action"}))))return!1}else{const t=null==o?void 0:o.compilationResultStore.state;if(!t||S.x.isFail(t))return!1;const n=(0,g.vx)(t.value.valueTypes,e.id),r=n?Z(n,o.context.parentRecordStore):void 0;if(!r)return!1;const a=r.getSchema();if(i.some((e=>q({property:e,collectionSchema:a})||U({collectionSchema:a,property:e,type:"action"}))))return!1}}else{if("page"===e.type)return!1;(0,b.t1)(e)}return!0}if(t.isType("create_page")){const e=t.getConfigStore().getKeyStore("collection").getValue();if(!(0,b.$K)(e))return!1;const o=T.NW.createChildStore(n,e).getSchema();return!(t.getConfigStore().getKeyStore("properties").getValue()??[]).some((e=>q({property:e,collectionSchema:o})||U({collectionSchema:o,property:e,type:"action"})))}throw new Error(`isActionStoreComplete not implemented for ${t.getType()}`)}({actionStore:e,automationContextStore:t,collectionStore:n})))}function Z(e,t){let o;return"block"===e.type.type&&e.type.collection?o=T.NW.createChildStore(t,e.type.collection):"array"===e.type.type&&"block"===e.type.of.type&&e.type.of.collection&&(o=T.NW.createChildStore(t,e.type.of.collection)),o}function B(e){const{collectionStore:t}=e;if(!t)return!1;if((t.getFormat().automation_ids??[]).length>=s.ss&&!(0,P.sX)())return!1;const o=t.pointer,n=t.getSpaceId();return(0,u.IC)({targetTriggerType:"event",targetParentPointer:o,targetSpaceId:n}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function D(e){const{automationStore:t,actionStores:o}=e,n=t.getMinimumFieldsForPermissions();if(!n)return!1;if(!o.every((e=>e.isDefined())))return!1;const i=o.some((e=>!e.isType("slack_notification")));if(!(0,P.sX)()&&i)return!1;return(0,u.fz)({automationValue:n,actionValues:o.map((e=>({config:e.getConfig(),type:e.getType()})))}).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function K(e){const{automationStore:t}=e,o=t.getMinimumFieldsForPermissions();if(!o)return!1;return(0,u.bM)(o).every((e=>{let{pointer:o,minimumRequiredRole:n}=e;const i=t.getRecordRole(o);return!!i&&(0,v.yY)(i,n)}))}function N(e){const{anyOptionCheckState:t,currentFilter:o,propertyId:n,updateCurrentState:i}=e;!0===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):!1===t?i({type:"remove_trigger",trigger:{type:"property_changed",property:n,filter:{operator:"changes_to_any"}}}):"partial"===t?i({type:"update_trigger",trigger:{type:"property_changed",property:n,filter:o}}):(0,b.t1)(t)}function q(e){const{property:t,collectionSchema:o}=e;return!!o&&!o[t]}function U(e){const{collectionSchema:t,property:o,type:n}=e,i=null==t?void 0:t[o];return!i||("action"===n?!(0,l.SF)(i):!l.Ym[i.type])}function W(e){const{automationStore:t,collectionStore:o}=e,n=t.getTrigger();if(!n||"event"!==n.type&&"notification_event"!==n.type)return!1;const i=n.event.source;if(i.type===x.v||"filter"===i.type)return!1;const r=T.Xr.createChildStore(o,i.pointer);return L({collectionSchema:o.getSchema(),collectionViewStore:r})}function L(e){const t=$(e);return(0,b.$K)(t)}function $(e){var t;const{collectionViewStore:o,collectionSchema:n}=e,i=o.getPropertyFiltersStore().getValue()??[],r=null===(t=o.getQuery(n))||void 0===t?void 0:t.filter,a={operator:"and",filters:(0,d.OH)({propertyFilters:i,combinatorFilter:r,schema:n})},c=(0,d.SH)(a,(e=>{if((0,d.aN)(e)){const t=n[e.property];return!!t&&!(0,l.TX)(t)}return!1}));if(c)return(0,d.aN)(c)?c.property:(0,d.Mm)(c)?c.timestamp:void 0}function z(e){if("collectionTypedView"===e.contextType)return!1;const t=e.collectionStore();return!!t&&!(t.isSyncedCollection()&&!R.default.checkGate("support_synced_database_automations"))}function Q(e){const{collectionSchema:t,propertyIds:o,searchTerm:n}=e;if(!n)return o.slice(0);const r=new Map,a=o.map((e=>{const o=t[e],n=o?`${o.name} ${V.SO[o.type]}`:"";return r.set(e,n),n})),l=i().filter(n,a).map((e=>{let{original:t}=e;return t}));return o.filter((e=>l.includes(r.get(e)??"")))}function X(e){return S.x.isFail(e.compilationResultStore.state)?[]:e.compilationResultStore.state.value.valueTypes}function j(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,c=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:c,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??c,parent_id:n.id,parent_table:x.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,y.ZP)(),type:"event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:x.v}},properties:{name:o},userId:i})}function G(e){const{automationId:t,automationName:o,collectionStore:n,userId:i}=e;return function(e){const{actionIds:t,automationId:o,collectionStore:n,eventConfiguration:i,lastEditedTime:r,properties:a,userId:l}=e,c=Date.now();return{action_ids:t,alive:!0,created_by_id:l,created_by_table:"notion_user",created_time:c,id:o,last_edited_by_id:l,last_edited_by_table:"notion_user",last_edited_time:r??c,parent_id:n.id,parent_table:x.v,properties:a??{},space_id:n.getSpaceId(),status:"active",trigger:{event:i,id:(0,y.ZP)(),type:"notification_event"},version:1}}({actionIds:[],automationId:t,collectionStore:n,eventConfiguration:{pagesAdded:!1,pagePropertiesEdited:{type:"none"},source:{pointer:n.getSpaceShardedPointer(),type:x.v}},properties:{name:o},userId:i})}function Y(e){const{actionId:t,actionType:o,automationId:n,spaceId:i}=e;return{alive:!0,id:t??(0,y.ZP)(),parent_id:n,parent_table:h.cv,space_id:i,type:o,version:1}}function H(e){const t=e.getActionStores().filter((0,b.AO)((e=>e.isType("slack_notification")?{true:e}:{false:e}))),o={};for(const n of t){const e=n.getConfig(),t=null==e?void 0:e.external_bot_id;if(!t)continue;const i=T.Qx.createChildStore(n,{id:t,spaceId:n.getSpaceId(),table:I.cZ}).getCreatedByStore();i&&(o[n.id]=i.getDisplayName(w.default.getIntl()))}return o}async function J(e){const{automationAvailabilityContext:t}=e;let o=t.automation.getTriggerType();"notification_event"===o&&(o="event");const n=s.Gl[o],i="default_bound"===n.max?s.xZ:n.max;if(t.automationActions.length>=i)return[];const r=(0,c.P)("display"),a=[];for(const l of r)await l.isAvailableForContext(t)&&a.push(l);return a}function ee(){const e=(0,a.VK)((()=>k.Z.completeSlackAuthentications.state),[]);return(0,r.useMemo)((()=>0===e.length?{type:"connectToSlackDefault"}:1===e.length?{type:"selectChannelNew"}:{type:"selectWorkspace"}),[e.length])}},68910:(e,t,o)=>{o.d(t,{L:()=>c});var n=o(14577),i=o(78106),r=o(72126),a=o(68626),l=o(82343);class c{constructor(e){this.context=void 0,this.compilationResultStore=new n.Z((()=>(0,l.pt)({context:this.context})),{useDeepEqual:!0,debugName:"compilationResultsStore"}),this.context=e}getAllContextValues(){const e=this.compilationResultStore.state;return a.x.isFail(e)?[]:r.d9(e.value.valueTypes)}getContextValuesForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionInputValueTypes[e]??[]}getValidationErrorsForAction(e){const t=this.compilationResultStore.state;return a.x.isFail(t)?[]:t.value.actionValidationFailures[e]??[]}getContextValueForActionById(e,t){const o=this.getContextValuesForAction(e);return(0,i.vx)(o,t)}}},22109:(e,t,o)=>{o.d(t,{T:()=>r});var n=o(23174),i=o.n(n);o(67294);const r=(0,o(45238).I)("arrowsUpDown",{viewBox:"0 0 16 16",svg:i()("path",{d:"M4.11 2.385a.61.61 0 01.48-.211c.191 0 .353.07.486.21L8.03 5.409a.66.66 0 01.2.475c0 .191-.061.347-.182.469a.627.627 0 01-.463.181.59.59 0 01-.451-.187L5.926 5.098l-.72-.844.04 1.219v7.242a.624.624 0 01-.187.469.624.624 0 01-.47.187.636.636 0 01-.468-.187.635.635 0 01-.182-.47V5.474l.041-1.22-.726.845-1.201 1.248a.61.61 0 01-.457.187.627.627 0 01-.463-.181.634.634 0 01-.182-.47.66.66 0 01.2-.474l2.958-3.023zm7.786 10.781a.636.636 0 01-.486.205.665.665 0 01-.486-.205l-2.947-3.035a.64.64 0 01-.206-.475c0-.191.061-.345.182-.463a.634.634 0 01.469-.181c.18 0 .33.06.451.181l1.201 1.248.727.85-.041-1.219V2.824c0-.187.06-.342.181-.463a.636.636 0 01.47-.187.627.627 0 01.65.65v7.248l-.041 1.219.726-.85 1.207-1.248a.6.6 0 01.451-.181c.188 0 .342.06.463.181a.615.615 0 01.182.463.648.648 0 01-.2.475l-2.953 3.035z"})})}}]);