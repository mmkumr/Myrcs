"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[348],{88426:(e,t,r)=>{r.d(t,{Pq:()=>ce,oe:()=>de,bU:()=>pe});var i=r(10434),o=r.n(i),n=r(23174),l=r.n(n),s=(r(57658),r(67294)),a=r(83355),p=r(76205);const d=(0,r(45238).I)("addFilterGroup",{viewBox:"0 0 16 16",svg:l()("path",{d:"M2.374 12.42h1.293v1.157c0 1.557.787 2.344 2.375 2.344h7.591c1.573 0 2.367-.787 2.367-2.344V5.924c0-1.557-.794-2.344-2.367-2.344h-1.3V2.423C12.333.866 11.539.08 9.966.08H2.374C.786.08 0 .866 0 2.423v7.653c0 1.557.786 2.344 2.374 2.344zm.015-1.218c-.756 0-1.172-.408-1.172-1.194V2.49c0-.786.416-1.194 1.172-1.194h7.554c.749 0 1.172.408 1.172 1.194v1.09H6.042c-1.588 0-2.375.778-2.375 2.343v5.278H2.39zm3.668 3.501c-.749 0-1.172-.408-1.172-1.194V5.991c0-.786.423-1.194 1.172-1.194h7.554c.748 0 1.172.408 1.172 1.194v7.516c0 .787-.424 1.195-1.172 1.195H6.057zm3.773-1.565c.4 0 .643-.272.643-.71v-2.042h2.17c.423 0 .718-.227.718-.628 0-.408-.272-.643-.718-.643h-2.17V6.938c0-.447-.242-.719-.643-.719-.4 0-.628.288-.628.719v2.177h-2.17c-.438 0-.718.235-.718.643 0 .4.295.628.718.628h2.17v2.041c0 .424.227.711.628.711z"})});var c=r(42853),h=r(56666),u=r(88437),m=r(62208),g=r(47453),v=r(37612),f=r(72126),y=r(97880),M=r(5366),F=r(50906),b=r(97004),C=r(17335),S=r(87279),w=r(61766),Z=r(13401),V=r(80951),I=r(43690),x=r(480),P=r(33929),T=r(98742),k=r(52275),O=r(45959),A=r(26388),E=r(64369),_=r(62045);function R(e){window.__c={n:"CollectionFilterMenuDateFilterMode"};const{filter:t}=e,{isMobile:r}=(0,x.Fy)(),i=P.default.getIntl(),n={width:190,menuTitle:i.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.mobileDateFilterModeMenu.title"}),items:p.T,selectedItem:(0,p.TX)(t),getKey:e=>e,onSelect:r=>{const i={...t,use_end:(0,p.UG)(r)};e.onChange(i)},renderItem:e=>l()(A.Z,{renderTooltip:()=>(0,C._T)(e.value),render:t=>s.createElement(k.Z,o()({title:(0,C.IF)(e.value)},(0,T.Z)(e,t))),placement:A.Z.Placement.Right,textWrap:!0,style:{width:"260px"}}),renderOrigin:e=>s.createElement(_.Z,o()({},e,{placeholder:i.formatMessage({defaultMessage:"Date Options",id:"database.filterMenu.dateFilterModeMenu.label"}),title:l()(E.Z,{isMobile:r},void 0,(0,C.IF)((0,p.TX)(t))),disableMargins:!0,desktopStyle:{width:"100px"}}))};return s.createElement(O.Z,o()({key:"date-filter-mode"},n,{mobileActionSheet:!0}))}var D=r(34299);class G extends a.Z{renderComponent(){const{filterValueType:e,filter:t,intl:r}=this.props,i=(0,p.xm)(e),n={width:190,menuTitle:r.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.mobileComparatorValueMenu.title"}),items:i,selectedItem:t.operator,getKey:e=>e,onSelect:r=>{const i=(0,C.li)(e,t,r,"combinator");this.props.onChange(i),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_comparator"})},renderItem:e=>s.createElement(k.Z,o()({title:(0,C.WC)(e.value)},e)),renderOrigin:e=>s.createElement(_.Z,o()({},e,{placeholder:r.formatMessage({defaultMessage:"Comparator",id:"database.filterMenu.comparatorMenuDropdownButton.label"}),title:l()(E.Z,{isMobile:this.environment.device.isMobile},void 0,(0,C.WC)(t.operator)),disableMargins:!0}))};return s.createElement(O.Z,o()({key:"comparator"},n,{mobileActionSheet:!0}))}}G.displayName="CollectionFilterMenuFilterOperator";const B=(0,M.injectIntl)(G);var N=r(49068),U=r(26909);const W=(0,M.defineMessages)({setFilter:{defaultMessage:"Set filter",id:"database.filterMenu.rollupPropertyValue.mobileMenu.title"}});class L extends a.Z{renderComponent(){const{filter:e}=this.props;if((0,p.a_)(e))return this.renderArrayFilter(e);const t=(0,p.fI)({schema:this.props.schema,property:this.props.property,getRecordModel:this.props.parentStore.getRecordModel});if(!(0,p.ZB)(t,e)){const e=(0,C.rn)(t);return l()(s.Fragment,{},void 0,l()(B,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),l()(N.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange}))}const r=s.createElement(M.FormattedMessage,o()({},C.xe[t],{values:{property:l()(M.FormattedMessage,{id:"collectionFilterMenuFilter.property.name",defaultMessage:"Property"}),operator:l()(B,{filterValueType:t,filter:e,collectionViewType:this.props.collectionViewType,onChange:this.props.onChange}),operatorValue:l()(N.Z,{filterValueType:t,filter:e,schema:this.props.schema,property:this.props.property,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId,onChange:this.props.onChange})}}));return this.environment.device.isMobile?r:l()("div",{style:{alignItems:"center",display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:this.props.isArrayFilter?void 0:"span 2",gridColumnGap:`${U.l0}px`,gridTemplateRows:`${U.fg}px`,gridTemplateColumns:"[value-start] max-content auto [value-end operator-start] auto"}},void 0,r)}renderArrayFilter(e){const{intl:t}=this.props,r={menuTitle:t.formatMessage(W.setFilter),items:p.Rf,getKey:e=>e,selectedItem:e.operator,onSelect:t=>{const r={...e,operator:t};this.props.onChange(r),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_rollup_set_filter"})},renderItem:e=>s.createElement(k.Z,o()({title:(0,C.SW)(e.value,t)},e)),renderOrigin:r=>s.createElement(_.Z,o()({},r,{placeholder:t.formatMessage(W.setFilter),title:(0,C.SW)(e.operator,t),disableMargins:!0,desktopStyle:{minWidth:70}}))},i=(0,D.gT)({property:this.props.property,schema:this.props.schema,getRecordModel:this.props.parentStore.getRecordModel});if(!i)return l()("div",{style:{gridColumnEnd:"span 2"}});const n=l()(s.Fragment,{},void 0,s.createElement(O.Z,o()({key:"set_filter"},r,{mobileActionSheet:!0})),l()(Q,{collectionViewId:this.props.collectionViewId,filter:e.subfilter,schema:i.targetCollectionSchema,property:i.targetProperty,parentStore:this.props.parentStore,collectionViewType:this.props.collectionViewType,onChange:t=>{const r={...e,subfilter:t};this.props.onChange(r)},isArrayFilter:!0}));return this.environment.device.isMobile?n:l()("div",{style:{display:"grid",gridAutoFlow:"column",gridAutoColumns:"1fr",gridColumnEnd:"span 2",gridColumnGap:`${U.l0}px`,gridTemplateColumns:"max-content",gridTemplateRows:`${U.fg}px`}},void 0,n)}}L.displayName="LocalizableCollectionFilterMenuFilter";const Q=(0,M.injectIntl)(L),$=Q;var z=r(31945),j=r(77498),H=r(50542);class K extends a.Z{constructor(){super(...arguments),this.handleChangeProperty=e=>{var t,r;const{schema:i}=this.props,{property:o,filter:n}=this.props.propertyFilter,l=i[o],s=i[e],a={property:e,filter:n},d=s&&(0,p.J5)(i,e,n,this.props.parentStore.getRecordModel),c=s&&"relation"===s.type&&o!==e,h=l&&("created_by"===l.type||"last_edited_by"===l.type)&&s&&"person"===s.type,u=(0,p.Gb)(n)&&!(0,p.mv)(n)&&(0,p.R8)(n).some((e=>"exact"===e.type&&e.value&&"bot"===e.value.table));(!d||c||h&&u||!(0,I.dN)(a,i))&&(a.filter=(0,C.zZ)({schema:i,property:e,getRecordModel:this.props.parentStore.getRecordModel})),null===(t=(r=this.props).onChange)||void 0===t||t.call(r,this.props.index,a),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_property"})}}renderComponent(){const{device:e}=this.environment,{schema:t,propertyFilter:r}=this.props,i=(0,V.Qm)({schema:t,property:r.property});if(!i)return;if(!(0,p.J5)(t,r.property,r.filter,this.props.parentStore.getRecordModel))return;const n=(0,p.gE)(r.filter)&&(0,p.vR)(r.filter)&&(0,p.c3)(i),a=n?{width:"120px",marginRight:"4px"}:{},d=l()(s.Fragment,{},void 0,l()(z.ZP,{popupType:e.isMobile?z.Z4.SlideUp:z.Z4.Popup,renderOrigin:e=>s.createElement(H.Z,o()({},e,{propertySchema:i,disableMargins:!0,textWrapperStyle:{width:"100%",...a}})),render:e=>l()(j.Z,{isRelationProperty:!1,schema:this.props.schema,onAccept:this.handleChangeProperty,onClose:e.close})}),n&&l()(R,{filter:r.filter,onChange:e=>{var t,i;const o={...r,filter:e};null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.index,o)}}));return l()(s.Fragment,{},void 0,this.props.filterOperator,e.isMobile?d:l()("div",{style:{display:"flex"}},void 0,d),l()(M.FormattedMessage,{id:"collectionFilterMenuRow.propertyConjunction.label",defaultMessage:" "}),l()($,{filter:r.filter,schema:t,property:r.property,parentStore:this.props.parentStore,collectionViewId:this.props.collectionViewId,collectionViewType:this.props.collectionViewType,onChange:e=>{var t,i;const o={...r,filter:e};null===(t=(i=this.props).onChange)||void 0===t||t.call(i,this.props.index,o)},isArrayFilter:!1}))}}K.displayName="CollectionFilterMenuRow";const q=K;function J(){return l()(M.FormattedMessage,{defaultMessage:"Add filter rule",id:"database.filterMenu.addFilterRuleButtonTitle"})}const X=(0,M.defineMessages)({operatorPlaceholder:{defaultMessage:"Operator",id:"database.filterMenu.operatorPlaceholder"}});class Y extends a.Z{renderComponent(){const{intl:e,filterOperator:t,onChange:r,disableMargins:i}=this.props,n={width:"auto",menuTitle:e.formatMessage({defaultMessage:"Operator",id:"database.filterMenu.filterOperatorMenu.title"}),items:p.Uz,getKey:e=>e,selectedItem:t,onSelect:r,renderItem:t=>s.createElement(k.Z,o()({title:(0,C.KV)(t.value,e),caption:(0,C.Qz)(t.value,e)},t)),renderOrigin:r=>s.createElement(_.Z,o()({},r,{title:t&&(0,C.KV)(t,e),placeholder:e.formatMessage(X.operatorPlaceholder),disableMargins:i}))};return s.createElement(O.Z,o()({key:"operator"},n,{mobileActionSheet:!0}))}}Y.displayName="CollectionFilterOperatorSelect";const ee=(0,M.injectIntl)(Y);var te=r(31339),re=r(8982),ie=r(73063),oe=r(78140),ne=r(32163),le=r(40721),se=r(53437),ae=r(72495);const pe=170,de=400;class ce extends a.Z{constructor(){super(...arguments),this.buttonPopupStores=[],this.renderChildFilter=(e,t)=>{const r=this.environment.device.isMobile;return(0,p.vA)(e)?r?this.renderMobileCombinatorFilter(e,t):this.renderDesktopCombinatorFilter(e,t):(0,p.aN)(e)?r?this.renderMobilePropertyFilter(e,t):this.renderDesktopPropertyFilter(e,t):void 0},this.renderAddFilterMenuItem=e=>{const t=this.renderMenuIcon(g.R);return s.createElement(k.Z,o()({focused:!1},e,{icon:t,title:l()(J,{})}))},this.renderAddFilterGroupMenuItem=e=>{const t=this.renderMenuIcon(d);return s.createElement(k.Z,o()({focused:!1},e,{icon:t,title:l()(M.FormattedMessage,{defaultMessage:"Add filter group",id:"database.filterMenu.addFilterGroup2ButtonTitle"}),caption:l()(M.FormattedMessage,{defaultMessage:"A group to nest more filters",id:"database.filterMenu.addFilterGroupButtonCaption"})}))},this.renderCombinatorActions=()=>{const{device:e}=this.environment;if(e.isMobile)return l()(ae.Z,{topBorder:this.shouldRenderEmptyState()},void 0,this.renderAddFilterMenuItem({onClick:this.handleAddFilterClick}),this.allowNewCombinatorFilters()&&this.renderAddFilterGroupMenuItem({onClick:this.handleAddFilterGroupClick}));const t={height:32},r={padding:`${U.cn}px 0`};return this.allowNewCombinatorFilters()?l()(ae.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:r},void 0,l()(z.ZP,{alignmentToOrigin:se.ZP.Alignment.Start,popupType:se.ZP.PopupType.Popup,renderOrigin:e=>l()(re.i,{action:()=>e.onClick(),render:r=>{const{focused:i,...n}=r;return s.createElement(Z.Z,o()({},e,n,{focused:i,isBlue:!1,style:t,title:l()("div",{},void 0,l()(J,{}),(0,c.i)({width:10,marginLeft:6,display:"inline"}))}))}}),render:e=>l()(ne.Z,{type:ne.i.Vertical,initialFocus:0,sections:[{key:"actions",render:e=>s.createElement(ae.Z,e),items:[{key:"add_filter",render:this.renderAddFilterMenuItem,action:t=>{e.close(),this.handleAddFilterClick()}},{key:"add_filter_group",render:this.renderAddFilterGroupMenuItem,action:t=>{e.close(),this.handleAddFilterGroupClick()}}]}]})})):l()(ae.Z,{topBorder:this.shouldRenderEmptyState(),desktopStyle:r},void 0,l()(re.i,{action:this.handleAddFilterClick,render:e=>{const{focused:r,...i}=e;return s.createElement(Z.Z,o()({},i,{focused:e.focused,isBlue:!1,style:t,onClick:this.handleAddFilterClick,title:l()(J,{})}))}}))},this.handleChildFilterChange=(e,t)=>{this.mutateFilters((r=>r.splice(e,1,t)))},this.handleAddFilterClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema);this.mutateFilters((t=>t.push(e))),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter"})},this.handleAddFilterGroupClick=()=>{const e=this.getDefaultNewPropertyFilter(this.props.schema),t={operator:this.getOppositeOperator(),filters:[e]},r=this.mutateFilters((e=>e.push(t)));this.openIndex(r-1),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"add_filter_group"})},this.handleChangeFilterOperator=e=>{const t={...this.props.combinatorFilter,operator:e};this.props.onChange(this.props.index,t),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_operator"})}}willUnmount(){this.buttonPopupStores=[]}renderComponent(){const{combinatorFilter:e}=this.props,{device:t}=this.environment,r=(e.filters??[]).flatMap((e=>(0,p.Mm)(e)?[]:[e]));return l()(s.Fragment,{},void 0,this.shouldRenderEmptyState()?void 0:l()("div",{style:t.isMobile?void 0:this.getGridStyles()},void 0,r.map(this.renderChildFilter)),this.renderCombinatorActions())}renderDesktopPropertyFilter(e,t){return l()(s.Fragment,{},t,l()(q,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:this.renderCombinatorOperator(t),parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t))}renderMobilePropertyFilter(e,t){return l()(s.Fragment,{},t,this.renderCombinatorOperator(t),l()(ae.Z,{title:l()(M.FormattedMessage,{defaultMessage:"Filter {index}",id:"database.filterMenu.filterIndex",values:{index:t+1}})},void 0,l()(q,{index:t,propertyFilter:e,schema:this.props.schema,filterOperator:null,parentStore:this.props.parentStore,onChange:this.handleChildFilterChange,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId},t),this.renderRowActions(e,t)))}renderDesktopCombinatorFilter(e,t){const r={gridColumn:"property-start / value-end",...this.getSubgridWrapperStyles()};return l()(s.Fragment,{},t,this.renderCombinatorOperator(t),l()("div",{style:r},void 0,l()(ce,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId})),this.renderRowActions(e,t))}renderMobileCombinatorFilter(e,t){const r=(e.filters||[]).length,i=l()(M.FormattedMessage,{defaultMessage:"Filter Group {index}",id:"database.filterMenu.filterGroupIndex",values:{index:t+1}});return l()(s.Fragment,{},t,this.renderCombinatorOperator(t),l()(ae.Z,{title:i},void 0,l()(z.ZP,{buttonPopupStore:this.getButtonPopupStore(t),popupType:z.Z4.SlideUp,renderOrigin:t=>s.createElement(k.Z,o()({focused:!1},t,{showExtensionArrow:!0,right:r.toString(),title:(0,C.qh)({filter:e,schema:this.props.schema})})),render:r=>l()(oe.Z,{menuType:S.og.Modal,title:i,left:l()(le.BackMenuText,{}),onClickLeft:r.close},void 0,l()(ce,{index:t,level:this.props.level+1,combinatorFilter:e,onChange:this.handleChildFilterChange,parentStore:this.props.parentStore,schema:this.props.schema,collectionViewType:this.props.collectionViewType,collectionViewId:this.props.collectionViewId}))}),this.renderRowActions(e,t)))}renderCombinatorOperator(e){const t=this.props.combinatorFilter.operator,{device:r}=this.environment,i={justifySelf:"end"},o={...i,lineHeight:"32px",paddingRight:4};if(0===e){if(r.isMobile)return;return l()(E.Z,{style:o},void 0,l()(M.FormattedMessage,{defaultMessage:"Where",id:"database.filterMenu.where"}))}if(1===e){const e=l()(ee,{disableMargins:!0,filterOperator:t,onChange:this.handleChangeFilterOperator});return this.environment.device.isMobile?l()(ae.Z,{},void 0,e):l()("div",{style:i},void 0,e)}if(!r.isMobile)return l()(E.Z,{style:o},void 0,l()(ue,{operator:t}))}renderRowActions(e,t){return this.environment.device.isMobile?this.renderRowActionMenuItems(e,t,void 0):l()(z.ZP,{popupType:se.ZP.PopupType.Popup,renderOrigin:e=>l()(re.i,{action:()=>e.onClick(),render:e=>s.createElement(ie.Z,o()({},e,{hovered:e.focused,style:{width:"100%",height:32},icon:h.o}))}),render:r=>this.renderRowActionMenuItems(e,t,r)})}renderMenuIcon(e,t){return l()(te.Z,{icon:e,styles:t})}renderRowActionMenuItems(e,t,r){const i=(0,p.vA)(e),n=l()(M.FormattedMessage,i?{defaultMessage:"Remove",id:"database.filterMenu.removeFilterGroupMenuTitle"}:{defaultMessage:"Remove",id:"database.filterMenu.removeFilterMenuTitle"}),a=l()(M.FormattedMessage,i?{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterGroupMenuTitle"}:{defaultMessage:"Duplicate",id:"database.filterMenu.duplicateFilterMenuTitle"}),d=[{key:"delete",action:()=>{r&&r.close(),this.handleDeleteFilter(t)},render:e=>s.createElement(k.Z,o()({},e,{icon:this.renderMenuIcon(v.y),title:n}))},{key:"duplicate",action:()=>{r&&r.close(),this.handleDuplicateFilter(t)},render:e=>s.createElement(k.Z,o()({},e,{icon:this.renderMenuIcon(u.a),title:a}))}];if((0,p.aN)(e)&&this.allowNewCombinatorFilters()&&d.push({key:"turn_into_group",action:()=>{r&&r.close(),this.handleTurnIntoGroup(t,e)},render:e=>s.createElement(k.Z,o()({},e,{icon:this.renderMenuIcon(m.z),title:l()(M.FormattedMessage,{defaultMessage:"Turn into group",id:"database.filterMenu.turnIntoGroupMenuTitle"})}))}),(0,p.vA)(e)&&e.filters&&1===e.filters.length){const i=(0,p.vA)(e.filters[0])?l()(M.FormattedMessage,{defaultMessage:"Unwrap group",id:"database.filterMenu.unwrapGroupMenuTitle"}):l()(M.FormattedMessage,{defaultMessage:"Turn into filter",id:"database.filterMenu.turnIntoFilterMenuTitle"});d.push({key:"turn_into_filter",action:()=>{r&&r.close(),this.handleTurnIntoFilter(t,e)},render:e=>s.createElement(k.Z,o()({},e,{icon:this.renderMenuIcon(m.z),title:i}))})}const c=he(e);return(0,p.vA)(e)&&this.props.level+c+1<3&&d.push({key:"wrap_in_group",action:()=>{r&&r.close(),this.handleTurnIntoGroup(t,e)},render:e=>s.createElement(k.Z,o()({},e,{icon:this.renderMenuIcon(m.z),title:l()(M.FormattedMessage,{defaultMessage:"Wrap in group",id:"database.filterMenu.wrapInGroupMenuTitle"}),caption:l()(M.FormattedMessage,{defaultMessage:"Create a filter group around this",id:"database.filterMenu.wrapInGroupMenuCaption"})}))}),l()(ne.Z,{initialFocus:this.environment.device.isMobile?void 0:0,type:ne.i.Vertical,sections:[{key:"actions",render:this.environment.device.isMobile?e=>s.createElement("div",e):e=>s.createElement(ae.Z,e),items:d}]})}handleDuplicateFilter(e){this.mutateFilters((t=>{const r=t[e];if(r){const i={...r};t.splice(e,0,i)}})),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"duplicate_filter"})}handleTurnIntoGroup(e,t){const r={operator:this.getOppositeOperator(),filters:[t]};this.handleChildFilterChange(e,r),this.openIndex(e),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter_group"})}handleTurnIntoFilter(e,t){const r=f.Ps(t.filters||[]);r&&!(0,p.Mm)(r)&&this.handleChildFilterChange(e,r),F.wds(this.environment,{view_type:this.props.collectionViewType,action:"turn_into_filter"})}handleDeleteFilter(e){this.mutateFilters((t=>t.splice(e,1))),this.getButtonPopupStore(e).reset(),this.buttonPopupStores.splice(e,1)}openIndex(e){this.getButtonPopupStore(e).setState({open:!0})}getButtonPopupStore(e){for(;this.buttonPopupStores.length<e+1;){const e=new w.Z;this.buttonPopupStores.push(e)}return this.buttonPopupStores[e]}getOppositeOperator(){return"or"===this.props.combinatorFilter.operator?"and":"or"}allowNewCombinatorFilters(){return this.props.level<2}getDefaultNewPropertyFilter(e){const t=(this.props.combinatorFilter.filters||[]).filter(p.aN),r=t[t.length-1];return r?f.Xh(r):(0,b.Me)(e)}mutateFilters(e){const t=[...this.props.combinatorFilter.filters||[]],r=e(t),i={...this.props.combinatorFilter,filters:t};return this.props.onChange(this.props.index,i),r}shouldRenderEmptyState(){return(0,p.$1)(this.props.combinatorFilter)&&0===this.props.level}getEmptyTextWrapStyle(){return{color:this.theme.lightTextColor,lineHeight:1.5,whiteSpace:"nowrap"}}getSubgridWrapperStyles(){return{background:this.theme.filterGroupBackground,borderRadius:3,boxShadow:`0 0 0 1px ${this.theme.filterGroupBorder}`,margin:1,alignSelf:"stretch"}}getGridStyles(){return ce.style}}function he(e){if((0,p.vA)(e)){const t=(e.filters||[]).filter(p.vA);return 1+(f.Fp(t.map(he))||0)}return 0}function ue(e){const{operator:t,lowercase:r}=e;return"or"===t?l()(M.FormattedMessage,r?{id:"collectionFilterCombinatorGrid.filterOperator.or.lowercase",defaultMessage:"or"}:{id:"collectionFilterCombinatorGrid.filterOperator.or",defaultMessage:"Or"}):"and"===t?l()(M.FormattedMessage,r?{id:"collectionFilterCombinatorGrid.filterOperator.and.lowercase",defaultMessage:"and"}:{id:"collectionFilterCombinatorGrid.filterOperator.and",defaultMessage:"And"}):(0,y.t1)(t)}ce.displayName="CollectionFilterCombinatorGrid",ce.style={display:"grid",gridTemplateColumns:`\n             [boolean-start] 60px\n             [boolean-end property-start] minmax(min-content, 120px)\n             [property-end operator-start] 110px\n             [operator-end value-start] auto\n             [value-end menu-start] ${U.fg}px\n             [menu-end]\n        `,gridAutoRows:`minmax(${U.fg}px, auto)`,gridColumnGap:U.l0,gridRowGap:U.cn,padding:`${U.cn}px ${U.l0}px 0 ${U.l0}px`,justifyItems:"stretch",alignItems:"start"}},49068:(e,t,r)=>{r.d(t,{Z:()=>q,$:()=>K});var i=r(10434),o=r.n(i),n=r(23174),l=r.n(n),s=r(67294),a=r(83355),p=r(66897),d=r(76205),c=r(99036),h=r(80951),u=r(84619),m=r(40506),g=r(76725),v=r(32056),f=r(23014),y=r(97880),M=r(82990),F=r(5366),b=r(50906),C=r(17335),S=r(29376),w=r(57559),Z=r(88426),V=r(62644),I=r(68834),x=r(49085),P=r(8982),T=r(36488),k=r(74194),O=r(68894);const A=(0,F.defineMessages)({value:{defaultMessage:"Value",id:"database.filterAndSort.propertyValueInput.placeholder"}});class E extends a.Z{constructor(){super(...arguments),this.storeTypes={isEditing:x.default.createClass(!1)},this.input=null,this.handleClick=()=>{this.stores.isEditing.setState(!0)},this.handleInputBlur=()=>{this.stores.isEditing.setState(!1)},this.handleInputCancel=()=>{this.input&&(this.input.handleBlur(),this.handleInputBlur())},this.handleInputChange=e=>{const t=e.target.value;this.props.onChange(t)}}renderComponent(){return l()("div",{style:{display:"flex",...this.getDivStyle()},onClick:this.handleClick},void 0,this.renderInput())}renderInput(){const{device:e}=this.environment,t=this.stores.isEditing.state,r=this.props.value||"",{intl:i}=this.props;return e.isMobile?l()(O.ZP,{value:r,onChange:this.handleInputChange,placeholder:i.formatMessage(A.value),onBlur:this.handleInputBlur,rightMobileEditLabel:l()(F.FormattedMessage,{defaultMessage:"Edit",id:"database.filterAndSort.mobileEditButton.label"})}):l()(P.i,{action:()=>this.stores.isEditing.setState(!0),render:e=>s.createElement("div",{ref:e.ref,onMouseEnter:e.onMouseEnter,style:{background:e.focused&&!t?this.theme.buttonHoveredBackground:"transparent",...this.getDivStyle()}},l()(T.Z,{capture:t,render:e=>s.createElement("div",o()({},e,{style:this.getDivStyle()}),s.createElement(k.Z,{focus:t,ref:e=>this.input=e,value:r,onChange:this.handleInputChange,placeholder:i.formatMessage(A.value),onBlur:this.handleInputBlur,onCancel:this.handleInputCancel,style:this.getInputStyle()}))}))})}getDivStyle(){return E.disableMarginStyles}getInputStyle(){return{...E.inputStyle,...E.disableMarginStyles,minWidth:Z.bU}}}E.displayName="CollectionOperatorValueInput",E.inputStyle={marginRight:8,paddingLeft:6,paddingRight:0,width:80,height:30},E.disableMarginStyles={margin:0,width:"100%",height:"100%",transition:"background 120ms ease-in"};const _=(0,F.injectIntl)(E);var R=r(26909),D=r(52275),G=r(31945),B=r(60458),N=r(45959),U=r(92864),W=r(89845),L=r(62045),Q=r(10009),$=r(14390),z=r(22084);const j=(0,F.defineMessages)({dateTitle:{defaultMessage:"Date",id:"database.filterMenu.mobileDateSelectMenu.title"},emptyPlaceholder:{defaultMessage:"Empty",id:"database.filterMenu.dateSelectMenu.emptyPlaceholder"}});class H extends a.Z{constructor(){super(...arguments),this.getRelatedCollectionAppConfigUri=this.createComputedStore((()=>{const{schema:e,property:t,parentStore:r}=this.props,i=e[t];if(i&&(0,c.p_)(i))return(0,S.ke)(i,r)})),this.renderPersonInner=e=>{var t;const{device:r}=this.environment;if(!e.value)return;if("relative"===e.type&&"me"===e.value)return l()("span",{style:{marginTop:1,marginRight:10,marginBottom:6}},void 0,l()(F.FormattedMessage,{defaultMessage:"Me",id:"database.filterAndSort.firstPersonPropertyValue.title"},"relative"));const i=(0,p.Hl)({pointer:e.value,getRecordValue:this.props.parentStore.getRecordValue});return l()(U.ZP,{actor:i,isSingle:!1,shouldShrink:!1,format:r.isMobile?U.vw.Format.Large:U.vw.Format.Medium,showRemoveButton:!1},null===(t=i.asActor)||void 0===t?void 0:t.id)}}renderComponent(){const{filter:e,property:t,collectionViewId:r,schema:i,parentStore:o}=this.props,n=this.props.filterValueType,s=l()("span",{});if("date"===n)return(0,d.gE)(e)?(0,d.mv)(e)?s:(0,d.TQ)(e)?this.renderDateRangeFilterOperatorValue(e):this.renderDateFilterOperatorValue(e):s;if("text"===n){if(!(0,d.Ly)(e))return s;const t=e;if((0,d.mv)(t))return s;if("string_has_no_alphabet_prefix"===t.operator)return;const r=t.value;return l()(_,{value:r.value,onChange:e=>{const r={type:"exact",value:e},i={...t,value:r};this.props.onChange(i)}})}if("number"===n){if(!(0,d.h6)(e))return s;const t=e;if((0,d.mv)(t))return s;const r=t.value;return l()(_,{value:void 0===r.value?"":r.value.toString(),onChange:e=>{const r={type:"exact",value:(0,v.p3)(e)},i={...t,value:r};this.props.onChange(i)}})}if("checkbox"===n){if(!(0,d.XA)(e)||!r)return s;const n=e,a=n.value;return l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderCheckboxOrigin(a,e),render:e=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("select"===n||"multi_select"===n||"status"===n){if(!((0,d.dx)(e)||(0,d.NU)(e)||(0,d.r2)(e))||!r)return s;const n=e;if((0,d.mv)(n))return s;const a=this.props.schema[this.props.property];if(!a)return s;const p=(0,d.dx)(n)?(0,d.mg)(n):(0,d.NU)(n)?(0,d.qC)(n):(0,d.Js)(a,(0,d.wB)(n));return l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderSelectOrigin(p,e),render:e=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("location"===n){if(!(0,d.Mp)(e))return s;const n=e,a=(0,d.u0)(n);return l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderLocationOrigin(a,e),render:e=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("relation"===n){if(!(0,d.e)(e)||!r)return s;const n=e;if((0,d.mv)(n))return s;const a=(0,d.YO)(n);return l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderRelationOrigin(a,e),render:e=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("person"===n){if(!(0,d.Gb)(e)||!r)return s;const n=e;if((0,d.mv)(n))return s;const a=(0,d.R8)(n);return l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderPersonOrigin(a,e),render:e=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:n},schema:i,onChange:e=>{this.props.onChange(e)},onClose:e.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}if("file"===n){if(!(0,d.W6)(e))return s;const t=e;if((0,d.mv)(t))return s;(0,y.t1)(t)}if("verification"===n)return(0,d.Jw)(e)?l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:t=>this.renderVerificationOrigin((0,d.fl)(e),t),render:n=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:t,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:n.close,parentStore:o,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!1})}):s;(0,y.t1)(n)}renderCheckboxOrigin(e,t){const r=null==e?void 0:e.value;return s.createElement(L.Z,o()({},t,{disableMargins:!0,placeholder:l()(F.FormattedMessage,{defaultMessage:"Select a value",id:"database.filterOperatorValue.checkboxPlaceholder.title"}),title:"boolean"==typeof r&&l()(B.Z,{checked:r,size:16,disabled:!0})}))}renderSelectOrigin(e,t){const{device:r}=this.environment,i=this.props.schema[this.props.property],n=i&&((0,c.cu)(i)||"status"===i.type)&&i.options||[];return s.createElement(L.Z,o()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(F.FormattedMessage,{defaultMessage:"Select an option",id:"collections.operatorValueSelect.placeholder"}),title:e.length>0&&s.createElement(s.Fragment,null,e.map((e=>{if(void 0===e.value)return null;const t=(0,h.i7)(n,e.value);return t?l()(z.a,{format:r.isMobile?u.l.Large:u.l.Medium,isSingle:!1,value:t.value,color:t.color,showRemoveButton:!1},e.value):null})))}))}renderRelationOrigin(e,t){const{device:r}=this.environment;return s.createElement(L.Z,o()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(F.FormattedMessage,{defaultMessage:"Select a page",id:"databaseRelationOperators.selectPlaceholder"}),title:e.length>0&&e.map((e=>{if(!e.value)return;const t=e.type,i={isSingle:!1,shouldShrink:!1,format:r.isMobile?u.l.Large:u.l.Medium};if("exact"===t)return s.createElement(Q.Z,o()({key:e.value,blockId:e.value,parentStore:this.props.parentStore},i));if("relative"===t){const t=this.getRelatedCollectionAppConfigUri.state;if(!t)return;return s.createElement(u.Z,o()({value:f.qB[t][e.value.variable].formattedMessage,backgroundColor:"transparent",theme:this.theme},i))}(0,y.t1)(t)}))}))}renderLocationOrigin(e,t){const{parentStore:r}=this.props;return s.createElement(L.Z,o()({},t,{disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),placeholder:l()(F.FormattedMessage,{defaultMessage:"Select a location",id:"databaseLocationOperators.selectPlaceholder"}),title:e.length>0&&e.map((e=>e.value&&l()("div",{style:{margin:"0 10px 6px 0"}},void 0,l()(I.Z,{collectionStore:w.NW.createChildStore(r,{table:"collection",id:e.value})},e.value))))}))}renderPersonOrigin(e,t){return s.createElement(L.Z,o()({},t,{placeholder:K(void 0),disableMargins:!0,desktopStyle:this.getValueDesktopStyle(),innerStyle:this.getValueInnerStyle(e.length>0),title:e.length>0&&e.map(this.renderPersonInner)}))}renderDateFilterOperatorValue(e){const{intl:t,collectionViewId:r,property:i,schema:n,parentStore:a}=this.props;if(!r)return;const p={menuTitle:t.formatMessage(j.dateTitle),items:d.tO,getKey:e=>"relative"===e.type?e.value:e.type,selectedItem:e.value,onSelect:t=>{const r={...e,value:t};this.props.onChange(r),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>s.createElement(D.Z,o()({title:(0,C.x)(e.value)},e)),renderOrigin:r=>s.createElement(L.Z,o()({},r,{disableMargins:!0,placeholder:t.formatMessage(j.emptyPlaceholder),title:(0,C.x)(e.value)}))},c=e.value;if("exact"===c.type){const t=l()(s.Fragment,{},void 0,l()(F.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.date.exact.order",defaultMessage:"{exact}{dateValue}",values:{exact:s.createElement(N.Z,o()({key:"date-filter-value-type"},p,{mobileActionSheet:!0})),dateValue:l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderExactDateOrigin(c,e,!1),render:t=>l()(V.ZP,{collectionViewId:r,propertyFilter:{property:i,filter:e},schema:n,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:a,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),d=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:R.l0,width:"100%"}:void 0;return l()("div",{style:d},void 0,t)}return s.createElement(N.Z,o()({key:"date-filter-value-type"},p,{mobileActionSheet:!0}))}renderExactDateOrigin(e,t,r){const i=this.props.schema[this.props.property],n=i&&"date"===i.type?i.date_format:void 0;let a;if("exact"===e.type&&e.value)if((0,m.J_)(e.value))a=e.value;else if((0,m.gR)(e.value)){const t=(0,m.Gc)(e.value);t&&(a=t.value)}return s.createElement(L.Z,o()({},t,{placeholder:l()(F.FormattedMessage,r?{defaultMessage:"Select a range",id:"database.filterAndSort.dateRangePropertyValue.placeholder"}:{defaultMessage:"Select a date",id:"database.filterAndSort.datePropertyValue.placeholder"}),desktopStyle:{minWidth:165},title:a&&l()("span",{style:{...M.Z.textOverflowStyle}},void 0,l()(W.Z,{value:a,dateFormat:n||m.sF})),disableMargins:!0}))}renderDateRangeFilterOperatorValue(e){const{intl:t,parentStore:r,schema:i,collectionViewId:n,property:a}=this.props;if(!n)return;const p={menuTitle:t.formatMessage(j.dateTitle),items:(0,d.bS)(),getKey:e=>(0,d.eX)(e),selectedItem:e.value,onSelect:t=>{const r={...e,value:t};this.props.onChange(r),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})},renderItem:e=>s.createElement(D.Z,o()({title:(0,C.ip)(e.value)},e)),renderOrigin:r=>s.createElement(L.Z,o()({},r,{disableMargins:!0,placeholder:t.formatMessage(j.emptyPlaceholder),title:(0,C.ip)(e.value)}))},c=e.value;if("exact"===c.type){const t=l()(s.Fragment,{},void 0,l()(F.FormattedMessage,{id:"collectionFilterMenuFilterOperatorValue.dateRange.exact.order",defaultMessage:"{dateValue}",values:{exact:s.createElement(N.Z,o()({key:"date-filter-value-type"},p,{mobileActionSheet:!0})),dateValue:l()(G.ZP,{popupType:this.environment.device.isMobile?G.Z4.SlideUp:G.Z4.Popup,renderOrigin:e=>this.renderExactDateOrigin(c,e,!0),render:t=>l()(V.ZP,{collectionViewId:n,propertyFilter:{property:a,filter:e},schema:i,onChange:e=>{this.props.onChange(e)},onClose:t.close,parentStore:r,context:V.Qv.AdvancedFilter,allowRelativePersonFilter:!0})})}})),d=this.environment.device.isDesktop?{display:"grid",justifyContent:"stretch",gridTemplateColumns:"1fr 1fr",gridColumnGap:R.l0,width:"100%"}:void 0;return l()("div",{style:d},void 0,t)}return"relative"!==c.type||"custom"!==c.value&&"surrounding"!==c.value?s.createElement(N.Z,o()({key:"date-filter-value-type"},p,{mobileActionSheet:!0})):l()($.b,{renderAsQueryDropdown:this.environment.device.isMobile,filter:c,onUpdate:t=>{const r={...e,value:t};this.props.onChange(r),b.wds(this.environment,{view_type:this.props.collectionViewType,action:"set_filter_value_type"})}})}renderVerificationOrigin(e,t){const r=e.filter((e=>{let{value:t}=e;return Boolean(t)})).map(C.cq);return s.createElement(L.Z,o()({},t,{disableMargins:!0,placeholder:l()(F.FormattedMessage,{defaultMessage:"Select an option",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.placeholder"}),title:r.length&&l()("span",{},void 0,(0,g.Z)(r,(e=>l()("span",{style:{whiteSpace:"pre"}},e,l()(F.FormattedMessage,{defaultMessage:", ",id:"CollectionFilterMenuFilterOperatorValue.verificationFilterSelect.commaSeparator"})))))}))}getValueDesktopStyle(){return{maxWidth:Z.oe}}getValueInnerStyle(e){return{paddingTop:e?6:void 0,overflow:"hidden"}}}function K(e){return l()(F.FormattedMessage,e?{defaultMessage:"Select one person",id:"database.personPropertyValue.selectPerson.searchPlaceholderWithLimit"}:{defaultMessage:"Select one or more people",id:"database.personPropertyValue.selectPerson.searchPlaceholder"})}H.displayName="CollectionFilterMenuFilterOperatorValue";const q=(0,F.injectIntl)(H)},50542:(e,t,r)=>{r.d(t,{Z:()=>h});var i=r(23174),o=r.n(i),n=(r(67294),r(83355)),l=r(5366),s=r(52275),a=r(97820),p=r(69872),d=r(62045);class c extends n.Z{renderComponent(){const{device:e}=this.environment;if(e.isMobile)return this.props.propertySchema?o()(p.Z,{propertySchema:this.props.propertySchema,onClick:this.props.onClick,focused:!1,format:p.Z.DisplayFormat.Name,showExtensionArrow:!this.props.disabled}):o()(s.Z,{focused:!1,title:o()(l.FormattedMessage,{defaultMessage:"Property",id:"database.mobileFilterAndSortMenu.property.buttonMenuItem.label"})});{const e=this.props.propertySchema&&o()(a.Z,{propertySchema:this.props.propertySchema,showIcon:!0,style:{lineHeight:1.4}}),t=o()(l.FormattedMessage,{defaultMessage:"Property",id:"database.filterAndSortMenu.propertyButton.label"});return o()(d.Z,{title:e,placeholder:t,onClick:this.props.onClick,disabled:this.props.disabled,disableMargins:this.props.disableMargins,desktopStyle:this.props.textWrapperStyle})}}}c.displayName="QueryMenuPropertyItem";const h=c}}]);