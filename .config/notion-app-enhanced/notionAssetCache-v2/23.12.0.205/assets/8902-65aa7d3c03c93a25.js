"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8902],{78902:(e,t,r)=>{r.d(t,{Z:()=>oe});var s=r(10434),i=r.n(s),n=r(23174),a=r.n(n),o=r(67294),l=r(83355);const d=(0,r(45238).I)("sidebarTrash",{viewBox:"0 0 14 14",svg:a()("path",{d:"M13.5000308,3.23952 C13.5000308,4.55848168 11.9230308,12.0493 11.9230308,12.0782 C11.9230308,12.6571 9.73825083,14 7.04165083,14 C4.34504083,14 2.16025083,12.6571 2.16025083,12.0782 C2.16025083,12.0541 0.5,4.55799105 0.5,3.23952 C0.5,1.91780104 3.02713083,0 7.03525083,0 C11.0433308,0 13.5000308,1.9178004 13.5000308,3.23952 Z M7,2 C3.625,2 2.5,3.25 2.5,4 C2.5,4.75 3.625,6 7,6 C10.375,6 11.5,4.75 11.5,4 C11.5,3.25 10.375,2 7,2 Z"})});var h=r(5366),c=r(50906),u=r(42858),m=r(39699),p=r(98742),g=r(80444),b=r(11689),v=r(43339),f=r(64921),Z=r(31945),S=r(79954),T=r(14694),M=r(15145),C=r(1800),y=r(35840),k=r(37612),w=r(55863),P=r(21202),B=r(75018),F=r(31299),I=r(74647),x=r(39865),O=r(95477),R=r(43250),H=r(33929),D=r(87279),E=r(18514),N=r(88632),L=r(57559),_=r(72087),q=r(68894),U=r(68785),Y=r(78140),A=r(32163),G=r(43765),V=r(40721),W=r(89728),$=r(11470),K=r(77137),j=r(43145),z=r(72495),J=r(30506),Q=r(33411),X=r(26388),ee=r(83182),te=r(46247),re=r(66957);const se=(0,h.defineMessages)({filterByPlaceholder:{id:"sidebarTrash.filterBy.placeholder",defaultMessage:"Filter by page titleâ€¦"}});class ie extends l.Z{constructor(){super(...arguments),this.storeTypes={requestStore:_.Z},this.renderTrashPages=(e,t)=>{const{device:r}=this.environment,s=t?t.results:[],{mainEditorCurrentBlockStore:n}=g.default.state;if(!n)return;const l=s.map((e=>L.G.createChildStore(n,{table:P.iU,id:e}))).filter((e=>e.isDefined()&&!v.Z.state.excludePages.has(e.id))).map((e=>({key:e.id,action:t=>{let{event:s}=t;if("metaKey"in s&&s.metaKey){const t=(0,C.Z)({baseUrl:O.default.domainBaseUrl,pageId:e.id,pageVisitSource:M.tY.SidebarTrash});B.navigateToExternalURL({environment:this.environment,url:t})}else B.navigateToBlock({environment:this.environment,store:e,pageVisitSource:M.tY.SidebarTrash}),b.Z.setState({...b.Z.state,open:!1});r.isMobile&&I.close()},render:t=>o.createElement($.Z,i()({},t,{dontShrinkRight:!0,store:e,right:a()("div",{style:{display:"flex"}},void 0,a()(X.Z,{placement:X.Z.Placement.Bottom,renderTooltip:()=>a()(h.FormattedMessage,{defaultMessage:"Restore",id:"sidebarTrash.restorePageButton.tooltip"}),render:t=>o.createElement(W.Z,i()({isGray:!0,onClick:()=>this.handleRestoreClick(e)},t),(0,w.s)({width:18,height:18}))}),a()(X.Z,{placement:X.Z.Placement.Bottom,renderTooltip:()=>a()(h.FormattedMessage,{defaultMessage:"Delete permanently",id:"sidebarTrash.deletePagePermanentlyButton.tooltip"}),render:t=>o.createElement(W.Z,i()({isGray:!0,onClick:()=>this.handleDeleteClick(e)},t),(0,k.y)({width:18,height:18}))}))}))})));return 0===l.length?a()(z.Z,{},void 0,r.isMobile?a()(G.Z,{title:a()(h.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.mobileFilterBy.noMatchesPrompt"})}):a()("div",{style:{fontSize:14,color:this.theme.mediumTextColor,textAlign:"center"}},void 0,a()(h.FormattedMessage,{defaultMessage:"No matches found.",id:"sidebarTrash.filterBy.noMatchesPrompt"}))):a()(o.Fragment,{},void 0,a()(A.Z,{type:A.i.Vertical,initialFocus:void 0,sections:[{key:0,items:l,render:e=>o.createElement(z.Z,e)}]}),a()(Q.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>{if(e)return a()("div",{style:{height:44,display:"flex",flex:1,alignItems:"center",justifyContent:"center"}},void 0,a()(U.Z,{}))}}),a()(j.Z,{onChange:this.handleScrollOffsetChange}))},this.handleSwipeLeft=()=>{const e=ie.tabs.indexOf(v.Z.state.currentTab)+1,t=ie.tabs[e];void 0!==t&&this.changeTab(t)},this.handleSwipeRight=()=>{const e=ie.tabs.indexOf(v.Z.state.currentTab)-1,t=ie.tabs[e];void 0!==t&&this.changeTab(t)},this.handleTabChange=e=>{const t=ie.tabs[e];this.changeTab(t)},this.handleRestoreClick=e=>{const{currentSpaceStore:t}=g.default.state;t&&x.DV({environment:this.environment,block:e,spaceId:e.pointer.spaceId||t.id})},this.handleDeleteClick=e=>{x.Rn({environment:this.environment,blocks:[e]})},this.handleSearchInputChange=e=>{v.Z.setState({...v.Z.state,filter:e.target.value,limit:v.Z.startLimit})},this.handleClose=()=>{const{mobileNative:e}=this.environment,t=()=>{b.Z.setState({...b.Z.state,open:!1})};null!=e&&e.supportsNativeHomeOnPhone()?B.navigateToHomeTab(this.environment,t):t()},this.handleScrollOffsetChange=e=>{const{requestStore:t}=this.stores,{ready:r,loading:s,result:i}=t.state,n=i;e<=v.Z.loadMoreOffset&&n&&r&&!s&&!n.endOfResultsReached&&v.Z.setState({...v.Z.state,limit:v.Z.state.limit+v.Z.limitIncrement})},this.performSearchRequest=async e=>{const{currentSpaceStore:t,mainEditorCurrentBlockStore:r,currentUserStore:s}=g.default.state;if(!t||!r||!s)return;const{limit:i,filter:n,currentTab:a}=v.Z.state;let o,l;if("in_current_page"===a)if(r.isCollectionView()){if(!r.isDefined())return;const e=r.getCollectionPointer();if(!e)return;l=e.id}else l=r.id;else"last_edited_by_me"===a&&(o=s.id);return await F.bI({environment:this.environment,query:n,limit:i,ancestorId:l,spaceId:t.id,editedById:o})}}willMount(e){super.willMount(e),v.Z.setState({...v.Z.state,limit:v.Z.startLimit,excludePages:new Set})}willUnmount(){v.Z.setState({...v.Z.state,filter:""})}renderComponent(){const{mobileNative:e}=this.environment;return null!=e&&e.supportsNativeHomeOnPhone()?this.renderNativeHomeEnabledLayout():this.renderLayout()}renderLayout(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:D.og.Modal,title:a()(h.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:a()(V.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderHeaderWithTabs()}:{menuType:D.og.Popup,height:"50vh",width:414,header:this.renderHeaderWithTabs(),footer:this.renderFooter()},a()(J.Z,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>o.createElement(Y.Z,i()({},t,e,{className:R.TYv}),this.renderPages())})}renderNativeHomeEnabledLayout(){const e={menuType:D.og.Modal,title:a()(h.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrash.menu.header"}),left:this.renderMobileHelpButton(),right:a()(V.DoneMenuText,{}),onClickRight:this.handleClose,onCancel:this.handleClose,header:this.renderSearchInput()};return o.createElement(Y.Z,i()({},e,{className:R.TYv}),this.renderPages())}renderHeaderWithTabs(){const{device:e}=this.environment,t=v.Z.state.currentTab,r=ie.tabs.indexOf(t);return a()(o.Fragment,{},void 0,a()(re.Z,{tabs:[a()(h.FormattedMessage,{defaultMessage:"All pages",id:"sidebarTrash.allPages.tabHeader"},"allPages"),a()(h.FormattedMessage,{defaultMessage:"In current page",id:"sidebarTrash.inCurrentPage.tabHeader"},"currentPage"),a()(h.FormattedMessage,{defaultMessage:"Last edited by me",id:"sidebarTrash.lastEditedByMe.tabHeader"},"lastEditedByMe")],selectedIndex:r,onChange:this.handleTabChange}),a()("div",{style:{margin:e.isMobile?0:"10px 0"}},void 0,this.renderSearchInput()))}renderSearchInput(){const{device:e}=this.environment;return a()(q.ZP,{left:a()(Q.Z,{show:this.stores.requestStore.state.loading,showDelay:500,showHold:200,render:e=>e?a()(U.Z,{style:this.getSearchIconStyle()}):(0,y.R)(this.getSearchIconStyle())}),style:{...e.isAndroid&&{borderBottom:"none"}},showClearButton:!0,placeholder:H.default.formatMessage(se.filterByPlaceholder),focus:!e.isMobile||void 0,value:v.Z.state.filter,onChange:this.handleSearchInputChange})}renderFooter(){return a()(z.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,a()(ee.Z,{title:a()(h.FormattedMessage,{defaultMessage:"Learn about deleting and restoring pages",id:"sidebarTrash.learnMore.prompt"}),href:(0,E.UY)("guides.trash"),analyticsFrom:"trash"}))}renderMobileHelpButton(){return a()(te.Z,{href:(0,E.UY)("guides.trash"),analyticsFrom:"trash"})}renderPages(){if(!N.Z.state.online)return a()(z.Z,{},void 0,a()(G.Z,{title:a()(h.FormattedMessage,{defaultMessage:"Please go online to view the Trash.",id:"sidebarTrash.goOnline.prompt"})}));{const{filter:e,limit:t,currentTab:r}=v.Z.state,s=`${e}:${t}${r}`;return a()(K.Z,{requestStore:this.stores.requestStore,request:s,performRequest:this.performSearchRequest,render:this.renderTrashPages,debounce:F.vp})}}changeTab(e){v.Z.setState({...v.Z.state,currentTab:e,limit:v.Z.startLimit}),this.stores.requestStore.setState({...this.stores.requestStore.state,result:null}),c.vqh(this.environment,{tab:e})}getSearchIconStyle(){return{width:14,height:14,flexGrow:0,flexShrink:0,color:this.theme.regularIconColor}}}ie.displayName="SidebarTrash",ie.tabs=["all_pages","in_current_page","last_edited_by_me"];const ne=ie;class ae extends l.Z{constructor(){super(...arguments),this.renderOrigin=e=>{const{onClick:t,...r}=(0,p.Z)(e,{onClick:this.props.onClick,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave});return a()(S.Z,{store:this.clonedStore,canDropOnto:!0,onSelectableDrop:this.handleDrop,analyticsName:"sidebar_trash",shouldShowDropZone:!0},void 0,o.createElement(f.Z,i()({},r,{style:this.props.buttonStyle,onClick:t||this.handleClick,mobileFeedback:this.props.isMobile}),a()(T.Z,{left:this.renderIcon(),style:{...b.Z.state.open&&{background:this.theme.buttonHoveredBackground}},disableMobileBorder:!0},void 0,a()(h.FormattedMessage,{defaultMessage:"Trash",id:"sidebarTrashButton.text"}))))},this.renderSidebarTrash=()=>{const{currentSpaceStore:e}=g.default.state;if(e)return a()(ne,{spaceStore:e})},this.handleClick=e=>{v.Z.setState({...v.Z.state,currentTab:"all_pages"}),c.YFJ(this.environment)},this.handleDrop=e=>{const{droppedStores:t,duplicate:r}=e;r||m.createAndCommit({userAction:"SidebarTrashButton.handleDrop",environment:this.environment,perform:e=>{u.Cl({environment:this.environment,blocks:t,transaction:e})}})}}willMount(e){super.willMount(e),this.clonedStore=e.store.clone()}renderComponent(){const{device:e,mobileNative:t}=this.environment,r=(null==t?void 0:t.supportsNativeHomeOnPhone())||!1;return a()(Z.ZP,{popupType:e.isMobile?Z.Z4.SlideUp:Z.Z4.Popup,hidesMobileNativeBottomBar:r,preventSlideUpTransition:r,buttonPopupStore:b.Z,alignmentToOrigin:Z.vR.Start,placementToOrigin:Z.pO.Right,originGap:0,onClick:this.handleClick,isFullWidthOnMobile:!0,render:this.renderSidebarTrash,preventScaleTransition:!0,renderOrigin:this.renderOrigin})}renderIcon(){const{device:e}=this.environment,t=this.theme.mediumIconColor;return e.isMobile?d({fill:t,height:16}):d({fill:t,width:14})}}ae.displayName="SidebarTrashButton";const oe=ae}}]);